# Crypto

> å­¦ä¹ å¯†ç å­¦éœ€è¦äº†è§£ä¸€å®šçš„æ•°è®ºçŸ¥è¯†ï¼Œç‰¹åˆ«æ˜¯åˆç­‰æ•°è®ºä»¥åŠç¾¤ã€ç¯ã€åŸŸã€æ ¼ã€‚

å¯†ç å­¦ï¼ˆCryptographyï¼‰ä¸€èˆ¬å¯åˆ†ä¸º**å¤å…¸å¯†ç å­¦**å’Œ**ç°ä»£å¯†ç å­¦**ã€‚

å…¶ä¸­ï¼Œ**å¤å…¸å¯†ç å­¦**ï¼Œä½œä¸ºä¸€ç§å®ç”¨æ€§è‰ºæœ¯å­˜åœ¨ï¼Œå…¶ç¼–ç å’Œç ´è¯‘é€šå¸¸ä¾èµ–äºè®¾è®¡è€…å’Œæ•Œæ‰‹çš„åˆ›é€ åŠ›ä¸æŠ€å·§ï¼Œå¹¶æ²¡æœ‰å¯¹å¯†ç å­¦åŸä»¶è¿›è¡Œæ¸…æ™°çš„å®šä¹‰ã€‚å¤å…¸å¯†ç å­¦ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- å•è¡¨æ›¿æ¢åŠ å¯†ï¼ˆMonoalphabetic Cipherï¼‰
- å¤šè¡¨æ›¿æ¢åŠ å¯†ï¼ˆPolyalphabetic Cipherï¼‰
- å¥‡æ€ªæ€ªçš„åŠ å¯†æ–¹å¼

è€Œ**ç°ä»£å¯†ç å­¦**åˆ™èµ·æºäº 20 ä¸–çºªä¸­åæœŸå‡ºç°çš„å¤§é‡ç›¸å…³ç†è®ºï¼Œ1949 å¹´é¦™å†œï¼ˆC. E. Shannonï¼‰å‘è¡¨äº†é¢˜ä¸ºã€Šä¿å¯†ç³»ç»Ÿçš„é€šä¿¡ç†è®ºã€‹çš„ç»å…¸è®ºæ–‡æ ‡å¿—ç€ç°ä»£å¯†ç å­¦çš„å¼€å§‹ã€‚ç°ä»£å¯†ç å­¦ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

- å¯¹ç§°åŠ å¯†ï¼ˆSymmetric Cryptographyï¼‰ï¼Œä»¥ DESï¼ŒAESï¼ŒRC4 ä¸ºä»£è¡¨ã€‚
- éå¯¹ç§°åŠ å¯†ï¼ˆAsymmetric Cryptographyï¼‰ï¼Œä»¥ RSAï¼ŒElGamalï¼Œæ¤­åœ†æ›²çº¿åŠ å¯†ä¸ºä»£è¡¨ã€‚
- å“ˆå¸Œå‡½æ•°ï¼ˆHash Functionï¼‰ï¼Œä»¥ MD5ï¼ŒSHA-1ï¼ŒSHA-512 ç­‰ä¸ºä»£è¡¨ã€‚
- æ•°å­—ç­¾åï¼ˆDigital Signatureï¼‰ï¼Œä»¥ RSA ç­¾åï¼ŒElGamal ç­¾åï¼ŒDSA ç­¾åä¸ºä»£è¡¨ã€‚

å…¶ä¸­ï¼Œå¯¹ç§°åŠ å¯†ä½“åˆ¶ä¸»è¦åˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š
- åˆ†ç»„å¯†ç ï¼ˆBlock Cipherï¼‰ï¼Œåˆç§°ä¸ºå—å¯†ç ã€‚
- åºåˆ—å¯†ç ï¼ˆStream Cipherï¼‰ï¼Œåˆç§°ä¸ºæµå¯†ç ã€‚

# å¤å…¸å¯†ç 

> å„ç§å„æ ·çš„å¤å…¸å¯†ç (æä¾›æ€è·¯)
http://www.practicalcryptography.com/

#### æ›¿æ¢å¯†ç 
http://quipqiup.com/

#### XOR å¯†ç (å¼‚æˆ–å¯†ç )
https://www.dcode.fr/xor-cipher

#### ç»´å‰å°¼äºšå¯†ç 
* è§£å¯†å·¥å…·
    * https://www.mygeocachingprofile.com/codebreaker.vigenerecipher.aspx 

#### å¯†ç ç ´è§£å·¥å…·é›†

https://www.dcode.fr/tools-list#cryptography


#### latexæ•°å­¦ç¬¦å·
ç»™å‡ºä¸€å †latexæ•°å­¦ç¬¦å·ï¼Œç„¶åè¦æ±‚è§£flagã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒæŠŠæ•°å­¦ç¬¦å·è½¬æ¢ä¸ºlatexå…¬å¼çš„å½¢å¼ï¼Œç„¶åå–æ¯ä¸ªå…¬å¼çš„é¦–ä¸ªå­—ç¬¦å°±æ˜¯flagã€‚

* https://blog.csdn.net/anscor/article/details/80878285 latexæ•°å­¦ç¬¦å·
* http://detexify.kirelabs.org/classify.html latexæ‰‹å†™å…¬å¼è¯†åˆ«

#### Playfair
###### åŸç† 
Playfair å¯†ç ï¼ˆPlayfair cipher or Playfair squareï¼‰æ˜¯ä¸€ç§æ›¿æ¢å¯†ç ï¼Œ1854 å¹´ç”±è‹±å›½äººæŸ¥å°”æ–¯ Â· æƒ æ–¯é€šï¼ˆCharles Wheatstoneï¼‰å‘æ˜ï¼ŒåŸºæœ¬ç®—æ³•å¦‚ä¸‹ï¼š

1. é€‰å–ä¸€ä¸²è‹±æ–‡å­—æ¯ï¼Œé™¤å»é‡å¤å‡ºç°çš„å­—æ¯ï¼Œå°†å‰©ä¸‹çš„å­—æ¯é€ä¸ªé€ä¸ªåŠ å…¥ 5 Ã— 5 çš„çŸ©é˜µå†…ï¼Œå‰©ä¸‹çš„ç©ºé—´ç”±æœªåŠ å…¥çš„è‹±æ–‡å­—æ¯ä¾ a-z çš„é¡ºåºåŠ å…¥ã€‚æ³¨æ„ï¼Œå°† q å»é™¤ï¼Œæˆ–å°† i å’Œ j è§†ä½œåŒä¸€å­—ã€‚
2. å°†è¦åŠ å¯†çš„æ˜æ–‡åˆ†æˆä¸¤ä¸ªä¸€ç»„ã€‚è‹¥ç»„å†…çš„å­—æ¯ç›¸åŒï¼Œå°† Xï¼ˆæˆ– Qï¼‰åŠ åˆ°è¯¥ç»„çš„ç¬¬ä¸€ä¸ªå­—æ¯åï¼Œé‡æ–°åˆ†ç»„ã€‚è‹¥å‰©ä¸‹ä¸€ä¸ªå­—ï¼Œä¹ŸåŠ å…¥ X ã€‚
3. åœ¨æ¯ç»„ä¸­ï¼Œæ‰¾å‡ºä¸¤ä¸ªå­—æ¯åœ¨çŸ©é˜µä¸­çš„åœ°æ–¹ã€‚
    * è‹¥ä¸¤ä¸ªå­—æ¯ä¸åŒè¡Œä¹Ÿä¸åŒåˆ—ï¼Œåœ¨çŸ©é˜µä¸­æ‰¾å‡ºå¦å¤–ä¸¤ä¸ªå­—æ¯ï¼ˆç¬¬ä¸€ä¸ªå­—æ¯å¯¹åº”è¡Œä¼˜å…ˆï¼‰ï¼Œä½¿è¿™å››ä¸ªå­—æ¯æˆä¸ºä¸€ä¸ªé•¿æ–¹å½¢çš„å››ä¸ªè§’ã€‚
    * è‹¥ä¸¤ä¸ªå­—æ¯åŒè¡Œï¼Œå–è¿™ä¸¤ä¸ªå­—æ¯å³æ–¹çš„å­—æ¯ï¼ˆè‹¥å­—æ¯åœ¨æœ€å³æ–¹åˆ™å–æœ€å·¦æ–¹çš„å­—æ¯ï¼‰ã€‚
    * è‹¥ä¸¤ä¸ªå­—æ¯åŒåˆ—ï¼Œå–è¿™ä¸¤ä¸ªå­—æ¯ä¸‹æ–¹çš„å­—æ¯ï¼ˆè‹¥å­—æ¯åœ¨æœ€ä¸‹æ–¹åˆ™å–æœ€ä¸Šæ–¹çš„å­—æ¯ï¼‰ã€‚
    æ–°æ‰¾åˆ°çš„ä¸¤ä¸ªå­—æ¯å°±æ˜¯åŸæœ¬çš„ä¸¤ä¸ªå­—æ¯åŠ å¯†çš„ç»“æœã€‚

ä»¥ playfair example ä¸ºå¯†åŒ™ï¼Œå¾—

```
P L A Y F
I R E X M
B C D G H
K N O Q S
T U V W Z
```
è¦åŠ å¯†çš„è®¯æ¯ä¸º ```Hide the gold in the tree stump```

```HI DE TH EG OL DI NT HE TR EX ES TU MP```
å°±ä¼šå¾—åˆ°

```BM OD ZB XD NA BE KU DM UI XM MO UV IF```
>å·¥å…· 
CAP4

#### Polybius
###### åŸç† 
Polybius å¯†ç åˆç§°ä¸ºæ£‹ç›˜å¯†ç ï¼Œå…¶ä¸€èˆ¬æ˜¯å°†ç»™å®šçš„æ˜æ–‡åŠ å¯†ä¸ºä¸¤ä¸¤ç»„åˆçš„æ•°å­—ï¼Œå…¶å¸¸ç”¨å¯†ç è¡¨
```
1	2	3	4	5
1	A	B	C	D	E
2	F	G	H	I/J	K
3	L	M	N	O	P
4	Q	R	S	T	U
5	V	W	X	Y	Z
```
ä¸¾ä¸ªä¾‹å­ï¼Œæ˜æ–‡ HELLOï¼ŒåŠ å¯†åå°±æ˜¯ ```23 15 31 31 34```ã€‚

#### åŸ¹æ ¹å¯†ç 
ç‰¹ç‚¹ï¼š
* åªæœ‰ä¸¤ç§å­—ç¬¦
* æ¯ä¸€æ®µçš„é•¿åº¦ä¸º 5
* åŠ å¯†å†…å®¹ä¼šæœ‰ç‰¹æ®Šçš„å­—ä½“ä¹‹åˆ†ï¼Œäº¦æˆ–è€…å¤§å°å†™ä¹‹åˆ†ã€‚

#### æ …æ å¯†ç 
åŸç†ï¼šæ …æ å¯†ç æŠŠè¦åŠ å¯†çš„æ˜æ–‡åˆ†æˆ N ä¸ªä¸€ç»„ï¼Œç„¶åæŠŠæ¯ç»„çš„ç¬¬ 1 ä¸ªå­—è¿èµ·æ¥ï¼Œå½¢æˆä¸€æ®µæ— è§„å¾‹çš„è¯ã€‚
æœ¬è´¨ä¸Šå°±æ˜¯ç½®æ¢å¯†ç 

#### æ›²è·¯å¯†ç 
åŸç†æ›²è·¯å¯†ç ï¼ˆCurve Cipherï¼‰æ˜¯ä¸€ç§ç½®æ¢å¯†ç ï¼Œéœ€è¦äº‹å…ˆåŒæ–¹çº¦å®šå¯†é’¥ï¼ˆä¹Ÿå°±æ˜¯æ›²è·¯è·¯å¾„ï¼‰
![æ›²è·¯å¯†ç ](crypto/images/Curve_Cipher.PNG)

#### åˆ—ç§»ä½åŠ å¯†
æœ¬è´¨ä¸Šä¹Ÿæ˜¯ç½®æ¢å¯†ç 

#### 01248å¯†ç (äº‘å½±å¯†ç )
è¯¥å¯†ç åˆç§°ä¸ºäº‘å½±å¯†ç ï¼Œä½¿ç”¨ 0ï¼Œ1ï¼Œ2ï¼Œ4ï¼Œ8 å››ä¸ªæ•°å­—ï¼Œå…¶ä¸­ 0 ç”¨æ¥è¡¨ç¤ºé—´éš”ï¼Œå…¶ä»–æ•°å­—ä»¥åŠ æ³•å¯ä»¥è¡¨ç¤ºå‡º å¦‚ï¼š28=10ï¼Œ124=7ï¼Œ18=9ï¼Œå†ç”¨ 1->26 è¡¨ç¤º A->Zã€‚

#### JSFuck
JSFuck å¯ä»¥åªç”¨ 6 ä¸ªå­—ç¬¦ []()!+ æ¥ç¼–å†™ JavaScript ç¨‹åºã€‚
> å·¥å…· 
JSFuck åœ¨çº¿åŠ å¯†ç½‘ç«™ http://www.jsfuck.com/

#### BrainFuck
Brainfuckï¼Œæ˜¯ä¸€ç§æå°åŒ–çš„è®¡ç®—æœºè¯­è¨€
> å·¥å…·
https://www.splitbrain.org/services/ook

#### WINGDING
WINGDINGæ˜¯ä¸€ä¸ªå°†æ–‡æœ¬ç¬¦å·è½¬æ¢ä¸ºWingdingç¬¦å·çš„å·¥å…·ï¼ŒWingdingç¬¦å·æ˜¯"Unicode"ç¬¦å·ï¼Œå¯ä»¥è¿›è¡Œå¤åˆ¶ç²˜è´´ã€‚(è¿™é‡Œå…¶å®æ›´åƒmisc)ï¼Œå› ä¸ºæœ¬è´¨ä¸Šæ˜¯ç¼–ç çš„è½¬æ¢è€Œä¸æ˜¯å¯†ç ã€‚
ä¾‹å­ï¼š
```
â™â—â™‹â™‘â€â™ğŸ“ğŸ–®ğŸ–²ğŸ“‚â™â™âŒ›ğŸ–°â™ğŸ–®ğŸ“‚ğŸ–°ğŸ“‚ğŸ–°ğŸ–°â™ğŸ“ğŸ—ğŸ–®ğŸ–°â™ŒğŸ“‚â™ğŸ“â™‹ğŸ—â™Œâ™â™ğŸ–²â™â
è§£ç ï¼šflag{e0791ce68f718188c0378b1c0a3bdc9e}
```
> å·¥å…·
https://lingojam.com/WingDing


#### çŒªåœˆå¯†ç 
![çŒªåœˆå¯†ç ](crypto/images/pip_sty.PNG)
#### èˆåŠ¨çš„å°äººå¯†ç 
è¿™äº›å¯†ç æœ¬è´¨ä¸Šæ˜¯ä»¥ä¸€äº›ç¬¦å·ä»£æ›¿è‹±æ–‡å­—æ¯ï¼Œåªè¦æŠŠè‹±æ–‡å­—æ¯æ›¿æ¢ä¸Šå»å°±å¯è§£å¯†ï¼Œå®è´¨ä¸Šå¯ä»¥ä½¿ç”¨è¯é¢‘åˆ†æ

#### é”®ç›˜å¯†ç 
æ‰€è°“é”®ç›˜å¯†ç ï¼Œå°±æ˜¯é‡‡ç”¨æ‰‹æœºé”®ç›˜æˆ–è€…ç”µè„‘é”®ç›˜è¿›è¡ŒåŠ å¯†ã€‚
##### æ‰‹æœºé”®ç›˜å¯†ç 
æ‰‹æœºé”®ç›˜åŠ å¯†æ–¹å¼ï¼Œæ˜¯æ¯ä¸ªæ•°å­—é”®ä¸Šæœ‰ 3-4 ä¸ªå­—æ¯ï¼Œç”¨ä¸¤ä½æ•°å­—æ¥è¡¨ç¤ºå­—æ¯
##### ç”µè„‘é”®ç›˜æ£‹ç›˜
ç”µè„‘é”®ç›˜æ£‹ç›˜åŠ å¯†ï¼Œåˆ©ç”¨äº†ç”µè„‘çš„æ£‹ç›˜æ–¹é˜µ
##### ç”µè„‘é”®ç›˜åæ ‡
ç”µè„‘é”®ç›˜åæ ‡åŠ å¯†ï¼Œåˆ©ç”¨é”®ç›˜ä¸Šé¢çš„å­—æ¯è¡Œå’Œæ•°å­—è¡Œæ¥åŠ å¯†
##### ç”µè„‘é”®ç›˜ QWE
ç”µè„‘é”®ç›˜ QWE åŠ å¯†æ³•ï¼Œå°±æ˜¯ç”¨å­—æ¯è¡¨æ›¿æ¢é”®ç›˜ä¸Šé¢çš„æ’åˆ—é¡ºåº
##### é”®ç›˜å¸ƒå±€åŠ å¯†
ç®€å•åœ°è¯´å°±æ˜¯æ ¹æ®ç»™å®šçš„å­—ç¬¦åœ¨é”®ç›˜ä¸Šçš„æ ·å­æ¥è¿›è¡ŒåŠ å¯†ã€‚
> ä¾‹ï¼šå¯†æ–‡ï¼š```4esxcft5 rdcvgt 6tfc78uhg 098ukmnb```ã€‚è¯•ç€åœ¨é”®ç›˜ä¸ŠæŒ‰ç…§å­—æ¯é¡ºåºæç»˜ä¸€ä¸‹ï¼Œå¯å¾—åˆ° ```0ops``` å­—æ ·

### è§£é¢˜æŠ€å·§
1. å¦‚æœé‡åˆ°ä¸€æ®µæ— è„‘çš„å¯†æ–‡ç„¶åæ²¡æœ‰ä»»ä½•çš„æç¤ºï¼Œé‚£ä¹ˆè€ƒè™‘æ›¿æ¢å¯†ç ï¼Œä»£æ¢å¯†ç ï¼Œå“ˆå¸Œå‡½æ•°ï¼Œç›´æ¥ä¸Šç ´è§£ç½‘ç«™è¿›è¡Œç ´è§£ã€‚
2. ä¸€èˆ¬å¦‚æœæ˜¯å¤å…¸å¯†ç ï¼Œä¸€èˆ¬éƒ½ä¼šç»™å‡ºä¸€å®šçš„æç¤ºå‘Šè¯‰æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å“ªä¸€ç§å¤å…¸å¯†ç ã€‚
3. é‡åˆ°ç»™å®šçš„.pyæ–‡ä»¶çš„é¢˜ç›®ï¼Œé¦–å…ˆéœ€è¦åˆ†æå…¶ä¸»è¦è¿ç”¨çš„åŠ å¯†é€»è¾‘ï¼Œä¸å¤å…¸å¯†ç è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥æ˜¯ä¸€ç§æ–°æå‡ºçš„æ–¹æ¡ˆï¼Œä¸€èˆ¬éƒ½ä¼šç»™å‡ºè¶³å¤Ÿçš„ä¿¡æ¯ä½œä¸ºçªç ´å£ã€‚
4. åœ¨æœç´¢å…³é”®è¯çš„æ—¶å€™ï¼Œç›¸åŒä½¿ç”¨`common`è€Œä¸æ˜¯`same`


# ç°ä»£å¯†ç 

## å¯¹ç§°å¯†ç 

### æµå¯†ç 

#### ä¼ªéšæœºæ•°ç”Ÿæˆå™¨PRNG

##### éšæœºæ€§çš„ä¸¥æ ¼æ€§ 
* éšæœºæ€§ï¼šéšæœºæ•°åº”è¯¥ä¸å­˜åœ¨ç»Ÿè®¡å­¦åå·®ï¼Œæ˜¯å®Œå…¨æ‚ä¹±çš„æ•°åˆ—ã€‚
* ä¸å¯é¢„æµ‹æ€§ï¼šä¸èƒ½ä»è¿‡å»çš„åºåˆ—æ¨æµ‹å‡ºä¸‹ä¸€ä¸ªå‡ºç°çš„æ•°ã€‚
* ä¸å¯é‡ç°æ€§ï¼šé™¤éæ•°åˆ—ä¿å­˜ä¸‹æ¥ï¼Œå¦åˆ™ä¸èƒ½é‡ç°ç›¸åŒçš„æ•°åˆ—ã€‚




#### BBSç”Ÿæˆå™¨ (Blum-Blum-Shub)

> å…·ä½“ç®—æ³•è§ï¼šã€Šå¯†ç å­¦åŸç†ä¸å®è·µã€‹(ç¬¬ä¸‰ç‰ˆ) 8.3èŠ‚ï¼Œè¿™é‡Œä½œç®€è¦çš„å™è¿°

è®¾$p,q$æ˜¯æ»¡è¶³$p\equiv q\equiv 3\ mod\ 4$ çš„$k$æ¯”ç‰¹ç´ æ•°ã€‚$n=pq$ã€‚è®¾$s_0$æ˜¯æ¨¡$n$çš„äºŒæ¬¡å‰©ä½™ã€‚å¯¹äº$0\leq i\leq l-1$ï¼Œæœ‰$$s_{i+1} = s_i^2\ mod\ n$$ï¼Œå®šä¹‰$f(s_0) = (z_1,z_2,...,z_l)$ï¼Œå…¶ä¸­$z_i = s_i\ mod\ 2,\ \ 1\leq i\leq l$ã€‚è¿™æ ·ä¸€æ¥$f$å°±æ˜¯ä¸€ä¸ª$(k,l)$çš„BBSç”Ÿæˆå™¨ã€‚



#### ç å®‰å…¨ä¼ªéšæœºæ•°ç”Ÿæˆå™¨

* ä¾‹é¢˜ï¼šwoodman - Google CTF
```python
class SecurePrng(object):
    def __init__(self):
        # generate seed with 64 bits of entropy
        self.p = 4646704883L
        self.x = random.randint(0, self.p)
        self.y = random.randint(0, self.p)

    def next(self):
        self.x = (2 * self.x + 3) % self.p
        self.y = (3 * self.y + 9) % self.p
        return (self.x ^ self.y)
```
ç›®æ ‡æ˜¯è¦æ±‚å‡ºå‰100ä¸ªéšæœºæ•°ã€‚
å‰é¢å‡ ä¸ªéšæœºæ•°å¾ˆå®¹æ˜“å°±å¯ä»¥çŸ¥é“ï¼Œå‡è®¾æ˜¯sol1å’Œsol2ï¼Œå› æ­¤å¯ä»¥å†™å‡ºç›¸åº”çš„è¡¨è¾¾å¼ï¼Œç„¶åç”±äºç›¸ä¹˜çš„ç³»æ•°åªä¸º2å’Œ3ï¼Œå› æ­¤å®é™…ä¸Šæ±‚æ¨¡çš„æ—¶å€™æœ€å¤šåªä¼šå‡å»3ä¸ªpï¼Œå› æ­¤å¯ä»¥é€šè¿‡æšä¸¾å‡å»çš„pçš„æ•°é‡æ¥çŒœæµ‹x0å’Œy0çš„å€¼ã€‚è¿™é‡Œåªè¦æ‰¾å‡ºäº†ä¸¤ä¸ªæ˜æ–‡å°±å¯ä»¥æŠŠx0å’Œy0æ¢å¤å‡ºæ¥ã€‚

> é¦–å…ˆéœ€è¦æ¨¡æ‹Ÿxå’Œyæ¨¡pæ˜¯å‡å»pçš„ä¸ªæ•°kxï¼Œky

> å¯¹äºæ¯ä¸€ä¸ªå€™é€‰æ¯”ç‰¹ä¸²txï¼Œéƒ½æšä¸¾0å’Œ1è¡¨ç¤ºå½“å‰çš„ç¬¬i bitï¼Œè®°ä¸ºbiï¼›æŠŠæšä¸¾å‡ºçš„biæ·»åŠ åˆ°å€™é€‰æ¯”ç‰¹ä¸²çš„ç¬¬iä½ä¸­ã€‚ç„¶åæŠŠtxå’Œsol1è¿›è¡Œå¼‚æˆ–æ±‚å‡ºå¦ä¸€ä¸ªæ¯”ç‰¹ä¸²tyï¼Œå†æŠŠtxå’Œtyä»£å…¥éšæœºæ•°ç”Ÿæˆçš„å‡½æ•°ä¸­(æ¨¡på°±ä½¿ç”¨å‡å»kxå’Œkyè¡¨ç¤º)ï¼Œå¹¶æŠŠç»“æœè¿›è¡Œå¼‚æˆ–å¾—åˆ°guess2ï¼ŒæŠŠguess2çš„ä½iä½ä¸sol2çš„ä½iä½è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œé‚£ä¹ˆå°±æŠŠtxåŠ å…¥æ–°ä¸€è½®çš„å€™é€‰ï¼Œç¬¬iè½®ç»“æŸåï¼Œä½¿ç”¨æ–°ä¸€è½®çš„å€™é€‰è¦†ç›–ç¬¬iè½®çš„å€™é€‰ä½œä¸ºç¬¬i+1è½®å€™é€‰ã€‚

> ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰bitéƒ½é€‰æ‹©å®Œæ¯•ï¼Œè¿™æ ·ä¸€æ¥ç”¨æœ€åå‰©ä¸‹çš„å€™é€‰è¿›è¡Œæµ‹è¯•ï¼Œ


#### çº¿æ€§åŒä½™ç”Ÿæˆå™¨ LCG(linear congruential generator)

* https://en.wikipedia.org/wiki/Linear_congruential_generator

ç®€ä»‹ï¼šThe generator is defined by recurrence relation: $$ X_{n+1}=(aX_n+c)\ mod\ m$$å…¶ä¸­$X$æ˜¯ä¼ªéšæœºå€¼(pseudorandom values)ï¼Œå¹¶ä¸”
* $m,\ 0 < m$ the "modulus"æ¨¡æ•°
* $a,\ 0 < a < m$ the "multiplier"ä¹˜æ•°
* $c,\ 0\leq c < m$ the "increment"åŠ æ•°
* $X_0,\ 0\leq X_0 < m$ the "seed" ç§å­ã€‚

æ±‚è§£æ–¹æ¡ˆå‚è€ƒreferenceï¼šhttps://www.codercto.com/a/35743.html
ä¸»è¦æµç¨‹å‚è§`crypto/linear_congruential_generator.md`


#### åé¦ˆç§»ä½å¯„å­˜å™¨
![åé¦ˆç§»ä½å¯„å­˜å™¨](crypto/images/Feedback_shift_register.jpg)
* $a_0, a_1, ... , a_{n-1}$ä½åˆæ€
* F ä¸ºåé¦ˆå‡½æ•°æˆ–è€…åé¦ˆé€»è¾‘ã€‚å¦‚æœ F ä¸ºçº¿æ€§å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°å…¶ä¸ºçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨ï¼ˆLFSRï¼‰ï¼Œå¦åˆ™æˆ‘ä»¬ç§°å…¶ä¸ºéçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨ï¼ˆNFSRï¼‰ã€‚
* $a_{i+n} = F(a_i, a_{i+1},...,a_{i+n-1})$

##### çº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨ - LFSR

##### B-M ç®—æ³• (ä¸€ç§æ±‚è§£çº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨çš„ç®—æ³•)

##### pythonä¸­çš„ä¸€ä¸ªåº“`z3`
`z3`è¿™ä¸ªåº“ä¸»è¦ç”¨æ¥**è§£æ–¹ç¨‹ç»„**ï¼Œå®ƒå¾®è½¯å¼€å‘çš„ä¸€å¥—çº¦æŸæ±‚è§£å™¨ï¼Œå¯ä»¥ç®€å•çš„ç†è§£å®ƒæ˜¯è§£æ–¹ç¨‹ã€‚å…¶ä¼˜åŠ¿åœ¨äºå¯ä»¥æ±‚è§£æœ‰ä½è¿ç®—çš„æ–¹ç¨‹ç»„ã€‚å¦‚æœæ–¹ç¨‹æœ‰å¤šç»„è§£ï¼Œz3åªä¼šç»™å‡ºå…¶ä¸­çš„ä¸€ç»„è§£ã€‚

* å‚è€ƒé¢˜ç›®
    * TCTF 2019 Quals - zer0lfsr https://fireshellsecurity.team/0ctf-zer0lfsr/
    * TCTF 2021 - zer0lfsr-

åŸºæœ¬ç”¨æ³•ï¼š å‚è€ƒ https://www.jianshu.com/p/64d87659673a
`z3.simplify()`å‡½æ•°å¯ä»¥ç®€åŒ–z3è¡¨è¾¾å¼ä»è€ŒåŠ å¿«è¿ç®—é€Ÿåº¦ï¼Œä½†æ˜¯æœ‰å¯èƒ½å¯¼è‡´ç²¾åº¦ä¸¢å¤±ã€‚

* **å¦‚æœé¢˜ç›®ä¸­ç»™å‡ºå¤šå…ƒå¤šæ¬¡æ–¹ç¨‹ï¼Œå¯ä»¥æ‰¾å‡ºé¢å¤–çš„çº¦æŸæ¡ä»¶ï¼Œä»è€Œå¯ä»¥ç”¨z3æ±‚è§£ã€‚**

ä½¿ç”¨`z3`æ±‚è§£å‡ºçº¦æŸçš„å¤šé¡¹å¼ä¹‹åï¼Œéœ€è¦æŠŠç»“æœè½¬æ¢æˆ`python`ä¸­çš„ç±»å‹ï¼Œæ¯”å¦‚int,float,boolç­‰ç±»å‹ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹
(å‚è€ƒï¼šhttps://www.jb51.cc/python/186627.html å’Œ https://jingyan.baidu.com/article/48a420579c65f3e8242504b8.html)
> å¯¹äºå¸ƒå°”å€¼,å¯ä»¥ä½¿ç”¨å‡½æ•°is_trueå’Œis_false.æ•°å€¼å¯ä»¥æ˜¯æ•´æ•°,åˆç†æˆ–ä»£æ•°.æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°is_int_value,is_rational_valueå’Œis_algebraic_valueæ¥æµ‹è¯•æ¯ç§æƒ…å†µ.æ•´æ•°æƒ…å†µæ˜¯æœ€ç®€å•çš„,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–¹æ³•as_long()å°†Z3æ•´æ•°å€¼è½¬æ¢ä¸ºPython long.å¯¹äºæœ‰ç†å€¼,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–¹æ³•numerator()å’Œåˆ†æ¯()æ¥è·å–è¡¨ç¤ºåˆ†å­å’Œåˆ†æ¯çš„Z3æ•´æ•°.æ–¹æ³•numerator_as_long()å’Œdenominator_as_long()æ˜¯self.numerator().as_long()å’Œself.denominator().as_long()çš„å¿«æ·æ–¹å¼.æœ€å,ä»£æ•°æ•°å­—ç”¨äºè¡¨ç¤ºéç†æ€§æ•°å­—. AlgebraicNumRefç±»æœ‰ä¸€ä¸ªç§°ä¸ºçº¦(self,precision)çš„æ–¹æ³•.å®ƒè¿”å›ä¸€ä¸ªZ3æœ‰ç†æ•°,å®ƒä»¥ç²¾åº¦ä¸º1/10 ^çš„ç²¾åº¦é€¼è¿‘ä»£æ•°

```python
x,y,z = BitVecs('x y z', 8)
s = Solver()
s.add(x^y&z== 12)   # ç”¨addæ–¹æ³•æ·»åŠ çº¦æŸ
s.add(y&x>>3 == 3)
s.add(z^y==4)

s.check()   # æ±‚è§£
s.model()
[z = 19, y = 23, x = 31]
```
æ›´è¿›ä¸€æ­¥çš„ç†è§£ï¼šhttps://blog.csdn.net/s1054436218/article/details/78651075


#### éçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨
* éçº¿æ€§ç»„åˆç”Ÿæˆå™¨ï¼Œå¯¹å¤šä¸ª LFSR çš„è¾“å‡ºä½¿ç”¨ä¸€ä¸ªéçº¿æ€§ç»„åˆå‡½æ•°
* éçº¿æ€§æ»¤æ³¢ç”Ÿæˆå™¨ï¼Œå¯¹ä¸€ä¸ª LFSR çš„å†…å®¹ä½¿ç”¨ä¸€ä¸ªéçº¿æ€§ç»„åˆå‡½æ•°
* é’Ÿæ§ç”Ÿæˆå™¨ï¼Œä½¿ç”¨ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰LFSR çš„è¾“å‡ºæ¥æ§åˆ¶å¦ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰LFSR çš„æ—¶é’Ÿ
ä»£è¡¨ Geffe

#### `python`ä¸­çš„`random`åº“çš„é¢„æµ‹
pythonä¸­çš„randomåº“ä½¿ç”¨çš„æ˜¯**Mersenne Twister ç®—æ³•ä½œä¸ºæ ¸å¿ƒç”Ÿæˆå™¨**ã€‚

å‚è€ƒæ–‡çŒ®ï¼š
1. https://docs.python.org/zh-cn/3/library/random.html
2. https://en.wikipedia.org/wiki/Mersenne_Twister

> å…·ä½“çš„ç®—æ³•æµç¨‹è¿˜æ²¡æœ‰å®Œå…¨äº†è§£ï¼Œç›®å‰åªéœ€è¦çŸ¥é“æ€ä¹ˆå»ç ´è§£å³å¯ã€‚

å‚è€ƒï¼š`crypto/random_number_Mersenne_Twister_2021NahamconCTF_Dice_Roll`ä¸­çš„writeupã€‚
ç ´è§£ä»£ç è§`crypto/code/mersenne-twister-predictor-master.zip`ã€‚

#### `python`ä¸­çš„éšæœºæ•°ç”Ÿæˆ
åœ¨æ™®é€šçš„å·¥ç¨‹ä¸Šä½¿ç”¨`random`å‡½æ•°åº“å³å¯ï¼Œä½†æ˜¯å¦‚æœè¦è®¾è®¡å¯†ç æ–¹æ¡ˆï¼Œåˆ™éœ€è¦ç”¨åˆ°å¼ºéšæœºæ•°ç”Ÿæˆå™¨ã€‚ä¸€èˆ¬æ¥è¯´ä½¿ç”¨
* `os.urandom()`ï¼šå‡½æ•°è°ƒç”¨è®¡ç®—æœºåº•å±‚çš„æ¨¡å—ç”Ÿæˆéšæœºæ•°ï¼Œå¹¶ä¸”å®ƒä¼šä»è®¸å¤šä¸å¯é¢„æµ‹çš„æ¥æºä¸­æå–å…¶ç†µæºï¼Œæœ‰è¾ƒå¼ºçš„éšæœºæ€§ã€‚
* `secrets`ï¼šä¸€ä¸ªè¾ƒä¸ºé€šç”¨çš„å¼ºä¼ªéšæœºæ•°ç”Ÿæˆå™¨ã€‚

> ä¸€èˆ¬æ¥è¯´éœ€è¦ä»”ç»†è§‚å¯ŸLFSRï¼Œç„¶åçœ‹çœ‹æ˜¯å¦æœ‰ç‰¹æ®Šçš„æƒ…å†µï¼Œç„¶åçœ‹çœ‹èƒ½å¦ç”¨è¿™ç§ç‰¹æ®Šçš„æƒ…å†µæ¥è¿›è¡Œç ´è§£ã€‚ç„¶åçœ‹çœ‹æ˜¯å¦ä¸ºLFSRï¼Œå¦‚æœæ˜¯çš„è¯çœ‹çœ‹èƒ½ä¸èƒ½æ„é€ BMç®—æ³•çš„æ±‚è§£æ–¹å¼ï¼Œæˆ–è€…çœ‹çœ‹æœ‰æ²¡æœ‰è¿™ç§æƒ…å†µã€‚ç„¶åå…¶ä¸­è¦è€ƒè™‘æš´åŠ›ç ´è§£çš„å¯èƒ½ã€‚ç„¶åæœ‰æ—¶å€™ä¹Ÿèƒ½æƒ³ä¸€ä¸‹æ˜¯å¦èƒ½ç”¨`z3`å»æ±‚è§£ã€‚





### å—å¯†ç 
æ‰€è°“å—åŠ å¯†å°±æ˜¯æ¯æ¬¡åŠ å¯†ä¸€å—æ˜æ–‡ï¼Œå¸¸è§çš„åŠ å¯†ç®—æ³•æœ‰ï¼š
- IDEA åŠ å¯†
- DES åŠ å¯†
- AES åŠ å¯†
- ARX åŠ å¯†
- TEA åŠ å¯†
- Simon and Speck åŠ å¯†

è¿˜æœ‰è®¸å¤šå¯¹ç§°åŠ å¯†æ–¹æ¡ˆï¼Œè¿™é‡Œåªåˆ—å‡ºå¸¸è§çš„å‡ ç§ï¼Œæ¯ä¸€ç§æ–¹æ³•ç½‘ä¸Šèµ„æ–™éƒ½æ¯”è¾ƒå¤šï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾ã€‚

åœ¨åˆ†ç»„å¯†ç è®¾è®¡æ—¶ï¼Œä¸€èˆ¬å›ä½¿ç”¨**æ··æ·†(Sç›’ï¼Œä¹˜æ³•)ä¸æ‰©æ•£(çº¿æ€§å˜æ¢ï¼Œç½®æ¢ï¼Œç§»ä½)** ä¸¤å¤§ç­–ç•¥ã€‚

#### DES (Data Encryption Standard)

DES is developed in 1970s until 2000s after it was broken (in 22 hours and 15 minutes by distributed.net and the Electronic Frontier Foundation in January 1999). **Triple DES** is hence recommended by the NIST for future use.

DESæ˜¯ä¸€ä¸ª**16è½®**çš„Feistelå‹ç»“æ„å¯†ç ï¼Œå®ƒçš„**åˆ†ç»„é•¿åº¦ä¸º64æ¯”ç‰¹**ï¼Œç”¨ä¸€ä¸ª**56æ¯”ç‰¹çš„å¯†é’¥**æ¥åŠ å¯†ä¸€ä¸ª64æ¯”ç‰¹çš„æ˜æ–‡ä¸²ï¼Œè¾“å‡ºä¸€ä¸ª64æ¯”ç‰¹çš„å¯†æ–‡ä¸²ã€‚

* DESçš„åŸç†è§ã€Šå¯†ç å­¦åŸç†ä¸å®è·µ ç¬¬ä¸‰ç‰ˆã€‹3.5ç« ï¼Œä¸‹é¢ä»…ç»™å‡ºDESçš„è½®å‡½æ•°ï¼š
![DESä¸»è¦æµç¨‹](crypto/images/DES_main_process.png)
![DESçš„Få‡½æ•°](crypto/images/F_function_of_DES.PNG)

* å‚è€ƒSagemath9.2ä»£ç 
```python
# Sagemath9.2
from sage.crypto.block_cipher.des import DES
des = DES()
P = 0x01A1D6D039776742
K = 0x7CA110454A1A6E57
K2 = 0x133457799bbcdff1
K3 = 0x1f08260d1ac2465e
C1 = des.encrypt(plaintext=P, key=K)
C2 = des.encrypt(plaintext=C1, key=K2)
C3 = des.encrypt(plaintext=C2, key=K3)
print(C3.hex())
#9c0102317f7a6991

#Now decrypt back:
D3 = des.decrypt(ciphertext=C3, key=K3)
D2 = des.decrypt(ciphertext=D3, key=K2)
D1 = des.decrypt(ciphertext=D2, key=K)
print(D1.hex())
#1a1d6d039776742
```

##### 1. çº¿æ€§Sç›’
DESçš„Sç›’å¦‚æœæ˜¯çº¯çº¿æ€§çš„ï¼Œé‚£ä¹ˆåªè¦çŸ¥é“ä¸€ç»„æ˜å¯†æ–‡å¯¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ—å‡ºåœ¨$GF(2)$ä¸Šçš„çº¿æ€§æ–¹ç¨‹ç»„ï¼Œä»è€ŒæŠŠå¯†é’¥æ±‚è§£å‡ºæ¥ã€‚å¯ä»¥ä½¿ç”¨`python`çš„`z3`åº“åˆ—ä¸¾çº¿æ€§æ–¹ç¨‹ç»„ï¼Œç„¶åä½¿ç”¨Sagemathè¿›è¡Œæ±‚è§£ï¼Œå› ä¸º`z3`æ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„æ¯”è¾ƒæ…¢ã€‚

* å…·ä½“æµç¨‹
```python
from z3 import *

key_z3 = [BitVec(f'k_{i}', 1) for i in range(64)]
print(len(key_z3))
s = Solver()
msg = # 64 bit message
myc = encrypt_z3(msg, key_z3)
cc =  # 64 bit ciphertext
for i in range(64):
    print([z3.simplify(myc[i])],',')
```
æ–¹ç¨‹ç»„åˆ—ä¸¾å®Œæˆåï¼Œä½¿ç”¨Sagemathè¿›è¡Œæ±‚è§£

```python
# Sagemath 9.2
M = Matrix(GF(2), M)
v = vector(GF(2), v)
x = M.solve_right(v)
print(x)    # x is the key in bits
```

> å¦‚æœSç›’æ˜¯çº¿æ€§çš„ï¼Œé‚£ä¹ˆè¿™ç§æ”»å‡»æ–¹æ³•ä¹Ÿå¯ä»¥æ¨å¹¿åˆ°AESä¸­ã€‚


#### AES (Advanced Encryption Standard)

AES is a block cipher encryption standard approved by NIST in 2002 and developed by Vincent Rijmen and Joan Daemen.
**Block-size:** 128 bits
**Key-size:** 128, 192 and 256 bits with 10, 12 and 14 rounds respectively

ä¸»è¦æµç¨‹ï¼š![AESæµç¨‹](crypto/images/AES.PNG)

* é¢„è®¡ç®—ï¼šè½®å¯†é’¥ç”Ÿæˆï¼ŒSç›’çš„è®¡ç®—
* æ¯ä¸€è½®ä¸»è¦åŒ…å«å››ä¸ªè¿ç®—ï¼Œåˆ†åˆ«æ˜¯ï¼ˆè¿™é‡Œè¯´çš„ä¸å›¾çš„ä¸å¤ªä¸€è‡´ï¼Œä½†æ˜¯è¿ç®—æ˜¯ä¸€è‡´çš„ï¼‰
    1. è½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰
    2. å­—èŠ‚æ›¿æ¢ï¼ˆSubBytes / Sç›’ï¼‰
    3. è¡Œç§»ä½ï¼ˆShiftRowsï¼‰
    4. åˆ—æ··åˆï¼ˆMixColumnsï¼‰
* æœ€åä¸€è½®è¿ç®—çš„æ—¶å€™ä¸éœ€è¦è¿›è¡Œåˆ—æ··åˆ
* æœ€åä¸€è½®è¿ç®—ç»“æŸåï¼Œè¿˜éœ€è¦è¿›è¡Œä¸€æ¬¡è½®å¯†é’¥åŠ è¿ç®—


> å¸¸è§pythonå®ç°(è¿™ç§å®ç°AESæ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œåªèƒ½ç”¨ä½œåŠ å¯†å’Œè§£å¯†ï¼Œæ— æ³•æ·±å…¥è¿›è¡Œåˆ†æ)ï¼š
``` python 
# python3
from Crypto.Cipher import AES
import os
key = b'1234567890123456' #ç§˜é’¥
text = b'1234567890123456' #éœ€è¦åŠ å¯†çš„å†…å®¹
iv = os.urandom(16)   # åˆå§‹å‘é‡
model = AES.MODE_CBC #å®šä¹‰æ¨¡å¼
aes = AES.new(key, AES.MODE_CBC, iv=iv) #åˆ›å»ºä¸€ä¸ªaeså¯¹è±¡

en_text = aes.encrypt(text) #åŠ å¯†æ˜æ–‡
print(en_text)

aes2 = AES.new(key, AES.MODE_CBC, iv=iv)
de_text = aes2.decrypt(en_text) #è§£å¯†æ˜æ–‡
print(de_text)
```

> å¸¸è§sagemathå®ç°(è¿™é‡Œçš„å®ç°æ¶‰åŠåˆ°aesçš„æ¯ä¸€æ­¥ï¼Œè¿™é‡Œæ¯ä¸€æ­¥çš„è¿ç®—æ˜¯ä¸€ä¸ªé»‘ç›’ï¼Œå¦‚æœé¢˜ç›®ä¸­æœ‰è‡ªå·±å®šä¹‰çš„Sç›’ï¼Œè¡Œç§»ä½ï¼Œåˆ—æ··åˆè¿ç®—ï¼Œå°±éœ€è¦æ›´å…·ä½“çš„åˆ†æ)ã€‚Sagemathçš„AESçš„å®ç°ä¸»è¦ç”¨åˆ°äº†``RijndaelGF``è¿™ä¸ªç±»ã€‚

> Rijndael-GFæ˜¯AESå¯†ç çš„ä»£æ•°å®ç°ï¼Œå®ƒå¯»æ±‚æä¾›æ•´ä¸ªAESå¯†ç åŠå…¶å•ä¸ªç»„ä»¶çš„å®Œå…¨å¹¿ä¹‰ä»£æ•°è¡¨ç¤ºã€‚

* Sagemath9.2åŸºäº``Rijndael-GF``å®ç°çš„AESè§``crypto/code/AES_sage.sage``

##### AESç›¸å…³æ”»å‡»
* å·®åˆ†é”™è¯¯åˆ†æ(Differential Fault Analysis)åœ¨AESçš„ç¬¬å…«è½®æ·»åŠ 1ä¸ªbyteçš„é”™è¯¯ä¿¡æ¯ï¼Œåˆ™å¯ä»¥æ¢å¤å‡ºAESçš„å¯†é’¥ï¼Œè§``crypto/2021_CSISC/AES_2021_oddaes``ã€‚


#### TEAåŠ å¯†
TEAç®—æ³•ç”±å‰‘æ¡¥å¤§å­¦è®¡ç®—æœºå®éªŒå®¤çš„David Wheelerå’ŒRoger Needhamäº1994å¹´å‘æ˜ã€‚å®ƒæ˜¯ä¸€ç§åˆ†ç»„å¯†ç ç®—æ³•ï¼Œå…¶æ˜æ–‡å¯†æ–‡å—ä¸º64æ¯”ç‰¹ï¼Œå¯†é’¥é•¿åº¦ä¸º128æ¯”ç‰¹ã€‚TEAç®—æ³•åˆ©ç”¨ä¸æ–­å¢åŠ çš„Delta(é»„é‡‘åˆ†å‰²ç‡)å€¼ä½œä¸ºå˜åŒ–ï¼Œä½¿å¾—æ¯è½®çš„åŠ å¯†æ˜¯ä¸åŒï¼Œè¯¥åŠ å¯†ç®—æ³•çš„è¿­ä»£æ¬¡æ•°å¯ä»¥æ”¹å˜ï¼Œå»ºè®®çš„è¿­ä»£æ¬¡æ•°ä¸º32è½®ã€‚

å‚è€ƒèµ„æ–™ï¼š
* https://blog.csdn.net/gsls200808/article/details/48243019
* https://github.com/iweizime/StepChanger/wiki/%E8%85%BE%E8%AE%AFTEA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95

æœ€æ˜æ˜¾çš„æ˜¯`delta=0x9e3779b9`è¿™ä¸ªç‰¹æ®Šçš„è®¾å®šå—ï¼Œ**é‡åˆ°åŠ å¯†æˆ–è§£å¯†æ–‡ä»¶é‡Œé¢æœ‰ç‰¹æ®Šçš„å­—ç¬¦æ—¶ï¼Œç›´æ¥æœç´¢è¿™ä¸²å­—ç¬¦æœ‰å¾ˆå¤§æ¦‚ç‡èƒ½æ‰¾åˆ°ç›¸åº”çš„åŠ å¯†è§£å¯†ç®—æ³•**ã€‚
```python
def TEA_encryption(vs, ks):
    delta = 0x9E3779B9
    v0, v1 = map(uint32, unpack('>2I', vs))
    k0, k1, k2, k3 = map(uint32, unpack('>4I', ks))
    sm, delta = uint32(0), uint32(delta)

    for i in range(32):
        sm.value += delta.value
        v0.value += ((v1.value << 4) + k0.value) ^ (v1.value + sm.value) ^ ((v1.value >> 5) + k1.value)
        v1.value += ((v0.value << 4) + k2.value) ^ (v0.value + sm.value) ^ ((v0.value >> 5) + k3.value)

    return pack('>2I', v0.value, v1.value)


def TEA_decryption(vs, ks):
    delta = 0x9E3779B9
    v0, v1 = map(uint32, unpack('>2I', vs))
    k0, k1, k2, k3 = map(uint32, unpack('>4I', ks))
    sm, delta = uint32(delta * 32), uint32(delta)

    for i in range(32):
        v1.value -= ((v0.value << 4) + k2.value) ^ (v0.value + sm.value) ^ ((v0.value >> 5) + k3.value)
        v0.value -= ((v1.value << 4) + k0.value) ^ (v1.value + sm.value) ^ ((v1.value >> 5) + k1.value)
        sm.value -= delta.value

    return pack('>2I', v0.value, v1.value)
```

#### prince åŠ å¯†
åŒæ ·æ˜¯ä¸€ä¸ªåˆ†ç»„å¯†ç åŠ å¯†æ–¹æ¡ˆï¼Œä½¿ç”¨çš„æ˜¯å—åŠ å¯†çš„æ¨¡å¼ã€‚æ ‡å¿—æ€§å­—ç¬¦ä¸²ï¼š
```
ALPHA = BitArray("0xc0ac29b7c97c50dd")
BETA = BitArray("0x3f84d5b5b5470917")
```

æ­¤åŠ å¯†ç®—æ³•å­˜åœ¨integral attackã€‚ æ”»å‡»ä»£ç ï¼š https://github.com/de-ci-phe-red-LABS/PRINCE-under-Differential-Fault-Attack-Now-in-3D

ç®—æ³•ä»‹ç»å‚è€ƒï¼šhttps://en.wikipedia.org/wiki/Prince_(cipher)


#### åˆ†ç»„æ¨¡å¼
åˆ†ç»„åŠ å¯†ä¼šå°†æ˜æ–‡æ¶ˆæ¯åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„å—ï¼Œæ¯å—æ˜æ–‡åˆ†åˆ«åœ¨å¯†é’¥æ§åˆ¶ä¸‹åŠ å¯†ä¸ºå¯†æ–‡ã€‚å½“ç„¶å¹¶ä¸æ˜¯æ¯ä¸ªæ¶ˆæ¯éƒ½æ˜¯ç›¸åº”å—å¤§å°çš„æ•´æ•°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½éœ€è¦è¿›è¡Œå¡«å……ã€‚å¸¸è§çš„åˆ†ç»„æ¨¡å¼ï¼š
- **ECB**ï¼šå¯†ç æœ¬æ¨¡å¼ï¼ˆElectronic codebookï¼‰
    - è¿™ç§æ¨¡å¼æ˜¯å°†æ•´ä¸ªæ˜æ–‡åˆ†æˆè‹¥å¹²æ®µç›¸åŒçš„å°æ®µï¼Œç„¶åå¯¹æ¯ä¸€å°æ®µè¿›è¡ŒåŠ å¯†ã€‚
- **CBC**ï¼šå¯†ç åˆ†ç»„é“¾æ¥ï¼ˆCipher-block chainingï¼‰
    - è¿™ç§æ¨¡å¼æ˜¯å…ˆå°†æ˜æ–‡åˆ‡åˆ†æˆè‹¥å¹²å°æ®µï¼Œç„¶åæ¯ä¸€å°æ®µä¸åˆå§‹å—æˆ–è€…ä¸Šä¸€æ®µçš„å¯†æ–‡æ®µè¿›è¡Œå¼‚æˆ–è¿ç®—åï¼Œå†ä¸å¯†é’¥è¿›è¡ŒåŠ å¯†ã€‚
- **PCBC**ï¼šå¯†ç åˆ†ç»„é“¾æ¥ï¼ˆCipher-block chainingï¼‰
- **CFB**ï¼šå¯†æ–‡åé¦ˆæ¨¡å¼ï¼ˆCipher feedbackï¼‰
    - æ­¤æ¨¡å¼å°†ä¼šä»¥ä¸€ç§æµå¯†ç çš„å½¢å¼è¿›è¡Œï¼Œè¯¦ç»†è§ä¸‹é¢æè¿°ï¼š
    - CFBæ¨¡å¼éœ€è¦ä¸€ä¸ªæ•´æ•°å‚æ•°$s$ï¼Œä½¿$1\leq s\leq b$ã€‚åœ¨ä¸‹é¢çš„CFBæ¨¡å¼è§„èŒƒä¸­ï¼Œæ¯ä¸ªæ˜æ–‡æ®µ($P_j$)å’Œå¯†æ–‡æ®µ($C_j$)ç”±$s$ä½ç»„æˆã€‚$s$çš„å€¼æœ‰æ—¶è¢«åˆå¹¶åˆ°æ¨¡å¼çš„åç§°ä¸­ï¼Œä¾‹å¦‚ï¼Œ1ä½CFBæ¨¡å¼ã€8ä½CFBæ¨¡å¼ã€64ä½CFBæ¨¡å¼æˆ–128ä½CFBæ¨¡å¼ã€‚è¿ç®—å½¢å¼å¦‚ä¸‹ï¼š $$ \begin{array}{l}I_0 = IV. \\ I_i=((I_{i-1}\ll s) + C_i)\ mod\ 2^b, \\ C_i = MSB_s(E_K(I_{i-1}))\oplus P_i, \\ P_i = MSB_s(E_K(I_{i-1}))\oplus C_i \end{array}$$
    - `pycryptodome`ä¸­é»˜è®¤æ˜¯$s=8$ï¼Œæ˜¯å…¶ä¸­çš„`segment_size`å‚æ•°ã€‚

- **OFB**ï¼šè¾“å‡ºåé¦ˆæ¨¡å¼ï¼ˆOutput feedbackï¼‰
- **CTR**ï¼šè®¡æ•°å™¨æ¨¡å¼ï¼ˆCounter modeï¼‰

**æ³¨ï¼šECBæ¨¡å¼çš„AESæ˜¯ä¸å®‰å…¨çš„ã€‚å»ºè®®ä»”ç»†è¿›è¡Œç¡®è®¤ï¼Œç½‘ä¸Šæœ‰äº›å¡«å……æ¨¡å¼è¯´å¾—ä¸å¯¹ã€‚**

* å‚è€ƒï¼š https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation

* æœ‰æ—¶å€™ä¼šæŠŠåˆ†ç»„æ¨¡å¼ä½œä¸ºé¢˜ç›®ï¼Œæ­¤æ—¶æŠŠAESçœ‹æˆé»‘ç®±ï¼Œç„¶åæ ¹æ®æœ€åçš„ç»“æœã€æœ€åˆçš„ç»“æœå’Œå…è®¸æ‰§è¡Œçš„ä¸­é—´è¿‡ç¨‹æ„é€ å‡ºé¢˜ç›®æƒ³è¦çš„ç»“æœã€‚

#### å¡«å……æ–¹æ³•
ç›®å‰æœ‰ä¸å°‘çš„å¡«å……è§„åˆ™ã€‚å¸¸è§çš„å¡«å……è§„åˆ™ï¼š
- **pkcs5**ï¼šå¡«å……å­—èŠ‚æ•°ä¸å¡«å……å­—èŠ‚æ•°ç›¸åŒçš„å€¼
- **pkcs7**ï¼š(OneAndZeroes Padding)Pad with 0x80 followed by zero bytes
- **Pad with zeroes except make the last byte equal to the number of padding bytes** ç”¨é›¶å¡«å……ï¼Œå¹¶ä½¿æœ€åä¸€ä¸ªå­—èŠ‚ç­‰äºå¡«å……å­—èŠ‚çš„æ•°ç›®
- **null**ï¼šPad with zero charactersï¼ˆé›¶å¡«å……ï¼‰
- **Pad with spaces**ï¼šç©ºæ ¼å¡«å……


#### å—åŠ å¯†æ”»å‡»æ–¹æ³•
##### BitFlipping
è¿™æ˜¯ä¸€ç§å—åŠ å¯†çš„å¸¸ç”¨æ”»å‡»æ–¹æ³•ï¼Œç›®çš„æ˜¯æ„é€ ç›¸åº”çš„`iv`æˆ–è€…å¯†æ–‡ï¼Œä½¿å¾—é€šè¿‡é»‘ç›’è§£å¯†å¾—åˆ°çš„æ˜æ–‡æ˜¯æˆ‘ä»¬æƒ³æ„é€ å‡ºçš„æ˜æ–‡ã€‚é€‚åˆäºæ‰€æœ‰çš„å—åŠ å¯†ï¼Œåªè¦å‡ºç°å¯†æ–‡æˆ–`iv`å’ŒæŸäº›ä¸œè¥¿å¼‚æˆ–å¾—åˆ°æ˜æ–‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹å¯†æ–‡æˆ–è€…`iv`ä½¿å¾—åœ¨ä¸ç ´è§£é»‘ç›’(AESæˆ–å…¶å®ƒå—åŠ å¯†)çš„æƒ…å†µä¸‹ä¿®æ”¹æ˜æ–‡ï¼Œä½¿å¾—æ˜æ–‡å˜æˆæˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚

**é€‚ç”¨åˆ†ç»„æ¨¡å¼**ï¼šCBCï¼ŒCRTç­‰ã€‚
ä¾‹å­ï¼š
![CBC_BitFlipping](crypto/images/CBC_BitFlipping.png)


##### å·®åˆ†æ”»å‡»
å·®åˆ†æ”»å‡»ä¸€èˆ¬åº”ç”¨äºå—åŠ å¯†å‡½æ•°ä¸­éçº¿æ€§å‡½æ•°ï¼ˆæ¯”å¦‚è¯´sç›’æˆ–æŸäº›è½®å‡½æ•°ï¼‰è®¾è®¡ç¼ºé™·å¯¼è‡´å·®åˆ†ä¿¡æ¯è¾ƒä¸ºæ˜æ˜¾ï¼Œä»è€Œæ„é€ ç›¸åº”çš„è¾“å…¥å¯¹å¯†ç ç³»ç»Ÿè¿›è¡Œæ”»å‡»ã€‚ä¸€èˆ¬æ¥è¯´æ˜¯é€‰æ‹©æ˜æ–‡æ”»å‡»ã€‚

å·®åˆ†æ”»å‡»é€‚ç”¨è®¸å¤šå—åŠ å¯†ç³»ç»Ÿå¦‚DES, Blowfish, FEAL, and RC5

* AESçš„å·®åˆ†æ”»å‡»å¯è§å¯†ç å­¦è¯¾æœ¬
* å¯¹FEALçš„æ”»å‡»è§http://www.theamazingking.com/crypto-feal.php

å¯¹äºæ²¡æœ‰çº¿æ€§å˜æ¢ï¼ˆè¡Œç§»ä½ï¼Œåˆ—æ··åˆç­‰ï¼‰çš„å¯†ç æ–¹æ¡ˆæ”»å‡»ä¼šç›¸å¯¹ç®€å•ã€‚

æ”»å‡»æµç¨‹ï¼š
1. é¦–å…ˆå¯»æ‰¾éçº¿æ€§å‡½æ•°ä¸­æœ€æ˜æ˜¾çš„å·®åˆ†ä¿¡æ¯ã€‚ä»£ç ï¼š
    ```python
    def find_differential():
        for i in range(0x10000):
            diffs = {}
            for j in range(0x100):
                input1 = random.randint(0, 0xffff)
                input2 = input1 ^ i
                output1 = f(input1)
                output2 = f(input2)
                diff = output1 ^ output2
                if diff in diffs.keys():
                    diffs[diff] += 1
                else:
                    diffs[diff] = 1
            for k in diffs.keys():
                if diffs[k] >= 60:
                    print(hex(i)[2:], hex(k)[2:], diffs[k])
    ```
    è¿™é‡Œçš„få°±è¡¨ç¤ºéçº¿æ€§å‡½æ•°ï¼Œä»£ç æ‰¾å‡ºçš„æ˜¯è¾“å‡ºå·®åˆ†å¤§äºç­‰äº1/4çš„æ‰€æœ‰è¾“å…¥å·®åˆ†ã€‚
2. åœ¨æ²¡æœ‰çº¿æ€§å˜æ¢çš„æƒ…å†µä¸‹ï¼Œä»¥FEAL-4åŠ å¯†ä¸ºä¾‹ï¼Œå…¶åŠ å¯†è¿‡ç¨‹å¦‚ä¸‹ï¼š
    ![](crypto/images/crypto-feal2.jfif)
    åœ¨FEAL-4åŠ å¯†çš„è¿‡ç¨‹ä¸­ï¼Œè½®å‡½æ•°åœ¨å·®åˆ†è¾“å…¥ä¸º0x8080çš„æƒ…å†µä¸‹è¾“å‡ºå·®åˆ†ä¸€å®šä¸º0x400ã€‚å³å¯¹äºè½®å‡½æ•°$f$ï¼Œç»™å®šä¸¤ä¸ªè¾“å…¥$in_1$ï¼Œ$in_2$å…¶ä¸­ $in_1 = in_2 \oplus 0x8080$ï¼Œåˆ™å¿…æœ‰$f(in_1) = f(in_2) \oplus 0x400$ã€‚
3. æ¯ä¸€è½®åŠ å¯†åªæ˜¯ä¸€è¾¹çš„è¾“å…¥å¼‚æˆ–è½®å¯†é’¥åå†ç»è¿‡è½®å‡½æ•°få¾—åˆ°è¾“å‡ºã€‚æ”»å‡»ä»æœ€åä¸€è½®å¯†é’¥å¼€å§‹è¿›è¡Œæ”»å‡»ã€‚å…¶ä¸­æœ‰ä¸€ç‚¹å¾ˆé‡è¦çš„æ˜¯**éçº¿æ€§å‡½æ•°çš„è¾“å…¥çš„å·®åˆ†ä¸ç¡®å®šçš„æƒ…å†µä¸‹å’Œè¾“å‡ºçš„å·®åˆ†ä¸€èˆ¬æ˜¯å‡åŒ€åˆ†å¸ƒã€‚** å› æ­¤åœ¨æ”»å‡»æ˜¯æ—¶å€™å·²çŸ¥è½®å‡½æ•°fè¾“å‡ºï¼Œåœ¨è½®å¯†é’¥äº¤å°çš„æƒ…å†µæš´åŠ›ç ´è§£è½®å¯†é’¥æ¨¡æ‹Ÿè¾“å…¥ï¼Œå¦‚æœè½®å‡½æ•°fçš„æ¨¡æ‹Ÿçš„è¾“å…¥çš„ç»“æœçš„å·®åˆ†å’Œå·²çŸ¥è¾“å‡ºçš„å·®åˆ†ä¸€è‡´ï¼Œåˆ™å½“å‰è½®å¯†é’¥å°±æ˜¯ä¸€ä¸ªå€™é€‰å¯†é’¥ã€‚
4. å¾—åˆ°ä¸Šä¸€è½®çš„å€™é€‰å¯†é’¥å°±å¯ä»¥æ„é€ å½“å‰è¿™ä¸€è½®çš„è½®å‡½æ•°fçš„è¾“å‡ºï¼Œç„¶åå†æš´åŠ›æšä¸¾è½®å¯†é’¥è¿›è¡Œå½“å‰å¯†é’¥çš„ç ´è§£ã€‚ä»¥è¿™æ ·å°±èƒ½å¾—åˆ°ç¬¬äºŒè½®ä¹‹åçš„è½®å¯†é’¥ã€‚
5. ç¬¬ä¸€è½®çš„è½®å¯†é’¥å¯èƒ½æƒ…å†µæ¯”è¾ƒçš„å¤šï¼Œè€Œä¸”ä¹Ÿä¸ä¸€å®šéœ€è¦ç”¨åˆ°å·®åˆ†æ€§è´¨ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ”»å‡»ã€‚

ä¾‹é¢˜è§`crypto\2021_TianYiBei\2021_TianYiBei_MyCipher`








## éå¯¹ç§°å¯†ç 

![](crypto/images/RSA_theory.PNG)

## RSA
***TITLE:***

0. å®ç”¨å·¥å…·
1. åˆ†è§£å¤§æ•´æ•°N
2. åŸºæœ¬æ”»å‡»
3. å°è§£å¯†æŒ‡æ•°æ”»å‡»
4. å°å…¬é’¥æŒ‡æ•°æ”»å‡»(Coppersmith's Theorem)
5. é€‰æ‹©æ˜å¯†æ–‡æ”»å‡»
6. ä¾§ä¿¡é“æ”»å‡»
7. åŸºäºå…·ä½“RSAå®ç°çš„æ”»å‡»
8. å®ç”¨å·¥å…·

***RSA Reference***ï¼š
1.  Boneh D . **Twenty Years of Attacks on the RSA Cryptosystem**[J]. Notices of the Ams, 2002, 46.
2. D. Boneh and G. Durfee. **New results on cryptanalysis of low private exponent RSA**[J]. Preprint, 1998.
3. Howgrave-Graham N , Seifert J P . **Extending Wiener's Attack in the Presence of Many Decrypting Exponents**[M] Secure Networking â€” CQRE [Secure] â€™ 99. Springer Berlin Heidelberg, 1999.
4. Cao Z , Sha Q , Fan X . **Adleman-Manders-Miller Root Extraction Method Revisited**[J]. 2011.
5. Nagaraj S V . Cryptanalysis of RSA and its variants[M]. Computing Reviews, 2010, 51(7) http://index-of.es/Varios-2/Cryptanalysis%20of%20RSA%20and%20It's%20Variants.pdf

* ç¬¬5ä¸ªå‚è€ƒæ–‡çŒ®é›†æˆäº†å¤§éƒ¨åˆ†çš„RSAçš„æ”»å‡»ï¼Œéƒ½å¯ä»¥å½“ä½œå·¥å…·ä½¿ç”¨ã€‚

#### é›¶ã€å®ç”¨å·¥å…·
* RSAå·¥å…·é›†-openssl,rsatool,RsaCtfTool
å‚è€ƒï¼šhttps://www.jianshu.com/p/c945b0f0de0a
    * opensslå¯ä»¥å®ç°ï¼šç§˜é’¥è¯ä¹¦ç®¡ç†ã€å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ã€‚ä¸€èˆ¬æ¥è¯´Windowsæœ‰è‡ªå¸¦çš„ï¼ŒUbuntuä¸­aptå¯ä»¥æ–¹ä¾¿åœ°ä¸‹è½½ã€‚
    * æ ¹æ®ç»™å®šçš„ä¸¤ä¸ªç´ æ•°ï¼ˆpï¼Œqï¼‰æˆ–æ¨¡æ•°å’Œç§æœ‰æŒ‡æ•°ï¼ˆnï¼Œdï¼‰æ¥è®¡ç®—RSAï¼ˆpï¼Œqï¼Œnï¼Œdï¼Œeï¼‰å’ŒRSA-CRTï¼ˆdPï¼ŒdQï¼ŒqInvï¼‰å‚æ•°ã€‚ https://github.com/ius/rsatool
    * RsaCtfTool:RSAå¤šé‡æ”»å‡»å·¥å…·ï¼Œä»å¼±å…¬é’¥è§£å¯†æ•°æ®å¹¶å°è¯•æ¢å¤ç§é’¥é’ˆå¯¹ç»™å®šçš„å…¬é’¥è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ”»å‡»ã€‚ https://github.com/Ganapati/RsaCtfTool

* **Sagemath9.2**: Sageæ˜¯å…è´¹çš„ã€å¼€æºçš„æ•°å­¦è½¯ä»¶ï¼Œæ”¯æŒä»£æ•°ã€å‡ ä½•ã€æ•°è®ºã€å¯†ç å­¦ã€æ•°å€¼è®¡ç®—å’Œç›¸å…³é¢†åŸŸçš„ç ”ç©¶å’Œæ•™å­¦ã€‚Sageçš„å¼€å‘æ¨¡å¼å’ŒSageæœ¬èº«çš„æŠ€æœ¯éƒ½éå¸¸å¼ºè°ƒå¼€æ”¾æ€§ã€ç¤¾åŒºæ€§ã€åˆä½œæ€§å’Œåä½œæ€§ï¼šæˆ‘ä»¬åœ¨åˆ¶é€ æ±½è½¦ï¼Œè€Œä¸æ˜¯é‡æ–°å‘æ˜è½®å­ã€‚Sageçš„æ€»ä½“ç›®æ ‡æ˜¯ä¸ºMapleã€Mathematicaã€Magmaå’ŒMATLABåˆ›å»ºä¸€ä¸ªå¯è¡Œçš„ã€å…è´¹çš„ã€å¼€æºçš„æ›¿ä»£å“ã€‚
    * å…¥é—¨ä¸­æ–‡æ–‡æ¡£ï¼šhttps://www.osgeo.cn/sagemath/tutorial/index.html
    * Referenceï¼šhttps://doc.sagemath.org/html/en/reference/index.html
    * å®˜æ–¹ç½‘ç«™ï¼šhttps://www.sagemath.org/
    * ç®€å•ä½¿ç”¨ï¼šWindowsä¸ŠSagemathå®‰è£…å®Œæˆåï¼Œè¿è¡Œ``SageMath 9.2 Notebook``æ–‡ä»¶ï¼Œç„¶åä¼šæ‰“å¼€Jupyter Notebookï¼Œåœ¨é‡Œé¢è¿›è¡Œç¼–ç¨‹å³å¯ã€‚
    * SageMathå¸¸ç”¨å‡½æ•°ï¼šhttps://blog.csdn.net/weixin_44338712/article/details/105320810
    * å¸¸ç”¨å‡½æ•°åŠæ–‡æ¡£ï¼š
      * `discrete_log`:åœ¨`Modules`æ–‡æ¡£ä¸­ https://doc.sagemath.org/html/en/reference/groups/sage/groups/generic.html#sage.groups.generic.discrete_log
    * å¸¸è§ä½¿ç”¨æ–‡æ¡£ï¼šè§`crypto/Sagemath_Usage.md`

* Cryptoå¸¸ç”¨çš„pythonåº“
    * gmpy2 (pip ä¸€èˆ¬ä¸èƒ½ç›´æ¥å®‰è£…ï¼Œè¦åœ¨ç½‘ä¸Šä¸‹è½½.whlæ–‡ä»¶ç„¶åç”¨pipè¿›è¡Œå®‰è£…)
    * Crypto (å®‰è£…å‘½ä»¤``pip install pycryptodome``)

#### ä¸€ã€åˆ†è§£å¤§æ•´æ•°N
ç›®å‰æœ€å¿«çš„åˆ†è§£å¤§æ•´æ•°Nçš„æ–¹æ³•æ˜¯å¹¿ä¹‰æ•°åŸŸç­›æ³•(General Number Field Sieve)ã€‚å¯¹äºn-bitçš„æ•´æ•°ï¼Œæ—¶é—´ä¸º$O(exp((c+o(1))n^{\frac{1}{3}}log^{\frac{2}{3}}n))$

å¦ä¸€ç§åˆ†è§£å¤§æ•´æ•°çš„æ–¹æ³•ï¼šå·²çŸ¥ç§é’¥$d$ï¼Œå’Œå…¬é’¥$e$ï¼Œåˆ™å¯å¿«é€Ÿå¯¹$N$è¿›è¡Œåˆ†è§£ã€‚åä¹‹äº¦ç„¶ï¼Œå³å·²çŸ¥$N$çš„åˆ†è§£$N=pq$ï¼Œåˆ™å¯ä»¥å¿«é€Ÿæ¢å¤å‡º$d$ã€‚

* å¸¸è§å¤§æ•´æ•°$N$åˆ†è§£å·¥å…·ï¼š
    * yafu (p,qç›¸å·®è¿‡å¤§æˆ–è¿‡å°yafuå¯åˆ†è§£æˆåŠŸ)ï¼Œä¸€èˆ¬æ¥è¯´åœ¨300bitä»¥ä¸‹çš„$N$éƒ½èƒ½åœ¨1å°æ—¶å†…åˆ†è§£
    * http://www.factordb.com

##### 1.1 å·²çŸ¥ $(N, e, d)$ æ±‚ $(p, q)$ V1
* æ”»å‡»æ¡ä»¶ï¼Œ$e$æˆ–$d$è¶³å¤Ÿå°
* æ”»å‡»åŸç†ï¼š$ed-1=k\varphi(N)$ã€‚å› ä¸º$e$æˆ–$d$æ¯”è¾ƒå°ï¼Œç„¶å$\varphi(N)$ä¸$N$æ¯”è¾ƒæ¥è¿‘ï¼Œå› æ­¤çˆ†ç ´$k$ï¼Œä»è€Œæ‰¾åˆ°$\varphi(N)$ã€‚**ä½†æ˜¯å®é™…ä¸Šæ±‚è§£$\varphi(N)$æ˜¯éå¸¸å›°éš¾çš„ï¼Œåªæœ‰å°‘æ•°ç‰¹æ®Šæƒ…å†µèƒ½æ±‚è§£**ã€‚ç„¶åç”±$$N=pq \newline \varphi(N)=(p-1)(q-1)$$å¾—$$N-\varphi(N)+1=p+q$$æ¥ä¸‹æ¥æ„é€ æ–¹ç¨‹$$x^2-(N-\varphi(N)+1)x+N=(x-p)(x-q)=0 \tag{1.1}$$åªéœ€è¦è§£æ–¹ç¨‹$(1.1)$å°±å¯ä»¥æŠŠ$p$å’Œ$q$è§£å‡ºæ¥ã€‚

* ä»£ç å‚è€ƒ https://blog.csdn.net/ayang1986/article/details/112714749
* ***å…·ä½“python2ä»£ç è§``crypto/code/Known_ed_factor_N_V1.py``*** 
**æ³¨æ„ï¼šä»£ç ä¸­é‚£ç§çˆ†ç ´$k$æ±‚è§£å‡º$\varphi(N)$çš„æ–¹æ³•å®é™…ä¸Šéœ€è¦$e$æˆ–$d$éå¸¸çš„å°ï¼Œè€Œä¸”è¶³å¤Ÿå°äº†ä¹Ÿä¸ä¸€å®šèƒ½ç”¨ä¸Šã€‚å› æ­¤è¿™é‡Œæœ€å¥½ä»…ä»…æ˜¯ä½œä¸ºä¸€ç§å·²çŸ¥$\varphi(N)$æ±‚è§£$p,q$çš„æ–¹æ¡ˆã€‚**

##### 1.2 å·²çŸ¥ $(N, e, d)$ æ±‚ $(p, q)$ V2
* æ²¡æœ‰æ”»å‡»æ¡ä»¶çš„é™åˆ¶
* åˆ†è§£åŸç†ï¼š
![](crypto/images/RSA_Factor_N.PNG)

å‚è€ƒä¹¦ç±ï¼š**å¯†ç å­¦åŸç†ä¸å®è·µ(ç¬¬ä¸‰ç‰ˆ)** ä½œè€…ï¼š**å†¯ç™»å›½**
* å…³é”®å®šç†ï¼š
**å®šç†1.2.1ï¼š** å‡å®š$p$ä¸ºä¸€ä¸ªå¥‡ç´ æ•°ï¼Œ$a$ä¸ºä¸€ä¸ªæ­£æ•´æ•°,$x$ä¸ºä¸€ä¸ªæ•°ï¼Œä¸”$gcd(x,p)=1$ã€‚é‚£ä¹ˆåŒä½™æ–¹ç¨‹$y^2\equiv x(mod\ p^a)$å½“$(\frac{a}{p})=-1$æ—¶æ²¡æœ‰è§£ï¼Œå½“$(\frac{a}{p})=1$æ—¶æœ‰ä¸¤ä¸ªè§£$(mod\ p^a)$ã€‚
**å®šç†1.2.2ï¼š** å‡å®š$n>1$æ—¶ä¸€ä¸ªå¥‡æ•°ï¼Œä¸”æœ‰å¦‚ä¸‹åˆ†è§£$$n=\prod_{i=1}^{l}p_i^{a_i}$$å…¶ä¸­$p_i$ä¸ºä¸åŒçš„ç´ æ•°ï¼Œä¸”$a_i$ä¸ºæ­£æ•´æ•°ã€‚è¿›ä¸€æ­¥å‡å®š$gcd(x,n)=1$ã€‚é‚£ä¹ˆåŒäºæ–¹ç¨‹$y^2\equiv x(mod\ n)$å½“$(\frac{a}{p_i})=1$å¯¹äºæ‰€æœ‰çš„$i\in\{1,...,l\}$æˆç«‹æ—¶æœ‰$2^l$ä¸ªæ¨¡$n$çš„è§£ï¼Œå…¶å®ƒæƒ…å†µæ— è§£ã€‚

ç”±å®šç†1.2.2å¯çŸ¥ï¼Œ$N=pq$å¯¹äºæ–¹ç¨‹$x^2\equiv 1\ mod\ N$æœ‰4ä¸ªè§£ã€‚å±•å¼€å¯å¾—$$x\equiv\pm1\ mod\ p \newline x\equiv\pm1\ mod\ q$$å…¶ä¸­$\pm1\ mod\ N$ä¸ºå¹³å‡¡å¹³æ–¹æ ¹ã€‚å¦å¤–ä¸¤ä¸ªæ ¹ç§°ä¸ºéå¹³å‡¡å¹³æ–¹æ ¹ã€‚è€Œå¯¹äºéå¹³å‡¡å¹³æ–¹æ ¹ï¼Œæ˜¯ç”±$$x\equiv1\ mod\ p \newline x\equiv-1\ mod\ q$$å’Œ$$x\equiv-1\ mod\ p \newline x\equiv1\ mod\ q$$æ‰€ç”Ÿæˆçš„ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬æ‰¾åˆ°äº†$1\ mod\ N$çš„éå¹³å‡¡å¹³æ–¹æ ¹$x$ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¡ç®—$gcd(x+1,N)$å’Œ$gcd(x-1,N)$æ¥åˆ†è§£$N$ã€‚å› ä¸ºéå¹³å‡¡å¹³æ–¹æ ¹æ»¡è¶³$x\equiv\pm1\ mod\ p$ã€‚ç„¶åé€šè¿‡ä¸‹æ–¹ä»£ç æ˜¯ç®—æ³•èƒ½å¤Ÿä»¥$\frac{1}{2}$çš„æ¦‚ç‡åˆ†è§£$N$ã€‚å…·ä½“è¯æ˜è¿‡ç¨‹è§å‚è€ƒä¹¦ç±ä¸­çš„P159~P161ã€‚æˆ–è€…å‚è€ƒï¼šhttps://www.cnblogs.com/jcchan/p/8430904.html

* ä»£ç å‚è€ƒ https://blog.csdn.net/ayang1986/article/details/112714749
* ***å…·ä½“python2ä»£ç è§``crypto/code/Known_ed_factor_N_V2.py``***
* å¿«é€Ÿçš„åšæ³•
    ```python
    RSA.construct(x.n, x.e, x.d)    # å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥åˆ†è§£nå¾—åˆ°på’Œq
    ```

##### 1.3 Pollard $p-1$
* æ”»å‡»å‰æï¼š$p-1$æˆ–è€…$q-1$åªæœ‰å°çš„ç´ å› å­ï¼Œå‡è®¾å…¶ç´ å› å­éƒ½ä¸å¤§äº$B$ã€‚
* æ”»å‡»åŸç†ï¼šè¿™ç§æƒ…å†µä¸‹å¿…ç„¶æœ‰  $$(p-1)|B!$$  å› æ­¤æœ‰$2^{p-1} | 2^{B!}$ã€‚ ä»¤$a=2$ï¼Œ å› ä¸º$a^{p-1}\equiv 1\ mod\ p$ï¼Œ å› æ­¤æœ‰$a^{B!}\equiv 1\ mod\ n$ã€‚åˆ™æœ‰$$2^{B!}-1 = kp,$$å› æ­¤åªè¦è®¡ç®—$gcd(2^{B!}-1, n) = p$ã€‚

##### 1.4 William $p+1$
æ”»å‡»æ¡ä»¶ä¸1.3èŠ‚çš„ç›¸åŒè¿™é‡Œç›´æ¥ç»™å‡ºä»£ç ã€‚
* ä»£ç å‚è€ƒ https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/
* ***å…·ä½“python2ä»£ç è§``crypto/code/William_p_plus_1.py``*** 

**ç†è®ºä¸Š1.3å’Œ1.4èŠ‚çš„æ•´æ•°çš„åˆ†è§£ä½¿ç”¨å¤§æ•°åˆ†è§£å·¥å…·éƒ½èƒ½è¿›è¡Œåˆ†è§£ã€‚**

##### 1.5 Batch GCD
åœ¨å¾—çŸ¥ **æˆåƒä¸Šä¸‡å¯¹rsaçš„å…¬é’¥$N$** çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°æŸäº›ç§é’¥$p,q$ç›¸åŒçš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨gcdæ¥æ±‚å‡ºç§é’¥$N$ã€‚ä½†æ˜¯ç›´æ¥å¯¹ä¸¤ä¸¤çš„$N$æ±‚æœ€å¤§å…¬çº¦æ•°ä¼šéå¸¸çš„è€—æ—¶ã€‚å› æ­¤ä½¿ç”¨Batch GCDçš„æ–¹æ³•å¯ä»¥å¿«é€Ÿæ±‚å‡ºæ¯ä¸ª$N$å…³äºå…¶å®ƒæ‰€æœ‰$N$çš„å…¬çº¦æ•°ï¼Œå³å¯ä»¥æ±‚å‡º      $$\exists i, gcd(N_0,N_i)\neq 0$$ å‚è€ƒï¼š
* https://github.com/therealmik/batchgcd
* https://protonmail.com/blog/batch-gcd/
* https://facthacks.cr.yp.to/batchgcd.html
* https://windowsontheory.org/2012/05/15/979/

ä¾‹é¢˜è§`crypto\2021_RCTF\2021_RCTF_Uncommon_Factors_I`


##### 1.6 å·²çŸ¥$(N,p,q,m,c)$ æ±‚ $d$
æœ¬è´¨ä¸Šæ˜¯æ±‚è§£ç¦»æ•£å¯¹æ•°é—®é¢˜ã€‚ä½¿ç”¨Pohlig-Hellmanæ–¹æ³•æ±‚å‡º$dp$å’Œ$dq$ï¼Œç„¶åå˜æˆ2.5èŠ‚ä¸­çš„å·²çŸ¥$dp,dq$ç”¨ä¸­å›½å‰©ä½™å®šç†æ±‚å‡º$d$ã€‚

è¿™é‡Œå…¶ä¸­ä¸€ä¸ªéš¾ç‚¹åœ¨äºå½“$p,q$æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œ$p-1$å’Œ$q-1$å°†ä¼šæœ‰æ¯”è¾ƒå¤§çš„ç´ å› å­$p_i$ï¼Œæ­¤æ—¶è¦æ±‚$g^{d\ mod\ p_i}\ mod\ p$ä¸€èˆ¬æ¥è¯´ä¼šç”¨Pollard rhoè¿™äº›$O(\sqrt{p_i})$çš„ç®—æ³•ã€‚ä½†æ˜¯æ­¤æ—¶ä¼šæ±‚ä¸å‡ºæ¥ã€‚

è¿™é‡Œå¯ä»¥ä½¿ç”¨ç¦»æ•£å¯¹æ•°çš„æ•°åŸŸç­›(Number Field Sieve)ç®—æ³•ï¼Œè§ç¦»æ•£å¯¹æ•°æ•°åŸŸç­›ç®—æ³•ã€‚

å‚è€ƒé¢˜ç›®ï¼šhttps://zhuanlan.zhihu.com/p/428567414



#### äºŒã€åŸºæœ¬æ”»å‡»
##### 2.1. Nä¸äº’ç´ 
ç»™å®šä¸¤ä¸ªN1ï¼ŒN2ï¼Œè‹¥ä¸äº’ç´ ï¼Œåˆ™å…¶gcd(N1,N2)å°±æ˜¯å…¶ä¸­ä¸€ä¸ªpæˆ–qã€‚å› æ­¤ç›´æ¥è¢«ç ´è§£ã€‚

##### 2.2 å…±æ¨¡æ”»å‡»(Common Modules)
å½“ä¸¤ä¸ªç”¨æˆ·ä½¿ç”¨ç›¸åŒçš„æ¨¡æ•° Nã€ä¸åŒçš„ç§é’¥æ—¶ï¼ŒåŠ å¯†åŒä¸€æ˜æ–‡æ¶ˆæ¯Mï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨æ­¤æ”»å‡»ã€‚
è®¾ä¸¤ä¸ªç”¨æˆ·çš„å…¬é’¥åˆ†åˆ«ä¸º$e_1$å’Œ$e_2$ï¼Œä¸”ä¸¤è€…äº’è´¨ã€‚æ˜æ–‡æ¶ˆæ¯ä¸º$m$ï¼Œå¯†æ–‡åˆ†åˆ«ä¸º
$$
c_1 = m^{e_1}\ mod \ N \newline 
c_2 = m^{e_2}\ mod \ N
$$
æˆªè·$c_1å’Œc_2$åï¼Œè®¡ç®—$re_1+se_2=1\ mod \ n$ä¸­çš„$r$å’Œ$s$ï¼Œåˆ™$m^{re_1+se_2}\ mod\ n\equiv m\ mod\ n$

##### 2.3 ç›²åŒ–æ”»å‡»(Blinding)
Bobæœ‰ç§é’¥<N,d>ï¼Œå…¬é’¥<N,e>ã€‚æ•Œæ‰‹Aliceæƒ³è¦Bobå¯¹Mè¿›è¡Œç­¾åï¼Œä½†æ˜¯Bobä¸ä¼šå¯¹Mç­¾åã€‚äºæ˜¯Aliceè®¡ç®—$M'=r^eM\ mod\ N$ã€‚ç„¶åBobå°±ä¼šå¯¹M'è¿›è¡Œç­¾åå¾—åˆ°S'ï¼Œåˆ™æœ‰$$S'=r^{ed}M^d\ mod\ N = rM^d\ mod\ N$$å› æ­¤$$S=S'/r\ mod\ N=M^d\ mod\ N$$ã€‚

##### 2.4 å·²çŸ¥$dp\equiv d\ mod\ (p-1)$
å·²çŸ¥$$d_p\equiv d\ mod\ (p-1)\newline ed\equiv 1\ mod\ (p-1)(q-1)$$æœ‰$$d_p=k(p-1)+d \newline ed=k'(p-1)(q-1)+1$$åˆ™æœ‰$$ed_p-1=(p-1)(ek+k'(q-1))$$å› ä¸º$$0\leq ed_p-1\leq ep$$å› æ­¤$$0\leq (p-1)(ek+k'(q-1))\leq ep \newline 0\leq (ek+k'(q-1))\leq e+1$$å› æ­¤éå†$i\in[0,e]$è‹¥å‘ç°$N$èƒ½è¢«$(ed_p-1)/i+1$æ•´é™¤ï¼Œåˆ™$p=(ed_p-1)/i+1$ã€‚

å‚è€ƒä¾‹å­ï¼š
```python
e= 65537
n = 9637571466652899741848142654451413405801976834328667418509217149503238513830870985353918314633160277580591819016181785300521866901536670666234046521697590230079161867282389124998093526637796571100147052430445089605759722456767679930869250538932528092292071024877213105462554819256136145385237821098127348787416199401770954567019811050508888349297579329222552491826770225583983899834347983888473219771888063393354348613119521862989609112706536794212028369088219375364362615622092005578099889045473175051574207130932430162265994221914833343534531743589037146933738549770365029230545884239551015472122598634133661853901
c = 5971372776574706905158546698157178098706187597204981662036310534369575915776950962893790809274833462545672702278129839887482283641996814437707885716134279091994238891294614019371247451378504745748882207694219990495603397913371579808848136183106703158532870472345648247817132700604598385677497138485776569096958910782582696229046024695529762572289705021673895852985396416704278321332667281973074372362761992335826576550161390158761314769544548809326036026461123102509831887999493584436939086255411387879202594399181211724444617225689922628790388129032022982596393215038044861544602046137258904612792518629229736324827
dp = 81339405704902517676022188908547543689627829453799865550091494842725439570571310071337729038516525539158092247771184675844795891671744082925462138427070614848951224652874430072917346702280925974595608822751382808802457160317381440319175601623719969138918927272712366710634393379149593082774688540571485214097
for i in range(1,e+1):
    if (dp*e-1)%i == 0:
        if n%(((dp*e-1)/i)+1)==0:
            p=((dp*e-1)/i)+1
            q=n/(((dp*e-1)/i)+1)
            phi = (p-1)*(q-1)
            d = gmpy2.invert(e,phi)%phi
            m = pow(c,d,n)
            print(long_to_bytes(m))
```

##### 2.5 å·²çŸ¥$N,e,dp,dq,p,q$çš„RSAå¿«é€Ÿè§£å¯†

* åœ¨RSAä¸­$dp,dq$è¢«ç§°ä¸º â€œprivate CRT-exponentsâ€ï¼Œåœ¨æœè®ºæ–‡çš„æ—¶å€™å¯ä»¥ç”¨è¿™ä¸ªå…³é”®è¯è¿›è¡Œæœç´¢ï¼Œæˆ–è€…æœâ€œRSA-CRTâ€ã€‚

åœ¨å‚æ•°å¾ˆå¤§çš„æ—¶å€™æ¯”å¦‚$N$æ˜¯2048æˆ–4096æ¯”ç‰¹çš„æ—¶å€™è®¡ç®—$m\equiv c^d\ mod\ N$è®¡ç®—é‡éå¸¸çš„å¤§ã€‚å› æ­¤ç»™å®š$$dp\equiv d\ mod\ p$$å’Œ$$dq\equiv d\ mod\ q$$ä»¥åŠ$p,q$ï¼Œå¯ä»¥æ›´å¿«åœ°è¿›è¡Œè§£å¯†ã€‚

* åŸç†ï¼šå·²çŸ¥$$c\equiv m\ mod\ N \\ m\equiv c^d\ mod\ N\\ dp\equiv d\ mod\ (p-1)\\ dq\equiv d\ mod\ (q-1)$$
    1. ç”±ä¸­å›½å‰©ä½™å®šç†å¯çŸ¥$$m_1\equiv c^d\ mod\ p\\ m_2\equiv c^d\ mod\ q$$
    2. è®°$c^d=kp+m_1$ï¼Œåˆ™æœ‰$$(m_2-m_1)p^{-1}\equiv k\ mod\ q$$æŠŠæœ¬æ­¥çš„ä¸¤ä¸ªå…¬å¼åˆå¹¶å¾—åˆ°$$m\equiv c^d \equiv ((m_2-m_1)p^{-1}\ mod\ q)p+m_1 \ mod\ N$$
    3. ç”±1ä¸­å¼å¯å¾—$$m_1\equiv c^d\equiv c^{dp}\ mod\ p\\ m_2\equiv c^d\equiv c^{dq}\ mod\ q$$ æ­¤æ—¶$m_1,m_2,p,q$éƒ½æ˜¯å·²çŸ¥çš„ï¼Œå› æ­¤å¯ä»¥è®¡ç®—å‡º$m$
* å‚è€ƒä»£ç 
    ```python
    InvQ = gmpy2.invert(q, p)
    mp = pow(enc, dp, p)
    mq = pow(enc, dq, q)
    m = (((mp - mq) * InvQ) % p) * q + mq
    print(long_to_bytes(m))
    ```
    å®é™…ä¸Šæ‰“æ¯”èµ›çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœçŸ¥é“äº†$p,q$ç›´æ¥è®¡ç®—$\phi(N)$å°±è¡Œï¼Œæ²¡å¿…è¦ç”¨è¿™ç§æ–¹æ³•ã€‚


#### ä¸‰ã€å°è§£å¯†æŒ‡æ•°æ”»å‡»
##### 3.1 Wienerâ€™s attack
* **Theorem 2 (M. WIener)ï¼š** è®©$ N=pq, q<p<2q $ï¼Œå¹¶ä¸”æœ‰$d<\frac{1}{3}N^{\frac{1}{4}}$ã€‚ç»™å®šå…¬é’¥<N,e>ï¼Œåˆ™æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•æ¢å¤å‡ºç§é’¥dã€‚

* è¯æ˜ï¼šæ­¤å®šç†æ˜¯åŸºäºè¿åˆ†æ•°çš„è¿‘ä¼¼ã€‚æ˜“å¾— $$|\frac{e}{\varphi(N)}-\frac{k}{d}|=\frac{1}{d\varphi(N)}$$ $$\varphi(N)=N-p-q+1 $$ $$
k < d <\frac{1}{3}N^{\frac{1}{4}}
$$ å› æ­¤æœ‰ $$
|\frac{e}{N}-\frac{k}{d}|\leq\frac{1}{2d^2}
$$ æ ¹æ®![](crypto/images/Th2.2_Continued_Fraction.PNG)

å¯çŸ¥$\frac{e}{N}$çš„**è¿åˆ†æ•°çš„æ”¶æ•›å¼**ä¸­æœ‰ä¸€é¡¹ä¸º$\frac{k}{d}$ã€‚**è¿åˆ†æ•°çš„æ”¶æ•›å¼(Convergent)** çš„å®šä¹‰ï¼šè®°ä¸º$c_i$ã€‚ä»¤$n$è¡¨ç¤ºè¿åˆ†æ•°æœ€å¤šå±•å¼€$n$å±‚ã€‚å³
$$
a=a_0+\frac{1}{a_1+\frac{1}{\ddots +\frac{1}{a_n}}}ç®€å†™ä¸ºa=[a_0;a_1,a_2,...,a_n]
$$
åˆ™è¿åˆ†æ•°çš„æ”¶æ•›å¼$c_i$æ»¡è¶³
$$\forall x\in[0,n],\ c_i=[a_0;a_1,...,a_i]$$ 
å› æ­¤åªéœ€è¦å¯¹$\frac{e}{N}$è¿›è¡Œè¿åˆ†æ•°å±•å¼€ï¼Œæ‰¾å‡ºæ»¡è¶³ $$ed-1=0\ mod\ k \tag{3.1}$$ çš„æ”¶æ•›å¼ $\frac{k}{d}$ï¼Œå³ $\exists i'\in[0,n],c_{i'}=\frac{k}{d}$ ï¼Œåˆ™ $$\phi(n)=\frac{ed-1}{k}$$ å¯èƒ½ä¼šå‡ºç°å½“$d$æ¯”è¾ƒå°çš„æ—¶å€™$(3.1)$å¼æˆç«‹ï¼Œå› æ­¤éœ€è¦è¿›è¡Œç‰¹æ®Šçš„åˆ¤åˆ«ã€‚

* é¿å…æ­¤ç±»æ”»å‡»çš„æ–¹æ³•
    * é€‰æ‹©æ¯”è¾ƒå¤§çš„å…¬é’¥$e$ï¼Œ$e>1.5N$ã€‚[è¿™æ ·ä»¥æ¥kå°±ä¼šå˜å¤§]
    * ä½¿ç”¨ä¸­å›½å‰©ä½™å®šç†è®¾å®šä¸¤ä¸ªç§é’¥$d_p, d_q$ï¼Œä¸€ä¸ªmod pä¸€ä¸ª mod q,è¿™æ ·è§£å¯†é€Ÿåº¦ä¼šå˜å¿«ï¼Œå¹¶ä¸”é€šè¿‡ä¸­å›½å‰©ä½™å®šç†æ¢å¤å‡ºæ¥çš„dä¼šå¾ˆå¤§ã€‚

Boneh and Durfee [D. Boneh and G. Durfee.New results on cryptanalysis of low private exponent RSA. Preprint, 1998.]ç­‰äººæå‡ºå½“$d<N^{0.292}$æ—¶æ•Œæ‰‹ä¹Ÿèƒ½å¿«é€Ÿæ¢å¤å‡ºç§é’¥dã€‚

* 3.1èŠ‚ä»£ç å‚è€ƒ https://www.cnblogs.com/Guhongying/p/10145815.html

* ***å…·ä½“python2ä»£ç è§``crypto/code/Wieners_Attack.py``*** åœ¨ä»£ç ä¸­ç»™å‡º$e,n$å¯æ¢å¤å‡ºç§é’¥æŒ‡æ•°$d$ã€‚

* ä¸€åŠæ¥è¯´ï¼Œå¦‚æœé¢˜ç›®ä¸­å‡ºç°$\frac{1}{3}N^{0.25}$ï¼Œå³ä½¿ä¸æ˜¯ä½¿ç”¨Wienerç®—æ³•æ±‚è§£RSAï¼Œä¹Ÿå¯ä»¥ç”¨åˆ°**Theorem 2.2**ä¸­çš„è¿åˆ†æ•°åˆ†è§£å®šç†ï¼Œä»è€Œæ±‚å‡ºæŸäº›å€¼ã€‚ä¾‹å­è§``crypto/2021_CSISC/RSA_ECC_2021_CSISC_move``ã€‚

##### 3.2 Extending Wiener's Attack

åŸç†ï¼šå¯¹äºåŒä¸€ä¸ª$N$ï¼Œæœ‰$i, i>1$ä¸ªå…¬é’¥æŒ‡æ•°$e_i$ï¼Œæ‰€æœ‰$e_i$æ‰€å¯¹åº”çš„ç§é’¥æŒ‡æ•°$d_i$éƒ½æ¯”è¾ƒçš„å°ã€‚æ­¤æ—¶å¯ä»¥ä½¿ç”¨Extending Wiener's Attackè¿›è¡Œæ±‚è§£ã€‚ä¸‹é¢ç»™å‡ºå½“$i$æ¯”è¾ƒå°æ—¶$d_i$æ‰€å–çš„èŒƒå›´ã€‚æˆ‘ä»¬ä»¤$d_i< N^{\alpha}$ï¼Œåˆ™$i$ä¸$\alpha$çš„å…³ç³»ä¸º(ä¸€èˆ¬æƒ…å†µæ¯”è¾ƒçš„å¤æ‚ï¼Œè¿™é‡Œåªåˆ—ä¸¾$i$æ¯”è¾ƒå°çš„æƒ…å†µ)ï¼š
$i$|$\alpha$
:-:|:-:
2|$< 5/14-\epsilon'$
3|$< 2/5-\epsilon'$
4|$< 15/34-\epsilon'$

å…·ä½“æ€è·¯ï¼šä»¤$$g = gcd(p-1,q-1)$$æ˜“å¾—$$deg=k(p-1)(q-1)+g$$ä»¤$$s=1-p-q$$è®°æ–¹ç¨‹$W_i$ä¸º$$e_id_ig-k_iN=g+k_is \tag{Wi}$$ã€‚å¯¹äºä¸¤ä¸ªå…¬é’¥æŒ‡æ•°çš„æƒ…å†µï¼Œæœ‰$$e_1d_1-k_1\varphi(N)=1 \newline e_2d_2-k_2\varphi(N)=1$$ä¸Šå¼ä¹˜$k_2$å‡å»ä¸‹å¼ä¹˜$k_1$å¾—$$e_1d_1k_2-e_2d_2k_1=k_2-k_1 \tag{G(1,2)}$$è®¡ç®—å¯å¾—$W_1W_2$åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªç­‰å¼ã€‚ç”±å¼$$k_1k_2=k_1k_2 \newline W_1*k_2 \newline G_{(1,2)} \newline W_1*W_2 $$å››ä¸ªç­‰å¼å¯ä»¥æ„é€ å¦‚ä¸‹ç­‰å¼$$A*L_2=B_2$$å…¶ä¸­$$A=(k_1k_2,d_1gk_2,d_2gk_1,d_1d_2g^2)$$
![](crypto/images/Extended_Wieners_Attack_L.PNG)
å…¶ä¸­$L_2$çŸ©é˜µéƒ½æ˜¯å·²çŸ¥çš„é¡¹æ„æˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ$L_2$çœ‹ä½œä¸€ä¸ªæ ¼ï¼Œç„¶å$B_2$æ˜¯å…¶æœ€çŸ­å‘é‡ï¼Œä½¿ç”¨**LLLå®šç†**ï¼ˆè§4.1èŠ‚ï¼‰å¯ä»¥æ±‚å‡ºå…¶æœ€çŸ­å‘é‡ã€‚è€Œä¸”è‹¥$B_2$ä¸ºæœ€çŸ­å‘é‡ï¼Œåˆ™éœ€è¦æ»¡è¶³$||B_2||\leq \sqrt{n}det(L)^{\frac{1}{n}}$ï¼Œå³$$2N^{1+2\alpha}\leq 2N^{(\frac{13}{2}+\alpha)\frac{1}{4}}$$è§£å¾—$\alpha\leq \frac{5}{14}$ä»è€Œå¯ä»¥ä»£å…¥$M_2$ä¸­ã€‚(**ç¼–ç¨‹å®ç°çš„è¿‡ç¨‹ä¸­å¯ç¨å¾®ç¼©å°$\alpha$ä½¿å¾—LLLç®—æ³•å¿…å®šæœ‰è§£**)æ±‚å‡ºæœ€çŸ­å‘é‡$B_2$åï¼Œè®¡ç®—$B_2*L_2^{-1}$å¾—åˆ°$A$ã€‚ç„¶åç”¨açš„å‰ä¸¤é¡¹è®¡ç®—$$\frac{a[1]}{a[0]}e_1 = \frac{e_1d_1g}{k_1} = \varphi(N)$$ä»è€ŒæŠŠ$\varphi(N)$æ¢å¤å‡ºæ¥ã€‚

* ä»£ç å‚è€ƒï¼šhttps://blog.csdn.net/jcbx_/article/details/109306542
* ***å…·ä½“Sagemath9.2ä»£ç è§``crypto/code/Extended_Wieners_Attack.py``*** åœ¨ä»£ç ä¸­æä¾›$\alpha,e_1,e_2,n$å¯æ¢å¤å‡º$\varphi(N)$


##### 3.3 ä¸€ç§RSAçš„å¹¿ä¹‰æ”»å‡»

* **å‚è€ƒæ–‡çŒ®ï¼šBunder M , Nitaj A , Susilo W , et al. A generalized attack on RSA type cryptosystems[J]. Theoretical Computer Science, 2017:74-81.**

* æ”»å‡»æ¡ä»¶ï¼š$q < p < 2q$ï¼Œ$ex-(p^2-1)(q^2-1)y=z$ï¼Œå…¶ä¸­æ­£æ•´æ•°$x,y$äº’ç´ ã€‚ä¸”æœ‰ $$xy < 2N - 4\sqrt{2} N^{0.75}\ and\ |z| < (p-q)N^{0.25}y$$ å¯ä½¿ç”¨è¿åˆ†æ•°ä¸Coppersmithå®šç†å¯¹$N$è¿›è¡Œåˆ†è§£ã€‚

* ä¾‹å­è§å‚è€ƒæ–‡çŒ®
```python
# sagemath 9.2 
# è°ƒè¯•çš„æ—¶å€™small_rootså‡½æ•°çš„è¾¹ç•Œæ¯”è¾ƒéš¾è°ƒ
from tqdm import tqdm

N = ZZ(204645825996541)
e = ZZ(26384989321053458213237)

def solve_pell (N, e):
    X = e/(N^2+1-9/4*N)
    cf = continued_fraction (X)
    PR.<xx> = PolynomialRing(Zmod(N))
    p_low = floor(N^(1/4) / (2 ^ 1))
    for i in tqdm(range (len(cf))):
        denom = cf . denominator ( i )
        numer = cf . numerator ( i )
        y, x = numer, denom
        if (y != 0):
            p_bar = 1/2 * ((abs((N+1)^2 - e*x/y))^(1/2) + (abs((N-1)^2 - e*x/y))^(1/2))
            p_bar = floor(p_bar)
            f = xx + p_bar

            sol = f.small_roots(X=p_low, beta=0.48, epsilon=0.03)
            if (len(sol) != 0):
                p = ZZ(f(sol[0]))
                print(p)

print(N.nbits())
print(e.nbits())
solve_pell(N, e)
```

##### 3.4 å…¬æœ‰è§£å¯†æŒ‡æ•°æ”»å‡»(Common Private exponent)

* **å‚è€ƒæ–‡çŒ®ï¼šRavva S K . Lattice Based Attack on Common Private Exponent RSA[J]. International Journal of Computer Science Issues, 2012, 9(2):28-31. http://ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf**

* æ”»å‡»æ¡ä»¶ï¼š ç»™å‡º$r$å¯¹RSAçš„å…¬é’¥$\{(e_1,N_1),...,(e_r,N_r)\}$ï¼Œè€Œä¸”è¿™$r$å¯¹RSAçš„ç§é’¥$d$æ˜¯ç›¸åŒçš„ã€‚å¹¶ä¸”æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š
    1. $N_1 < N_2 < ... < N_r < 2N_1$
    2. $N_i$æ˜¯ç¨³å®šçš„ï¼Œæ—¢è‹¥$\phi(N_i) = N_i - s_i$ï¼Œåˆ™$|s_i| < 3N_i^{0.5}$
    3. $d < N_r^{\sigma_r}$ å…¶ä¸­ $\sigma_r < \frac{1}{2} - \frac{1}{2(r+1)} - log_{N_r}\sigma_r$

* æ”»å‡»åŸç†ï¼šæœ‰æ–¹ç¨‹ $$e_id = 1 + k_i\phi(N_i),$$ åˆ™æœ‰ $$e_id - N_ik_i = 1 - k_is_i$$ è¿›è€Œæ„é€ $r+1$ä¸ªæ–¹ç¨‹ $$x_rB_r=V_r$$ å…¶ä¸­ $$x_r =(d,k_1,k_2,...,k_r) \\ $$$$B_r = \left[\begin{matrix} 
M & e_1 & e_2 & \cdots & e_r \\
0 & -N_1 & 0 & \cdots & 0 \\
0 & 0 & -N_2 & \cdots & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
0 & 0 & 0 & \cdots& -N_r
\end{matrix}\right] \\ V_r = (dM, 1-k_1s_1 ,..., 1-k_rs_r)$$ å…¶ä¸­$M = \lfloor N_r^{0.5} \rfloor$.

* å‚æ•°ç¡®å®šï¼šé¦–å…ˆå¯ä»¥æ ¹æ®ç»™å‡ºçš„å…¬é’¥ç¡®å®š$r$çš„å–å€¼ï¼Œä¸€èˆ¬æ¥è¯´å¦‚æœéšæœºç”Ÿæˆçš„è¯å»20å°±è¶³å¤Ÿäº†ã€‚

* æ”»å‡»ä¾‹å­è§å‚è€ƒæ–‡çŒ®

* å‚è€ƒä»£ç : `crypto/code/Common_Private_Exponent_RSA.sage`







#### å››ã€å°å…¬é’¥æŒ‡æ•°æ”»å‡»(Coppersmith's Theorem)
##### 4.1 æ”»å‡»åŸç†
***æœ¬è´¨ä¸Šæ˜¯å½“å…¬é’¥æŒ‡æ•°è¾ƒå°$e\leq 5$ï¼ŒæŠŠé—®é¢˜å˜æˆæ±‚è§£$f(x)\equiv 0\ mod\ N$çš„é—®é¢˜ï¼Œå…¶ä¸­$f(x)=\sum_{i=0}^{e} a_ix^iï¼Œa_i\in Z_N$ã€‚ä¸»è¦åº”ç”¨åœºæ™¯åœ¨eå¾ˆå°ï¼Œæ–¹ç¨‹çš„æ ¹æ¯”è¾ƒå°çš„æƒ…å†µã€‚***
* **Theorem 3 (Coppersmith)ï¼š** $N$æ˜¯æ•´æ•°ï¼Œ$f\in Z[x]$æ˜¯åº¦æ•°ä¸º**d**çš„é¦–ä¸€å¤šé¡¹å¼ã€‚ä»¤$X=N^{\frac{1}{d}-\epsilon}$*ï¼ˆ$X$æ˜¯å®æ•°ï¼‰*ã€‚åˆ™ç»™å®š$<N,f>$ï¼Œæ•Œæ‰‹å¯ä»¥å¿«é€Ÿæ‰¾å‡ºæ‰€æœ‰çš„æ•´æ•°$\{x_0|\ \ |x_0|<X\ ä¸”\ f(x_0)\equiv 0\ mod\ N\}$ã€‚è¿è¡Œæ—¶é—´ä¸ºè¿è¡Œ*LLL*ç®—æ³•æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œè®°ä¸º$O(w), w=min(1/\epsilon,log_2 N)$
* **Coppersmithæ–¹æ³•**ä¸»è¦é€šè¿‡æ‰¾åˆ°ä¸$f\ mod\ N$æœ‰ **(1.ç›¸åŒæ ¹ 2.ç³»æ•°ä¸ºæ•´æ•°åŸŸ 3.ç³»æ•°æ›´å°)** æ€§è´¨çš„å¤šé¡¹å¼$g$ï¼Œä»è€Œæ‰¾å‡º$g$çš„æ ¹(å› ä¸ºå®¹æ˜“æ‰¾å‡ºæ•´æ•°åŸŸä¸Šçš„å¤šé¡¹å¼æ ¹)
    * $fåˆ°g$çš„è½¬æ¢æ–¹å¼ï¼šé¢„å®šä¹‰ä¸€ä¸ªæ•´æ•°mï¼Œå®šä¹‰$$g_{u,v}(x)=N^{m-v}x^uf(x)^v$$ã€‚å› æ­¤$x_0$æ˜¯$g_{u,v}(x)\ mod\ N^m$çš„ä¸€ä¸ªæ ¹ï¼Œå…¶ä¸­$u\geq ä¸”0\leq x_0\leq m$ä¸æ­¤åŒæ—¶æœ‰$f(x_0)\equiv 0\ mod\ N$
    * å› æ­¤æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ç»„$g_{u,v}$çš„çº¿æ€§ç»„åˆ$h(x)$ï¼Œæ»¡è¶³$h(xX)$æœ‰å°äº$N^m$çš„èŒƒå¼(æ ¹)ï¼Œå…¶ä¸­$X$æ˜¯$x_0$ä¸­æ»¡è¶³$X<N^{\frac{1}{d}}$çš„ä¸Šç•Œã€‚åªè¦mè¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆä¸€å®šèƒ½æ‰¾åˆ°è¿™æ ·çš„$h(x)$ã€‚**æ­¤æ—¶è¡¨ç¤ºæˆ‘ä»¬æ‰¾åˆ°äº†è¿™æ ·çš„$h(x)$ï¼Œå®ƒåœ¨æ•´æ•°ä¸­æœ‰åŒæ ·çš„æ ¹$x_0$**ã€‚
##### $h(x)$çš„å¯»æ‰¾æ–¹æ³•
* å®šä¹‰$h(x)=\sum a_ix^i \in Z[x]$ï¼Œåˆ™$\|h(x)\| = \sum a_i$
* **Lemma 4 (Howgrave-Graham)ï¼š** Let $h(x)\in Z[x]$ be a polynomial of degree $dg$ and let $X$ be a positive integer. Suppose $\|h(xX)\| < N/\sqrt{dg}$. If $|x_0| < X$ satisfies $h(x_0)=0\ mod\ N$, then $h(x_0)=0$ holds over the integer.ï¼ˆ$h(x_0)=0$åœ¨æ•´æ•°ä¸Šæˆç«‹ï¼‰
    * é¦–å…ˆæˆ‘ä»¬æŠŠå¤šé¡¹å¼$g_{u,v}(xX)$ä½œä¸ºå‘é‡ï¼Œå¹¶è®°æ ¼$L$æ˜¯ç”±å®ƒæ‰€ç”Ÿæˆçš„ã€‚å›ºå®šä¸€ä¸ªmï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºæ ¼$L$çš„è¡¨è¾¾å¼ï¼Œå½¢å¦‚ä¸‹å›¾ã€‚å…¶ä¸­å¸¦``*``å·çš„è¡¨ç¤ºé0ç³»æ•°ï¼Œç©ºçš„ä½ç½®ä»£è¡¨0ã€‚ä¸‹å›¾æ˜¯å½“$m=3,dg=2$æ—¶æ‰€æ„é€ å‡ºçš„æ ¼$L$ã€‚
    ![æ ¼L](crypto/images/lattice_L.PNG)
    * é€šè¿‡**LLLå®šç†**ï¼Œå¯ä»¥æ‰¾å‡ºæ ¼Lä¸­çš„ä¸€ä¸ªå‘é‡$v\in L$ï¼Œæ»¡è¶³$\|v\|\leq 2^{w/4}det(L)^{1/w}$ï¼Œwè¡¨ç¤ºæ ¼çš„ç»´æ•°ã€‚æ¥ä¸‹æ¥éœ€è¦è¯æ˜ï¼š$2^{w/4}det(L)^{1/w} < N^m/\sqrt{w}ï¼Œå…¶ä¸­w=dg(m+1)$ã€‚å½“mè¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œä¸Šå¼å¯ä»¥è¢«æ»¡è¶³ã€‚å› æ­¤é€šè¿‡LLLå®šç†æ‰¾å‡ºçš„å‘é‡$v$å°±æ˜¯æ‰€æ±‚çš„$h(x)$ã€‚
    * å‚æ•°çš„ç¡®å®š:å½“ç”±$X=N^{\frac{1}{dg}-\epsilon}$æ—¶ï¼Œæœ‰$m=O(k/dg)ï¼Œk=min(\frac{1}{\epsilon},log\ N)$

**LLLå®šç†ï¼š** Let L be a lattice spanned by $<u_1,...,u_w>$. When $<u_1,...,u_w>$ are given as input, then the LLL algorithm outputs a point $v\in L$ satisfying $$\|v\|\leq 2^{w/4}det(L)^{1/w}$$ LLLçš„è¿è¡Œæ—¶é—´æ˜¯è¾“å…¥é•¿åº¦$w$çš„å››æ¬¡æ–¹ã€‚
* **Coppersmithå®šç†æ‰€ä½¿ç”¨çš„æ”»å‡»æ–¹æ³•ä¸€èˆ¬éƒ½è¢«å†™åœ¨äº†``Magma``çš„``SmallRoots``å‡½æ•°ä¸­ï¼Œä»¥åŠ``SageMath``çš„``small_root``å‡½æ•°ä¸­ã€‚**
* è¯¦ç»†å®ç°è¿‡ç¨‹å‚è€ƒï¼šhttps://github.com/mimoo/RSA-and-LLL-attacks
* å‚è€ƒæ–‡çŒ®ï¼š Wong D. Survey: Lattice Reduction Attacks on RSA. 

##### 4.2 Hastadçš„å¹¿æ’­æ”»å‡»
å‡è®¾$e=3$ï¼Œå¹¶ä¸”åŠ å¯†è€…ä½¿ç”¨äº†ä¸‰ä¸ªä¸åŒçš„æ¨¡æ•°$n_1,n_2,n_3$ç»™ä¸‰ä¸ªä¸åŒçš„ç”¨æˆ·å‘é€äº†åŠ å¯†åçš„æ¶ˆæ¯$m$: $$c_1=m^3\ mod\ n_1 \newline 
c_2=m^3\ mod\ n_2 \newline 
c_3=m^3\ mod\ n_3$$
å…¶ä¸­$n_1,n_2,n_3$ä¸äº’ç´ ï¼Œ$m < n_i$ã€‚
* æ”»å‡»æ–¹æ³•ï¼šé¦–å…ˆé€šè¿‡ä¸­å›½å‰©ä½™å®šç†å¾—åˆ°$m^3\equiv C\ mod\ n_1n_2n_3$ã€‚å› æ­¤åªè¦å¯¹$C$å¼€ä¸‰æ¬¡æ ¹å°±å¯ä»¥å¾—åˆ°$m$çš„å€¼ã€‚å¼€æ ¹å¯ä»¥ä½¿ç”¨``SageMath``ä¸­çš„``iroot``å‡½æ•°ã€‚
    * ä»£ç å‚è€ƒï¼šhttps://github.com/yifeng-lee/RSA-In-CTF/blob/master/exp2.sage
    * ***å…·ä½“Sagemath9.2ä»£ç è§``crypto/code/Hastad_Broadcast_Attact.sage``***
* **æ‹“å±•ï¼š** å…·æœ‰çº¿æ€§å¡«å……çš„å¹¿æ’­æ”»å‡»ä¹Ÿèƒ½é€šè¿‡Coppersmith's Theoremè¢«æ”»ç ´ã€‚
* å› æ­¤å¹¿æ’­æ”»å‡»çš„é¿å…æ–¹å¼å¯ä»¥ä½¿ç”¨éšæœºå¡«å……(padding)

##### 4.3 Franklin-Reiter ç›¸å…³ä¿¡æ¯æ”»å‡»
(**Franklin-Reiter**)å½“ Alice ä½¿ç”¨åŒä¸€å…¬é’¥å¯¹ä¸¤ä¸ªå…·æœ‰æŸç§çº¿æ€§å…³ç³»çš„æ¶ˆæ¯ M1 ä¸ M2 è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å°†åŠ å¯†åçš„æ¶ˆæ¯ C1ï¼ŒC2 å‘é€ç»™äº† Bob æ—¶ï¼Œæˆ‘ä»¬å°±å¯èƒ½å¯ä»¥è·å¾—å¯¹åº”çš„æ¶ˆæ¯ M1 ä¸ M2ã€‚è¿™é‡Œæˆ‘ä»¬å‡è®¾æ¨¡æ•°ä¸º Nï¼Œä¸¤è€…ä¹‹é—´çš„çº¿æ€§å…³ç³»ä¸º$M_1\equiv f(M_2)\ mod\ Nï¼Œf=ax+b$ã€‚åˆ™æ­¤æ—¶å¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°æ¢å¤å‡º$M$ã€‚
* æ–¹æ³•ï¼šå½“e=3æ—¶ï¼Œ$C_1=M_1^e\ mod\ N$ï¼Œåˆ™æœ‰$M_2$æ˜¯$g_1(x) = f(x)^e - C_1\equiv 0\ mod\ N$çš„æ ¹ï¼Œè€Œä¸”$M_2$ä¹Ÿæ˜¯$g_2(x)=x^e - C_2\equiv 0\ mod\ N$çš„æ ¹ã€‚å¦‚æœ$g_1,g_2$çš„æœ€å¤§å…¬å› å­æ˜¯çº¿æ€§çš„ï¼Œé‚£ä¹ˆ$M_2 = gcd(g_1,g_2)$ã€‚
* å½“e>3æ—¶ï¼Œ$g_1,g_2$ä¸ä¸€å®šæ˜¯çº¿æ€§çš„ï¼Œæ­¤æ—¶æ— æ³•ç”¨æ­¤æ–¹æ³•æ±‚è§£ã€‚
##### 4.4 Coppersmithâ€™s short-pad attack ï¼ˆçŸ­å¡«å……æ”»å‡»ï¼‰
å‡è®¾Né•¿åº¦ä¸ºnï¼Œä»¤$m=\lfloor n/e^2\rfloor$ï¼ŒåŠ å¯†æ¶ˆæ¯Mçš„é•¿åº¦ä¸è¶…è¿‡(n-m) bitsã€‚è‹¥æœ‰$$M_1=2^mM+r_1 \newline M_2=2^mM+r_2$$$0\leq r_1,r_2\leq 2^m$æ˜¯ä¸åŒçš„æ•´æ•°ï¼Œåˆ™è‹¥çŸ¥é“$e,M_1,M_2,C_1,C_2$ï¼Œå®¹æ˜“æ¢å¤å‡ºMã€‚
* ä»¤$$g_1(x,y)=x^e-C_1 \newline g_2(x,y) = (x+y)^e-C_2$$ 
å…¶ä¸­$y=r_2-r_1$ï¼Œåˆ™$M_1$æ˜¯ä¸¤ä¸ªæ–¹ç¨‹çš„æ ¹ã€‚å› æ­¤æœ‰$M_1=gcd(g_1(x,y),g_2(x,y))$ï¼Œè¿‡ç¨‹ï¼š

![CoppersmithçŸ­å¡«å……æ”»å‡»](crypto/images/Coppersmith_ShortPadAttack.PNG)
* å½“paddingçš„é•¿åº¦å°äºä¿¡æ¯é•¿åº¦çš„1/9çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ”»å‡»ã€‚
##### 4.5 Known High Bits Message Attack(å·²çŸ¥é«˜æ¯”ç‰¹ä¿¡æ¯æ”»å‡»)
å·²çŸ¥$C\equiv m^e\ mod\ N$ï¼Œå‡è®¾å·²çŸ¥å¾ˆå¤§ä¸€éƒ¨åˆ†$m_0$,åˆ™æœ‰$C\equiv(m_0+x)^e\ mod\ N$ã€‚ç›´æ¥ä½¿ç”¨Coppersmithå®šç†æ±‚è§£$x$ï¼Œä½†è®°å¾—å…¶ä¸­çš„$x$éœ€è¦æ»¡è¶³Coppersmithå®šç†ä¸­çš„çº¦æŸï¼Œå³$x < N^{\frac{1}{e}}$ã€‚

* ***å…·ä½“Magmaä»£ç è§``crypto/code/Known_High_Bits_Message_Attack.m``***

##### 4.6 Factoring with High Bits Known(å·²çŸ¥é«˜æ¯”ç‰¹åˆ†è§£)
å·²çŸ¥$p$æˆ–$q$ä¸­å…¶ä¸­ä¸€ä¸ªæ•°çš„é«˜ä½æ¯”ç‰¹ï¼Œæˆ‘ä»¬å°±æœ‰ä¸€å®šå‡ ç‡æ¥åˆ†è§£ $N$ã€‚
**è¿™é‡Œçš„åŸç†å°±æ˜¯Theorem 10ï¼Œä½†æ˜¯åŸç†çš„å…·ä½“æµç¨‹æ²¡æœ‰æ‰¾åˆ°ã€‚è¿™é‡Œåªæ˜¯ä½¿ç”¨ç°æˆçš„ä»£ç èƒ½åšåˆ°å·²çŸ¥pçš„é«˜æ¯”ç‰¹éƒ¨åˆ†ï¼Œä»£ç è¿è¡Œä¹‹åèƒ½å¾—åˆ°ç›¸åº”çš„$p$ã€‚**
åŸç†åˆ™æ˜¯æ±‚è§£$x+p_{fake}\equiv 0\ mod\ Factor(N)$ï¼ŒSageé‡Œé¢æ°å¥½æœ‰è¿™æ ·çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚
* æ”»å‡»è¦æ±‚ï¼šä¸€èˆ¬æ¥è¯´éœ€è¦éœ€è¦å·²çŸ¥bitæœ€å°‘éœ€è¦å æ®æ‰€æœ‰bitçš„**56%**ï¼Œç„¶å$p$éœ€è¦æ»¡è¶³$p \geq N^{\beta}$ï¼Œä¸€èˆ¬æœ‰$0.4\leq \beta\leq 0.5$ã€‚**è€Œä¸”è¿™é‡Œçš„$p$ä¸ä¸€å®šæ˜¯ç´ æ•°ï¼Œå¯ä»¥æ˜¯$N$çš„æŸäº›å› æ•°çš„ä¹˜ç§¯ã€‚**

* ä»£ç å‚è€ƒï¼šhttps://github.com/yifeng-lee/RSA-In-CTF/blob/master/exp6.sage
* ***å…·ä½“Sagemath9.2ä»£ç è§``crypto/code/Factoring_with_High_Bits_Known.py``***

##### 4.6.2 Improve Factoring with High Bits Konwn
è¿™é‡Œè¯•4.6èŠ‚çš„å˜ç§ï¼Œå°±æ˜¯ç°åœ¨å·²çŸ¥$p$æˆ–$q$çš„é«˜ä½æ¯”ç‰¹å’Œä½ä½æ¯”ç‰¹ï¼Œåªæœ‰ä¸­é—´çš„bitä¸çŸ¥é“ï¼Œè€Œä¸”é«˜ä½bitå’Œä½ä½bitå æ‰€æœ‰bitçš„56%æˆ–ä»¥ä¸Šã€‚å¦‚æœä¸è¶³åˆ™å¯ä»¥æš´åŠ›æšä¸¾æŸäº›æ¯”ç‰¹ä½¿å¾—å·²çŸ¥æ¯”ç‰¹çš„æ•°é‡å¤§äº56%ï¼Œä»è€Œå®ç”¨è¯¥æ”»å‡»
* æ”»å‡»åŸç†ï¼šæ±‚è§£$$2^lx + p_{low} + p_{high} \equiv 0\ mod\ N$$ åŒæ ·æ˜¯ä½¿ç”¨sagemathä¸­çš„`small_root`å‡½æ•°ã€‚å°±æ˜¯éœ€è¦åŠ ä¸Š`f = f.monic()`ä¸€å¥ä¿è¯å¤šé¡¹å¼`f`æ˜¯é¦–ä¸€çš„ã€‚
* æ”»å‡»è¦æ±‚ä¸4.6èŠ‚çš„ä¸€è‡´ã€‚
* å…·ä½“ä»£ç åŒæ ·è§4.6èŠ‚çš„ä»£ç ã€‚

##### 4.7 Partial Key Exposure attack ï¼ˆéƒ¨åˆ†å¯†é’¥æ³„éœ²æ”»å‡»ï¼‰
æ­¤æ—¶å…¬é’¥$e$å¾ˆå°
* **Theorem 9 (BDF)ï¼š** ç»™å®šç§é’¥<$N,d$>ï¼Œ$N$é•¿ä¸º$n$æ¯”ç‰¹ï¼Œå¹¶ç»™å‡ºç§é’¥$d$çš„$\lceil n/4\rceil$ä½æœ€ä½æœ‰æ•ˆä½(å³$d$çš„ä½ä½)ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æ—¶é—´$O(elog_2\ e)$ä¸­æ¢å¤å‡º$d$ã€‚
* **Theorem 10 (Coppersmith)ï¼š**$N=pq$ï¼Œ$N$ä¸º$n$æ¯”ç‰¹ã€‚ç»™å‡ºç§é’¥$p$çš„é«˜æˆ–ä½$n/4$æ¯”ç‰¹ï¼Œé‚£ä¹ˆå¯ä»¥å¿«é€Ÿåˆ†è§£$N$ã€‚

æˆ‘ä»¬ä¸»è¦è®¨è®ºå®šç†10ï¼Œ

**åŸç†ï¼š** é¦–å…ˆå·²çŸ¥$ed-k(N-p-q+1)=1$ï¼Œå› ä¸º$d<\varphi(N)$ï¼Œæ‰€ä»¥æœ‰$0< k\leq e$ã€‚ç„¶ååˆå› ä¸º$q=N/p$ã€‚åˆ™æœ‰$$(ed)p-kp(N-p+1)+kN=p\ mod\ (2^{n/4})$$å› ä¸ºæ•Œæ‰‹Marvinå¾—åˆ°äº†$d$çš„$n/4$ä¸ªæœ€ä½æœ‰æ•ˆä½$d_0$ï¼Œæ‰€ä»¥ä»–çŸ¥é“$ed\equiv ed_0\ mod\ 2^{n/4}$ã€‚å› æ­¤ï¼Œä»–å¾—åˆ°äº†ä¸€ä¸ªå…³äº$k$å’Œ$p$çš„æ–¹ç¨‹ã€‚å¯¹äº$k$çš„æ¯ä¸€ä¸ªå¯èƒ½çš„å€¼$[0,e]$ï¼ŒMarvinæ±‚è§£äº†å…³äº$p$çš„äºŒæ¬¡æ–¹ç¨‹$$(ed_0)x-kx(N-x+1)+kN=x\ mod\ (2^{n/4})$$å¾—åˆ°äº†ä¸€äº›$p$çš„å€™é€‰å€¼$x\ mod\ 2^{n/4}$çš„å€™é€‰å€¼ã€‚å¯¹äºæ¯ä¸€ä¸ªå€™é€‰å€¼ï¼Œæ‰§è¡Œå®šç†10çš„ç®—æ³•(**4.6èŠ‚**)å»å°è¯•åˆ†è§£$N$ã€‚å¯ä»¥çœ‹å‡ºï¼Œå¯¹äº$p\ mod\ 2^{n/4}$çš„å€™é€‰å€¼çš„æ€»æ•°æœ€å¤šä¸º$elog_2\ e$ã€‚å› æ­¤ï¼Œæœ€å¤šå°è¯•$elog_2\ e$æ¬¡åï¼Œ$N$å°†è¢«å› å¼åˆ†è§£ã€‚ç„¶åå°±å¯ä»¥é€šè¿‡$e$å’Œ$\varphi (N)$æ±‚å‡ºç§é’¥$d$ã€‚
* å®šç†10çš„ä»£ç è§4.6èŠ‚ã€‚

* ä»£ç å‚è€ƒï¼šhttps://github.com/yifeng-lee/RSA-In-CTF/blob/master/exp8.sage
* ***å…·ä½“Sagemath9.2ä»£ç è§``crypto/code/Partial_Key_Exposure_attack.py``***

##### 4.8 Boneh and Durfee attack
å½“ $d$ è¾ƒå°æ—¶ï¼Œæ»¡è¶³ $d < N^{0.292}$ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥æ”»å‡»ï¼Œæ¯” Wiener's Attack è¦å¼ºä¸€äº›ã€‚

* æ³¨æ„ï¼š4.2~4.7èŠ‚çš„å…¬é’¥æŒ‡æ•°$e$éƒ½æ˜¯éå¸¸å°(ä¸€èˆ¬ä¸º3)ã€‚è€Œæœ¬èŠ‚ä»…ä»…æ˜¯ç§é’¥æŒ‡æ•°$d$æ¯”è¾ƒçš„å°ï¼Œè€Œä¸€èˆ¬å‡è®¾$e$éå¸¸çš„å¤§ã€‚

###### 4.8.1 æ”»å‡»åŸç†
å‡è®¾$gcd(p-1, q-1)=2$ï¼Œå·²çŸ¥$\varphi(N)=N-p-q+1$ï¼Œåˆ™æœ‰
$$ed\equiv 1\ mod\ \varphi(N)/2$$
$$ed+k(\frac{N+1}{2}-\frac{p+q}{2})=1$$
ä»¤$A=\frac{N+1}{2}, s=-\frac{p+q}{2}$ï¼Œåˆ™æœ‰$$k(A+s)\equiv 1\ (mod\ e)$$
è€Œä¸”æ»¡è¶³$|k|< e^{\delta}$ä»¥åŠ$|s|< e^{0.5}$ï¼Œå…¶ä¸­$\delta < 0.292$
è¿™é‡Œ$k$å’Œ$s$æ˜¯æœªçŸ¥æ•°ï¼Œå› æ­¤æˆ‘ä»¬ç›¸å½“äºæ±‚ä¸€ä¸ªäºŒå…ƒäºŒæ¬¡æ–¹ç¨‹çš„è§£ã€‚è¿™é‡Œç”¨åˆ°çš„æ˜¯Coppersmithç®—æ³•çš„å¹¿ä¹‰çš„å½¢å¼ã€‚

* ä»£ç å‚è€ƒï¼šhttps://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage
* ***å…·ä½“Sagemath9.2ä»£ç è§``crypto/code/boneh_and_durfee.sage``***

##### 4.9 ä½åŠ å¯†æŒ‡æ•°æ”»å‡»
$m ^ e = kN + c$å…¶ä¸­ä¸€èˆ¬ $e = 3$ï¼Œ$k$æ¯”è¾ƒå°($k$å°äº10äº¿çˆ†ç ´æ—¶é—´ä¸€èˆ¬å°äºåŠå°æ—¶)

##### 4.10 å…¬é’¥$e$ä¸$\varphi(N)$ä¸äº’ç´ 
* æ”»å‡»å‰æï¼š$p,q,e$å·²çŸ¥ï¼Œä½†æ˜¯ç”±äº$e$ä¸$\varphi(N)$ä¸äº’ç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•æ±‚è§£å¾—åˆ°ç§é’¥$d$ã€‚åªæœ‰å½“ä»–ä»¬äº’ç´ æ—¶ï¼Œæ‰èƒ½ä¿è¯$e$çš„é€†å…ƒ$d$å”¯ä¸€å­˜åœ¨ã€‚
###### 4.10.1 $e \nmid \varphi(N)$
å·²çŸ¥$p,q,e,m,c$ï¼Œå‡è®¾$gcd(e, \phi(N)) = a$ï¼Œåˆ™æœ‰$e = ab$ï¼Œå…¶ä¸­$gcd(b,\phi(N)=1$ã€‚è®¡ç®—$$c' = c^{-b} = (m^{ab})^{-b} = m^a\ mod\ N$$ä¸€èˆ¬æ¥è¯´$a$éƒ½ä¼šæ¯”è¾ƒå°ï¼Œè¿™å°±ç›¸å½“äºå¯¹$c' = m^a$å¼€$a$æ¬¡æ–¹ï¼Œæ—¢æ±‚$c'$çš„$a$æ¬¡å‰©ä½™ã€‚**è§4.10.2èŠ‚**ã€‚


<!-- ä¸€èˆ¬æƒ…å†µä¸‹ä¼šå¯¹åŒä¸€ä¸ªä¿¡æ¯$m$ç»™å‡ºä¸¤å¯¹$c_1,e_1,n_1,c_2,e_2,n_2$ä¿¡æ¯ï¼Œä¸”$n_1 = pq_1$ã€$n_2=pq_2$ã€‚äºæ­¤åŒæ—¶è¿˜æœ‰$$gcd(e_1,(p-1)*(q_1-1)) = gcd(e2,(p-1)*(q_2-1)) = b$$ç„¶åä»¤$e_i=a_ib$åˆ™$a_i$ä¸$\varphi(N)$äº’ç´ ï¼Œåˆå› ä¸º$ed\equiv 1\ mod\ \varphi(N)$å› æ­¤æ¯ä¸ª$a_i$éƒ½å”¯ä¸€ç¡®å®šä¸€ä¸ª$bd_i$ï¼Œåˆ™æœ‰$c_i^{bd_i} \equiv m^b\ mod\ N$è®°$c_i^{bd_i}=res_i$ä»è€Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°$$res_1 \equiv m^b\ mod\ n_1 \newline res_2 \equiv m^b\ mod\ n_2$$å±•å¼€å¾—$$res_1 \equiv m^b\ mod\ p \newline res_1 \equiv m^b\ mod\ q_1 \newline res_2 \equiv m^b\ mod\ q_2$$é€šè¿‡ä¸­å›½å‰©ä½™å®šç†è®¡ç®—å¯å¾—$$res \equiv m^b\ mod\ q_1q_2$$æ­¤æ—¶æ±‚å‡º$b' = gcd(b,q_1q_2)$ï¼Œ$d'=e/b'$ï¼Œ$d'd'^{-1}\equiv 1\ mod\ \varphi(q_1q_2)$ï¼Œåˆ™$$res^{d'^{-1}} \equiv m^{bd'^{-1}} \equiv m^{b'}\ mod\ q_1q_2$$ä¸€èˆ¬æ¥è¯´$b'$ä¸º2ï¼Œæ­¤æ—¶$res^{d'^{-1}}$å·²çŸ¥ï¼Œå› æ­¤ä¹‹éœ€è¦å¼€ä¸ªå¹³æ–¹å°±å¯ä»¥å¾—åˆ°$m$ï¼Œ**è‹¥$b'$ä¸ä¸º2ï¼Œåˆ™ç›¸å½“äºå˜æˆäº†4.10.2èŠ‚çš„æƒ…å†µ**ã€‚ -->

###### 4.10.2 $e\ |\ \varphi(N)$
* æ”»å‡»å‰æï¼š$e$æ¯”è¾ƒå°ï¼Œä¸å¤§äº65536ã€‚è€Œä¸”æœ‰$e\ |\ (p-1)$ å’Œ $e\ |\ (q-1)$ã€‚è‹¥æœ‰å…¶ä¸­ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™ä¸‹é¢è®²åˆ°çš„AMMç®—æ³•å°±æ— æ³•æ±‚è§£ã€‚

ç°åœ¨ç›¸å½“äºæ˜¯è¿™æ ·çš„ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€ä¸ªæ–¹ç¨‹$$c\equiv m^e\ mod\ N, \tag{4.10}$$å…¶ä¸­$c,N,e,p,q$å·²çŸ¥ï¼Œéœ€è¦æ±‚$m$ã€‚ä½†æ˜¯æ­¤æ—¶æœ‰$e | \varphi(N)$ã€‚å› æ­¤è¿™ä¸ªæ–¹ç¨‹å¯ä»¥åŒ–ä¸º$$c\equiv m^e\ mod\ p \newline c\equiv m^e\ mod\ q$$å› ä¸º$e$ä¸$p,q$äº’ç´ ï¼Œå› æ­¤ä¸¤ä¸ªæ–¹ç¨‹å„æœ‰$e$ä¸ªæ ¹ï¼Œä»è€Œæ–¹ç¨‹$(4.10)$æœ‰$e^2$ä¸ªæ ¹ã€‚æˆ‘ä»¬çš„ç›®çš„å°±æ˜¯æ‰¾åˆ°è¿™$e^2$ä¸ªæ ¹ä¸­æˆ‘ä»¬éœ€è¦çš„é‚£ä¸ªï¼Œ**å°±æ˜¯æ‰¾åˆ°æœ‰ç‰¹æ®Šå­—ç¬¦ä¸²å¼€å¤´æ¯”å¦‚``flag{``å¼€å¤´çš„æ ¹$m$**ã€‚

* ä¸»è¦æµç¨‹ï¼š
    1. ç”¨**Adleman-Manders-Miller rth Root Extraction Method**åœ¨GF(p)å’ŒGF(q)ä¸Šå¯¹$c$å¼€$e$æ¬¡æ ¹ï¼Œåˆ†åˆ«å¾—åˆ°ä¸€ä¸ªè§£ã€‚
    2. æ‰¾åˆ°æ‰€æœ‰çš„$e$ä¸ªprimitive $e^{th}$ root of 1ï¼Œä¹˜ä»¥ä¸Šé¢é‚£ä¸ªè§£ï¼Œå¾—åˆ°æ‰€æœ‰çš„$e$ä¸ªæ–¹ç¨‹$c\equiv m^e\ mod\ p$å’Œæ–¹ç¨‹$c\equiv m^e\ mod\ q$çš„è§£.
    3. ç”¨**ä¸­å›½å‰©ä½™å®šç†CRT**å¯¹GF(p)å’ŒGF(q)ä¸Šçš„ä¸¤ç»„$e$ä¸ªè§£ç»„åˆæˆ$mod\ N$ä¸‹çš„è§£ï¼Œå¯ä»¥å¾—åˆ°$e^2$ä¸ªæ–¹ç¨‹$(4.10)$è§£ã€‚

**Adleman-Manders-Miller rth Root Extraction Method ï¼ˆAMMï¼‰**
![AMM](crypto/images/AMM.PNG)
https://arxiv.org/pdf/1111.4877.pdf  **Cao Z , Sha Q , Fan X . Adleman-Manders-Miller Root Extraction Method Revisited[J]. 2011.** è¿™ç¯‡æ–‡ç« é‡Œç»™å‡ºäº†ç®—æ³•çš„æ¨å¯¼è¿‡ç¨‹ï¼Œç”±äºç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œå°±ä¸å†™åœ¨è¿™é‡Œäº†ã€‚
æ›´è¯¦ç»†çš„è§£é‡Šå¯å‚è€ƒ https://blog.csdn.net/jcbx_/article/details/105303760 è¿™ç¯‡åšå®¢ã€‚

é¢˜å¤–è¯ï¼šå…¶å®å¼€næ¬¡æ–¹æ ¹çš„æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œè¿™åªæ˜¯å…¶ä¸­ä¸€ç§æ¯”è¾ƒå¥½ç†è§£å’Œå®ç°çš„ã€‚

**æ‰¾å‡ºæ‰€æœ‰çš„$e$ä¸ªprimitive $e^{th}$ root of 1**ï¼šä¸€ç§ä¸ä¸¥è°¨çš„åšæ³•å°±æ˜¯éšæœºç”Ÿæˆ$e$ä¸ª$GF(p)$ä¸Šçš„æ•°è®°$x_i,\ i\in[1,e]$ï¼Œç„¶åè®¡ç®—$x^{\frac{p-1}{e}}\ mod\ p = x_i$ï¼Œè¿™æ ·ä¸€æ¥æ¯ä¸ª$x_i^e \equiv 1\ mod\ p$ã€‚ä¸ä¸¥è°¨å°±åœ¨äºå¯èƒ½ä¼šå‡ºç°é‡å¤çš„ç°è±¡ã€‚

è¿›è€Œåªè¦ç”¨AMMç®—æ³•æ±‚å‡ºçš„$c$åœ¨$GF(p)$ä¸Šçš„$e$æ¬¡æ ¹è®°$m_p$ï¼Œåˆ™è®¡ç®—$m_pÂ·x_i\ mod\ p$å°±å¾—åˆ°æ‰€æœ‰çš„$e$ä¸ªæ–¹ç¨‹$c\equiv m^e\ mod\ p$çš„è§£ã€‚

* ä»£ç å‚è€ƒï¼šhttps://blog.csdn.net/cccchhhh6819/article/details/112766888 æœ¬è´¨ä¸Šè¿™é‡Œçš„ä»£ç æ˜¯å‚è€ƒstarctf2021_Crypto_little_caseé¢˜ç›®ä¸­çš„writeupã€‚
* ***å…·ä½“Sagemath9.2ä»£ç è§``crypto/code/AMM.sage``***

###### 4.10.3 $e\ |\ \varphi(N)\ v2$
åŒæ ·æœ‰$e\ |\ \varphi(N)$ï¼Œä½†æ˜¯å¯†æ–‡$c$æ²¡æœ‰$e$ä¸ªæ ¹ï¼Œå› ä¸ºæ­¤æ—¶æœ‰$e \nmid (p-1)$ã€‚ä¸å¤±ä¸€èˆ¬æ€§ï¼Œå‡è®¾æœ‰$gcd(e, p-1) = a$ï¼Œ$gcd(e, q-1) = b$ï¼Œå…¶ä¸­$1 < a,b < e$ã€‚**æš‚æ—¶è¿˜æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„ç®—æ³•è¿›è¡Œè®¡ç®—ã€‚** åªèƒ½å°†å°±ç€ä½¿ç”¨Sagemathä¸­çš„æ±‚æ ¹å‡½æ•°ï¼Œæ­¤æ—¶å½“$e > 100$æ—¶ï¼Œå‡½æ•°åŸºæœ¬ä¸Šä¸èƒ½æ±‚è§£ï¼Œå› ä¸ºæ—¶é—´å¤ªé•¿äº†ã€‚

* å‚è€ƒä»£ç ï¼š
    ```python
    P.<x> = GF(p)[]
    c_ = 
    f = x^e - c_
    print(f.roots())
    ```

###### å°æŠ€å·§
å› ä¸ºé¢˜ç›®ç»™å‡ºçš„$m$ä¸€èˆ¬æ¯”è¾ƒçš„å°ï¼Œå› æ­¤å½“å¾—åˆ°äº†$$c' = m^e \ mod\ N,$$çš„æ—¶å€™ï¼Œå¯ä»¥å°è¯•ç”¨`gmpy2.iroot`å‡½æ•°å¯¹$c'$å¼€$e$æ¬¡æ–¹æ ¹ï¼Œå½“$m^e < N$æ—¶å¯ä»¥æ¢å¤å‡º$m$ã€‚


##### 4.11 Small private CRT-exponents $d_p, d_q$

> è¿™ä¸€å°èŠ‚ä¸»è¦ä»‹ç»Bleichenbacher-May Attack

* Bleichenbacher-May Attack
    å½“$q < N^{0.468}$ ä¸” $d_p,d_q \leq min\{(N/e)^{0.4}, N^{0.25} \}$ æ—¶ï¼Œæ­¤æ”»å‡»å¯ä»¥å¯¹$N$è¿›è¡Œåˆ†è§£ã€‚
    * https://link.springer.com/content/pdf/10.1007%2F11745853_1
    * D. Bleichenbacher, A. May, â€New Attacks on RSA with Small Secret CRTExponentsâ€, Proceedings of PKC 2006, LNCS 3958 [2006], pp. 1â€“13.
    * å·²çŸ¥å¼$$ed_p=1+k(p-1) \\ ed_q=1+l(q-1)$$ç›¸ä¹˜å¹¶å±•å¼€å¾—$$e^2d_pd_q+ed_p(l-1)+ed_q(k-1)-(N-1)kl=k+l-1$$æˆ‘ä»¬ä»¤$$w = d_pd_q \\ x =d_p(l-1)+d_q(k-1) \\ y=kl \\ z=k+l-1$$åˆ™æˆ‘ä»¬å¯ä»¥æ„é€ æ ¼$$L = \left[\begin{matrix}
    1 & 0 & e\\
    0 & 1 & 1-N\\
    0 & 0 & e^2\\
    \end{matrix}\right]$$ å› æ­¤æˆ‘ä»¬æœ‰$[x\ y\ w]*L = [x\ y\ z]$ï¼Œè¿™é‡Œ$[x\ y\ w]$æ˜¯ä¸€ä¸ªçº¿æ€§å˜æ¢ï¼Œé€šè¿‡LLLç®—æ³•æ±‚å‡ºçš„æœ€çŸ­å‘é‡å°†ä¼šæ˜¯$[x\ y\ z]$çš„å½¢å¼ã€‚æˆ‘ä»¬ä¸èƒ½ç›´æ¥å¯¹æ ¼$L$è¿›è¡Œè§„çº¦ï¼Œå› ä¸ºè¿˜éœ€è¦ä¿è¯$[x\ y\ w]$æœ‰ç›¸åŒçš„å¤§å°ï¼Œå› æ­¤$L$éœ€è¦æœ‰ä¹˜ä¸€ä¸ªå¯¹è§’é˜µæ¥å¹³è¡¡ç›®æ ‡å‘é‡ï¼Œå³ä»¤$[x\ y\ w]$ä¸­çš„æ¯ä¸ªå…ƒç´ å¤§å°å¤§è‡´ç›¸åŒã€‚
    * å‚è€ƒä»£ç ï¼š
    ```python
    # Sagemath 9.2
    e = 399995007353334843492700652707
    n = 183656432204946278583158645163956954879148229006140604544321
    
    m = Matrix(ZZ, 3, 3)
    m[0,0] = 1
    m[0,2] = e
    m[1,1] = 1
    m[1,2] = 1-n
    m[2,2] = e*e
    
    ml = m.LLL()
    ttt = ml.rows() 
    # print(ttt[0])
    
    kl = abs(ttt[0][1])
    kpl_1 = abs(ttt[0][2])
    # x^2-(kpl_1+1)x + kl = 0
    k = int(kpl_1+1 +((kpl_1+1)**2-4*kl)**0.5)//2
    l = kpl_1+1-k
    
    for i in range(0,5):
        dp = inverse_mod(e, k)+i*k
        for j in range(0,5):
            dq = inverse_mod(e, l) + j*l
            p = (e * dp - 1) // k + 1
            q = (e * dq - 1) // l + 1
            if is_prime(p) and is_prime(q):
                print(p,q)
    ```



* å½“$d_p,d_q < N^{0.073}$æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¾å¯†ä¼šä¸­çš„ä¸€ç¯‡æ–‡ç« å¯¹$N$è¿›è¡Œåˆ†è§£
    * https://www.iacr.org/archive/crypto2007/46220388/46220388.pdf
    * Jochemsz E ,  May A . A Polynomial Time Attack on RSA with Private CRT-Exponents Smaller Than N 0.073[J]. International Cryptology Conference on Advances in Cryptology, 2007.



##### 4.12 Unbalanced Small private CRT-exponents $d_p, d_q$

å½“$p,q$ç›¸å·®æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œè®°$p=N^{1-\beta}, q = N^{\beta}$ï¼Œå…¶ä¸­$\beta < 0.38$ï¼Œ$d_p,d_q < N^{\delta}$ï¼Œå…¶ä¸­$\delta \leq 1-\frac{2}{3}\beta + \frac{2}{3}\sqrt{3\beta + \beta^2} -\epsilon$ï¼Œæ­¤æ—¶ä½¿ç”¨Mayæå‡ºçš„æ–¹æ¡ˆå¯ä»¥æŠŠ$N$åˆ†è§£ã€‚

å…¶ä¸­Mayä¸€å…±æå‡ºäº†ä¸‰ä¸ªç®—æ³•(å‰ä¸¤ä¸ªç®—æ³•åœ¨[2]ï¼Œç¬¬ä¸‰ä¸ªç®—æ³•åœ¨[1])ï¼Œæ­£å¸¸æ¥è¯´é¢˜ç›®ä¸€èˆ¬åªä¼šå‡ºåˆ°Mayçš„ç¬¬äºŒä¸ªç®—æ³•ã€‚

åœ¨ç¬¬äºŒä¸ªç®—æ³•ä¸­ï¼Œç”±äºç•Œçš„é—®é¢˜ï¼Œä¸»è¦å°±æ˜¯æ±‚è§£æ—¶çš„å‚æ•°$t=\tau m$éœ€è¦é€‚å½“åœ°å¢å¤§ï¼Œå’Œç•Œ$X,Y$éœ€è¦é€‚å½“åœ°å‡å°ã€‚å› ä¸ºè®ºæ–‡ä¸­æœ‰ç‚¹ç†æƒ³åŒ–ï¼Œå› æ­¤æ±‚è¡Œåˆ—å¼çš„æ—¶å€™æŠŠç•Œå†™å°äº†ï¼Œå› æ­¤è¿™é‡Œçš„å‚æ•°$t$è¦é€‚å½“åœ°å¢å¤§ï¼Œç›´æ¥å–$t=3$æˆ–$t=5$ï¼Œè¿™æ ·ä¸€èˆ¬éƒ½èƒ½è§£å‡ºæ¥ã€‚ç¬¬äºŒä¸ªå‘å°±æ˜¯ç•Œ$X,Y$çš„é€‰å–ï¼Œè¦æ±‚$$X=N^{\beta+\delta} \\ Y = N^{\beta}$$ æˆ‘ä»¬éœ€è¦æ„è¯†åˆ°æ–¹ç¨‹$$ed_pq=(kâˆ’1)(Nâˆ’q)+N$$ æœ‰å°æ ¹ $(kâˆ’1,q)$ï¼Œåˆ™$X>k-1, Y> q$ï¼Œå› æ­¤$Y$å¯å–$N^{\beta}$ï¼Œä½†æ˜¯ä»”ç»†è§‚å¯Ÿä»¥ä¸‹æ³¨æ„ç”Ÿæˆå‚æ•°çš„æ—¶å€™$e,d_p,q$éƒ½æ¯”ç•Œè¦å°ï¼Œå› æ­¤è¿™é‡Œçš„$Y$ä¼šåå°ï¼Œå› æ­¤æœ€å¥½å°±æ˜¯$Y = N^{\beta} // (2^5)$

* å‚è€ƒèµ„æ–™
  * [1] https://www.iacr.org/archive/pkc2006/39580001/39580001.pdf
  * [2] https://rd.springer.com/content/pdf/10.1007%2F3-540-45708-9_16.pdf
  * [3] https://www.iacr.org/archive/eurocrypt2017/10210359/10210359.pdf

* é¢˜ç›®ï¼š2022å¹´TQLCTFâ€”â€”hardrsa
* ***å…·ä½“Sagemath9.2ä»£ç è§``crypto/code/May__Unbalanced_prime_and_small_CRT_exponents.sage``***

#### äº”ã€å˜ç§RSAå¯†ç åˆ†æ

è§Cryptanalysis of RSA and It's Variantsçš„Section 11 Common Prime RSAä¸­çš„å†…å®¹ã€‚

##### 5.1 Common Prime RSA (ç´ æ•°ä¸­å«æœ‰å…¬çº¦æ•°)
å¯¹äº$N=pq$ï¼Œè‹¥æœ‰$p-1=2ag,\ q-1 = 2bg$ã€‚åˆ™æ­¤RSAä¸ºCommon Prime RSA. 

###### 5.1.1 å…¬å› æ•°$g\approx N^{1/2}$
è¿™æ ·ä¸€æ¥å°±æœ‰$N=2g(2gab+a+b)+1$ï¼Œåˆå› ä¸º$p-1=2ga$ï¼Œå› æ­¤æœ‰$c^{N-1}\ mod\ N$æœ‰$ab$ä¸ªå…ƒç´ ï¼Œè€Œåœ¨æ¨¡$p$çš„ä¹˜æ³•ç¾¤ä¸­åªæœ‰$a$ä¸ªå…ƒç´ ï¼Œç„¶åä½¿ç”¨Pollard rhoç®—æ³•çš„æ—¶å€™ç®—æ³•å¤æ‚åº¦å°±å˜ä¸ºäº†$O(\sqrt{a})$ã€‚

å› æ­¤å½“$g\approx N^{1/2}$æ—¶ï¼Œ$O(\sqrt{a})$å°±å¾ˆå°ï¼Œå¯ä»¥ç”¨Pollard rhoç®—æ³•è¿›è¡Œæ±‚è§£ã€‚

###### 5.1.2 å·²çŸ¥$a,b$
æ ¹æ®æ–¹ç¨‹$N=2g(2gab+a+b)+1$ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å‡º $$4abg^2+2(a+b)g-N+1=0$$ é€šè¿‡è§£ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å°±å¯ä»¥æŠŠ$g$è§£å‡ºæ¥ã€‚

###### 5.1.3 å·²çŸ¥$g$
è¿™é‡Œéœ€è¦åˆ†3ç§æƒ…å†µã€‚åˆ†åˆ«æ˜¯$g>a+b$,$g=a+b$,$g < a+b$ï¼Œä¸”ç´ æ•°$p,q$éœ€è¦æ˜¯å¹³è¡¡çš„ã€‚
* $g > a+b$
  * ä»¤$c=a+b$ï¼Œæœ‰$$N=2g(2gab+a+b)+1\ (1)$$ï¼Œåˆ™æœ‰$M=2gab+c$ï¼Œå› æ­¤$c=M\ mod\ g$ï¼Œå› æ­¤ä»¤$b=c-a$ï¼Œä»£å…¥æ–¹ç¨‹(1)å¯ä»¥åˆ—å‡ºå…³äº$a$çš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ï¼Œä»è€Œæ±‚è§£å‡º$a$ã€‚
* $g = a+b$
  * å’Œä¸Šé¢çš„ç±»ä¼¼
* $g < a+b$
  * ç”±æ–¹ç¨‹(1)å¾—$$\frac{N-1}{2g}=2gu+v$$ å…¶ä¸­$0\leq v < 2g$ä¸”$u,v$å·²çŸ¥ã€‚ç„¶å$\exist c$ä»¤$$\begin{cases} a+b=v+2gc \\ ab=u-c \end{cases}$$ åˆ™å¯¹äº$gcd(x,N)=1$ï¼Œæœ‰$x^{2gu}\equiv x^{2gab+2gc}\equiv x^{2gc}\ (mod\ N)$ï¼Œä»¤$y=x^{2g}$ï¼Œåˆ™æˆ‘ä»¬æœ‰åŒä½™æ–¹ç¨‹$$y^u\equiv y^c\ (mod\ N)$$ ç„¶åæ±‚ç¦»æ•£å¯¹æ•°å°±å¯ä»¥æŠŠ$c$æ±‚å‡ºæ¥ã€‚çŸ¥é“$c$ä¹‹åä»£å…¥æ–¹ç¨‹ç»„å°±å¯ä»¥æŠŠ$a,b$æ±‚å‡ºï¼ŒæˆåŠŸåˆ†è§£$N$ã€‚ 
  * å…¶ä¸­$c$çš„å–å€¼ä¸º$c\leq a+b \approx 2N^{0.5-\gamma}$ï¼Œå…¶ä¸­$\gamma\approx\frac{1}{4}-mlog(long(N))$ï¼Œ$m$ä¸ºå¸¸æ•°ã€‚ç®—æ³•å¤æ‚åº¦çº¦ä¸º$O(\sqrt(c))$ã€‚


#### å…­ã€é€‰æ‹©æ˜å¯†æ–‡æ”»å‡»
##### 6.1 é€‰æ‹©æ˜æ–‡æ”»å‡»
* å‰æï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªOracleï¼Œå¯¹äºç»™å®šä»»æ„æ˜æ–‡ï¼ŒOracleéƒ½ä¼šç»™å‡ºç›¸åº”çš„å¯†æ–‡ã€‚
* ç›®æ ‡ï¼šè·å–å…¬é’¥Nï¼Œe
    1. é¦–å…ˆé€šè¿‡æ„é€ å¤šå¯¹åŠ è§£å¯†è·å–Nã€‚
    2. å½“$e < 2^{64}$æ—¶ï¼Œç”¨ Pollardâ€™s kangaroo algorithm ç®—æ³•è·å–å…¬é’¥$e$ã€‚

##### 6.2 é€‰æ‹©å¯†æ–‡æ”»å‡»
* å‰æï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªOracleï¼Œå¯¹äºä»»æ„çš„åˆæ³•å¯†æ–‡ï¼ŒOracleéƒ½ä¼šç»™å‡ºç›¸åº”çš„æ˜æ–‡(ç›¸å½“äºæ—¶æ”»å‡»è€…ä¸´æ—¶è·å¾—äº†è§£å¯†æœºå™¨çš„è®¿é—®æƒ)ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å¯†é’¥ã€‚
* ç›®æ ‡ï¼šAliceè®¡ç®—$C=m^e\ mod\ N$ï¼ŒæŠŠAliceç”¨è‡ªå·±çš„å…¬é’¥ç­¾åçš„ä¿¡æ¯$m$æ¢å¤å‡ºæ¥ã€‚
    1. é€‰æ‹©ä»»æ„$X\in Z_N^*$
    2. è®¡ç®—$Y=CX^e\ mod\ N$
    3. æƒ³åŠæ³•è®©Aliceè®¡ç®—$Z = Y^d\ mod\ N$
    4. $m = ZX^{-1}\ mod\ N$

æ­¤æ”»å‡»å¹¶æ²¡æœ‰æŠŠAliceçš„ç§é’¥æ¢å¤å‡ºæ¥ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹RSAåè®®æœ¬èº«çš„æ”»å‡»è€Œä¸æ˜¯ç®—æ³•çš„æ”»å‡»ã€‚

##### 6.3 RSA parity oracle
å‡è®¾ç›®å‰å­˜åœ¨ä¸€ä¸ª Oracleï¼Œå®ƒä¼šå¯¹ä¸€ä¸ªç»™å®šçš„å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œå¹¶ä¸”ä¼šæ£€æŸ¥è§£å¯†çš„æ˜æ–‡çš„å¥‡å¶æ€§ï¼Œå¹¶æ ¹æ®å¥‡å¶æ€§è¿”å›ç›¸åº”çš„å€¼ï¼Œæ¯”å¦‚ 1 è¡¨ç¤ºå¥‡æ•°ï¼Œ0 è¡¨ç¤ºå¶æ•°ã€‚é‚£ä¹ˆç»™å®šä¸€ä¸ªåŠ å¯†åçš„å¯†æ–‡ï¼Œæˆ‘ä»¬åªéœ€è¦ log(N) æ¬¡å°±å¯ä»¥çŸ¥é“è¿™ä¸ªå¯†æ–‡å¯¹åº”çš„æ˜æ–‡æ¶ˆæ¯ã€‚

Oracleè¿”å›å¥‡å¶æ€§ä¿¡æ¯é€ æˆäº†ä¿¡æ¯çš„æ³„éœ²ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨é€‰æ‹©æ˜æ–‡æ”»å‡»çš„æ€è·¯è¿›è¡Œæ”»å‡»ï¼Œå…·ä½“çš„æ”»å‡»æ–¹æ¡ˆè§ï¼šhttps://ctf-wiki.org/crypto/asymmetric/rsa/rsa_chosen_plain_cipher/

* æœ¬è´¨ä¸Šæ˜¯äºŒåˆ†æ³•ï¼Œç„¶åå¤¹é€¼ã€‚

##### 6.4 RSA Byte Oracle
å‡è®¾ç›®å‰å­˜åœ¨ä¸€ä¸ª Oracleï¼Œå®ƒä¼šå¯¹ä¸€ä¸ªç»™å®šçš„å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œå¹¶ä¸”ä¼šç»™å‡ºæ˜æ–‡çš„æœ€åä¸€ä¸ªå­—èŠ‚ã€‚é‚£ä¹ˆç»™å®šä¸€ä¸ªåŠ å¯†åçš„å¯†æ–‡ï¼Œæˆ‘ä»¬åªéœ€è¦$log_{256}N$æ¬¡å°±å¯ä»¥çŸ¥é“è¿™ä¸ªå¯†æ–‡å¯¹åº”çš„æ˜æ–‡æ¶ˆæ¯ã€‚

å…·ä½“æ–¹æ¡ˆåŒæ ·è§ï¼šhttps://ctf-wiki.org/crypto/asymmetric/rsa/rsa_chosen_plain_cipher/

##### 6.5 RSA parity oracle variant
å¦‚æœ oracle çš„å‚æ•°ä¼šåœ¨ä¸€å®šæ—¶é—´ã€è¿è¡Œå‘¨æœŸåæ”¹å˜ï¼Œæˆ–è€…ç½‘ç»œä¸ç¨³å®šå¯¼è‡´ä¼šè¯æ–­å¼€ã€é‡ç½®ï¼ŒäºŒåˆ†æ³•å°±ä¸å†é€‚ç”¨äº†ï¼Œä¸ºäº†å‡å°‘é”™è¯¯ï¼Œåº”å½“è€ƒè™‘é€ä½æ¢å¤ã€‚

è¿™é‡Œçš„æ”»å‡»æ˜¯åŸºäº**RSA parity Oracle** æ–¹æ¡ˆï¼Œå³å¯¹ä¸€ä¸ªç»™å®šçš„å¯†æ–‡è§£å¯†åä¼šæ£€æŸ¥æ˜æ–‡çš„å¥‡å¶æ€§ï¼Œç„¶åè¿”å›ç›¸åº”çš„å€¼ã€‚è¿™é‡Œæ‰€å­˜åœ¨çš„é—®é¢˜æ˜¯æ¯æ¬¡åŠ å¯†å’Œè§£å¯†æ‰€ä½¿ç”¨çš„å¯†é’¥ä¼šä¸ä¸€æ ·ï¼Œ5.3èŠ‚ä¸­æ‰€ä»‹ç»çš„äºŒåˆ†æ³•çš„åŸç†æ˜¯åœ¨ç›¸åŒçš„å¯†é’¥çš„æƒ…å†µä¸‹é€šè¿‡é€‰æ‹©æ˜æ–‡æ”»å‡»ä¸æ–­å‘é€æ¶ˆæ¯ï¼Œä»è€Œå¾—å‡ºæ˜æ–‡ã€‚

è€Œåœ¨ä¸åŒçš„å¯†é’¥çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é€æ¯”ç‰¹è¿›è¡Œæ¢å¤ã€‚åŸç†å¦‚ä¸‹ï¼š
* é¦–å…ˆæ˜æ–‡ä¸º$m$ï¼Œå¯†æ–‡ä¸º$c_i$ï¼Œå…¬é’¥ä¸º$e_i,N_i$ï¼Œç§é’¥ä¸º$d_i$ï¼Œå…¶ä¸­$i$è¡¨ç¤ºç¬¬$i$æ¬¡åœ¨Oracleä¸­çš„æ•°æ®ï¼Œå…¶ä¸­å¯†æ–‡å’Œå…¬é’¥æ˜¯å¯ä»¥è·å–çš„ã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»Oracleçš„æ‰‹ä¸­è·å¾—æ˜æ–‡çš„æœ€åä¸€ä¸ªbitï¼Œå³æˆ‘ä»¬å¯ä»¥æŠŠ$c_i$é‡æ–°å‘ç»™Oracleï¼Œç„¶åOracleä¼šè¿”å›$y = c_i^{d_i}\ mod\ 2$ã€‚
* **æ”»å‡»ï¼š** è¦æ¢å¤æ˜æ–‡çš„ç¬¬$j$æ¯”ç‰¹ï¼Œåˆ™æŠŠ$c_i(2^{-je_i\ mod\ N_i})$å‘é€ç»™Oracleï¼Œåˆ™Oracleå°†ä¼šè¿”å›$$y_j \equiv a_j + a_{j-1} \times 2^{j-1} \times 2^{-j} + ... + a_0 \times 2^0 \times 2^{-j}$$ æ ¹æ®å‰é¢æ¢å¤å‡ºçš„æ˜æ–‡$m$çš„å‰$j$æ¯”ç‰¹:$a_0,a_1,...,a_{j-1}$å®¹æ˜“è®¡ç®—å¾—å‡ºæ˜æ–‡$m$çš„ç¬¬$j$æ¯”ç‰¹$a_j$ã€‚

**æ³¨æ„ï¼š** è¿™é‡Œçš„æ”»å‡»åŒæ ·é€‚ç”¨äº5.3èŠ‚è¯´è®²åˆ°çš„RSA parity Oracle æ”»å‡»ã€‚

å…·ä½“æ–¹æ¡ˆåŒæ ·è§ï¼šhttps://ctf-wiki.org/crypto/asymmetric/rsa/rsa_chosen_plain_cipher/
* ***å…·ä½“Python3ä»£ç è§``crypto/code/RSA_parity_oracle_variant.py``***

#### ä¸ƒã€ä¾§ä¿¡é“æ”»å‡»
ä¾§ä¿¡é“æ”»å‡»ï¼šæ”»å‡»è€…èƒ½è·å–å¯†ç è®¾å¤‡ä¸­çš„ä¾§ä¿¡é“ä¿¡æ¯(ä¾‹å¦‚èƒ½é‡æ¶ˆè€—ã€è¿ç®—æ—¶é—´ã€ç”µç£è¾å°„ç­‰ç­‰)ä»è€Œè·å–å¯†ç ä¿¡æ¯ã€‚

æ”»å‡»æ¡ä»¶ï¼šå¯†ç å®ç°çš„è¿‡ç¨‹ä¸­ä¾§ä¿¡é“ä¿¡æ¯æ³„éœ²ï¼Œèƒ½ä»ä¾§ä¿¡é“ä¿¡æ¯ä¸­è·å–åŠ å¯†è¿‡ç¨‹çš„ä¿¡æ¯ï¼Œä»è€Œåˆ†æå‡ºæ˜æ–‡ã€‚

è¯¦ç»†ä¾‹å­è§ï¼šhttps://ctf-wiki.org/crypto/asymmetric/rsa/rsa_side_channel/

#### å…«ã€åŸºäºå…·ä½“RSAå®ç°çš„æ”»å‡»
##### 8.1  Bleichenbacher's Attack on PK CS 1
å³åœ¨PKCS 1(Public Key Cryptography Standard 1)ä¸­å®ç°æ—¶å¯ä»¥æ‰¾å‡ºå®ç°æ—¶çš„æ¼æ´ï¼Œç„¶åç›¸å½“äºæ•Œæ‰‹è·å¾—ä¸€ä¸ªoracleï¼Œä½¿å¾—æ•Œæ‰‹å¯ä»¥ä¸æ–­çŒœæµ‹ä¸€ä¸ªä¼ªé€ çš„ç­¾åï¼ŒçŸ¥é“çŒœæµ‹æˆåŠŸã€‚

è¿™ç§æ”»å‡»ä¸»è¦é’ˆå¯¹PKCS 1å®ç°æ—¶çš„æ”»å‡»ã€‚

***æ³¨ï¼šè¿™é‡Œåªæä¾›ç†è®ºæ”¯æ’‘ï¼Œè¯¦ç»†ä¾‹å­è§cryptoæ–‡ä»¶å¤¹ä¸­çš„å„ä¸ªwriteupã€‚å…¶å®æœ‰ä¸€éƒ¨åˆ†ç†è®ºæˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œç‰¹åˆ«æ˜¯Coppersmithæ–¹æ¡ˆä¸­çš„æ–¹æ³•ã€‚è¦åšå‡ é“é¢˜æ¥å†ææ¸…æ¥šä¸€ä¸‹å…¶ç»†èŠ‚çš„æ–¹æ¡ˆï¼Œç‰¹åˆ«æ˜¯***
1. ***Coppersmithæ–¹æ¡ˆè§£æ–¹ç¨‹çš„å®ç°***
2. ***éƒ¨åˆ†å¯†é’¥æ³„éœ²æ”»å‡»***
3. ***Boneh and Durfee attack***








## èƒŒåŒ…åŠ å¯† (knapsack based cryptosystem)
* å‚è€ƒï¼šhttps://ctf-wiki.org/crypto/asymmetric/knapsack/knapsack/#_9

![Knapsack_problem](crypto/images/Knapsack_problem.PNG)
èƒŒåŒ…é—®é¢˜éœ€è¦æ»¡è¶³$a_i$ä¸ºè¶…é€’å¢åºåˆ—çš„æ—¶å€™æ‰èƒ½æ»¡è¶³è§£å¯†çš„è¦æ±‚ï¼Œä½†æ­¤æ—¶å…¶ä»–äººä¹Ÿå¯ä»¥æˆªè·å¯†æ–‡è¿›è¡Œç ´è¯‘ã€‚å› æ­¤å‡ºç°äº†**Merkle-Hellman**ç®—æ³•ï¼Œä»è€Œè®¾è®¡å‡ºèƒŒåŒ…åŠ å¯†ã€‚æ‰€è°“çš„è¶…é€’å¢åºåˆ—æ˜¯æŒ‡æ»¡è¶³$$a_i>\sum_{k=1}^{i-1}a_k$$çš„åºåˆ—ã€‚

* **Merkle-Hellmanç®—æ³•**
    * å‚è€ƒï¼šhttp://en.wikipedia.org/wiki/Merkle%E2%80%93Hellman_knapsack_cryptosystem
    * ç§é’¥ï¼šè¶…é€’å¢åºåˆ—$a_i$ã€‚
    * å…¬é’¥ï¼šé¦–å…ˆç”Ÿæˆæ¨¡æ•°$m$ï¼Œæ»¡è¶³$m>\sum_{i=1}^{n}a_i$ã€‚é€‰å–$w$æ»¡è¶³$gcd(w,m)=1$ï¼Œç„¶åè®¡ç®—$b_i\equiv wa_i\ mod\ m$ã€‚æœ€ååºåˆ—$b_i$å’Œ$m$ä½œä¸ºå…¬é’¥ã€‚
    * åŠ å¯†ï¼šå‡è®¾æˆ‘ä»¬è¦åŠ å¯†çš„æ˜æ–‡ä¸º$v$ï¼Œå…¶æ¯ä¸€ä¸ªæ¯”ç‰¹ä½ä¸º$v_i$ï¼Œé‚£ä¹ˆæˆ‘ä»¬åŠ å¯†çš„ç»“æœä¸º$$\sum_{i=1}^{n}b_iv_i\ mod\ m$$
    * è§£å¯†ï¼šè®¡ç®—$w^{-1}$ï¼Œè®¡ç®—$$\sum_{i=1}^{n}w^{-1}b_iv_i\ mod\ m = \sum_{i=1}^{n}a_iv_i\ mod\ m$$ä»è€Œæ ¹æ®èƒŒåŒ…æ–¹æ¡ˆæ¢å¤å‡ºæ˜æ–‡ã€‚
* ç ´è§£ï¼šè¯¥åŠ å¯†ä½“åˆ¶åœ¨æå‡ºåä¸¤å¹´åè¯¥ä½“åˆ¶å³è¢«ç ´è¯‘ï¼Œç ´è¯‘çš„åŸºæœ¬æ€æƒ³æ˜¯æˆ‘ä»¬ä¸ä¸€å®šè¦æ‰¾å‡ºæ­£ç¡®çš„ä¹˜æ•° $w$ï¼ˆå³é™·é—¨ä¿¡æ¯ï¼‰ï¼Œåªéœ€æ‰¾å‡ºä»»æ„æ¨¡æ•° $m'$ å’Œä¹˜æ•° $w'$ï¼Œåªè¦ä½¿ç”¨ $w'$ å»ä¹˜å…¬å¼€çš„èƒŒåŒ…å‘é‡ $B$ æ—¶ï¼Œèƒ½å¤Ÿäº§ç”Ÿè¶…é€’å¢çš„èƒŒåŒ…å‘é‡å³å¯ã€‚
* å‚è€ƒä»£ç ï¼šhttps://github.com/ctfs/write-ups-2014/tree/b02bcbb2737907dd0aa39c5d4df1d1e270958f54/asis-ctf-quals-2014/archaic

* **ä½¿ç”¨æ ¼è§„çº¦ç®—æ³•è¿›è¡Œæ±‚è§£ï¼Œè¯¦ç»†å‚è€ƒHASHå‡½æ•°ä¸­FNVéƒ¨åˆ†ã€‚**










##  ç¦»æ•£å¯¹æ•°
**ç¦»æ•£å¯¹æ•°é—®é¢˜å®šä¹‰ï¼š** ç»™å®šæœ‰é™ä¹˜æ³•ç¾¤$(G,\cdot)$ï¼Œ$g\in G$ï¼Œä¸”æœ‰$|G|=n$ã€‚åˆ™$\langle g \rangle$æ˜¯$G$çš„ä¸€ä¸ªå­ç¾¤ï¼Œä½¿å¾—$g^d\equiv1\ mod\ n$æˆç«‹çš„æœ€å°çš„æ­£æ•´æ•°$d$ä¸ºç¾¤$\langle g \rangle$çš„é˜¶ã€‚ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œå¯†ç ä½“åˆ¶ä¸­Gä¸€èˆ¬æ˜¯æœ‰é™åŸŸ$Z_p$ã€‚ï¼‰ç»™å®šä¸€ä¸ª$n$é˜¶å…ƒç´ $\alpha\in G$å’Œå…ƒç´ $\beta\in\alpha$ï¼Œæ‰¾å‡ºå”¯ä¸€çš„æ•´æ•°$aï¼Œ0\leq a\leq n$ï¼Œæ»¡è¶³$$\alpha^a=\beta$$åˆ™æ•´æ•°$a$ä¸º$\beta$çš„ç¦»æ•£å¯¹æ•°ã€‚ç¦»æ•£å¯¹æ•°é—®é¢˜å°±æ˜¯æŠŠæ•´æ•°$a$æ±‚å‡ºæ¥ã€‚

æ€§è´¨ï¼šæ¨¡$m$å‰©ä½™ç³»å­˜åœ¨åŸæ ¹çš„å……è¦æ¡ä»¶$m=2,4,p^{\alpha},2p^{\alpha}$å…¶ä¸­$p$ä¸ºå¥‡ç´ æ•°ï¼Œ$\alpha$ä¸ºæ­£æ•´æ•°ã€‚

* ç¦»æ•£å¯¹æ•°æ±‚è§£ç›¸å…³ç®—æ³•å®ç°ï¼šhttps://blog.csdn.net/qq_41956187/article/details/104981499
* ***å…·ä½“Python3.7ä»£ç è§``crypto/code/Discrete_logarithm_algorithm.py``***

#### å¸¸è§æ±‚è§£æ–¹æ³•ï¼š
##### 1 Baby-step giant-step å¤§æ­¥å°æ­¥æ³•
æœ‰ä¸­é—´ç›¸é‡æ”»å‡»çš„æ€æƒ³ã€‚

ä»¤$m=\sqrt(n)$ï¼Œå¯¹äºç¦»æ•£å¯¹æ•°$\beta=\alpha^a$ã€‚æœ‰$a=mj+iï¼Œi < m$ã€‚å› æ­¤æœ‰$$\alpha^{mj+i}=\beta \newline \alpha^{mj}=\beta \alpha^{-i}$$å› æ­¤è®¡ç®—å‡º$m$ä¸ª$\alpha^{mj}$è®°ä¸º$L_1=(j,\alpha^{mj})$ã€‚ä»¥åŠ$m$ä¸ª$\beta \alpha^{-i}$è®°ä¸º$L_2=(i,\beta \alpha^{-i})$ã€‚ç„¶åæ‰¾å‡º$L_1,L_2$ä¸­æ»¡è¶³$\alpha^{mj}=\beta \alpha^{-i}$é‡å¤çš„æ•°å€¼å¯¹ï¼Œé‚£ä¹ˆå°±æœ‰$a=(mj+i)\ mod\ n$ã€‚

##### 2 Pollardâ€™s Ï algorithm

æ­¤ç®—æ³•èƒ½ä»¥$O(\sqrt{n})$çš„æ—¶é—´å¤æ‚åº¦å’Œ$O(1)$çš„ç©ºé—´å¤æ‚åº¦æ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚

ç®—æ³•çš„åŸç†æ˜¯ç”Ÿæ—¥æ”»å‡»ã€‚ï¼ˆæ‰©å±•çš„ç®—æ³•æœ‰åˆ†å¸ƒå¼Pollard $\rho$ç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦æ¯”æœ€åˆå§‹çš„ç®—æ³•è¦å¿«è®¸å¤šï¼‰

##### 3 Pollardâ€™s kangaroo algorithm ä¹Ÿç§°ä¸º$\lambda$ç®—æ³•

è‹¥æœ‰ç¦»æ•£å¯¹æ•°é—®é¢˜$h=g^x$ã€‚é‚£ä¹ˆå½“å·²çŸ¥$a\leq x\leq b$æ—¶ï¼Œæ­¤ç®—æ³•èƒ½ä»¥$O(\sqrt{b-a})$çš„æ—¶é—´å¤æ‚åº¦æ±‚å‡º$x$ã€‚

å½¢è±¡çš„æ¥è¯´ï¼ŒPollard's Kangarooç®—æ³•å°±æ˜¯ä½¿å¾—ä¸¤åªè¢‹é¼ åœ¨è§£ç©ºé—´é‡Œé¢å„è‡ªè·³è·ƒï¼Œå…¶ä¸­ä¸€åªä¸ºé©¯åŒ–çš„è¢‹é¼ ï¼Œå®ƒçš„å‚æ•°éƒ½æ˜¯ç¡®å®šçš„ï¼Œè€Œå¦ä¸€åªä¸ºé‡ç”Ÿçš„è¢‹é¼ ï¼Œå®ƒçš„å‚æ•°æ˜¯è¦æ±‚çš„ã€‚é©¯åŒ–è¢‹é¼ æ¯æ¬¡è·³è·ƒä¹‹åéƒ½ä¼šåšä¸€ä¸ªé™·é˜±ï¼Œå¦‚æœé‡ç”Ÿè¢‹é¼ çš„æŸæ¬¡è·³è·ƒç¢°åˆ°äº†è¿™ä¸ªé™·é˜±ï¼Œåˆ™è¡¨æ˜ä»–ä»¬çš„å‚æ•°æ˜¯ä¸€è‡´çš„ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥ä½¿ç”¨é©¯åŒ–è¢‹é¼ çš„å‚æ•°æ¥æ¨å¯¼å‡ºé‡ç”Ÿè¢‹é¼ çš„å‚æ•°ã€‚ç”±äºè¿™æ ·ä¸€ä¸ªè¿‡ç¨‹æ˜¯ä¸¤æ¡ä¸åŒçš„è·¯å¾„ç»è¿‡å˜åŒ–å¾—åˆ°ä¸€ä¸ªäº¤ç‚¹ï¼Œè·¯å¾„çœ‹èµ·æ¥æœ‰ç‚¹åƒå¸Œè…Šå­—æ¯lambdaï¼Œæ‰€ä»¥è¯¥ç®—æ³•ä¹Ÿç§°ä¸ºlambdaç®—æ³•ã€‚

åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/hillman_yq/article/details/1648141

* é«˜æ•ˆç®—æ³•ï¼šhttps://github.com/JeanLucPons/Kangaroo

* Sagemathä¸­å„ç§æ±‚ç¦»æ•£å¯¹æ•°çš„æ–¹æ³•
```python
# Sagemath 9.2
#é€šç”¨çš„æ±‚ç¦»æ•£å¯¹æ•°çš„æ–¹æ³•
# ALGORITHM: Pohlig-Hellman and Baby step giant step.
x=discrete_log(a,base,ord,operation)

#æ±‚ç¦»æ•£å¯¹æ•°çš„Pollard-Rhoç®—æ³•
x=discrete_log_rho(a,base,ord,operation)

#æ±‚ç¦»æ•£å¯¹æ•°çš„Pollard-kangarooç®—æ³•(ä¹Ÿç§°ä¸ºlambdaç®—æ³•)
x=discrete_log_lambda(a,base,bounds,operation)

#å°æ­¥å¤§æ­¥æ³•
x=bsgs(base,a,bounds,operation)
```

* æ›´è¯¦ç»†çš„ç”¨æ³•å’Œä¾‹å­å‚è€ƒSageæ–‡æ¡£ï¼šhttps://doc.sagemath.org/html/en/reference/groups/sage/groups/generic.html?highlight=discrete_log_rho

##### 4 Pohlig-Hellman algorithm

æ­¤ç®—æ³•ç”¨äºå…ƒç´ $\alpha\in G$çš„é˜¶$n$ä¸ä¸ºç´ æ•°çš„æƒ…å†µã€‚å‡è®¾$n=\prod_{i-1}^kp_i^{c_i}$ï¼Œå…¶ä¸­$p_i$ä¸ºä¸åŒçš„ç´ æ•°ã€‚å› ä¸º$a=log_{\alpha}\beta$æ˜¯æ¨¡$n$å”¯ä¸€ç¡®å®šçš„ã€‚å› æ­¤å¦‚æœèƒ½è®¡ç®—å‡ºæ¯ä¸ª$a\ mod\ p_i^{c_i}$ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ä¸­å›½å‰©ä½™å®šç†è®¡ç®—å‡º$a\ mod\ n$ã€‚

å¯¹äºæ¯ä¸€ä¸ªç´ æ•°$p_i$ï¼Œå› ä¸º$$a = \sum_{j=0}^{c_i-1}a_jp_i^j+sp_i^{c_i}$$æˆ‘ä»¬æœ‰$$\beta^{n/p_i} = (\alpha^a)^{n/p_i} \newline =(\alpha^{a_0+a_1p_i+...+a_{c-1}p_i^{c-1}+sp_i^c})^{n/p_i} \newline =\alpha^{a_0n/p_i}\alpha^{Kn} \newline =\alpha^{a_0n/p_i}$$å› æ­¤æœ‰$$\beta^{n/p_i} = \alpha^{a_0n/p_i}$$è¿™å°±ç›¸å½“äºå½’ç»“ä¸º1ä¸ªæ–°çš„ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼Œä½†æ˜¯æ­¤ç¦»æ•£å¯¹æ•°é—®é¢˜è§„çº¦åˆ°ä¸€ä¸ªé˜¶ä¸º$p_i$çš„å­ç¾¤ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨**Pollard Rho**ç­‰ç®—æ³•ç®—å‡ºè¿™ä¸ªç¦»æ•£å¯¹æ•°ã€‚
æœ€åç®—å‡ºè¿™$k$ä¸ªç¦»æ•£å¯¹æ•°$a_0$ï¼Œä»è€Œåˆ©ç”¨ä¸­å›½å‰©ä½™å®šç†è®¡ç®—å‡º$a\ mod\ n$ã€‚è€Œç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å–å†³äº$n$ä¸­æœ€å¤§çš„ä¸€ä¸ªç´ å› å­$p_{max}$ã€‚å› æ­¤ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(\sqrt{p_{max}})$ã€‚

**Sagemath æ‰‹å†™Pohlig-Hellmanç®—æ³•**ï¼Œå®é™…ä¸Šå¯ä»¥æŸ¥çœ‹`discrete_log`å‡½æ•°çš„å®ç°
```python
# Sagemath 9.2
def Pohlig_Hellman():
    E = EllipticCurve(GF(p), [0, 0, 0, A1, B1])
    P = E(,)
    Q = E(,)
    
    order = P.order()
    factors = factor(order)
    factors = [fac^m for fac,m in factors]
    ans = []

    for factor in factors:
        this = bsgs(G * (order // factor), Q * (order // factor), (0, factor), operation='+')
        ans.append(this)
        print(this)

    return crt(ans, factors)
```

##### 5 åŸºäºæœ‰é™åŸŸ$GF(p)$ä¸Šçš„ç‰¹æ®Šæƒ…å†µçš„ç¦»æ•£å¯¹æ•°

å·²çŸ¥æœ¬åŸæ ¹$g$ï¼Œå·²çŸ¥ç¦»æ•£å¯¹æ•°$a$ï¼Œå¯¹äº$x\in F_p$ï¼Œå…¶ä¸­$p$æ˜¯å¥‡ç´ æ•°ï¼Œå·²çŸ¥$y=x^a\ mod\ p$ï¼Œè¦æ±‚xã€‚ç†è®ºä¸Šè¿™æ˜¯ä¸€ä¸ªæ±‚næ¬¡å‰©ä½™çš„é—®é¢˜ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯å½“ $gcd(a,p-1)=1$çš„æ—¶å€™ï¼Œæ ¹æ®æ¬§æ‹‰å®šç†å­˜åœ¨$a$æ¨¡$p-1$çš„é€†å…ƒã€‚å› æ­¤å¯ä»¥æ±‚å‡º$a$åœ¨æ¨¡$p-1$ä¸‹çš„é€†è®°ä¸º$a^{-1}$ã€‚å› æ­¤æœ‰
$$
y^{a^{-1}} \equiv x^{aa^{-1}}\ mod\ p \\
y^{a^{-1}} \equiv x^{k(p-1)+1}\ mod\ p 
$$
åŒæ ·æ ¹æ®æ¬§æ‹‰å®šç†å®šç†ï¼Œæœ‰
$$
x^{\phi(p)}\equiv 1\ mod\ p \\
x^{p-1}\equiv 1\ mod\ p
$$
å› æ­¤$x = y^{a^{-1}}\ mod\ p$ï¼Œ**å‰ææ¡ä»¶**å¿…é¡»æ˜¯$gcd(a,p-1)=1$ï¼Œå¦åˆ™ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•å»æ±‚è§£ã€‚å½“ä¸æ»¡è¶³å‰ææ¡ä»¶çš„æ—¶å€™ï¼Œæ±‚è§£$n$æ¬¡å‰©ä½™çš„é—®é¢˜å¯ä»¥å½’ç»“ä¸ºæ±‚è§£ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼Œåœ¨è®¡ç®—ä¸Šæ˜¯å›°éš¾çš„ã€‚


##### 6 æ•°åŸŸç­›ï¼ˆNumber field Sieveï¼‰

æ•°åŸŸç­›ç®—æ³•çš„åŸç†æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯ç½‘ä¸Šæœ‰ç°æˆçš„å®ç°ï¼Œä¸»è¦æ˜¯`cado-nfs`è¿™ä¸ªå·¥å…·ã€‚

* é“¾æ¥ï¼šhttps://gitlab.inria.fr/cado-nfs/cado-nfs

æ ¹æ®readmeå®‰è£…å°±å¯ä»¥äº†ï¼Œç„¶åè¿™ä¸ªå·¥å…·å¦‚æœä¸è‡ªå·±è®¾è®¡æ•°åŸŸç­›ç®—æ³•é‚£è¿˜æ˜¯ä¸éš¾ç”¨çš„ã€‚ä¸»è¦è§`README.dlp`,`README.msieve`,`README.nonlinear`,`README.Python`è¿™å››ä¸ªreadmeæ–‡ä»¶ï¼Œå¦‚æœåªæ˜¯ä¸ºäº†è§£å†³ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦çœ‹`README.dlp`è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥äº†ã€‚

æ±‚è§£çš„è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
`./cado-nfs.py -dlp -ell <ell> target=<target> <p>`
å…¶ä¸­`p`è¡¨ç¤ºåœ¨$GF(p)$è¿™ä¸ªæœ‰é™åŸŸå¤§å°ï¼Œ`ell`è¡¨ç¤º`p`çš„ä¸€ä¸ªå¤§ç´ å› å­ï¼Œç„¶å`target`è¡¨ç¤ºåœ¨æœ‰é™åŸŸ$GF(p)$é‡Œé¢çš„ä¸€ä¸ªæ•°ï¼Œæˆ‘ä»¬è¦æ±‚å‡º`target`çš„ç¦»æ•£å¯¹æ•°ã€‚

ç„¶åæœ‰ä¸€ä¸ªæ³¨æ„çš„ç‚¹æ˜¯æˆ‘ä»¬æ²¡æœ‰æŒ‡å®šç¦»æ•£å¯¹æ•°çš„åŸº(base)ï¼Œæ—¢æ²¡æœ‰ç»™å‡º$a$ä½¿å¾—$a^{log(target)} = target\ mod\ p$ã€‚ç„¶åæ±‚è§£çš„æ—¶å€™ä¼šç»™å‡ºlog(2),log(3)ï¼Œæœ¬è´¨ä¸Šä»–ä»¬çš„åŸºéƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯å¯èƒ½2ï¼Œ3å’Œtargetä¼šåœ¨ä¸åŒçš„å­ç¾¤ä¸­ã€‚è¯¦ç»†å¯ä»¥è§ï¼šhttps://crypto.stackexchange.com/questions/74867/how-do-i-interpret-the-cado-nfs-output-for-discrete-logarithm-calculation-in-gf

å› æ­¤å¦‚æœæˆ‘ä»¬çŸ¥é“$m^a \equiv c\ mod\ p$ç„¶åæˆ‘ä»¬è¦æ±‚$a$ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦æ±‚å‡º`log(m)`å’Œ`log(c)`ï¼Œåˆ™æœ‰$$a = log(c) * log(m)^{-1}\ mod\ ell$$

* æ±‚è§£ï¼šæˆ‘ä»¬èƒ½å¤Ÿåœ¨å‡ ä¸ªå°æ—¶å†…æ±‚è§£256æ¯”ç‰¹çš„ç´ æ•°åŸŸæœ‰é™åŸŸçš„ç¦»æ•£å¯¹æ•°ï¼Œè€Œä¸”å¦‚æœæ˜¯å¯¹äºåŒä¸€ä¸ª$p$ï¼Œåˆ™è¿è¡Œ
`If you want to compute a new target, run ./cado-nfs.py /tmp/cado... target=<target>`
ä»è€Œå¯ä»¥å¿«é€Ÿæ±‚è§£åœ¨ç´ æ•°åŸŸ$p$ä¸Šçš„ç¦»æ•£å¯¹æ•°ï¼Œèƒ½è¾¾åˆ°åœ¨å‡ ç§’å†…æ±‚è§£å‡ºç­”æ¡ˆã€‚







### ä¸€ ElGamal
**å¯†ç ä½“åˆ¶**
![ElGamal](crypto/images/ElGamal.PNG)
ä¸€èˆ¬æ¥è¯´ï¼Œ$p$è‡³å°‘æ˜¯160ä½çš„åè¿›åˆ¶ç´ æ•°ï¼Œ**å¹¶ä¸”$p-1$æœ‰å¤§çš„ç´ å› å­**ã€‚







### äºŒ ECC æ¤­åœ†æ›²çº¿åŠ å¯†
ECC å…¨ç§°ä¸ºæ¤­åœ†æ›²çº¿åŠ å¯†ï¼ŒElliptic Curve Cryptographyï¼Œæ˜¯ä¸€ç§åŸºäºæ¤­åœ†æ›²çº¿æ•°å­¦çš„å…¬é’¥å¯†ç ã€‚ä¸ä¼ ç»Ÿçš„åŸºäºå¤§è´¨æ•°å› å­åˆ†è§£å›°éš¾æ€§çš„åŠ å¯†æ–¹æ³•ä¸åŒï¼ŒECC ä¾èµ–äºè§£å†³æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜çš„å›°éš¾æ€§ã€‚å®ƒçš„ä¼˜åŠ¿ä¸»è¦åœ¨äºç›¸å¯¹äºå…¶å®ƒæ–¹æ³•ï¼Œå®ƒå¯ä»¥åœ¨ä½¿ç”¨è¾ƒçŸ­å¯†é’¥é•¿åº¦çš„åŒæ—¶ä¿æŒç›¸åŒçš„å¯†ç å¼ºåº¦ã€‚ECCå¯†ç ä½“åˆ¶åœ¨åŒºå—é“¾ç­‰å¤šç§é¢†åŸŸä¸­éƒ½æœ‰åº”ç”¨ã€‚

* **æ¤­åœ†æ›²çº¿ä»‹ç»**
ä»£æ•°é—­åŒ…ä¸å®Œå–„å®šä¹‰ï¼šä½¿ç”¨åŸŸKä¸­çš„å…ƒç´ ä½œä¸ºç³»æ•°çš„æ‰€æœ‰å¤šé¡¹å¼æ–¹ç¨‹çš„è§£æ‰€æ„æˆçš„åŸŸã€‚æˆä¸ºKçš„ä»£æ•°é—­åŸŸ$~K$
ä»£æ•°é—­åŒ…ä¸€å®šæ˜¯æ— é™åŸŸã€‚
æ¤­åœ†æ›²çº¿Eå®šä¹‰ï¼šåœ¨åŸŸKä¸Šæ»¡è¶³ä¸‹åˆ—éå¥‡å¼‚çš„Weierstrassæ–¹ç¨‹çš„æ‰€æœ‰ç‚¹$(x,y)\in K^2$çš„é›†åˆã€‚$$E:y^2+a_1xy+a_3y=x^3+a_2x^2+a_4x+a_6$$ä¸‹æ ‡çš„å®šä¹‰ï¼Œ$a_i$ä¸­çš„iæ˜¯æƒé‡å¡«å……ã€‚xçš„æƒé‡æ˜¯2ï¼Œyçš„æƒé‡æ˜¯3.
**éå¥‡å¼‚ï¼š** Weierstrassæ–¹ç¨‹å®šä¹‰çš„å‡½æ•°æ²¡æœ‰å¥‡å¼‚ç‚¹(å¥‡ç‚¹)ï¼Œå³æ²¡æœ‰$(x,y)$æ»¡è¶³Eï¼Œä»¥åŠEçš„ä¸¤ä¸ªåå¯¼æ•°æ–¹ç¨‹$E_x'=0$å’Œ$E_y'=0$

* ç®€åŒ–ç‰ˆçš„Weierstrassæ–¹ç¨‹ï¼š$$E:y^2=x^3+ax+b$$å…¶ä¸­
(1)$\Delta=-16(4a^3+27b)\neq0$ï¼Œç”¨æ¥ä¿è¯æ›²çº¿æ˜¯å…‰æ»‘çš„ã€‚å³ä¿è¯æ˜¯æ¤­åœ†æ›²çº¿ã€‚
(2)$a,b\in K,K$ä¸º$E$çš„åŸºåŸŸï¼Œ$K$ä¸€èˆ¬ä¸º$GF(p)$ã€‚
(3)ç‚¹$O_{\infty}$æ˜¯æ›²çº¿ä¸Šå”¯ä¸€çš„æ— ç©·è¿œç‚¹ã€‚

* **æ¤­åœ†æ›²çº¿ä¸Šçš„é˜¿è´å°”ç¾¤**
**æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹åŠ è¿ç®—æ„æˆä¸€ä¸ªé˜¿è´å°”ç¾¤ã€‚** æ­¤ç‚¹åŠ è¿ç®—æœ‰å¤šç§å½¢å¼ï¼Œä¸‹é¢ç»™å‡ºå¸¸è§çš„ç®€åŒ–ç‰ˆçš„Weierstrassæ–¹ç¨‹çš„ä¸¤ç§å½¢å¼ã€‚
* åœ¨ç´ æ•°åŸŸGF(q)ä¸Šï¼Œæ¤­åœ†æ›²çº¿çš„ç‚¹åŠ å…¬å¼å¦‚ä¸‹ï¼š
![æ¤­åœ†æ›²çº¿ç´ æ•°åŸŸç‚¹åŠ å…¬å¼](crypto/images/GFq_PointAdd.PNG)
* åœ¨æ‰©åŸŸGF($2^p$)ä¸Šï¼Œæ¤­åœ†æ›²çº¿çš„ç‚¹åŠ å…¬å¼å¦‚ä¸‹ï¼š
![æ¤­åœ†æ›²çº¿æ‰©åŸŸç‚¹åŠ å…¬å¼](crypto/images/GF2-131_PointAdd.jpg)

**æ¤­åœ†æ›²çº¿çš„é˜¶ï¼š** å¦‚æœæ¤­åœ†æ›²çº¿ä¸Šä¸€ç‚¹$P$ï¼Œå­˜åœ¨æœ€å°çš„æ­£æ•´æ•°$n$ä½¿å¾—æ•°ä¹˜$nP = O_{\infty}$ï¼Œåˆ™å°†$n$æˆä¸ºç‚¹$P$çš„é˜¶ã€‚è‹¥$n$ä¸å­˜åœ¨ï¼Œåˆ™$P$æ˜¯æ— é™é˜¶çš„ã€‚

#### 1 ECCä¸­çš„ElGammalæ–¹æ¡ˆ
* å‡è®¾ç”¨æˆ·Bè¦æŠŠæ¶ˆæ¯åŠ å¯†åä¼ è¾“ç»™ç”¨æˆ·A

* å¯†é’¥ç”Ÿæˆï¼šç”¨æˆ·Aé€‰æ‹©æ¤­åœ†æ›²çº¿$E$ï¼Œä»¤$P$æ˜¯æ¤­åœ†æ›²çº¿$E$ä¸Šçš„ç‚¹ï¼Œç‚¹$P$çš„é˜¶ä¸º$n$ï¼Œå¹¶æŠŠç‚¹$P$ä½œä¸ºåŸºç‚¹ã€‚éšæœºé€‰å–ä¸€ä¸ªæ­£æ•´æ•°$m,m < n$æœ‰$Q = mP$ã€‚åˆ™$E,P,Q,n$æ˜¯**å…¬é’¥**ï¼Œ$m$æ˜¯ç§é’¥ã€‚
* åŠ å¯†ï¼š
    1. ç”¨æˆ·Aå°†$E,P,G,n$ä¼ è¾“ç»™ç”¨æˆ·Bã€‚
    2. ç”¨æˆ·Bæ¥å—åˆ°ä¿¡æ¯åï¼Œå°†æ˜æ–‡$msg$ç¼–ç åˆ°æ¤­åœ†æ›²çº¿$E$çš„ä¸€ä¸ªç‚¹$M$ä¸Šï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•°$r,r < n$ã€‚
    3. ç”¨æˆ·Bè®¡ç®—ç‚¹$C_1=M+rQ$ï¼Œ$C_2=rP$
    4. ç”¨æˆ·Bå°†$C_1,C_2$å‘é€ç»™ç”¨æˆ·Aã€‚
* è§£å¯†ï¼š
    ç”¨æˆ·Aæ¥å—åˆ°$C_1,C_2$åï¼Œæœ‰$M=C_1-mC_2$ã€‚

åŸç†ï¼š$$C_1-mC_2\newline=M+rQ-m(rP)\newline = M+rmP-mrP\newline=M$$

#### 2 å¸¸è§ECCæ”»å‡»æ–¹æ³•
* åˆ†å¸ƒå¼Pollard Rhoç®—æ³• ï¼ˆæš´åŠ›ç ´è§£ï¼‰
* Pohlig-Hellmanæ”»å‡»(**æ”»å‡»æ¡ä»¶**ï¼šç”¨äºåŸºç‚¹$P$çš„é˜¶$n$æ˜¯å…‰æ»‘(å¯è¢«åˆ†è§£æˆæ¯”è¾ƒå°çš„è´¨å› æ•°çš„ä¹˜ç§¯)çš„æƒ…æ™¯)
* æš´åŠ›æšä¸¾ç§é’¥
* å¸¸è§æ›²çº¿ï¼ˆç†è®ºä¸Šéœ€è¦ä½¿ç”¨ç‰¹å®šçš„æ–¹æ³•æŠŠè¯¥æ›²çº¿è½¬æ¢æˆWeierstrassæ›²çº¿çš„å½¢å¼ï¼‰ï¼šhttps://www.hyperelliptic.org/EFD/index.html

#### 3 ä¸€äº›é¢å¤–çš„æ”»å‡»æ–¹æ³•
* æ¤­åœ†æ›²çº¿ä¸­å¼±æ›²çº¿çš„ç ´è§£ï¼š
    1. https://wstein.org/edu/2010/414/projects/novotney.pdf
    2. https://link.springer.com/content/pdf/10.1007/s001459900052.pdf **åŸæ–‡**

#### 4 æ•´ç¯ä¸Šçš„æ¤­åœ†æ›²çº¿
* (ç†è®ºä¸Šæ•°åŸŸçŸ¥è¯†æ‰å®çš„è¯æ˜¯èƒ½å¤Ÿè‡ªå·±æ¨å‡ºçš„)

ä¸€èˆ¬æ¥è¯´ï¼Œæ¤­åœ†æ›²çº¿çš„æ„ä»¶éƒ½æ˜¯åœ¨æœ‰é™åŸŸä¸Šçš„ã€‚ä½†æ˜¯æœ‰äº›æ—¶å€™é¢˜ç›®ä¼šå‡ºåœ¨æ•´ç¯ä¸Šæ„é€ çš„æ¤­åœ†æ›²çº¿ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨Sagemathä¸­æ¤­åœ†æ›²çº¿çš„æ„å»ºä¸€èˆ¬æ˜¯
```python
EllipticCurve(GF(p), [0, 0, 0, A, B])
```
ä½†æ˜¯æœ‰äº›æ—¶å€™ä¼šå‡ºæˆ
```python
N = p * q   # usually we should factor N
EllipticCurve(Zmod(N), [0, 0, 0, A, B])
# given
P = (Px, Py)
```
æˆ‘ä»¬æŠŠæ¤­åœ†æ›²çº¿çœ‹æˆä¸¤æ¡æ¤­åœ†æ›²çº¿æ„æˆï¼Œå…ˆæŠŠç‚¹æ˜ å°„åˆ°ä¸¤æ¡åœ¨$GF(p)$å’Œ$GF(q)$ä¸Šæ¤­åœ†æ›²çº¿ä¸­ï¼Œå› ä¸ºç‚¹æ˜¯ç”±æ¤­åœ†æ›²çº¿æ–¹ç¨‹$y^2=x^3+ax+b\ mod\ N$æ„æˆï¼Œå› æ­¤åªè¦æŠŠç‚¹çš„åæ ‡æ¨¡$p$å’Œæ¨¡$q$å°±å¯ä»¥æ˜ å°„åˆ°ç›¸åº”çš„æ¤­åœ†æ›²çº¿ä¸Šã€‚
```python
E1 = EllipticCurve(GF(p), [0, 0, 0, A, B])
E2 = EllipticCurve(GF(q), [0, 0, 0, A, B])
#  map point P to E1 and E2 to get E1P and E2P
E1P = E1(P) # where E1Px == Px % q, E1Py == Py % q
E2P = E2(P) # where E2Px == Px % p, E2Py == Py % p
```
æ ¹æ®é¢˜ç›®è¦æ±‚æ±‚å‡ºä¸¤æ¡æ¤­åœ†æ›²çº¿çš„ç¦»æ•£å¯¹æ•°åï¼Œé€šè¿‡ä¸­å›½å‰©ä½™å®šç†æ±‚å‡ºæ¨¡$N$ä¸‹æ¤­åœ†æ›²çº¿çš„ç¦»æ•£å¯¹æ•°ã€‚æ³¨æ„æ¨¡æ•°å®ç”¨çš„æ˜¯ç‚¹P1qå’Œç‚¹P1pçš„é˜¶ï¼Œä¸æ˜¯ç”¨æ¤­åœ†æ›²çº¿E1,E2çš„é˜¶
```python
# å‰ä¸€ä¸ªåˆ—è¡¨æ˜¯ä½™æ•°ï¼Œ åä¸€ä¸ªåˆ—è¡¨æ˜¯æ¨¡æ•°
d1 = crt([d1p, d1q], [P1p.order(), P1q.order()])    
```

* å‚è€ƒé¢˜ç›®ï¼š2021å¹¿ä¸œçœå¼ºç½‘æ¯DLPï¼Œè§`crypto/2021_GD_QWB/2021_GD_QWB_DLP`

#### 5 MOVæ”»å‡»

* **æ”»å‡»åŸç†**ï¼šä½¿ç”¨åŒçº¿æ€§å¯¹è¿›è¡Œæ”»å‡»ï¼Œæœ¬è´¨ä¸Šæ˜¯æ„é€ ä¸€ä¸ªåŒçº¿æ€§æ˜ å°„ï¼Œå°†æ¤­åœ†æ›²çº¿$E(F_q)$çš„ä¸¤ä¸ªç‚¹æ˜ å°„åˆ°æœ‰é™åŸŸ$F_{q^k}$çš„ä¸€ä¸ªå…ƒç´ ï¼Œå…¶ä¸­$k$æ˜¯è¯¥æ›²çº¿çš„**åµŒå…¥åº¦**ã€‚è®¾æ›²çº¿$E$çš„é˜¶ä¸º$n$ï¼Œä¸”$n,q$äº’ç´ ï¼Œæˆ‘ä»¬è¦æ„é€ æ˜ å°„$$f:E[n]\times E[n]\rightarrow F_{q^k}$$ **åµŒå…¥åº¦$k$çš„å®šä¹‰**ä¸º$$n \mid q^k-1$$ 
è¿™é‡Œçš„åŒçº¿æ€§å¯¹ä¸€èˆ¬ä½¿ç”¨Weilå¯¹æˆ–è€…Tateå¯¹ã€‚å…¶ä¸­åŒçº¿æ€§å¯¹æœ‰åŒçº¿æ€§æ€§ï¼Œå³ï¼šå¯¹äºæ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹$P,Q$å’Œæ•´æ•°$r,s$ï¼Œæœ‰ $$f(rP,sQ) = f(P,Q)rs$$ å› æ­¤è‹¥è¦è®¡ç®—ç¦»æ•£å¯¹æ•°é—®é¢˜ $P' = rP$ ä¸­çš„$r$ã€‚æœ‰ $$u = f(P,Q) \\ v = f(P',Q) = f(rP,Q) = f(P,Q)r \\ v = ru$$ å…¶ä¸­$u,v\in F_{q^k}$ æ­¤æ—¶å˜æˆæ±‚è§£$ F_{q^k}$ä¸Šçš„ç¦»æ•£å¯¹æ•°ã€‚

* **æ”»å‡»æ¡ä»¶**ï¼šåµŒå…¥åº¦$k$éœ€è¦è¶³å¤Ÿå°ï¼Œå¯¹äºè¶…å¥‡å¼‚æ›²çº¿(supersingular curve)ï¼Œå…¶åµŒå…¥åº¦è¶³å¤Ÿå°ï¼Œä¸€èˆ¬$k\leq 6$ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨MOVæ”»å‡»ã€‚éè¶…å¥‡å¼‚æ›²çº¿çš„åµŒå…¥åº¦ä¸€èˆ¬ä¼šéå¸¸å¤§ã€‚

* **Sagemathè°ƒåŒ…**ï¼šé¦–å…ˆæ„é€ æ›²çº¿ï¼›ç„¶åç»™å‡ºç¦»æ•£å¯¹æ•°é—®é¢˜ï¼›æ¥ä¸‹æ¥é€‰æ‹©$Q$ä¸ºæ›²çº¿ä¸­ç”Ÿæˆå…ƒçš„å€ç‚¹ï¼Œå…¶ä¸­å€æ•°æ ¹æ®å®šç†D.1. æˆ–Table D.1 é€‰æ‹©ï¼›ç„¶åç”ŸæˆWeilå¯¹ï¼›æœ€åæ±‚è§£ç¦»æ•£å¯¹æ•°é—®é¢˜ã€‚
  **å®šç†D.1. (Theorem)**ï¼šä»¤$E(F_q)$æ˜¯ä¸€ä¸ªè¶…å¥‡å¼‚æ›²çº¿ï¼Œå…¶é˜¶ä¸º$q+1-t$ï¼Œå…¶ä¸­$q=p^m$ï¼Œ$p$ä¸ºç´ æ•°ï¼Œåˆ™æ›²çº¿$E$æœ‰ä»¥ä¸‹6ç§ç±»å‹ã€‚
    ![](crypto/images/Struct_in_supersingular_curves.PNG)
```python
# This is data for an example of
# a mov reduction using a super-
# singular curve over F{q}

p = 887421071545180331

assert(p+1 == E1.order())

k = 2 # decided by Table D.1.
F1 = GF(p)
E1=EllipticCurve(F1, [0,0,1,0,0])
F2 = GF(p^k)
phi = Hom(F1, F2)(F1.gen().minpoly().roots(F2)[0][0])
E2 = EllipticCurve(F2, [0, 0, 1, 0,0])

n = E1.order()

#random a point
P1 = E1.random_point()
R1 = 45*P1
P2 = E2(phi(P1.xy()[0]), phi(P1.xy()[1]))
R2 = E2(phi(R1.xy()[0]), phi(R1.xy()[1]))

# Choose Q in the group generated by P1 from Table D.1
# é€‰æ‹©ä¸€ä¸ªQç‚¹ï¼Œä¿è¯å®ƒåœ¨æ¤­åœ†æ›²çº¿E2ï¼ˆE(F_{q^k})ï¼‰çš„å­ç¾¤E[p+1]ä¸­ï¼Œéœ€è¦æ ¹æ®è¡¨Talbe D.1.è¿›è¡Œé€‰å–
cn1 = p+1
coeff = ZZ(cn1 / n)
print(coeff)

Q = coeff * E2.random_point()
alpha = P2.weil_pairing(Q, n)
beta = R2.weil_pairing(Q, n)
d = beta.log(alpha)

print(d)
# 45
```

* å‚è€ƒèµ„æ–™ï¼š
    * https://crypto.stanford.edu/pbc/thesis.pdf  åŒçº¿æ€§å¯¹
    * https://www.sagemath.org/files/thesis/hansen-thesis-2009.pdf sagemathæ±‚è§£MOVæ”»å‡»
    * Elliptic_Curves_in_Cryptography ä¹¦
    * https://zhuanlan.zhihu.com/p/421541257 å¤§ä½¬çš„ç¬”è®°



#### 6 Smartæ”»å‡»

* ***æ”»å‡»æ¡ä»¶ï¼šæ¤­åœ†æ›²çº¿$E(F_q)$çš„é˜¶ä¸º$q$ï¼Œ$q$æ˜¯ç´ æ•°***

* **æ”»å‡»åŸç†**ï¼šå·²çŸ¥$Q=kP$å…¶ä¸­$P,Q\in E(F_p)$ã€‚é¦–å…ˆæŠŠåœ¨$E(F_p)$ä¸­çš„ç‚¹æå‡(lift)åˆ°$E(Q_p)$è¿™ä¸ªæ¤­åœ†æ›²çº¿ä¸­ï¼Œå…¶ä¸­$Q_p$è¡¨ç¤ºçš„æ˜¯ **$p$è¿›åŸŸ**ã€‚ç„¶åé€šè¿‡**Pè¿›åˆ¶æ¤­åœ†å¯¹æ•°$\psi_p$**æŠŠ$E_1(Q_p)$ä¸Šçš„ç‚¹æ˜ å°„åˆ°$pZ_p$è¿™ä¸ª**ç¾¤**ä¸­ã€‚æœ€ååœ¨ç¾¤$pZ_p$ä¸­æ±‚å‡ºç¦»æ•£å¯¹æ•°$k$ã€‚
    * è¿™é‡Œçš„$Z_p$ä¸æ˜¯æ•´æ•°æ¨¡$p$æ‰€æ„æˆæœ‰é™åŸŸï¼Œè€Œæ˜¯ç”¨æ¥è¡¨ç¤º$p$è¿›åˆ¶çš„æ•´æ•°ï¼Œè€Œ$Q_p$åˆ™è¡¨ç¤º$p$è¿›åˆ¶çš„æœ‰ç†æ•°ï¼Œ$p$çš„å¹‚å¯ä»¥æ˜¯è´Ÿæ•°ã€‚
    * å®¹æ˜“å¾—çŸ¥æŠŠæ›²çº¿$E(Q_p)$çš„ç³»æ•°æ¨¡$p$ä¹‹åå°±å¾—åˆ°äº†$E(F_p)$ä¸Šçš„æ›²çº¿ï¼Œç‚¹åŒæ ·ä¹Ÿå¯ä»¥æ ¹æ®æ¨¡$p$å¾—åˆ°ã€‚è¿™æ ·ä¸€æ¥å°±å¾—åˆ°äº†$E(Q_p)\rightarrow E(F_p)$çš„ä¸€ä¸ªåŒæ€æ˜ å°„ã€‚ç„¶åæˆ‘ä»¬ä»¤$E_1(Q_p)$è¡¨ç¤ºçš„æ˜¯è¿™ä¸ªåŒæ€çš„kernelï¼Œå³$E_1(Q_p)$åŒ…å«äº†æ‰€æœ‰æ˜ å°„åˆ°$E(F_p)$æ— ç©·è¿œç‚¹çš„ç‚¹ã€‚
    * **( P-Adic Elliptic Log) Pè¿›åˆ¶æ¤­åœ†å¯¹æ•°$\psi_p: E_1(Q_p) \rightarrow pZ_p$**ï¼šå¯¹äºç‚¹$S(x_S,y_S) \in E_1(Q_p)$ æœ‰ $$\psi_p(S) = -\frac{x_S}{y_S}$$

* **æ”»å‡»å¤±è´¥**ï¼šé€‰å–çš„$Q_p$ä¸å½“ï¼Œå¯¼è‡´$E(Q_p)$å’Œ$E(F_p)$åŒæ„ï¼Œæ— æ³•è·å–é¢å¤–ä¿¡æ¯ï¼Œå¯¼è‡´æ”»å‡»å¤±è´¥ï¼Œè¿™ç§æƒ…å†µå«åš(canonical lift)ã€‚æ­£å¸¸æ¥è¯´åªæœ‰$\frac{1}{p}$çš„æ¦‚ç‡å‘ç”Ÿï¼Œä½†æ˜¯å¦‚æœé€‰å–ä¸å½“åˆ™æ”»å‡»å¤±è´¥ã€‚

* **æ”»å‡»æµç¨‹**ï¼š
    1. æŠŠç‚¹å‡æ ¼(lift)åˆ°$E(Q_p)$ä¸­ï¼Œå¯ä½¿ç”¨Hensel's Lemmaï¼Œå¾—åˆ°ç‚¹$P',Q'$ã€‚åˆ™æœ‰$$Q'-kP' \in E_1(Q_p)$$ã€‚
    2. æŠŠç‚¹$P',Q'$å‡æ ¼åˆ°$E_1(Q_p)$ä¸­ï¼Œç”±äºæ¤­åœ†æ›²çº¿$E(F_p)$çš„é˜¶ä¸º$p$ï¼Œå› æ­¤æœ‰$pP',pQ' \in E_1(Q_p)$ï¼Œæœ‰$$pQ'-k(pP')\in E_2(Q_p)$$ã€‚
    3. ç”¨Pè¿›åˆ¶æ¤­åœ†å¯¹æ•°æŠŠç‚¹æ˜ å°„åˆ°$pZ_p$ä¸­ï¼Œå› æ­¤æœ‰$$\psi_p(pQ'), \psi_p(pP') \in pZ_p \\ \psi_p(pQ') - k\psi_p(pP') \in pZ_p$$ã€‚
    4. å› æ­¤æœ‰$$k = \frac{\psi_p(pQ')}{\psi_p(pP')} \in pZ_p$$ æœ€åè®¡ç®—$k = k\ mod\ p$ã€‚

* **Sagemathä»£ç **ï¼š
    ```python
    def SmartAttack(P,Q,p):
        E = P.curve()
        Eqp = EllipticCurve(Qp(p, 2), [ ZZ(t) + randint(0,p)*p for t in E.a_invariants() ])
    
        P_Qps = Eqp.lift_x(ZZ(P.xy()[0]), all=True)
        for P_Qp in P_Qps:
            if GF(p)(P_Qp.xy()[1]) == P.xy()[1]:
                break
    
        Q_Qps = Eqp.lift_x(ZZ(Q.xy()[0]), all=True)
        for Q_Qp in Q_Qps:
            if GF(p)(Q_Qp.xy()[1]) == Q.xy()[1]:
                break
    
        p_times_P = p*P_Qp
        p_times_Q = p*Q_Qp
    
        x_P,y_P = p_times_P.xy()
        x_Q,y_Q = p_times_Q.xy()
    
        phi_P = -(x_P/y_P)
        phi_Q = -(x_Q/y_Q)
        k = phi_Q/phi_P
        return ZZ(k)
    
    E = EllipticCurve(GF(43), [0,-4,0,-128, -432])
    P = E([0,16])
    Q = 39 * P
    SmartAttack(P,Q,43)
    ```

* å‚è€ƒèµ„æ–™
    https://zhuanlan.zhihu.com/p/40898123 $p$è¿›åŸŸ
    https://wstein.org/edu/2010/414/projects/novotney.pdf  Smartæ”»å‡»
    https://zhuanlan.zhihu.com/p/421202600
    http://www.monnerat.info/publications/anomalous.pdf Anomalousæ›²çº¿ï¼Œé€‚ç”¨äºSmartæ”»å‡»

##### Anomalousæ›²çº¿çš„ç”Ÿæˆ
Anomalousæ›²çº¿çš„é˜¶ä¸º$p$ï¼Œé€‚ç”¨äºSmartæ”»å‡»ï¼Œæš´åŠ›æŸ¥æ‰¾è¿™æ ·çš„æ›²çº¿æ˜¯å¾ˆéš¾çš„ï¼Œéœ€è¦ç‰¹å®šçš„å¯»æ‰¾æ–¹æ³•ã€‚

* å‚è€ƒæ–‡çŒ®ï¼šhttp://www.monnerat.info/publications/anomalous.pdf Generating Anomalous Elliptic Curves

* åŸç†æ–‡çŒ®ä¸­éƒ½æœ‰ï¼Œè¿™ä¸ªç»™å‡ºç”Ÿæˆæ›²çº¿çš„ä»£ç ï¼š
    ```python
    # Sagemath 9.2
    # http://www.monnerat.info/publications/anomalous.pdf
    # if m is k-bits, then p is 2*k-bits
    
    import random
    D = 19
    j = -2^15*3^3
    
    def anon_prime(m):
        while True:
            p = (19*m*(m + 1)) + 5
            if is_prime(p):
                return m, p
            m += 1
    
    curves = []
    def anom_curve():
        m = random.getrandbits(128) 
        while True:
            m, p = anon_prime(m)
            a = (-3*j * inverse_mod((j - 1728), p)) % p
            b = (2*j * inverse_mod((j - 1728), p)) % p
            E = EllipticCurve(GF(p), [a,b])
            
            if E.order() == p:
                print(a,b,p)
                break
    ```


#### 7 singularæ›²çº¿
æ—¢æ»¡è¶³$-16(4a^3+27b^2)\ mod\ p = 0$çš„æ›²çº¿ã€‚å®ƒä¼šæœ‰è½åœ¨$(x_0,0)$è¿™æ ·çš„singularç‚¹ã€‚è¿™ç§å½¢å¼çš„æ›²çº¿æœ€ç»ˆä¼šåˆ†ä¸¤ç§æƒ…å†µã€‚

* $y^2=x^3$çš„å½¢å¼ï¼šæ›²çº¿æœ‰ä¸€ä¸ª **å°–ç‚¹(cusp)** ï¼Œåœ¨$(0,0)$ã€‚ç„¶åæœ‰åŒæ„æ˜ å°„$f:E(F_p) \rightarrow GF(p)$ï¼Œå…¶ä¸­$$f : (x,y) \rightarrow \frac{x}{y}$$
* $y^2=x^2(x+a)$çš„å½¢å¼ï¼šæ›²çº¿çš„singularç‚¹æ˜¯ **äº¤å‰ç‚¹(node)** ï¼Œåœ¨$(x_0,0)$ã€‚ç„¶åæ±‚å‡º$a$çš„å¹³æ–¹å‰©ä½™$a \equiv b^2\ mod\ p$ï¼Œåˆ™æœ‰åŒæ„æ˜ å°„$f:E(F_p) \rightarrow GF(p)$ï¼Œå…¶ä¸­$$f : (x,y) \rightarrow \frac{y+bx}{y-bx}$$

* ä¾‹å­ï¼š
    ```python
    # Sagemath 9.2 The second case y^2 = x^2(x+a)
    p = 23981
    P.<x> = GF(p)[]
    f = x^3 + 17230*x + 22699
    P = (1451, 1362)
    Q = (3141, 12767)
    # change variables to have the singularity at (0, 0)
    f_ = f.subs(x=x + 23796)
    P_ = (P[0] - 23796, P[1])
    Q_ = (Q[0] - 23796, Q[1])
    # show that the curve is of the form y^2 = x^3 + x^2
    print(f_.factor())
    # (x + 23426) * x^2
    t = GF(p)(23426).square_root()
    # map both points to F_p
    u = (P_[1] + t*P_[0])/(P_[1] - t*P_[0]) % p
    v = (Q_[1] + t*Q_[0])/(Q_[1] - t*Q_[0]) % p
    # use Sage to solve the logarithm
    print(discrete_log(v, u))
    ```

* å‚è€ƒèµ„æ–™  ï¼š 
    1. Joseph H.Silverman. The Arithmetic of Elliptic Curves[M]. 2nd Edition. ç¬¬ä¸‰ç« 
    2. https://crypto.stackexchange.com/questions/61302/how-to-solve-this-ecdlp



### ä¸‰ è¶…æ¤­åœ†æ›²çº¿

ä¸€ä¸ªåœ¨$F_q,q = p^l$ä¸Šçš„äºæ ¼ä¸º$g$çš„è¶…æ¤­åœ†æ›²çº¿$C$æ˜¯ç”±ä¸‹é¢çš„æ–¹ç¨‹æ„æˆ $$y^2+h(x)y=f(x)$$ å…¶ä¸­$h(x)$å’Œ$f(x)$æ˜¯ä¸¤ä¸ªç³»æ•°ä¸º$F_q$çš„å¤šé¡¹å¼ï¼Œå…¶ä¸­$deg(h(x))\leq g$å’Œ$deg(f(x))=2g+1$ã€‚ä¸æ­¤åŒæ—¶æ›²çº¿éœ€è¦æ»¡è¶³éå¥‡å¼‚çš„ç‰¹æ€§ï¼Œå³æ»¡è¶³$$ \begin{cases} y^2+h(x)y=f(x)\\
2y+h(x)=0\\
h'(x)y-f'(x)=0
\end{cases} $$ è¿™ä¸‰ä¸ªæ–¹ç¨‹æ²¡æœ‰è§£ã€‚

æ¥ä¸‹æ¥å¯¹äºæœ‰é™åŸŸ$F_q$çš„ä¸€ä¸ªæ‰©åŸŸ$K$ã€‚è®°$L$ä¸º$F_q$çš„ä¸€ä¸ªä»£æ•°é—­åŒ…ï¼Œé‚£ä¹ˆå°±æœ‰$F_q \subset K \subset L$ã€‚ 

**é™¤å­ï¼š** é™¤å­æ˜¯è¶…æ¤­åœ†æ›²çº¿$C$ä¸Šçš„ç‚¹$C(L)$çš„å½¢å¼å’Œï¼Œè®°$$D = Div_C(L) = \sum_{P\in C(L)}c_P[P]$$ å®šä¹‰é™¤å­çš„åº¦æ•°$deg(D)$ä¸º$\sum_Pc_P$ã€‚å¯¹äºæ‰©åŸŸ$K$ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰åº¦æ•°ä¸º0çš„åœ¨æ‰©åŸŸ$K$ä¸Šçš„é™¤å­ç¾¤ï¼Œå…¶ä¸­æœ‰$\#K = q^r$ï¼š$$Div_C^0(K):=\{ D\in Div_C(L) | deg(D) = 0, D^{\sigma^r} = D \}$$ å…¶ä¸­æœ‰$P^{\sigma} = (x^q,y^q)$ä¸”$D^{\sigma} = \sum_Pc_P[P^{\sigma}]$ã€‚

**order of vanishingï¼š** è®°$F(x,y)\in K[x,y]$ï¼Œå³å‡½æ•°$F$æ˜¯ç³»æ•°ä¸º$K$çš„å¤šé¡¹å¼ã€‚åœ¨Pç‚¹çš„$F$çš„**order of vanishing**è®°$ord_P(F)$ã€‚ç›´è§‚ä¸Š(ä¸ä¸¥è°¨)å¯ä»¥ç†è§£ä¸º$F$åœ¨$P$ç‚¹ä¸Šé›¶ç‚¹çš„é‡æ•°ã€‚

å®šä¹‰æœ‰ç†å‡½æ•°$F/G,\ F,G\in K[x,y]$åˆ™å¯¹äºæœ‰é™è¿œç‚¹$P$æœ‰$ord_P(F/G)=ord_P(F)-ord_P(G)$ã€‚éé›¶çš„æœ‰ç†å‡½æ•°å¯ä»¥ä¸åº¦æ•°ä¸º0çš„é™¤å­ç›¸è”ç³»$$ div(F/G) = \sum_{P\in C(L)}ord_P(F/G)[P] $$ ç”±ç³»æ•°åœ¨$L$ä¸Šçš„æœ‰ç†å‡½æ•°ç”Ÿæˆçš„é™¤å­ç§°ä¸ºä¸»é™¤å­æˆ–åŸåˆ™é™¤å­(principal divisor)ï¼Œå®ƒæ„æˆäº†é™¤å­ç¾¤$Div_C^0(L)$çš„ä¸€ä¸ªå­ç¾¤ï¼Œè®°ä¸º$P_C(L)$ï¼Œå¹¶å®šä¹‰$P_C(K)=P_C(L) \cap Div_C^0(K)$

**Jacobianç¾¤ï¼š** å¯¹äº$F_q$çš„æ‰©åŸŸ$K$ï¼Œæ›²çº¿$C$çš„Jacobiançš„K-æœ‰ç†ç‚¹çš„ç¾¤ä¸º$Div_C^0(K)/P_C(K)$ï¼Œè®°ä¸º$J_C(K)$ã€‚

* æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹åŠ ä¸Šä¸€ä¸ªæ— ç©·è¿œç‚¹å¯ä»¥æ„æˆä¸€ä¸ªæ¤­åœ†æ›²çº¿ç‚¹ç¾¤ã€‚ä½†æ˜¯è¶…æ¤­åœ†æ›²çº¿åˆ™æ— æ³•æ‰¾åˆ°ä¸€ä¸ªè¿ç®—è®©ä»…ä»…æ˜¯è¶…æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹æ„æˆä¸€ä¸ªç¾¤ã€‚ç„¶åæˆ‘ä»¬æ„é€ äº†$J_C(K)$è¿™ä¸ªç¾¤ï¼Œå®ƒå¯ä»¥å ªç§°æ˜¯æ¤­åœ†æ›²çº¿ç‚¹ç¾¤çš„ä¸€ä¸ªæ¨å¹¿ã€‚åœ¨æ¤­åœ†æ›²çº¿ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ˜ å°„$\phi : E(K)\rightarrow J_E(K)$ã€‚è¿™æ˜¯ä¸€ä¸ªç¾¤åŒæ„æ˜ å°„ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªJacobianç¾¤$J_C(K)$çš„ä¸€ä¸ªæ˜¾ç¤ºçš„å…ƒç´ çš„è¡¨ç¤ºæ–¹æ³•ã€‚è¿™ç§æ–¹æ³•å«åš``Mumford representation``ã€‚

* å‘½é¢˜ï¼šå¯¹äºæ¯ä¸ª$J_C(K)$ä¸­çš„å…ƒç´ ï¼Œéƒ½å¯ä»¥è¡¨ç¤ºæˆä¸€ä¸ªç¾¤$Div_C^0(K)$ä¸­çš„ä¸€ä¸ªè§„çº¦é™¤å­(reduced divisor)ã€‚

**å…³é”®å®šä¹‰ï¼š** ä¸€ä¸ªé™¤å­$D$çš„``Mumford representation``æ˜¯ä¸€ä¸ªåœ¨$K[x]$ä¸Šçš„å¤šé¡¹å¼å¯¹$[u(x), v(x)]$ã€‚æ»¡è¶³
1. $u(x)$æ˜¯é¦–ä¸€çš„ï¼›
2. $u(x) | f(x)-h(x)v(x)-v(x)^2$ ï¼›
3. $deg(v(x)) \le deg(u(x)) \leq g$ ï¼›

$J_C(K)$çš„è¿ç®—è§„åˆ™åœ¨è¿™é‡Œå°±ä¸ç»™å‡ºäº†ï¼Œæ¯•ç«Ÿæœ‰ç°æˆçš„è½®å­çš„ä¸œè¥¿æ²¡æœ‰å¿…è¦è¯¦ç»†ä»‹ç»ã€‚

**å…³é”®æ€§è´¨ï¼š** è‹¥$$u(x)=\prod_{i=1}^d(x-x_i)$$ å…¶ä¸­$x_i \in K$ã€‚æ ¹æ®æ¡ä»¶2å¯çŸ¥ç‚¹$(x_i, v(x_i))$æ˜¯æ›²çº¿$C$ä¸Šçš„ç‚¹ã€‚å› æ­¤é™¤å­$$\sum_{i=1}^d([x_i,v(x_i)]-[\infty])$$æ˜¯ä¸€ä¸ªåœ¨$Div_C^0(K)$ä¸Šçš„è§„çº¦é™¤å­ã€‚å› æ­¤è¶…æ¤­åœ†æ›²çº¿ä¸Šçš„$d\leq g$ä¸ªç‚¹å°±å¯¹åº”ç€Jacobianç¾¤$J_C(K)$ä¸Šçš„ä¸€ä¸ªå…ƒç´ ã€‚ 


> é¢˜ç›® hxp CTF 2020 hyper 
é¢˜ç›®æœ¬è´¨ä¸Šæ˜¯ç»™äº†è¶…æ¤­åœ†æ›²çº¿çš„åŠ å¯†æ–¹æ¡ˆï¼Œä½†æ˜¯å¯†é’¥æ³„éœ²äº†$u(x)$ã€‚ç„¶ååªéœ€è¦æ±‚å‡º$v(x)$å³å¯ã€‚æ ¹æ®$u(x)$æˆ‘ä»¬å¯ä»¥çŸ¥é“$u(x)$çš„ä¸‰ä¸ªæ ¹ï¼Œç„¶ååˆå› ä¸ºç‚¹$(x_i, v(x_i))$åœ¨æ›²çº¿$C$ä¸Šã€‚å› æ­¤å¯ä»¥åˆ—å‡ºä¸‰ä¸ªæ–¹ç¨‹ $$(ax^2+bx+c)^2 = x^7 +x,$$è§£å‡ºå‚æ•°$a,b,c$å¾—åˆ°$v(x)$ï¼Œç„¶åå°±å¯ä»¥æ±‚å‡ºflagã€‚ 

å‚è€ƒwrite upï¼šhttps://ctftime.org/writeup/25448







### å›› åœ†é”¥æ›²çº¿
> åœ†é”¥æ›²çº¿å­˜åœ¨ç€$\mathbb{F}_p$ä¸Šçš„æ›²çº¿ä¹Ÿå­˜åœ¨ç€$\mathbb{Z}_N$ä¸Šçš„æ›²çº¿ã€‚

åœ†é”¥æ›²çº¿æ–¹ç¨‹ä¸º$$C(\mathbb{F}_p):y^2=ax^2-bx \\ a,b\in \mathbb{F}_p$$ å…¶ä¸­å½“$a>0$æ—¶æ›²çº¿ä¸ºåŒæ›²çº¿ï¼Œ$a=0$æ—¶æ›²çº¿ä¸ºæŠ›ç‰©çº¿ï¼Œ$a<0$æ—¶æ›²çº¿ä¸ºæ¤­åœ†ã€‚è¿™ä¸ªæ›²çº¿æ’è¿‡$(0,0)$ç‚¹ã€‚

åœ†é”¥æ›²çº¿çš„å®‰å…¨æ€§æ˜¯åŸºäºç¦»æ•£å¯¹æ•°é—®é¢˜æ‰€å†³å®šçš„ï¼Œä¸åŒçš„å‚æ•°é€‰å–æœ‰ç€ä¸åŒçš„å®‰å…¨æ€§ã€‚åœ¨é€‰å–å®‰å…¨æ€§æœ€é«˜çš„æƒ…å†µä¸‹ï¼ŒGF(p)æœ‰é™åŸŸä¸Šçš„åœ†é”¥æ›²çº¿çš„å®‰å…¨æ€§ç›¸å½“äºæ‰©åŸŸ$\mathbb{F}_{p^2}$ä¸ŠDLPçš„å®‰å…¨æ€§ã€‚

**æ¼æ´**ï¼šå…¶ä¸­å½“$a >=0$æ—¶ï¼Œ$a$æœ‰æ¨¡$p$çš„äºŒæ¬¡å‰©ä½™ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡åŒæ„æ˜ å°„æ˜ å°„åˆ°æœ‰é™åŸŸ$GF(p)$è¿™ä¸ªä¹˜æ³•ç¾¤ä¸­ã€‚

* å­˜åœ¨åŒæ„æ˜ å°„$$M:C(\mathbb{F}_p)(x,y)\longrightarrow \phi_a(t) = \frac{t+\theta_1}{t+\theta_2} \\ t = \frac{y}{x} \\ \theta_1^2 \equiv \theta_2^2 \equiv a\ (mod\ p)$$ æŠŠæ›²çº¿ä¸Šçš„ç‚¹æ˜ å°„åˆ°æœ‰é™åŸŸçš„ä¹˜æ³•ç¾¤ä¸­ã€‚å› ä¸º$p$çš„å–å€¼ä¸å¤§ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç”¨`discrete_log`å‡½æ•°æ±‚è§£ç¦»æ•£å¯¹æ•°ã€‚

* å­˜åœ¨æ„é€ åŒæ„æ˜ å°„$$M:C(\mathbb{F}_p)(x,y)\longrightarrow \phi_a(t) = \frac{1}{t-\theta} \\ t = \frac{y}{x} \\ \theta^2 \equiv a\ (mod\ p)$$ å³$a$çš„äºŒæ¬¡å‰©ä½™$\theta$æœ‰é‡æ ¹ï¼ŒæŠŠæ›²çº¿ä¸Šçš„ç‚¹æ˜ å°„åˆ°æœ‰é™åŸŸçš„åŠ æ³•ç¾¤ä¸­ï¼Œç„¶åæ±‚ä¸ªé€†ç„¶åç›¸ä¹˜å¯æ±‚è§£ç¦»æ•£å¯¹æ•°ã€‚

- å‚è€ƒèµ„æ–™ï¼š
  - https://www.jiamisoft.com/blog/4068-yuanzhuiquxianjiamisuanfa.html
  - å¾æ—­ä¸œ, é³å²©å²©, èµµç£Š. åœ†é”¥æ›²çº¿å…¬é’¥å¯†ç ç®—æ³•çš„å‚æ•°é€‰æ‹©[J]. è®¡ç®—æœºå·¥ç¨‹, 2007, 33(15):3.





## æ ¼å¯†ç  




### æ ¼çš„åŸºæœ¬å®šä¹‰

![æ ¼çš„å®šä¹‰](crypto/images/Lattice.png)

### æ ¼ä¸Šçš„å›°éš¾é—®é¢˜
* **æœ€çŸ­å‘é‡é—®é¢˜ (Shortest Vector Problemï¼ŒSVP)**ï¼šç»™å®šæ ¼ $L$ åŠå…¶åŸºå‘é‡ $B$ ï¼Œæ‰¾åˆ°æ ¼ $L$ ä¸­çš„éé›¶å‘é‡ $v$ ä½¿å¾—å¯¹äºæ ¼ä¸­çš„ä»»æ„å…¶å®ƒéé›¶å‘é‡ $u$ï¼Œæœ‰$||v||\leq||u||$ã€‚

* **$\gamma$-è¿‘æœ€çŸ­å‘é‡é—®é¢˜(SPV-$\gamma$)**ï¼šç»™å®šæ ¼ $L$ åŠå…¶åŸºå‘é‡ $B$ ï¼Œæ‰¾åˆ°æ ¼ $L$ ä¸­çš„éé›¶å‘é‡ $v$ ä½¿å¾—å¯¹äºæ ¼ä¸­çš„ä»»æ„å…¶å®ƒéé›¶å‘é‡ $u$ï¼Œæœ‰$||v||\leq\gamma||u||$ã€‚

* **è¿ç»­æœ€å°é•¿åº¦é—®é¢˜ (Successive Minima Problem, SMP)**ï¼šç»™å®šä¸€ä¸ªç§©ä¸º $n$ çš„æ ¼ $L$ï¼Œæ‰¾åˆ°æ ¼ $L$ ä¸­ $n$ ä¸ªçº¿æ€§æ— å…³å‘é‡$s_i$ï¼Œæ»¡è¶³$\lambda_i(L)=||s_i||,\ 1\leq i\leq n$ã€‚

* **æœ€çŸ­çº¿æ€§æ— å…³å‘é‡é—®é¢˜ (Shortest Independent Vector Problem, SIVP)**ï¼šç»™å®šä¸€ä¸ªç§©ä¸º $n$ çš„æ ¼ $L$ï¼Œæ‰¾åˆ°æ ¼ $L$ ä¸­ $n$ ä¸ªçº¿æ€§æ— å…³å‘é‡$s_i$ï¼Œæ»¡è¶³$||s_i||\leq\lambda_n(L),\ 1\leq i\leq n$ã€‚

* **æœ€è¿‘å‘é‡é—®é¢˜ (Closest Vector Problemï¼ŒCVP)**ï¼šç»™å®šæ ¼ $L$ å’Œç›®æ ‡å‘é‡$t\in R^m$ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ ¼ä¸­çš„éé›¶å‘é‡ $v$ï¼Œä½¿å¾—å¯¹äºæ ¼ä¸­ $\forall u$ï¼Œæ»¡è¶³$||v-t||\leq||u-t||$ã€‚å³åœ¨æ ¼$L$ä¸Šæ‰¾åˆ°ä¸€ä¸ªç¦»$t$æœ€è¿‘çš„å‘é‡ã€‚

### æ ¼åŸºè§„çº¦ç®—æ³•(Lenstraâ€“Lenstraâ€“Lovasz, LLL)
* å‚è€ƒè®ºæ–‡: https://cims.nyu.edu/~regev/teaching/lattices_fall_2004/ln/lll.pdf

LLLç®—æ³•æœ¬è´¨ä¸Šæ˜¯å°†A lattice basis $B$è½¬æ¢ä¸º LLL-reduced basis $\tilde{B}$ï¼Œå…¶ä¸­$\tilde{B}$æ˜¯ä¸€ä¸ªæ­£äº¤åŸºç»„æˆçš„çŸ©é˜µï¼Œå»è§£å†³SPV-$\gamma$é—®é¢˜ã€‚**â€œè½¬æ¢â€** å°±æ˜¯è¦åšGram-Schmidtæ­£äº¤åŒ–ï¼Œä½†è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶
1. For every $i < j$, we have $|\mu_{i,j}|\leq\frac{1}{2}$. (Such a basis is said to be "size reduced.") **ç›®çš„æ˜¯ä¿è¯Gram-Schmidtæ­£äº¤åŒ–ä¸ä¼šå¤ªå°**
2. For every $1\leq i < n$, we have $\frac{3}{4}||\tilde{b}_i ||^2 \leq ||\mu_{i,i+1} \tilde{b}_i + \tilde{b}_{i+1}||^2$.  (This is the "Lovasz condition.") **ç›®çš„æ˜¯ä¿è¯ç¼©å‡ä¸è¦å¤ªå¿«**

è¿™é‡Œçš„$\mu$è¡¨ç¤ºçš„æ˜¯ï¼Œ$B=\tilde{B}U$ä¸­çŸ©é˜µ$U$çš„æŸäº›å…ƒç´ ã€‚å…¶ä¸­$U$æ˜¯ä¸€ä¸ªå•ä½ä¸Šä¸‰è§’çŸ©é˜µï¼Œå¯¹è§’çº¿å…¨ä¸º1ï¼Œç„¶åå¯¹è§’çº¿å¾€ä¸Šçš„å…ƒç´ ç¬¬$i$è¡Œç¬¬$j$åˆ—çš„å…ƒç´ è®°ä¸º$\mu_{i,j}$ã€‚

ä¸»è¦æ€§è´¨ï¼ˆè§£å†³SPV-$\gamma$ï¼‰ï¼š
![æ ¼LLLç®—æ³•](crypto/images/LLL.PNG)


### BKZ (Block Korkin-Zolotarev)
æœ‰å…´è¶£å¯ä»¥è‡ªå·±ç ”è¯»ä¸€ä¸‹ä¸‹é¢çš„æ–‡çŒ®ï¼Œå°±æ˜¯å…·ä½“æè¿°BKZç®—æ³•çš„æ–‡ç« ã€‚
- https://rd.springer.com/content/pdf/10.1007%2F978-3-642-25385-0_1.pdf    BKZ 2.0: Better Lattice Security Estimates
- Shor, P.W.: Algorithms for quantum computation: discrete logarithms and factoring. In: Proceedings 35th Annual Symposium on Foundations of Computer Science. pp. 124â€“134. IEEE, Santa Fe, NM, USA (Nov 1994)

ç®—æ³•æ¥å—ä¸¤ä¸ªé¢å¤–å‚æ•°çš„è¾“å…¥ï¼Œ$\beta$å’Œ$\epsilon$ï¼Œ$\epsilon$ æ˜¯LLLç®—æ³•çš„è¾“å…¥ï¼Œ$\beta$ æ˜¯BKZç‹¬æœ‰çš„ã€‚åŸºçš„è¾“å…¥ä¸º$B=(b_1,...,b_n)$

**ç›®æ ‡**ï¼šæ±‚å‡ºåŸº$B$çš„LLLç®—æ³•çš„ç»“æœï¼Œç„¶å$\forall 1\leq j \leq n$ï¼Œ$\parallel b_j^* \parallel = \lambda_1(L_{j,k})$ï¼Œå…¶ä¸­$k=min(j+\beta+1, n)$

**æ•ˆç‡**ï¼šä¸€èˆ¬æ¥è¯´BKZ 2.0çš„æ•ˆç‡å’Œæ•ˆæœæ˜¯æ ¼åŸºè§„çº¦ç®—æ³•ä¸­æœ€å¥½çš„ï¼Œå…·ä½“å®ç°æœ‰å…´è¶£å¯ä»¥ç ”è¯»è®ºæ–‡ã€‚

LLLç®—æ³•å’ŒBKZç®—æ³•åœ¨Sagemathä¸­çš„è°ƒç”¨è§`crypto/Sagemath_Usage.md`

> ä¸€èˆ¬æ¥è¯´å¯ä»¥å°è¯•ä¸€ä¸‹BKZä¸­çš„$\beta$å–20




### Babai's nearest plane algorithm
* æ­¤ç®—æ³•ç”¨æ¥æ±‚CVPé—®é¢˜çš„è¿‘ä¼¼è§£ï¼Œç®—æ³•å¤æ‚åº¦å½’ç»“äºLLLç®—æ³•ã€‚
* å‚è€ƒæ–‡çŒ®
    * https://cims.nyu.edu/~regev/teaching/lattices_fall_2004/ln/cvp.pdf
    * https://www.isg.rhul.ac.uk/~sdg/igor-slides.pdf

**è¯¥ç®—æ³•è¾“å…¥ä¸€ç»„æ ¼$L$(ç§©ä¸º$n$) çš„åŸº$B$ å’Œä¸€ä¸ªç›®æ ‡å‘é‡$t$ï¼Œè¾“å‡º CVP é—®é¢˜çš„è¿‘ä¼¼è§£ï¼Œæ—¢ä¸€ä¸ªåœ¨æ ¼ä¸Šçš„è·ç¦»å‘é‡$t$æœ€çŸ­çš„å‘é‡**ï¼Œè¿‘ä¼¼å› å­$\gamma =2^{\frac{n}{2}}$ã€‚å…·ä½“ç®—æ³•å¦‚ä¸‹ï¼Œæœ¬è´¨ä¸Šæ˜¯LLLç®—æ³•ï¼š
![Babai's nearest plane algorithm](crypto/images/BabaisNearestPlaneAlgorithm.PNG)
è¿™é‡Œçš„$b_j$è¡¨ç¤ºçš„æ˜¯ç»è¿‡LLLç®—æ³•å˜æ¢ä¹‹åä¸ªæ ¼åŸºçš„ç¬¬$j$ä¸ªå‘é‡ã€‚

#### Babaiâ€™s Rounding Technique
è¯¥ç®—æ³•æ˜¯``Babai's nearest plane algorithm``çš„ä¸€ä¸ªå˜ç§ã€‚

å‚è€ƒæ–‡çŒ®
- https://link.springer.com/content/pdf/10.1007/BF02579403.pdf  

#### Hidden number problem
* è¯¥é—®é¢˜å¯ä»¥è§„çº¦åˆ°CVPé—®é¢˜å¹¶ä½¿ç”¨Babai's nearest plane algorithmè§£å†³ã€‚

**HNP:** Recover $\alpha \in F_p$ such that for many known random $t\in F_p$ we are given $MSP_{l,p}(\alpha t)$ for some $l > 0$. 
**MSB:** $MSP_{l,p}(x)$ denotes any integer $u$ such that $$|\lfloor x \rfloor_p-u |\leq \frac{p}{2^{l+1}}$$ $MSP_{l,p}(x) \approx l$ most significant bits of $x$.
**B&V, 1996:** a polynomial time algorithm to solve HNP with $l \approx log^{1/2}p = (log(p))^{1/2}$.

åˆå‚è€ƒæ–‡çŒ® https://www.isg.rhul.ac.uk/~sdg/igor-slides.pdf å¯çŸ¥å½“$l \approx log^{\frac{1}{2}}p$æ—¶ï¼Œå¯ä»¥è®²æ­¤é—®é¢˜è§„çº¦åˆ°ä¸€ä¸ªCVPé—®é¢˜ã€‚

* ç®—æ³•æµç¨‹ï¼š
* è¾“å…¥ï¼šç»™å‡ºç´ æ•°$p$æ•´æ•°$l$ä¸”$l$æ»¡è¶³$l\approx log^{\frac{1}{2}}p$ï¼Œ$n$ä¸ª$t\in F_p$ï¼Œå¯¹åº”çš„$n$ä¸ªæ•°$u_i = MSP_{l,p}(\alpha t_i)$ã€‚
* è¾“å‡ºï¼šæ»¡è¶³æ¡ä»¶çš„æ•°$\alpha$ã€‚
* é¦–å…ˆæ„é€ çŸ©é˜µ$$
\left[\begin{matrix}
p & 0 & \cdots & 0 & 0\\
0 & p & \cdots & 0 & 0\\
\vdots & \vdots & \ddots & \vdots & \vdots\\
0 & 0 & \cdots & p & 0\\
t_1 & t_2 & \cdots & t_n & \frac{1}{2^{l+1}}
\end{matrix}\right]
$$ æ³¨æ„ï¼šè¿™é‡Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªå‘é‡ï¼Œå› æ­¤ä½¿ç”¨LLLç®—æ³•æ±‚çº¿æ€§ç»„åˆçš„æ—¶å€™ï¼Œæœ€åä¸€ä¸ªå‘é‡åªæœ‰ä¸€ä¸ªç³»æ•°ï¼Œè®°ä¸º$\alpha$ã€‚è®¾å…¶å®ƒçº¿æ€§ç»„åˆçš„ç³»æ•°ä¸º$z_i$ï¼Œé‚£ä¹ˆLLLç®—æ³•æ‰€æ±‚çš„å‘é‡å°±å…¥ä¸‹æ–¹å‘é‡$\pmb{v}$æ‰€ç¤ºã€‚
* ç„¶åä½¿ç”¨``Babai's nearest plane algorithm``æ‰¾å‡ºè·ç¦»å‘é‡$\pmb{u} = (u_1, u_2, ..., u_n, 0)$æœ€è¿‘çš„ä¸€ç»„å‘é‡$\pmb{v}$ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š
    * é¦–å…ˆå¯¹çŸ©é˜µè¿›è¡ŒLLLç®—æ³•å¾—åˆ°ä¸€ç»„æ ¼åŸº$$(\pmb{b_1,b_2,...,b_{n+1}})  $$
    * ç®—æ³•ç¬¬äºŒæ­¥æœ‰$\pmb{u}$éœ€è¦å‡å»å‘é‡$$\sum_{i=1}^{n+1}c_i\pmb{b_i} = \newline  (\sum_{i=1}^{n+1}c_i(b_{i,1}p+m_{n+1,i}t_i), ... ,  \sum_{i=1}^{n+1}c_im_{n+1,i}\frac{1}{2^{l+1}}) \newline = (z_1p+\alpha t_1, ..., z_np+\alpha t_n, \alpha\frac{1}{2^{l+1}}) \newline \equiv (\alpha t_1, \alpha t_2, ..., \frac{\alpha}{2^{l+1}}) \ mod\ p$$ å…¶ä¸­$m_{n+1,i}$è¡¨ç¤ºLLLç®—æ³•çš„è½¬æ¢çŸ©é˜µçš„æœ€åä¸€è¡Œçš„ç¬¬$i$ä¸ªå…ƒç´ ã€‚
    å› æ­¤å¯ä»¥æ±‚å‡ºåœ¨æ ¼ä¸Šç¦»è·ç¦»å‘é‡$\pmb{u}$æœ€çŸ­çš„å‘é‡$\pmb{v} = (\alpha t_1, \alpha t_2, ..., \frac{\alpha}{2^{l+1}})$ï¼Œæ­¤æ—¶$\alpha$å°±å¯ä»¥æ±‚å‡ºã€‚

#### BCTF 2018 - guess_number
æ¯”èµ›æ˜¯ä¸€ä¸ªå…¸å‹çš„**Hidden number problem**ï¼Œå¯ä»¥æŠŠè¿™é“é¢˜ç›®çš„æ±‚è§£å ªç§°æ˜¯Hidden number problemçš„ä¸€ä¸ªå…¸å‹çš„è§£æ³•ã€‚

* é¢˜ç›®ä»£ç ``crypto/code/Hidden_Number_Problem/server.py``
* è§£é¢˜ä»£ç ``crypto/code/Hidden_Number_Problem/Hidden_Number_Problem.sage``


#### GGHå…¬é’¥å¯†ç ä½“åˆ¶

è¿™æ˜¯ä¸€ä¸ªå›°éš¾æ€§åŸºäºæ ¼çš„æœ€çŸ­å‘é‡é—®é¢˜çš„å¯†ç ç®—æ³•($CVP_{\gamma},search$)ï¼Œå¯†ç æ„é€ å¦‚ä¸‹ï¼š
* KeyGen
    1. é€‰æ‹©ä¸€ç»„å¥½åŸº(Good basis)å“ˆè¾¾é©¬æ¯”ä¾‹(Hadamard ratio)æ¥è¿‘1çš„åŸºç§°ä¸ºå¥½åŸºã€‚è®°ä¸º$V = v_1,...,v_n$.
    2. é€‰æ‹©ä¸€ä¸ªçŸ©é˜µ$U$æ»¡è¶³$det(U) = \pm 1$.
    3. è®¡ç®—$W = UV$ï¼Œåˆ™$W$ä¸ºå…¬é’¥ï¼Œ$V,U$ä¸ºç§é’¥.
* Encryption
    1. ç»™å®šæ˜æ–‡å‘é‡$m$ï¼›é€‰æ‹©è¶³å¤Ÿå°çš„å‘é‡$r$ï¼Œä¸¤è€…éƒ½æœ‰$n$ä¸ªå…ƒç´ .
    2. è®¡ç®—$e = mW+r$ï¼Œ$e$ä¸ºå¯†æ–‡.
* Decryption
    * è®¡ç®—$m = eV^{-1}U^{-1}$.å› ä¸º$r$è¶³å¤Ÿå°ï¼Œå› æ­¤å¯ä»¥çº¦æ‰ã€‚

* æ”»å‡»ï¼šå½“æ–¹æ¡ˆè®¾è®¡ä¸å½“æ—¶å¯ä»¥ä½¿ç”¨Babai's nearest plane algorithmè¿›è¡Œæ±‚è§£.

* å‚è€ƒä»£ç 
    ```python
    # Sagemath 9.2
    W = matrix()    # n * n
    
    e = vector()    # n
    
    def babai(A, w):
        A = A.LLL(delta=0.75)
        G = A.gram_schmidt()[0]
        t = w
        for i in reversed(range(A.nrows())):
            c = ((t * G[i]) / (G[i] * G[i])).round()
            t -= A[i] * c
        return w - t
    
    V = babai(W, e)
    print(V * W^-1)
    ```

* å‚è€ƒæ–‡çŒ®ï¼š
    * https://zhuanlan.zhihu.com/p/337003376
    * https://staff.emu.edu.tr/alexanderchefranov/Documents/CMSE491/CMSE491%20Fall2020/Hoffstein2015%20Introduction%20to%20Mathematical%20Cryptography%20409-412%20GGH.pdf




### Lattice-Based Signature

> ç›¸å½“äºæ˜¯ç”¨ä¸€ç¯‡æ–‡çŒ®ï¼Œè¯¥æ–‡çŒ®çš„å‚è€ƒæ–‡çŒ®ä¸­å°±å¼•å‡ºäº†å¾ˆå¤šè‹±æ–‡æ–‡çŒ®

* GGH signature scheme
  * ä½¿ç”¨äº† **Hermite form of matrix**
  * Goldreich, O., Goldwasser, S., Halevi, S.: Public-key cryptosystems from lattice reduction problems. In: Kaliski, B.S. (ed.) Advances in Cryptology - CRYPTO â€™97: 17th Annual International Cryptology Conference, Santa Barbara, California, USA, August 17-21, 1997. Proceedings. Lecture Notes in Computer Science, vol. 1294, pp. 112â€“131. Springer Berlin Heidelberg, Berlin, Heidelberg (1997), https://doi.org/10.1007/BFb0052231
  * Nguyen P Q ,  Regcv O . Learning a Parallelepiped: Cryptanalysis of GGH and NTRU Signatures[J]. Journal of Cryptology, 2009, 22(2):139-160.  ï¼ˆ**ç»™å‡ºå¤§é‡ç­¾åï¼Œå¯ä»¥æ¢å¤å‡ºGGHå’ŒNTRUç­¾åæ–¹æ¡ˆçš„ç§é’¥**ï¼‰
* NTLU Signature
  * è¿Ÿæ¬¢æ¬¢,æé‡‘æ³¢,å¼ å¹³.åŸºäºNTRUæ ¼çš„æ•°å­—ç­¾åæ–¹æ¡ˆ[J].ç½‘ç»œå®‰å…¨æŠ€æœ¯ä¸åº”ç”¨,2021(12):34-36. 
* LWE Signature 
* GPV signature scheme


> ä½¿ç”¨BKZæˆ–LLLç®—æ³•æœ‰å¯èƒ½èƒ½è·å–ç­¾åæ–¹æ¡ˆä¸­æ‰€è®¾è®¡çš„å¥½åŸº(good basis)



## åŒæ€åŠ å¯†

> åŒæ€åŠ å¯†ä¸€èˆ¬ä¼šå› ä¸ºç®—æ³•æœ¬èº«çš„å¤æ‚åº¦è€Œä¸ä¼šå‡ºå¤ªéš¾ï¼Œå¯èƒ½å°±ä¼šè®©æˆ‘ä»¬æ¨ä¸€æ¨è§£å¯†ç®—æ³•ã€‚

### åŠåŒæ€åŠ å¯†

#### 1. Paillier Encryption Scheme

* å‚è€ƒï¼šINTRODUCTION TO MODERN CRYPTOGRAPHY ç¬¬äºŒç‰ˆç¬¬13ç« 

PaillieråŠ å¯†ç³»ç»Ÿç”¨åˆ°äº†ç¾¤$Z^*_{N^2}$ã€‚è€Œä¸”ä¸€èˆ¬æ¥è¯´$p = 2p'+1, q=2q'+1$éƒ½ä¼šå–å¼ºç´ æ•°ã€‚å®è´¨ä¸Šæ¨¡$N^2$çš„ç¾¤å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ªç¯ç¾¤ï¼Œå®ƒä¸ä¸€ä¸ªé˜¶ä¸º2çš„ç¾¤å’Œä¸€ä¸ªé˜¶ä¸º$2pp'qq'$çš„ç¾¤åŒæ„ï¼Œä½†æ˜¯è¯¥é˜¶ä¸º$2pp'qq'$çš„ç¾¤ä¹Ÿä¸æ˜¯å¾ªç¯ç¾¤ï¼Œå› ä¸ºè¯¥ç¾¤æœ‰ä¸€åŠçš„å…ƒç´ ä¸æ˜¯å¹³æ–¹å‰©ä½™ï¼Œåªæœ‰æœ‰å¹³æ–¹å‰©ä½™çš„å…ƒç´ æ‰æ„æˆå¾ªç¯ç¾¤ã€‚å› æ­¤æ¨¡$N^2$çš„å¾ªç¯ç¾¤çš„é˜¶ä¸º$pp'qq'$ã€‚ç”Ÿæˆçš„æ–¹å¼ä¸ºä»»å–æ¨¡$N^2$ä¸­çš„å…ƒç´ $a$ï¼Œåˆ™$g\equiv a^2\ mod\ N^2$æ˜¯å¾ªç¯ç¾¤çš„ä¸€ä¸ªç”Ÿæˆå…ƒã€‚

å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ€§è´¨æ˜¯ç¾¤ $Z^*_{N^2}$ åŒæ„äºç¾¤$Z_N \times Z_N^*$ã€‚å…¶ä¸­ä¸‰ä¸ªé‡è¦æ€§è´¨å¦‚ä¸‹ï¼š
![](crypto/images/Proposition_for_Paillier.PNG)

* ä¸€äº›æœ‰ç”¨çš„æ€§è´¨ï¼š
    * $\phi(N^2) = pq(p-1)(q-1) = N\phi(N)$ .
    * $a\in Z^*_{N^2}$ï¼Œåˆ™æœ‰$a^{\phi(N)} \equiv (1 + kN)\ mod\ N^2$.
    * è‹¥$f(a_1,b_1) = f(a_2,b_2)$ï¼Œåˆ™$(1+N)^{a_1-a_2}\cdot (b_1/b_2)^N \equiv 1\ mod\ N^2$.
    * $f(a_1,b_1)\cdot f(a_2,b_2) = f(a_1+a_2, b_1\cdot b_2)$

å› æ­¤æˆ‘ä»¬å¯ä»¥çœ‹æˆ$Z^*_{N^2}$ä¸Šçš„å…ƒç´ $c$å’Œ$Z_N \times Z_N^*$ä¸Šçš„å…ƒç´ $(m,r)$æ˜¯ç­‰ä»·çš„ã€‚
* Paillier å¯†ç æ–¹æ¡ˆ
* **KeyGen:** é€‰å–ä¸¤ä¸ªå¤§ç´ æ•°$p,q$ï¼Œä¿è¯$gcd(pq,(p-1)(q-1))=1$ï¼Œ$n=pq$ã€‚å…¶ä¸­$N$ä¸ºå…¬é’¥ï¼Œ$p,q$ä¸ºç§é’¥ã€‚
* **Encryption(m):**  
    1. éšæœºé€‰å–ä¸€ä¸ªå…ƒç´ $r\in Z^*_N$.
    2. è®¡ç®—$c = [(1+N)m\cdot r^N\ mod\ N^2]$
* **Decryption(c):** è§£å¯†æ¡ä»¶ï¼ï¼ï¼åˆ†è§£$N$
    * è®¡ç®—$m = [\frac{[c^{\phi(N)\ mod\ N^2}]-1}{N} \cdot \phi(N)^{-1}\ mod\ N]$

* å› æ­¤æ­¤åŠ å¯†æ–¹æ¡ˆåŸºäºçš„å›°éš¾æ€§é—®é¢˜æ˜¯å¤§æ•°åˆ†è§£ã€‚

* åŒæ€æ€§ï¼šåŠ æ³•åŒæ€ï¼ˆå¯†æ–‡ç›¸ä¹˜ç­‰äºæ˜æ–‡ç›¸åŠ ï¼‰$$((1+N)^{m_1}r_1^N)((1+N)^{m_2}r_2^N)\ =\ (1+N)^{(m_1+m_2)mod\ N}(r_1r_2)^N\ mod\ N^2.$$


#### 2. BCPå¯†ç ç³»ç»Ÿ

* å‚è€ƒè®ºæ–‡ï¼šhttps://www.iacr.org/archive/asiacrypt2003/01_Session01/03_106/28940037.pdf

* å‚è€ƒæ–‡çŒ®ï¼šhttps://zhuanlan.zhihu.com/p/428331342

> BCPå¯†ç ç³»ç»Ÿæ˜¯åŸºäºPaillierå¯†ç ç³»ç»Ÿè®¾è®¡çš„ï¼Œå…¶ç‰¹ç‚¹æ˜¯æœ‰ä¸¤ç§è§£å¯†ç®—æ³•ï¼Œç”¨äºè§£å¯†ç”¨æˆ·çš„ç§é’¥æˆ–ä½¿ç”¨ä¸»é’¥è§£å¯†ã€‚

* å¯†ç æ–¹æ¡ˆï¼š
![](crypto/images/BCP.PNG)
ä¸»å¯†é’¥å°±æ˜¯$\lambda(N)$ï¼Œç”¨æˆ·çš„ç§é’¥æ˜¯$x$ã€‚åœ¨å®é™…ä½¿ç”¨è¿™ä¸ªå¯†ç ç³»ç»Ÿçš„æ—¶å€™ï¼Œæœ‰ä¸ªBOSSå…ˆç”Ÿæˆ$(N,g)$ï¼ˆç³»ç»Ÿå…¬é’¥ï¼‰ï¼Œå¹¶çŸ¥é“çš„åˆ†è§£$N=pq$ï¼ˆç³»ç»Ÿç§é’¥ï¼‰ã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸‹ï¼Œæœ‰å¤šä¸ªç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æ ¹æ®ç³»ç»Ÿå…¬é’¥å¹¶æ ¹æ®ç­‰å¼$y=g^x\ mod\ N^2$ç”Ÿæˆå½¼æ­¤ä¸åŒçš„ç”¨æˆ·å…¬é’¥$y$å’Œç”¨æˆ·ç§é’¥$x$ã€‚ç³»ç»Ÿå¤–çš„äººä¸èƒ½è§£å¯†ä»»ä½•å¯†æ–‡ï¼Œæ™®é€šç”¨æˆ·åªå¯ä»¥ç”¨ä»–å¯¹åº”çš„ç”¨æˆ·ç§é’¥æ¥è§£å¯†ä»–è‡ªå·±çš„å¯†æ–‡ï¼Œè€ŒBOSSå¯ä»¥**åˆ©ç”¨ç³»ç»Ÿå¯†é’¥è§£å¯†ä»»ä½•ç”¨æˆ·çš„å¯†æ–‡**ã€‚


### å…¨åŒæ€åŠ å¯†

> TODO



## æ¦‚ç‡åŠ å¯†


### Goldwasser-Micali cryptosystem

Message encryption
Suppose Bob wishes to send a message m to Alice:

1. Bob first encodes m as a string of bits $(m_1, ..., m_n)$.
2. For every bit ${\displaystyle m_{i}}m_{i}$, Bob generates a random value ${\displaystyle y_{i}}y_{i}$ from the group of units modulo $N$, or ${\displaystyle \gcd(y_{i},N)=1}\gcd(y_{i},N)=1$. He outputs the value ${\displaystyle c_{i}=y_{i}^{2}x^{m_{i}}{\pmod {N}}}c_{i}=y_{i}^{2}x^{{m_{i}}}{\pmod  {N}}$.
Bob sends the ciphertext $(c_1, ..., c_n)$.

Message decryption
Alice receives $(c_1, ..., c_n)$. She can recover m using the following procedure:

For each i, using the prime factorization $(p, q)$, Alice determines whether the value $c_i$ is a quadratic residue; if so, $m_i = 0$, otherwise $m_i = 1$.
Alice outputs the message $m = (m_1, ..., m_n)$.

å‚è€ƒèµ„æ–™ï¼š
- https://en.wikipedia.org/wiki/Goldwasser%E2%80%93Micali_cryptosystem
- ã€Šå¯†ç å­¦åŸç†ä¸å®è·µã€‹ç¬¬ä¸‰ç‰ˆ 8.4èŠ‚


### Blumâ€“Goldwasser cryptosystem

> æ­¤å¯†ç ä½“åˆ¶ç”¨åˆ°äº†BBSç”Ÿæˆå™¨ç”Ÿæˆçš„éšæœºæ•°,**å¹¶å¯ä»¥æ‰©å±•åˆ°windowçš„å½¢å¼**

- **Keygen:**
  - $p\equiv q\equiv 3\ (mod\ 4)$, $n=pq$
  - $r\in Z_n^*$
  - $sk:p,q$ï¼Œ$pk:n$
- **Encrypt:($m:(m_1,...,m_l)$, pk)**
  - $s_0=r$ï¼Œç”¨BBSç”Ÿæˆå™¨ç”Ÿæˆ$z_1,...,z_l$
  - $s_{l+1}=s_0^{2^{l+1}}\ mod\ n$
  - For $1\leq i\leq l$,è®¡ç®—$y_i=(x_i+z_i)\ mod\ 2$
  - **return** $(y_1,...,y_l,s_{l+1})$
- **Decrypt:(å¯†æ–‡ï¼Œsk)**
  - $a_1 = ((p+1)/4)^{l+1}\ mod\ (p-1)$
  - $a_2 = ((q+1)/4)^{l+1}\ mod\ (q-1)$
  - $b_1 = s_{l+1}^{a_1}\ mod\ p$
  - $b_2 = s_{l+1}^{a_2}\ mod\ q$
  - ä½¿ç”¨ä¸­å›½å‰©ä½™å®šç†æ‰¾å‡º$$r\equiv b_1(mod\ p),\ r\equiv b_2(mod\ q)$$
  - æŠŠ$r$ä½œä¸ºBBSç”Ÿæˆå™¨ç”Ÿæˆ$z_1,...,z_l$
  - $\forall 1\leq i\leq l$è®¡ç®—$m_i = (y_i+z_i)\ mod\ 2$
  - æ˜æ–‡ä¸º$m = (m_1,...,m_l)$

å‚è€ƒèµ„æ–™ï¼š
- https://en.wikipedia.org/wiki/Blum%E2%80%93Goldwasser_cryptosystem
- ã€Šå¯†ç å­¦åŸç†ä¸å®è·µã€‹ç¬¬ä¸‰ç‰ˆ 8.4èŠ‚





# å“ˆå¸Œå‡½æ•°

å“ˆå¸Œå‡½æ•°ï¼ˆHash Functionï¼‰æŠŠæ¶ˆæ¯æˆ–æ•°æ®å‹ç¼©æˆæ‘˜è¦ï¼Œä½¿å¾—æ•°æ®é‡å˜å°ã€‚å³æŠŠä»»æ„é•¿åº¦çš„æ¶ˆæ¯hashæˆå›ºå®šé•¿åº¦çš„åºåˆ—ã€‚

å®šä¹‰ï¼šä¸€ä¸ªHashæ—æ˜¯æ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„å››å…ƒç»„$(\mathcal{X,Y,K,H})$ï¼š
1. $\mathcal X$æ˜¯æ‰€æœ‰å¯èƒ½çš„æ¶ˆæ¯çš„é›†åˆã€‚
2. $\mathcal Y$æ˜¯ç”±æ‰€æœ‰å¯èƒ½çš„æ¶ˆæ¯æ‘˜è¦æˆ–è®¤è¯æ ‡ç­¾æ„æˆçš„æœ‰é™é›†ã€‚
3. $\mathcal K$æ˜¯å¯†é’¥ç©ºé—´ï¼Œæ˜¯æ‰€æœ‰å¯èƒ½çš„å¯†é’¥æ„æˆçš„æœ‰é™é›†ã€‚
4. å¯¹äºæ¯ä¸ª$K\in \mathcal K$ï¼Œå­˜åœ¨ä¸€ä¸ªHashå‡½æ•°$h_K\in \mathcal H, h_K:\mathcal X \rightarrow \mathcal Y$ã€‚

* Hash å‡½æ•°çš„å®‰å…¨æ€§
    * æŠ—åŸåƒ(Preimage)æ”»å‡»:å·²çŸ¥$H(y)$ï¼Œæ‰¾å‡º$x$ï¼Œä½¿å¾—$H(x)=H(y)$
    * æŠ—ç¬¬äºŒåŸè±¡æ”»å‡»(æŠ—å¼±ç¢°æ’æ€§):å¯¹äºä»»æ„æ¶ˆæ¯ $x$ï¼Œæ‰¾åˆ°æ»¡è¶³å¦ä¸€æ¶ˆæ¯ $y$ï¼Œæ»¡è¶³$H(x)=H(y)$ï¼Œåœ¨è®¡ç®—ä¸Šä¸å¯è¡Œã€‚
    * æŠ—å¼ºç¢°æ’æ€§:æ‰¾åˆ°ä»»æ„ä¸€å¯¹æ»¡è¶³$H(x)=H(y)$çš„æ¶ˆæ¯ $x$ å’Œ $y$ åœ¨è®¡ç®—ä¸Šä¸å¯è¡Œã€‚
    * ä¼ªéšæœºæ€§

* Hash å‡½æ•°ç”¨é€”
    * ä¿è¯æ¶ˆæ¯å®Œæ•´æ€§
    * å†—ä½™æ ¡éªŒ
    * å£ä»¤
    * å…¥ä¾µæ£€æµ‹
    * èº«ä»½è®¤è¯
    * æ•°å­—ç­¾å
    * æ¶ˆæ¯è®¤è¯ç MAC(message authentication codes)
    * ...

## MD5
* è¾“å…¥ï¼šä»»æ„é•¿åº¦æ¶ˆæ¯ï¼Œ512bitåˆ†ç»„ã€‚
* è¾“å‡ºï¼š128bitçš„Hashå€¼ã€‚

æ­¤å¤–ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è·å¾—åˆ°çš„ md5 æ˜¯ 16 ä½çš„ï¼Œå…¶å®é‚£ 16 ä½æ˜¯ 32 ä½ md5 çš„é•¿åº¦ï¼Œæ˜¯ä» 32 ä½ md5 å€¼æ¥çš„ã€‚æ˜¯å°† 32 ä½ md5 å»æ‰å‰å…«ä½ï¼Œå»æ‰åå…«ä½å¾—åˆ°çš„ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°çš„åˆå§‹åŒ–æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ MD5 å‡½æ•°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æœ‰å¦‚ä¸‹å››ä¸ªåˆå§‹åŒ–çš„å˜é‡ï¼Œå¯ä»¥çŒœæµ‹è¯¥å‡½æ•°ä¸º MD5 å‡½æ•°ï¼Œå› ä¸ºè¿™æ˜¯ MD5 å‡½æ•°çš„åˆå§‹åŒ– IVã€‚

``0x67452301ï¼Œ0xEFCDAB89ï¼Œ0x98BADCFEï¼Œ0x10325476``

* **ç ´è§£:**
    * http://www.cmd5.com/
    * http://www.ttmd5.com/
    * http://pmd5.com/
    * https://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe.zip (ç”ŸæˆæŒ‡å®šå‰ç¼€çš„ md5 ç¢°æ’)


## SHA1
* è¾“å…¥ï¼šä»»æ„é•¿çš„æ¶ˆæ¯ï¼Œåˆ†ä¸º 512 æ¯”ç‰¹é•¿çš„åˆ†ç»„ã€‚é¦–å…ˆåœ¨æ¶ˆæ¯å³ä¾§è¡¥æ¯”ç‰¹ 1ï¼Œç„¶åå†è¡¥è‹¥å¹²ä¸ªæ¯”ç‰¹ 0ï¼Œç›´åˆ°æ¶ˆæ¯çš„æ¯”ç‰¹é•¿åº¦æ»¡è¶³å¯¹ 512 å–æ¨¡åä½™æ•°æ˜¯ 448ï¼Œä½¿å…¶ä¸ 448 æ¨¡ 512 åŒä½™ã€‚
* è¾“å‡ºï¼š160 æ¯”ç‰¹çš„æ¶ˆæ¯æ‘˜è¦ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°çš„åˆå§‹åŒ–æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯ SHA1 å‡½æ•°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æœ‰å¦‚ä¸‹äº”ä¸ªåˆå§‹åŒ–çš„å˜é‡ï¼Œå¯ä»¥çŒœæµ‹è¯¥å‡½æ•°ä¸º SHA1 å‡½æ•°ï¼Œå› ä¸ºè¿™æ˜¯ SHA1 å‡½æ•°çš„åˆå§‹åŒ– IVã€‚
``0x67452301 0xEFCDAB89 0x98BADCFE 0x10325476 0xC3D2E1F0``
* **ç ´è§£:**
    * The First Collision for Full SHA-1[C]// Annual International Cryptology Conference. Springer, Cham, 2017.
    * SHA1 å·²ç»ä¸å†å®‰å…¨äº†ï¼Œå› ä¸ºä¹‹å‰è°·æ­Œå…¬å¸ƒäº†æ±‚å¾—ä¸¤ä¸ª sha1 å€¼ä¸€æ ·çš„ pdfï¼Œå…·ä½“è¯·å‚è€ƒ https://shattered.io/
    * https://alf.nu/SHA1

## MACï¼ŒHMACï¼ŒCMAC

> MACï¼ˆæ¶ˆæ¯è®¤è¯ç ï¼‰ï¼šæ˜¯æ»¡è¶³æŸäº›å®‰å…¨æ€§è´¨çš„å¸¦å¯†é’¥çš„HASHå‡½æ•°ã€‚

* MACçš„è¾“å…¥ï¼šä¿¡æ¯mï¼›å¯†é’¥k
* MACçš„è¾“å‡ºï¼šå›ºå®šé•¿åº¦çš„Hashå€¼

æ„é€ MACçš„ä¸€ä¸ªå¸¸ç”¨æ–¹æ³•æ˜¯é€šè¿‡æŠŠä¸€ä¸ªå¯†é’¥ä½œä¸ºè¢«Hashçš„æ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ã€‚è®°$h$ä¸ºä¸å¸¦å¯†é’¥çš„è¿­ä»£Hashå‡½æ•°æ¥æ„é€ ä¸€ä¸ªå¸¦å¯†é’¥çš„Hashå‡½æ•°$h_K$ï¼Œè®°$K$ä¸ºå¯†é’¥ã€‚

> HMAC 

HMACæ˜¯äº2002å¹´3æœˆè¢«æè®®çš„ä½œä¸ºFIPSæ ‡å‡†çš„åµŒå¥—MACç®—æ³•ã€‚HMACçš„äº§ç”Ÿæ˜¯ä½¿ç”¨Hashå‡½æ•°ã€‚
ä¾‹å­ï¼šåŸºäºSHA-1æè¿°HMACï¼Œè¿™ä¸ªç‰ˆæœ¬çš„HMACä½¿ç”¨äº†512bitçš„å¯†é’¥$K$ã€‚$x$ä¸ºæ¶ˆæ¯ï¼Œè®°ipadå’Œopadä¸º$$ipad=3636...36 \newline opad = 5C5C...5C$$ åˆ™160bitçš„HMACå®šä¹‰ä¸ºï¼š$$HMAC_K(x)=SHA-1((K\oplus opad)\parallel SHA-1((K\oplus ipad)\parallel x))$$ å¦‚å›¾ï¼š![HMAC](crypto/images/HMAC.PNG)

* HMACä½œä¸ºMACäº‹å®‰å…¨çš„
> CMAC

CMACæ˜¯åŸºäºåˆ†ç»„åŠ å¯†çš„æ¶ˆæ¯è®¤è¯ç ã€‚CMACçš„äº§ç”Ÿæ˜¯ä½¿ç”¨åˆ†ç»„åŠ å¯†ç®—æ³•ï¼ˆä¸ç”¨Hashå‡½æ•°ï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªANSIæ ‡å‡†ï¼ˆX9.17ï¼‰ã€‚CBC-MACå®é™…ä¸Šå°±æ˜¯å¯¹æ¶ˆæ¯ä½¿ç”¨CBCæ¨¡å¼è¿›è¡ŒåŠ å¯†ï¼Œå–å¯†æ–‡çš„æœ€åä¸€å—ä½œä¸ºè®¤è¯ç ã€‚è®¾CMACçš„è¾“å‡ºçš„é•¿åº¦ä¸º$n$æ¯”ç‰¹ï¼Œé‚£ä¹ˆè¾“å…¥çš„ä¿¡æ¯çš„é•¿åº¦å¿…é¡»æ˜¯$n$çš„æ•´æ•°å€(å¯ä½¿ç”¨å„ç§å¡«å……æ–¹æ¡ˆè¿›è¡Œå¡«å……)ã€‚

æµç¨‹å¦‚ä¸‹ï¼š![CBC MAC](crypto/images/CBC_MAC.png)

* å¸¸è§çš„CMACæœ‰**AES-CMAC**ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å…¶åŠ å¯†å‡½æ•°$E$ä½¿ç”¨çš„å°±ç®—æ˜¯AESåŠ å¯†ã€‚

> ä»£ç å®ç°ï¼š
```python
#python3

############## HMAC ################
from Crypto.Hash import HMAC, SHA256
key = b'EE5815'
M = b'Hi Bob, let us meet at noon'
h = HMAC.new(key, msg=M, digestmod=SHA256)
hmac= h.hexdigest()
print(hmac)
# 668808fd32a4489382523347e23407b7c22ae25c7cb1f768c6dd1afcdcf84a3b

# éªŒè¯ï¼Œè‹¥æŠ¥é”™åˆ™è¡¨ç¤ºéªŒè¯å¤±è´¥
try:
    h.hexverify(hmac)
    print("The message '%s' is authentic" % M)
except ValueError:
    print("Unauthentic message or wrong key used")  


############## AES_CMAC ################
from Crypto.Hash import CMAC
from Crypto.Cipher import AES
key = b'Our 16 byte key!'           # keyå¿…é¡»æ˜¯128bit
M = b'Hi Bob, let us meet at noon'  # Mä¼šè‡ªåŠ¨å¡«å……
cobj = CMAC.new(key, msg=M, ciphermod=AES)  
cmac = cobj.hexdigest()
print(cmac)
# 294000f8a26b00dec9d2cd6e73c94617
#################################
# æ³¨æ„ï¼šä½¿ç”¨Crypto.Hash.CMACå‡½æ•°å®ç°CMACçš„è¯ä½¿ç”¨çš„æ˜¯CBCæ¨¡å¼ï¼Œ
# ä¼šè‡ªåŠ¨ç”Ÿæˆå¡«å……å¯†é’¥(ä»£ç é‡Œå«sub-key)ï¼Œå¯ä»¥å½“ä½œå¯†é’¥ï¼Œä¹Ÿå¯ä»¥å½“ä½œå¡«å……ï¼Œæœ¬è´¨ä¸Šæ˜¯å›ºå®šçš„
#################################
```







## Fowlerâ€“Nollâ€“Vo hash function (FNV)
å‚è€ƒï¼šhttps://en.wikipedia.org/wiki/Fowler%E2%80%93Noll%E2%80%93Vo_hash_function

æ­¤Hashå‡½æ•°é¦–å…ˆæŠŠè¾“å…¥åˆ†å—ï¼Œç„¶ååˆå§‹åŒ–ä¸€ä¸ª``FNV_offset_basis``å’Œ``FNV_prime``ï¼Œæœ€åˆå§‹çš„hashå€¼ç­‰äº``FNV_offset_basis``ã€‚ç„¶åå¯¹äºæ¯ä¸ªè¾“å…¥çš„å—ï¼ŒæŠŠå½“å‰hashå€¼ä¹˜ä»¥``FNV_prime``ç„¶åä¸è¾“å…¥çš„å—è¿›è¡Œå¼‚æˆ–ã€‚æ‰€æœ‰å—å¤„ç†å®Œåå°±æ˜¯æœ€ç»ˆçš„hashå€¼ã€‚

* è¿™ç§Hashå‡½æ•°æ˜¯ä¸€ä¸ªéå¯†ç å®‰å…¨çš„Hashã€‚ä¸€èˆ¬ç”¨äºå¿«é€Ÿhashï¼Œè®¡ç®—æ ¡éªŒå’Œï¼Œä¸ç”¨åšå¯†ç ã€‚å±€é™ç‚¹å¦‚ä¸‹ï¼š
    1. **è®¡ç®—é€Ÿåº¦**ï¼šè®¡ç®—é€Ÿåº¦ä¸Šæ­£å‘è®¡ç®—å’Œé€†å‘è®¡ç®—çš„é€Ÿåº¦æ¥è¿‘ã€‚
    2. **ç²˜ç¨ **ï¼šå› ä¸ºåªæ¶‰åŠä¹˜æ³•å’Œå¼‚æˆ–è¿ç®—ï¼Œå› æ­¤å¯¹äº0è¾ƒå¤šçš„è¾“å…¥éå¸¸çš„æ•æ„Ÿã€‚
    3. **æ‰©æ•£**ï¼šå› ä¸ºåªæœ‰å¼‚æˆ–è¿ç®—ï¼Œæ­¤hashå‡½æ•°çš„æ‰©æ•£æ€§è´¨å¯é€šè¿‡XOR-foldingå‡è½»ã€‚

#### 2018 ç½‘é¼æ¯ hashcoll
è¿™é“é¢˜ç›®å¹¶ä¸æ˜¯æ ‡å‡†çš„FNVå“ˆå¸Œï¼Œè€Œæ˜¯æœ‰ä¸€ç‚¹å°çš„å˜åŠ¨ã€‚è¯¥é—®é¢˜å¯ä»¥åˆ†æå¾—åˆ°æ˜¯ï¼š**ç»™å‡º$n$ä¸ªæ•°ï¼Œæ±‚è§£å®ƒä»¬çš„æ•´çº¿æ€§ç»„åˆä½¿å¾—çº¿æ€§ç»„åˆæ‰€å¾—åˆ°çš„ç»“æœä¸º0**ã€‚ä¸€ç§æ±‚è§£çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ ¼ä¸­çš„LLLç®—æ³•è¿›è¡Œæ±‚è§£ã€‚

* **ç®—æ³•åŸç†ï¼š**
* è¾“å…¥ï¼šç»™å®š$n$ä¸ª(å®/æœ‰ç†)æ•°$a_1,a_2,...,a_n$
* è¾“å‡ºï¼šæ±‚å‡º$n$ä¸ªæ•°$z_1, z_2, ..., z_n$ä½¿å¾—$\sum_{i=1}^nz_ia_i$ç­‰äº0æˆ–å°½å¯èƒ½ç­‰äº0ã€‚   
* è¿‡ç¨‹ï¼šæ„é€ å‡ºçŸ©é˜µ$$
  B = \left[\begin{matrix}
  1 & 0 & \cdots & 0 & Ka_1 \\
  0 & 1 & \cdots & 0 & Ka_2 \\
  \vdots & \vdots & \ddots & \vdots & \vdots \\
  0 & 0 & \cdots & 1 & Ka_n
  \end{matrix}\right]^T
  $$ ç„¶åä½¿ç”¨LLLç®—æ³•å¯¹çŸ©é˜µ$B$è¿›è¡Œè§„çº¦ï¼Œå¾—åˆ°è½¬æ¢çŸ©é˜µ$T'$ã€‚å› æ­¤ æœ‰$B^TT' = \tilde{B}$ã€‚
  **æ³¨ï¼šè‹¥$B$æ˜¯mè¡Œnåˆ—ï¼Œåˆ™$T'$æ˜¯mè¡Œnåˆ—ï¼Œåˆ™$\tilde{B}$æ˜¯nè¡Œnåˆ—çš„çŸ©é˜µã€‚åœ¨è§£å†³æ¬¡é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œå˜æ¢çŸ©é˜µ$T'$çš„æœ€å$m-n$åˆ—æ˜¯æ²¡æœ‰ç”¨çš„ã€‚**
    * è½¬æ¢çŸ©é˜µ$T'$çš„ç¬¬ä¸€è¡Œè¡¨ç¤ºçš„å°±æ˜¯æ‰€æ±‚çš„$z_1, z_2, ..., z_n$ã€‚è®°$\tilde{B}$çš„ç¬¬ä¸€ä¸ªå‘é‡ä¸º$v_1$ã€‚ç”±![æ ¼LLLç®—æ³•](crypto/images/LLL.PNG)è¿™ä¸ªæ€§è´¨å¯çŸ¥ï¼Œ**LLLåŸºçš„ç¬¬ä¸€ä¸ªå‘é‡$v_1$æœ‰ç€æœ€çŸ­çš„å‘é‡é•¿åº¦**ï¼Œå³ $$||v_1||\leq 2^{\frac{n-1}{4}}(1+\sum^n_{i=1}\alpha_i^2)^{\frac{1}{2(n+1)}}$$ è®°åä¸€é¡¹ä¸ºæ¯”è¾ƒå°çš„å¸¸æ•°$c$ã€‚åˆ™ $$||v_1||\leq c \times 2^{\frac{n-1}{4}}$$
    * è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå°çš„æ•°ï¼Œç„¶åæˆ‘ä»¬çŸ¥é“å‘é‡$v_i$æ˜¯åŸå‘é‡çš„çº¿æ€§ç»„åˆï¼Œå› æ­¤$v_i$çš„ç¬¬$n+1$ä¸ªå…ƒç´ ä¸º 
      $$v_i[n+1] = K\sum_{i=1}^nz_ia_i$$ å› æ­¤åªè¦å¸¸æ•°$K$è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆåé¢çš„æ±‚å’Œå°±å¿…é¡»è¶³å¤Ÿå°ï¼Œå› æ­¤å½“$a_i$å…¨ä¸ºæ•´æ•°çš„æ—¶å€™ï¼Œè¯¥æ±‚å’Œä¸€å®šä¸º0ã€‚(è‹¥$a_i$ä¸ºå®æ•°ï¼Œé‚£ä¹ˆè¯¥æ±‚å’Œå¯èƒ½å°±ä¸ä¸º0ï¼Œä½†æ˜¯ä¼šæ¯”è¾ƒæ¥è¿‘0) è¿™å°±è¯´æ˜äº†ç®—æ³•çš„æ­£ç¡®æ€§ã€‚ 
* å®éªŒï¼šåœ¨ä½¿ç”¨Sagemathè¿›è¡Œç¼–ç¨‹å®ç°çš„æ—¶å€™ï¼ŒçŸ©é˜µæ˜¯ä½¿ç”¨äºŒé‡åˆ—è¡¨çš„å½¢å¼è¡¨ç¤ºã€‚è‹¥è®°$B$ä¸ºéœ€è¦è¿›è¡ŒLLLå˜æ¢çš„çŸ©é˜µï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªæ ¼ä¸Šçš„å‘é‡ä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œè¡¨ç¤ºã€‚ç„¶åç›´æ¥æ‰§è¡Œ
``L = B.LLL()``
å¾—åˆ°**LLLç®—æ³•ä¸‹æ–°çš„æ ¼åŸº**ï¼Œè¿™ä¸ªæ–°çš„æ ¼åŸºçš„å¤§å°å’Œ$B$ä¸€è‡´ã€‚ç®—æ³•çš„è¦æ±‚æ˜¯è½¬æ¢çŸ©é˜µçš„çº¿æ€§ç»„åˆçš„ç³»æ•°ã€‚ç”±äºçŸ©é˜µ$B$åœ¨å‰$n\times n$çš„å…ƒç´ æ˜¯ä¸ªå•ä½çŸ©é˜µï¼Œå› æ­¤ç³»æ•°çŸ©é˜µä¸æ–°çš„æ ¼çŸ©é˜µåœ¨å·¦ä¸Šæ–¹$n\times n$çš„å…ƒç´ ä¸Šç›¸ç­‰ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨æ–°çš„æ ¼åŸºçš„ç¬¬ä¸€è¡Œçš„å‰$n$ä¸ªå…ƒç´ ä½œä¸ºç³»æ•°çŸ©é˜µçš„ç³»æ•°æ¥ä½¿ç”¨ã€‚

* ***å…·ä½“Sagemath9.2ä»£ç è§``crypto/code/LLL_n_positive_integral_combination.sage``*** è¿™é‡Œä¸æ˜¯ç»™å‡ºé¢˜è§£ï¼Œè€Œæ˜¯ç»™å‡ºå¦‚ä½•ä½¿ç”¨LLLç®—æ³•æ±‚è§£**ç»™å‡º$n$ä¸ªæ•°ï¼Œæ±‚è§£å®ƒä»¬çš„æ•´çº¿æ€§ç»„åˆä½¿å¾—çº¿æ€§ç»„åˆæ‰€å¾—åˆ°çš„ç»“æœä¸º0**è¿™ä¸ªé—®é¢˜ã€‚

## Hash å‡½æ•°çš„æ”»å‡»
* æš´åŠ›æ”»å‡»ï¼šä¸ä¾èµ–äºä»»ä½•ç®—æ³•ç»†èŠ‚ï¼Œä»…ä¸ Hash å€¼é•¿åº¦æœ‰å…³ï¼›
* ç”Ÿæ—¥æ”»å‡» (Birthday Attack)ï¼šæ²¡æœ‰åˆ©ç”¨ Hash å‡½æ•°çš„ç»“æ„å’Œä»»ä½•ä»£æ•°å¼±æ€§è´¨ï¼Œåªä¾èµ–äºæ¶ˆæ¯æ‘˜è¦çš„é•¿åº¦ï¼Œå³ Hash å€¼çš„é•¿åº¦ã€‚
* ä¸­é—´ç›¸é‡æ”»å‡» (Meet-In-The-Middle)ï¼šæ˜¯ç”Ÿæ—¥æ”»å‡»çš„ä¸€ç§å˜å½¢ï¼Œä¸æ¯”è¾ƒ Hash å€¼ï¼Œè€Œæ˜¯æ¯”è¾ƒä¸­é—´å˜é‡ã€‚è¿™ç§æ”»å‡»ä¸»è¦é€‚ç”¨äºæ”»å‡»å…·æœ‰åˆ†ç»„é“¾ç»“æ„çš„ Hash æ–¹æ¡ˆã€‚
* å¯†ç åˆ†æï¼šä¾èµ–äºå…·ä½“ç®—æ³•çš„è®¾è®¡ç¼ºç‚¹ã€‚

### æš´åŠ›æ”»å‡»
HashCat å·¥å…· : https://hashcat.net/hashcat/
(æ²¡æœ‰å°è¯•ä½¿ç”¨)








### å“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»ï¼ˆhash length extension attacksï¼‰
* åº”ç”¨åœºæ™¯ï¼šMD5 å’Œ SHA-1 ç­‰åŸºäº Merkleâ€“DamgÃ¥rd æ„é€ çš„ç®—æ³•å‡å¯¹æ­¤ç±»æ”»å‡»æ˜¾ç¤ºå‡ºè„†å¼±æ€§ã€‚MD5, SHA1, SHA256, SHA512éƒ½å¯ä»¥ã€‚è¯¥æ”»å‡»é€‚ç”¨äºåœ¨æ¶ˆæ¯ä¸å¯†é’¥çš„é•¿åº¦å·²çŸ¥çš„æƒ…å½¢ä¸‹ï¼Œæ‰€æœ‰é‡‡å–äº† $H(key || message)$ æ­¤ç±»æ„é€ çš„æ•£åˆ—å‡½æ•°ã€‚

* æ”»å‡»å‰æï¼ˆhashç®—æ³•çš„è„†å¼±æ€§ï¼‰ï¼šMD5å’ŒSHA-1ç­‰å“ˆå¸Œç®—æ³•åœ¨è¿ç®—çš„æ—¶å€™ä¼šå¯¹éœ€è¦è¿›è¡Œhashçš„æ¶ˆæ¯è¿›è¡Œåˆ†å—ï¼Œç„¶å **ä½¿ç”¨ä¸Šä¸€ä¸ªå—çš„è¿ç®—ç»“æœä½œä¸ºä¸‹ä¸€ä¸ªå—çš„è¿ç®—çš„åˆå§‹å‘é‡** ï¼Œç±»ä¼¼äºAESçš„CBCæ¨¡å¼ï¼Œè¿™æ˜¯æœ€å…³é”®çš„ä¸€ç‚¹ã€‚
    * SHA-1: å‚è€ƒhttps://www.cnblogs.com/gwind/p/8025130.html
    * MD5ï¼šå‚è€ƒhttps://blog.csdn.net/qq_35078631/article/details/70941204

* æ”»å‡»åŸç†ï¼šæœ€æ ¸å¿ƒåœ¨äºæ­¤ç­‰å¼æˆç«‹$$h_K(x||x')=compress(h_K(x)||x')$$ å…¶ä¸­$h_K$éœ€è¦æ¯ä¸ªè¾“å…¥æ¶ˆæ¯çš„é•¿åº¦æ˜¯$t$çš„å€æ•°ï¼Œç„¶å$x'$æ˜¯ä»»æ„é•¿åº¦ä¸º$t$çš„å€æ•°çš„æ¯”ç‰¹ä¸²ã€‚

* æ”»å‡»æµç¨‹ï¼šç°åœ¨å·²çŸ¥è¿›è¡Œhashè¿ç®—å‰ä¼šé™„åŠ æœªçŸ¥æ¯”ç‰¹ä¸²saltè®°ä¸º$k$ã€‚å·²çŸ¥$h(k)$çš„å€¼å’Œ$k$çš„é•¿åº¦ã€‚å°±å¯ä»¥æ ¹æ®MD5æˆ–è€…SHA-1çš„å¡«å……è§„åˆ™è¿›è¡Œå¡«å……ï¼Œä½¿å¾—$$
h(k) = h(k||padding)
$$ å› æ­¤æˆ‘ä»¬æ„é€ $x'=padding||m$ï¼Œè¿™æ ·ä¸€æ¥æœ‰ $$
h(k||x') = h(k||padding||x')$$  ç„¶åé€šè¿‡å› ä¸ºåˆšå¥½åœ¨å¯¹$k||padding$è¿›è¡Œhashçš„æ—¶å€™ä¸$x'$çš„è¿ç®—æ˜¯åˆ†å¼€ä¸¤å—çš„ï¼Œå› æ­¤$h(k||padding)$çš„è¾“å‡ºä¼šä½œä¸ºå¯¹$x'$è¿›è¡Œhashè¿ç®—çš„åˆå§‹å‘é‡ã€‚å› æ­¤æœ‰ $$ h(k||x') = h_{h(k)ä½œä¸ºåˆå§‹å‘é‡}(m)$$

* **å·¥å…· hashpump**ï¼š  https://github.com/bwall/HashPump
    * pythonä¸­`hashpump`åº“æœ‰ç‚¹éš¾è£…ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä¸‹è½½æºç ç„¶åå®‰è£…å†è¿è¡Œã€‚
    ```
    $ hashpump -h
        HashPump [-h help] [-t test] [-s signature] [-d data] [-a additional] [-k keylength]
        HashPump generates strings to exploit signatures vulnerable to the Hash Length Extension Attack.
        -h --help          Display this message.
        -t --test          Run tests to verify each algorithm is operating properly.
        -s --signature     The signature from known message.
        -d --data          The data from the known message.
        -a --additional    The information you would like to add to the known message.
        -k --keylength     The length in bytes of the key being used to sign the original message with.
        Version 1.2.0 with CRC32, MD5, SHA1, SHA256 and SHA512 support.
    ```
    åªæœ‰å°‘è®¸çš„å‡ ä¸ªå‚æ•°ï¼Œç„¶åä¸éœ€è¦æŒ‡å®šç”¨çš„æ˜¯å“ªä¸ªç®—æ³•ï¼Œå› ä¸ºé•¿åº¦éƒ½ä¸ä¸€æ ·ï¼Œä¼šè‡ªåŠ¨è¯†åˆ«ã€‚
    ä¾‹å­,å¯ä»¥åŠ å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä¸åŠ å‚æ•°æ ¹æ®æç¤ºç»™æ•°æ®ï¼š
    ``` bash
    > hashpump
    Input Signature: 571580b26c65f306376d4f64e53cb5c7
    Input Data: 123456
    Input Key Length: 20
    Input Data to Add: 654321
    af6f2842729baea20f2984f424897365
    123456\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd0\x00\x00\x00\x00\x00\x00\x00654321
    ```

### hash ç®—æ³•è®¾è®¡æœ‰è¯¯
ä¸€äº›è‡ªå®šä¹‰çš„ hash ç®—æ³•å¯èƒ½æ˜¯å¯é€†çš„ã€‚é€šè¿‡åˆ†æå‡ºå…¶é€†å‡½æ•°ï¼Œç„¶åå®ç°å¾—åˆ°ç»“æœã€‚

* **TIPS**ï¼šå¯ä»¥ä½¿ç”¨256ä¸ªçº¿æ€§æ— å…³çš„256bitçš„hashå€¼ç”Ÿæˆä»»æ„256bitçš„hashå€¼ã€‚

### å·¥ä½œé‡è¯æ˜(proof of work)
å¾ˆå¤šæ—¶å€™é¢˜ç›®è¦å…ˆè¦æˆ‘ä»¬ç»™å‡ºå·¥ä½œé‡è¯æ˜ï¼Œç”±äºå¥—è·¯éƒ½æ¯”è¾ƒç±»ä¼¼ï¼Œå› æ­¤è¿™é‡Œç»™å‡ºäº†ä¸€ä¸ªæ–¹ä¾¿çš„å·¥ä½œé‡è¯æ˜çš„æ–¹æ³•ï¼Œåœ¨å®é™…æ¯”èµ›çš„æ—¶å€™èƒ½ç›´æ¥ç”¨åˆ°ã€‚
```python
TABLE2 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'

def proof_of_work(str, hashh):
    l = len(TABLE2)
    for i in range(l):
        for j in range(l):
            for k in range(l):
                for ll in range(l):
                    tmp = (TABLE2[i] + TABLE2[j] + TABLE2[k] + TABLE2[ll]).encode()
                    if sha256(tmp + str).hexdigest().encode() == hashh:
                        print(tmp)
                        client.send(tmp + b'\n')
                        return
```

# æ•°å­—ç­¾å
æ•°å­—ç­¾åï¼ˆdigital signatureï¼‰ä¸»è¦ç”¨äºå¯¹æ•°å­—æ¶ˆæ¯ï¼ˆdigital messageï¼‰è¿›è¡Œç­¾åï¼Œä»¥é˜²æ¶ˆæ¯çš„å†’åä¼ªé€ æˆ–ç¯¡æ”¹ï¼Œäº¦å¯ä»¥ç”¨äºé€šä¿¡åŒæ–¹çš„èº«ä»½é‰´åˆ«ã€‚å…¶åŸºæœ¬åŸç†å¦‚ä¸‹ï¼š
![æ•°å­—ç­¾å](crypto/images/Digital_Signature.PNG)

* æ•°å­—ç­¾åçš„ç‰¹æ€§
    * ä¸å¯ä¼ªé€ 
    * å”¯ä¸€
    * å¯ä¿¡(è¦æœ‰ç¬¬ä¸‰æ–¹å‚ä¸)
    * ä¸å¯å¦è®¤(ä¸æ˜¯æ‰€æœ‰ç­¾åéƒ½æœ‰è¿™ç§ç‰¹æ€§ï¼Ÿ)

## RSAæ•°å­—ç­¾å
åŸç†ç±»ä¼¼äº RSA åŠ å¯†ï¼Œåªæ˜¯è¿™é‡Œä½¿ç”¨ç§é’¥è¿›è¡ŒåŠ å¯†ï¼Œå°†åŠ å¯†åçš„ç»“æœä½œä¸ºç­¾åã€‚

**å…·ä½“æ–¹æ¡ˆï¼š** ç»™å‡º$n=p,q$ï¼Œæœ‰$ed\equiv1\ (mod\ \phi(n))$ï¼Œå…¶ä¸­$n,e$ä¸ºå…¬é’¥ï¼Œ$p,q,d$ä¸ºç§é’¥ï¼Œåˆ™ï¼š$$sig_K(x)= y = x^e\ mod\ n$$ $$ver_K(x,y) = true \newline \Leftrightarrow x \equiv y^d\ mod\ n$$

* ç ´è§£æ–¹æ¡ˆä¸RSAç ´è§£ç±»ä¼¼

## ElGamalæ•°å­—ç­¾å
**å…·ä½“æ–¹æ¡ˆï¼š** è®¾$p$æ˜¯ä¸€ä¸ªä½¿å¾—åœ¨$Z_p$ä¸Šçš„ç¦»æ•£å¯¹æ•°é—®é¢˜æ˜¯éš¾å¤„ç†çš„ç´ æ•°ï¼Œè®¾$\alpha\in Z_p^*$æ˜¯ä¸€ä¸ªæœ¬åŸå…ƒ(ç”Ÿæˆå…ƒ)ã€‚è®¾$\mathcal P = Z_p, \mathcal A = Z_P^*\times Z_{p-1}$ï¼Œå®šä¹‰$$\mathcal K = \{(p,\alpha, a, \beta):\beta \equiv \alpha^a\ (mod\ p)\}$$ å…¶ä¸­$p,\alpha,\beta$æ˜¯å…¬é’¥ï¼Œ$a$æ˜¯ç§é’¥ã€‚

å¯¹äº$K=(p,\alpha, a, \beta) \in \mathcal K$å’Œä¸€ä¸ª(ç§˜å¯†)éšæœºæ•°$k\in Z_{p-1}^*$ï¼Œåˆ™ï¼š$$sig_K(x,k)=(\gamma,\delta)$$ å…¶ä¸­ $$\gamma = \alpha^k\ mod\ p \newline \delta = (x-a\gamma)k^{-1}\ mod\ (p-1)$$ å¯¹äº$x,\gamma\in Z_p^*$å’Œ$\delta\in Z_{p-1}$ï¼Œæœ‰ $$ver_K(x,(\gamma,\delta)) = true \newline \Leftrightarrow \beta^{\gamma}\gamma^{\delta}\equiv \alpha^{x}\ (mod\ p)$$

### å¸¸è§Elgamalæ”»å‡»
#### 1.å®Œå…¨ç ´è¯‘æ”»å‡»
* $p$å¤ªå°æˆ–$p$æ— å¤§ç´ å› å­
æ­¤æ—¶çš„æ”»å‡»æ–¹æ³•äºElgamalåŠ å¯†æ–¹æ¡ˆçš„ç ´è§£æ–¹æ³•ä¸€è‡´ï¼Œå³ä½¿ç”¨å¤§æ­¥å°æ­¥æ³•æˆ–è€…Pohlig-Hellmanç®—æ³•ã€‚

* éšæœºæ•°$k$å¤ç”¨
å¦‚æœç­¾åè€…å¤ç”¨äº†éšæœºæ•° kï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥è½»è€Œæ˜“ä¸¾åœ°è®¡ç®—å‡ºç§é’¥ã€‚

å®¹æ˜“å¾—$$\gamma = \alpha^k\ mod\ p \newline \delta_1 = (m_1-a\gamma)k^{-1}\ mod\ (p-1) \newline \delta_2 = (m_2-a\gamma)k^{-1}\ mod\ (p-1)$$ è¿›è€Œæœ‰ $$\delta_1k \equiv m_1 - a\gamma\ mod\ (p-1) \newline \delta_2k \equiv m_2 - a\gamma\ mod\ (p-1)$$ ä¸¤å¼ç›¸å‡å¾— $$k(\delta_1-\delta_2)\equiv m_1-m_2\ mod\ (p-1)$$ å®¹æ˜“è®¡ç®—å‡ºéšæœºæ•°$k$ï¼Œå¦‚æœ$gcd(\delta_1-\delta_2, p-1) \neq 1$ï¼Œå­˜åœ¨å¤šä¸ªè§£ï¼Œé€ä¸ªå»è¯•å³å¯ã€‚å› æ­¤æœ‰ç§é’¥$$a = (m-k\delta)\gamma^{-1}\ mod\ (p-1)$$

#### 2. é€šç”¨ä¼ªé€ ç­¾å
å¦‚æœæ¶ˆæ¯$x$æ²¡æœ‰å–å“ˆå¸Œï¼Œæˆ–è€…æ¶ˆæ¯$x$æ²¡æœ‰æŒ‡å®šæ¶ˆæ¯æ ¼å¼çš„æƒ…å†µä¸‹æ”»å‡»æˆç«‹ã€‚æ”»å‡»è€…åªèƒ½æ„é€ åŒæ„ç­¾åéªŒè¯çš„ä¿¡æ¯ï¼Œä½†æ— æ³•ä¼ªé€ æŒ‡å®šæ ¼å¼çš„æ¶ˆæ¯ã€‚å½“æ¶ˆæ¯$x$è¿›è¡Œhashæ“ä½œå¯é¿å…æ­¤æ”»å‡»ã€‚

**æ”»å‡»æµç¨‹ï¼š**
1. é€‰æ‹©æ•´æ•°$i,j$æ»¡è¶³$gcd(j,p-1)=1$ã€‚
2. è®¡ç®—ç­¾åï¼š$$\gamma = \alpha^i \beta^j\ mod\ p \newline \delta = -\gamma j^{-1}\ mod\ (p-1)$$
3. æ„é€ æ¶ˆæ¯ï¼š$$x=-\gamma ij^{-1}\ mod\ (p-1)$$

éªŒè¯ï¼š$$\beta^{\gamma}\gamma^{\delta} \equiv \alpha^{i\delta}\beta^{\gamma+j\delta} \equiv \alpha^{i\delta}\beta^{\gamma-j\gamma j^{-1}} \equiv \alpha^{-ij^{-1}\gamma} \equiv \alpha^x\ mod\ p$$

#### 3. å·²çŸ¥ç­¾åä¼ªé€ 
* æ”»å‡»è€…å·²çŸ¥$\gamma,\delta$ä»¥åŠæ¶ˆæ¯$x$ã€‚ï¼ˆå·²çŸ¥æ¶ˆæ¯æ”»å‡»çš„å­˜åœ¨æ€§ä¼ªé€ ï¼‰åŒæ ·å¯ä»¥å¯¹æ¶ˆæ¯$x$è¿›è¡Œhashæ“ä½œé¿å…æ­¤æ”»å‡»ã€‚

**æ”»å‡»æµç¨‹ï¼š**
1. é€‰æ‹©æ•´æ•°$h,i,j, 0\leq h,i,j \leq p-2$ï¼Œä¸”$gcd(h\gamma-j\delta, p-1)=1$ã€‚
2. è®¡ç®—ç­¾åï¼š$$\lambda = \gamma^h\alpha^i\beta^j\ mod\ p \newline \mu=\delta\lambda(h\gamma-j\delta)^{-1}\ mod\ (p-1)$$
3. æ„é€ æ–°æ¶ˆæ¯ï¼š$$x'=\lambda(hx+i\delta)(h\gamma-j\delta)^{-1}\ mod\ (p-1)$$

éªŒè¯ï¼š $$\beta^{\lambda}\lambda^{\mu}\equiv\alpha^{x'}\ mod\ p$$

#### 4. é€‰æ‹©ç­¾åä¼ªé€ 
* å¦‚æœå¯ä»¥åšåˆ°é€‰æ‹©æ¶ˆæ¯æ”»å‡»ï¼Œå³é€‰æ‹©æ¶ˆæ¯$m_1,m_2,...$è¿›è¡Œç­¾åã€‚ç„¶åå¯¹ä¸€ä¸ªæ¶ˆæ¯$m'$ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä½¿ç”¨é»‘ç›’çš„å‰æä¸‹æ„é€ å‡º$m'$çš„ç­¾åã€‚

**æ”»å‡»æ€æƒ³ï¼š** å› ä¸ºè¦éªŒè¯$$\beta^{\gamma}\gamma^{\delta}\equiv \alpha^{x}\ (mod\ p)$$ åªè¦é€‰æ‹©ä¸€ä¸ªæ¶ˆæ¯$m$æ»¡è¶³$m\equiv m'\ mod\ (p-1)$ï¼Œé€‰æ‹©$m$çš„ç­¾å$\gamma_m,\delta_m$ï¼Œåˆ™æœ‰$$\alpha^{m'} \equiv \alpha^m \equiv \beta^{\gamma_m}\gamma_m^{\delta_m} $$

## DSA / DSS
DSA æœ€æ—©åœ¨1991å¹´8æœˆè¢«æå‡ºï¼Œ1994å¹´12æœˆ1æ—¥è¢«é‡‡çº³æ•°å­—ç­¾åæ ‡å‡†ã€‚DSAæ˜¯ElGamalç­¾åæ–¹æ¡ˆçš„ä¸€ä¸ªå˜ç§ã€‚è¿™ä¸ªç­¾åæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºDSSç­¾å

**å…·ä½“æ–¹æ¡ˆï¼š** é€‰æ‹©ä¸€ä¸ªé•¿åº¦ä¸º$L$æ¯”ç‰¹çš„ç´ æ•°$p$ï¼Œåœ¨$Z_p$ä¸Šçš„ç¦»æ•£å¯¹æ•°é—®é¢˜æ˜¯éš¾å¤„ç†çš„ï¼Œå…¶ä¸­$L \equiv 0\ mod\ 64$ä¸”$512 \leq L \leq 1024$(å¯ä»¥æ›´å¤§)ã€‚é€‰æ‹©$q$æ˜¯ä¸€ä¸ª$N$æ¯”ç‰¹çš„ç´ æ•°ï¼Œè€Œä¸”æ»¡è¶³$q|p-1$ã€‚è®¾$\alpha\in Z_p^*$æ˜¯1æ¨¡$p$çš„$q$æ¬¡æ ¹ï¼Œå³$\alpha^q \equiv 1\ mod\ p$ã€‚è®¾$\mathcal P = \{0,1\}^*,\mathcal A=Z_q^*\times Z_q^*$ï¼Œå¹¶å®šä¹‰$$\mathcal K=\{(p,q,\alpha,a,\beta):\beta \equiv \alpha^a(mod\ p)\}$$ å…¶ä¸­$0\leq a \leq q-1$ã€‚$p,q,\alpha,\beta$æ˜¯å…¬é’¥ï¼Œ$a$ä¸ºç§é’¥ã€‚å¯¹äº$K=(p,q,a,\alpha, \beta) \in \mathcal K$å’Œä¸€ä¸ªç§˜å¯†éšæœºæ•°$k, 1\leq K\leq q-1$ï¼Œé€‰æ‹©ä¸€ä¸ªå“ˆå¸Œå‡½æ•°$H(x)$ï¼Œåˆ™æœ‰
$$sig_K(x,k)=(\gamma, \delta)$$ å…¶ä¸­$$\gamma = (\alpha^k\ mod\ p)\ mod\ q 
\newline
\delta = (H(x) + a\gamma)k^{-1}\ mod\ q$$
ä¸”æœ‰$\gamma \neq 0$ä¸”$\delta \neq 0$ã€‚ 
å¯¹äº$x\in\{0,1\}^*$å’Œ$\gamma, \delta \in Z_q^*$ï¼Œè®¡ç®—å‡ºï¼š 
$$e_1 = H(x)\delta^{-1}\ mod\ q
\newline
e_2 = \gamma \delta^{-1}\ mod\ q$$ éªŒè¯ï¼š$$ver_K(x,(\gamma, \delta)) = true  \Leftrightarrow \newline (\alpha^{e_1}\beta^{e_2}\ mod\ p)\ mod\ q = \gamma$$

### å¸¸è§DSAæ”»å‡»
#### 1. å·²çŸ¥éšæœºæ•°$k$
æ ¹æ®$\delta = (SHA-1(x) + a\gamma)k^{-1}\ mod\ q$ï¼Œæœ‰ç§é’¥$a = \gamma^{-1}(k\delta - H(x))\ mod\ q$

#### 2. éšæœºæ•°$k$å¤ç”¨
å¦‚æœä¸¤æ¬¡ç­¾åçš„è¿‡ç¨‹ä¸­å…±äº«äº†éšæœºæ•°$k$ï¼Œåˆ™æœ‰ï¼š
$$
\gamma_1 = \gamma_2 = \gamma
\newline
\delta_1 = (H(x_1) + a\gamma)k^{-1}\ mod\ q
\newline
\delta_2 = (H(x_2) + a\gamma)k^{-1}\ mod\ q
$$ å› æ­¤æœ‰ $$
\delta_1 k \equiv H(x_1) + a\gamma
\newline
\delta_2 k \equiv H(x_2) + a\gamma
$$ ä¸¤å¼ç›¸å‡å¾— $$
k(\delta_1 - \delta_2) \equiv H(x_1)-H(x_2)\ mod\ q$$  ä»è€Œè§£å‡ºéšæœºæ•°$k$ã€‚ç„¶åä½¿ç”¨ç¬¬ä¸€ä¸ªæ”»å‡»æ–¹æ³•æ¢å¤å‡ºç§é’¥$a$ã€‚

#### 3. DSA/DSS with LCG Pseudo-Random 
**æ”»å‡»æ¡ä»¶**ï¼šå¦‚æœDSAç­¾åä¸­çš„éšæœºæ•°$k$ä½¿ç”¨çš„æ˜¯çº¿æ€§åŒä½™ç”Ÿæˆå™¨æ‰€ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆå‚è€ƒ1997å¹´çš„ä¸€ç¯‡æ–‡ç« ï¼ˆè§å‚è€ƒæ–‡çŒ®ï¼‰ï¼Œç”¨æ ¼çš„æ–¹å¼å¯ä»¥æ±‚è§£ã€‚ 
1. DSAç­¾å
2. çº¿æ€§åŒä½™ç”Ÿæˆå™¨ç”Ÿæˆéšæœºæ•°$k$
3. è‡³å°‘ç»™å‡º2å¯¹æ˜æ–‡å’Œç­¾åå¯¹


é¦–å…ˆä¼šé‡åˆ°$$\begin{cases} s_1k_1-r_1x = m_1\ (mod\ q) \\ s_2k_2-r_2x=m_2\ (mod\ q) \\ -ak_1+k_2 = b\ (mod\ M) \end{cases}$$ çš„æƒ…å†µï¼Œç„¶åæˆ‘ä»¬æ„é€ ä¸‹é¢çš„æ ¼è¿›è¡Œæ±‚è§£ 
$$\left[\begin{matrix} -r_1 & s_1 & 0 & q & 0 & 0 \\ -r_2 & 0 & s_2 & 0 & q & 0 \\ 0 & -a & 1 & 0 & 0 & M \\ \gamma_x^{-1} & 0 & 0 & 0 & 0 & 0 \\ 0 & \gamma_{k_1}^{-1} & 0 & 0 & 0 & 0 \\ 0 & 0 & \gamma_{k_2}^{-1}  & 0 & 0 & 0  \end{matrix}\right]$$ 
æœ‰æ—¶å€™è¯¥LCGä¼šæœ‰ä¸åŒçš„æƒ…å†µï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µå»æ„é€ æ ¼


å‚è€ƒæ–‡çŒ®ï¼š
- [1] Bellare M ,  Goldwasser S ,  Micciancio D . pseudo-random number generation within cryptographic algorithms: the dss case[J].  2017.
- [2] "Pseudo-Random" Generators within cryptographic applications: the DSS case[J]. advances in cryptologyâ€”crypto â€™, 1997.

å‚è€ƒé¢˜ç›®ï¼š VNCTF 2022 AreYouAdmin




## ECDSA æ¤­åœ†æ›²çº¿æ•°å­—ç­¾åç®—æ³•
ECDSAç®—æ³•æœ‰ä¸¤ç§å½¢å¼ï¼Œç¬¬ä¸€ç§æ˜¯ç±»ä¼¼äºDSAç®—æ³•çš„ï¼Œç¬¬äºŒç§æ˜¯ç±»ä¼¼äºElgammaç­¾åæ–¹æ¡ˆçš„ï¼Œæœ¬è´¨ä¸Šåªæ˜¯æŠŠå…¶ä¸­çš„ç¦»æ•£å¯¹æ•°é—®é¢˜æ¢æˆECDLPã€‚

å‚è€ƒèµ„æ–™ï¼š
- https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm#Signature_generation_algorithm


## Boneh-Boyen Scheme ç­¾åç®—æ³•
ä¸»è¦ç®—æ³•è§
![Boneh-Boyen_signature](crypto/image/Boneh-Boyen_signature.PNG)
ç­¾åç®—æ³•ä¸»è¦åŸºäºq-SDH é—®é¢˜ï¼Œè¯¥é—®é¢˜ä¸»è¦è§ç¬¬2ã€3ç¯‡å‚è€ƒèµ„æ–™ã€‚

å‚è€ƒèµ„æ–™ä¸­æœ‰è¯¥ç­¾åç®—æ³•çš„ä¸€ä¸ªæ”»å‡»

å‚è€ƒèµ„æ–™ï¼š
- Yoshida K . Boneh-Boyen signatures and the strong Diffie-Hellman problem. [J]. 2009. 
- Dan Boneh and Xavier Boyen. Short signatures without random oracles. In Advances in Cryptologyâ€”EUROCRYPT 2004, volume 3027 of Lecture Notes in Computer Science, pages 56â€“73. Springer, 2004.
- Dan Boneh and Xavier Boyen. Short signatures without random oracles and the SDH assumption in bilinear groups. Journal of Cryptology, 21(2):149â€“177, 2008.






# å¸¸è§æ•°è®ºæ±‚è§£
## 1. äºŒæ¬¡å‰©ä½™æ±‚è§£
å·²çŸ¥
$$
x^2\equiv a\ (mod\ p)
$$
æ±‚$x$.

### 1.1 $p$æ˜¯å½¢ä¸º$4k+3$çš„ç´ æ•°
1. è‹¥ $x^2\equiv a\ (mod\ p)$ æœ‰è§£åˆ™å…¶è§£ä¸º
$$
x\equiv\pm a^{\frac{p+1}{4}}(mod\ p)
$$
2. è‹¥ $x^2\equiv a\ (mod\ pq)$ æœ‰è§£,$p,q$æ˜¯å½¢ä¸º$4k+3$çš„ç´ æ•°,åˆ™å…¶è§£ä¸º
$$
x\equiv\pm (a^{\frac{p+1}{4}}(mod\ p))\cdot s\cdot q\pm(a^{\frac{q+1}{4}}(mod\ q))\cdot t\cdot p\ \ (mod\ pq)
$$
### 1.2 $p$æ˜¯ä¸€èˆ¬çš„å¥‡ç´ æ•°
ä»£ç è§`crypto/code/square_root_of_quadratic_residue.py`
å‚è€ƒèµ„æ–™ï¼šhttps://learnblockchain.cn/article/1520

### $x^2+y^2=p$
> å¾…å®Œæˆ

### 1.3 å…‰æ»‘æ•°
å…‰æ»‘æ•°çš„å®šä¹‰ï¼šBä¸ºä¸€ä¸ªæ­£æ•´æ•°ï¼Œå¦‚æœä¸€ä¸ªè‡ªç„¶æ•°Nçš„å› å­åˆ†è§£å¼ä¸­æ²¡æœ‰å¤§äºBçš„å› å­ï¼Œæˆ‘ä»¬å°±ç§°Næ˜¯ä¸€ä¸ªBå…‰æ»‘æ•°ã€‚

## 2. è¿‘ä¼¼æœ€å¤§å…¬çº¦æ•°(Approximate Greatest Common Divisor)
ç»™å®šä¸¤ä¸ªæ•´æ•°$n_1 = q_1p$ï¼Œ$n_2 = q_2p$ï¼Œåˆ™ä¸¤è€…çš„æœ€å¤§å…¬çº¦æ•°ä¸º$p = gcd(n_1,n_2)$ã€‚

è‹¥$n_1 = q_1p+r_1$ï¼Œ$n_2 = q_2p+r_2$ï¼Œåˆ™æ±‚$n_1$ä¸$n_2$çš„è¿‘ä¼¼æœ€å¤§å…¬çº¦æ•°$p$æ˜¯æœ‰ä¸€å®šéš¾åº¦çš„ã€‚åœ¨æ™®éæƒ…å†µä¸‹æ˜¯ä¸€ä¸ªå›°éš¾é—®é¢˜ï¼Œä½†æ˜¯å½“$r_i$æ¯”è¾ƒå°çš„æ—¶å€™æ˜¯å¯ä»¥ç”¨è¿‡LLLç­‰ç®—æ³•è¿›è¡Œæ±‚è§£ã€‚

**å‚è€ƒä¾‹é¢˜ï¼š2021å¹´RCTFâ€”â€” Crypto â€”â€” Uncommon_Factors_II**
writeupè§`crypto\2021_RCTF\2021_RCTF_Uncommon_Factors_II`

å‚è€ƒèµ„æ–™ï¼š
* https://martinralbrecht.wordpress.com/2020/03/21/the-approximate-gcd-problem/
* https://eprint.iacr.org/2016/215.pdf

å¸¸ç”¨æ±‚è§£æ–¹æ³•ï¼ˆä¸åŒçš„æ–¹æ³•å¯¹åº”ç€ä¸€å®šçš„çº¦æŸæ¡ä»¶ï¼Œä¸æ»¡è¶³æ¡ä»¶åˆ™æ— æ³•å®Œæˆï¼‰ï¼š
* Simultaneous Diophantine approximation approach (SDA)
* Orthogonal based approach (OL)
* Multivariate polynomial approach (MP)

## 3. è§£ä¸€å…ƒå¤šæ¬¡æ–¹ç¨‹ç»„
### 3.1 æ•´æ•°å¼€næ¬¡æ–¹æ ¹
ä½¿ç”¨`python`ä¸­çš„`gmpy2.iroot(num, n)`å‡½æ•°ã€‚

### 3.2 æœ‰é™åŸŸä¸­ä¸€å…ƒå¤šæ¬¡æ–¹ç¨‹ç»„
```python
# Sagemath 9.2
P.<x> = GF(p)[]
f = x^2 + ax + b
f.roots()
```

## 4. é«˜æ–¯æ•´æ•°ç›¸å…³
> è¿™é‡Œä¸»è¦ä½¿ç”¨åˆ°çš„æ˜¯å¯¹ç´ æ•°è¿›è¡Œåˆ†è§£ï¼Œå’Œæ„é€ $a^2+b^2=n$

* å‚è€ƒèµ„æ–™ï¼šhttps://blog.csdn.net/weixin_45697774/article/details/113444562

### 4.0 åŸºç¡€çŸ¥è¯†
å½¢å¦‚ $a + bi$ï¼ˆå…¶ä¸­$a , b$æ˜¯æ•´æ•°ï¼‰çš„å¤æ•°è¢«ç§°ä¸ºé«˜æ–¯æ•´æ•°ï¼Œé«˜æ–¯æ•´æ•°å…¨ä½“è®°ä½œé›†åˆ $ Z[i] = \{ a + bi | a,b \in Z\}, \ where \ i^2 = -1$ï¼Œæ¢è¨€ä¹‹ï¼Œé«˜æ–¯æ•´æ•°æ˜¯å®éƒ¨å’Œè™šéƒ¨éƒ½ä¸ºæ•´æ•°çš„å¤æ•°ã€‚ç”±äºé«˜æ–¯æ•´æ•°åœ¨ä¹˜æ³•å’ŒåŠ æ³•ä¸‹äº¤æ¢ï¼Œå®ƒä»¬å½¢æˆäº†ä¸€ä¸ª**äº¤æ¢ç¯**ã€‚

**å®šä¹‰1**ï¼š è‹¥ $\epsilon\ | \ 1$ï¼Œåˆ™ç§°é«˜æ–¯æ•´æ•° $\epsilon$ æ˜¯ **å•ä½** ï¼Œè‹¥ $\epsilon$ æ˜¯å•ä½ï¼Œåˆ™ç§° $\epsilon\alpha$ æ˜¯é«˜æ–¯æ•´æ•° $\alpha$ çš„ä¸€ä¸ª**ç›¸ä¼´**ï¼Œé«˜æ–¯æ•´æ•°çš„å•ä½ä¸º $1,-1,i,-i$ã€‚

**å®šä¹‰2**ï¼š è‹¥éé›¶é«˜æ–¯æ•´æ•° $\pi$ ä¸æ˜¯å•ä½ï¼Œè€Œä¸”åªèƒ½å¤Ÿè¢«å•ä½å’Œå®ƒçš„ç›¸ä¼´æ•´é™¤ï¼Œåˆ™ç§°ä¹‹ä¸ºé«˜æ–¯ç´ æ•°ã€‚

**æ€§è´¨ï¼š**
* é«˜æ–¯æ•´ç¯æ˜¯ä¸€ä¸ªå”¯ä¸€åˆ†è§£åŸŸï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªé«˜æ–¯æ•´æ•°éƒ½å¯ä»¥å†™ä¸ºä¸€ä¸ªå•ä½å…ƒå’Œè‹¥å¹²é«˜æ–¯ç´ æ•°çš„ä¹˜ç§¯ï¼Œè¿™ç§åˆ†è§£æ˜¯å”¯ä¸€çš„ï¼ˆå¿½ç•¥å…±è½­å’Œç›¸ä¼´ï¼‰
* ä¸¤ä¸ªé«˜æ–¯æ•´æ•°çš„æœ€å¤§å…¬çº¦æ•°å¹¶ä¸å”¯ä¸€ï¼Œè‹¥$d$ æ˜¯ $a$ ä¸ $b$ çš„æœ€å¤§å…¬çº¦æ•°ï¼Œåˆ™ $a,b$ çš„æœ€å¤§å…¬çº¦æ•°ä¸º $d,âˆ’d,id,âˆ’id$ã€‚
* è‹¥$p$æ˜¯ä¸€ä¸ªç´ æ•°ï¼Œåˆ™$p$å¯ä»¥å†™æˆä¸¤ä¸ªå¹³æ–¹æ•°çš„å’Œï¼Œå½“ä¸”ä»…å½“$p=2$æˆ–$p\equiv 1(\ mod\ 4)$ã€‚
    * è¯æ˜ï¼š![](crypto/images/Fermat_sum_of_two_squares_theorem.PNG)


### 4.1 åˆ†è§£$4k+1$å‹ç´ æ•°
å·²çŸ¥$p$æ˜¯$4k+1$å‹ç´ æ•°ï¼Œå¦‚æœ$k^2\equiv -1\ (mod\ p)$ï¼Œåˆ™æœ‰$p|(k+i)(k-i)$ï¼Œå› æ­¤$p=u\bar{u}$ï¼Œå…¶ä¸­$u=k+i$ã€‚

å› æ­¤å› ä¸ºæœ‰ä¸€åŠçš„æ•°åœ¨æ¨¡$p$ä¸‹æ˜¯å¹³æ–¹å‰©ä½™ï¼Œå› æ­¤çƒ§å‡ºä¸€ä¸ªæ•°$t$ï¼ŒéªŒè¯$t^{\frac{p-1}{2}}\equiv -1(mod\ p)$ï¼Œåˆ™æœ‰$k=t^{\frac{p-1}{2}}$ã€‚

* è™½ç„¶è¿™é‡Œè®²äº†è¿™ä¹ˆå¤šï¼ŒSagemathé‡Œé¢æœ‰å‡½æ•°å¯ä»¥åˆ†è§£ï¼š
```python
# Sagemath 9.2
K = ZZ[i]   # å£°æ˜é«˜æ–¯æ•´æ•°ç¯
factor(K(97))
# (-4*I + 9) * (4*I + 9)
```

### 4.2 æ„é€ $a^2+b^2=n$
**é—®é¢˜ï¼š** å·²çŸ¥$n$ï¼Œéœ€è¦æ„é€ å‡º$a,b$æ»¡è¶³$a^2+b^2=n$ã€‚

* æµç¨‹ï¼š
    1. å°†$n$åˆ†è§£æˆ$n=\prod p_m^{e_m}$
    2. å°†2åˆ†è§£æˆ$(1+i)(1-i)$ï¼Œå°†$4k+1$å‹ç´ æ•°åˆ†è§£ä¸º$u\bar{u}$ï¼Œä¿ç•™$4k+3$å‹ç´ æ•°ã€‚
    3. å°†ç¬¬2æ­¥çš„ç»“æœåˆ†æˆä¸¤ç»„ï¼Œ$(1+i)$åˆ†å»1ç»„ï¼Œ$(1-i)$åˆ†å»2ç»„ï¼›å°†$u$åˆ†å»1ç»„ï¼Œ$\bar{u}$åˆ†åŒº2ç»„ï¼›$4k+3$å‹ç´ æ•°ä¸€å®šæ˜¯æˆå¯¹å‡ºç°çš„ï¼Œå³$2|e_m$ï¼Œå› æ­¤æ¯ç»„åˆ†åˆ°$\frac{e_m}{2}$ä¸ªã€‚
    4. ä»»æ„é€‰ä¸€ç»„ï¼ŒæŠŠæ”¹ç»„æ‰€æœ‰çš„æ•°ä¹˜èµ·æ¥å¾—åˆ°$A+Bi$ï¼Œåˆ™$a=A, b=B$ï¼Œå³æ»¡è¶³$a^2+b^2=n$æˆ–è€…è¯´$A^2+B^2=n$ã€‚

* Sagemathé‡Œé¢å¯ä»¥è½»æ¾å¯¹$n$è¿›è¡Œåˆ†è§£
```python
K = ZZ[i]   # å£°æ˜é«˜æ–¯æ•´æ•°ç¯
factor(K(19*19*97))
# (-4*I + 9) * (4*I + 9) * 19^2

guass_integer = (4*I + 9) * 19
a = abs(guass_integer.imag())
b = abs(guass_integer.real())
a^2+b^2 == 19*19*97
# 35017 == 35017
```

### 4.3 æ„é€ $a^2+b^2=n^k$
æ ¹æ®å…±è½­çš„æ€§è´¨ï¼Œé¦–å…ˆç±»ä¼¼4.2èŠ‚ä¸­å…ˆåˆ†è§£$n$ã€‚å¾—åˆ°$A+Bi$ï¼Œç„¶åè®¡ç®—$$(A+Bi)^k = A'+B'i$$ åˆ™æœ‰$A'^2+B'^2=n^k$ã€‚


### 4.4 æ‹‰æ ¼æœ—æ—¥å››å¹³æ–¹å®šç†

**å®šç†å†…å®¹ï¼š** æ¯ä¸ªæ­£æ•´æ•°å‡å¯è¡¨ç¤ºæˆä¸è¶…è¿‡å››ä¸ªæ•´æ•°çš„å¹³æ–¹ä¹‹å’Œ.


### 4.5 æ¨¡$p$ä¸‹çš„å¤æ•°ä¹˜æ³•ç¾¤

å…³é”®åœ¨äºè¦æ³¨æ„ä¹˜æ³•ç¾¤çš„å½¢å¼ï¼Œå¯¹äºä¹˜æ³•ç¾¤ä¸­çš„å…ƒç´ $a = x_1+y_1i$ï¼Œ$b = x_2 + y_2i$ï¼Œæœ‰$$c = a\cdot b =x_3+y_3i\\ x_3 = x_1x_2-y_1y_2 \\ y_3 = x_1y_2+x_2y_1$$ å…¶ä¸­å¯¹äºæ¨¡$p$ä¸‹çš„å¤æ•°ä¹˜æ³•ç¾¤å…¶é˜¶ä¸º$p^2-1$ï¼Œè¯æ˜è§ï¼š https://zhuanlan.zhihu.com/p/436496753 è¯„è®ºåŒºä¸­è¯´ä¹Ÿå¯ä»¥ä½¿ç”¨**é™ªé›†å®šç†**è¿›è¡Œè¯æ˜ã€‚

å¦‚æœç»™å‡ºå¤æ•°ä¹˜æ³•ç¾¤çš„å…ƒç´ $1+i$ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç»“æ„ï¼Œä»¥å®ƒä¸ºåŸºç”Ÿæˆçš„å…ƒç´ å¯ä»¥å’Œä¸€ä¸ªé˜¶ä¸º$4(p-1)$çš„æ•´æ•°ä¹˜æ³•ç¾¤åŒæ„(ä¸è¿‡è‡³äºé‚£ä¸ªæ•´æ•°ä¹˜æ³•ç¾¤é•¿ä»€ä¹ˆæ ·å­è¿˜ä¸æ¸…æ¥šemmmmmm)ã€‚

å¦ä¸€ç§æ–¹æ³•åŒæ ·è§ä¸Šé¢çš„é“¾æ¥ï¼Œå°±æ˜¯å¯¹ç¾¤ä¸­çš„å…ƒç´ å–æ¨¡é•¿ï¼Œç„¶åæ¨¡$p$ã€‚è¿™ç§æƒ…å†µä¸‹å°±ç›¸å½“äº$|x^2+y^2|\ mod\ p$ï¼Œå³æ§åˆ¶äº†è§’åº¦ï¼Œä¹Ÿæ§åˆ¶äº†é•¿åº¦ï¼Œå› æ­¤åŒæ ·ä¼šåŒæ„äºä¸€ä¸ªæ¨¡$p$çš„ä¹˜æ³•ç¾¤ã€‚ï¼ˆæœªç»™å‡ºä¸¥æ ¼çš„è¯æ˜ï¼Œä½†æ˜¯è¿è¡Œç¨‹åºç¡®å®å¦‚æ­¤ï¼‰

å› æ­¤å¦‚æœè¦æ±‚ä»¥$1+i$ä¸ºç”Ÿæˆå…ƒç”Ÿæˆçš„å¤æ•°ç¾¤ä¸­çš„ç¦»æ•£å¯¹æ•°ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆå¯¹å¤æ•°å…ƒç´ æ±‚æ¨¡ï¼Œç„¶åæ±‚æ¨¡$p$ä¸‹çš„ç¦»æ•£å¯¹æ•°ï¼Œæ­¤ç¦»æ•£å¯¹æ•°å°±æ˜¯æˆ‘ä»¬è¦æ±‚çš„ã€‚






## 5. æ±‚ç¯ä¸Šå›ºå®šé˜¶çš„ç”Ÿæˆå…ƒ
**æœ¬åŸå¤šé¡¹å¼**ï¼šä¸€ä¸ªæ¬¡æ•°ä¸º$n$çš„$F_q$ä¸Šçš„æœ¬åŸå¤šé¡¹å¼ï¼Œå°±æ˜¯å®ƒåœ¨åŸŸ$F_q^n$ä¸Šçš„æ‰€æœ‰æ ¹éƒ½æ˜¯æœ¬åŸå…ƒï¼ˆ**æœ¬åŸå…ƒ**èƒ½ç”ŸæˆåŸŸ$F_q^n$ä¸Šçš„æ‰€æœ‰å…ƒç´ ï¼Œç›¸å½“äºä¹˜æ³•çš„ç”Ÿæˆå…ƒï¼‰ã€‚
* æ‰€æœ‰åœ¨$F_q$ä¸Šçš„æœ¬åŸå¤šé¡¹å¼åœ¨$F_q$ä¸Šæ˜¯ä¸å¯çº¦çš„ï¼ˆä¸å¯åˆ†è§£ï¼‰ã€‚

### 5.1 æ±‚ç¯ä¸Šçš„ç”Ÿæˆå…ƒ
æ±‚ç¯$R$ä¸Šçš„ç”Ÿæˆå…ƒã€‚å·²çŸ¥ç¯çš„é˜¶(å…ƒç´ ä¸ªæ•°)ä¸º$n$ã€‚åˆ™æ‰¾ç”Ÿæˆå…ƒçš„è¿‡ç¨‹ä¸ºï¼šä»»å–$R$ä¸­çš„å…ƒç´ $g\in R$ï¼Œè‹¥æœ‰$g^{\frac{n}{2}}\neq -1\in R$ï¼Œåˆ™$g$ä¸ºç”Ÿæˆå…ƒã€‚è¿™ç§æ–¹å¼é€‚ç”¨äº$2|n$çš„æƒ…å†µã€‚

### 5.2 æ±‚ç¯ä¸Šå›ºå®šé˜¶çš„å…ƒç´ 
å‡è®¾éœ€è¦æ‰¾çš„å…ƒç´ çš„é˜¶ä¸º$q$ï¼Œç¯$R$çš„é˜¶ä¸º$n$ï¼Œç”±ç¯çš„æ€§è´¨å¯çŸ¥$q|n$ã€‚
1. é¦–å…ˆæ‰¾å‡ºç¯$R$çš„ä¸€ä¸ªç”Ÿæˆå…ƒï¼ˆå¯¹äºåŸŸæ¥è¯´å°±æ˜¯æ‰¾å‡ºæœ¬åŸå…ƒï¼‰$g$ã€‚
2. è®¡ç®—$a = g^{\frac{n}{q}}$ï¼Œåˆ™$a$ä¸ºç¯$R$çš„ä¸€ä¸ª$q$é˜¶å…ƒç´ ã€‚


## 6. Chinese remainder theorem(CRT) ä¸­å›½å‰©ä½™å®šç†

åŸç†è§https://en.wikipedia.org/wiki/Chinese_remainder_theorem

é‡åˆ°æ¨¡æ•°ä¸æ˜¯ç´ æ•°çš„æƒ…å†µä¸‹ï¼Œç”¨CTRåˆ†è§£ä¸€ä¸‹ï¼Œå¯èƒ½æœ‰å¥‡æ•ˆã€‚

```python
# pythonå®ç°
from functools import reduce

def egcd(a, b):
    if 0 == b:
        return 1, 0, a
    x, y, q = egcd(b, a % b)
    x, y = y, (x - a // b * y)
    return x, y, q

def chinese_remainder(pairs):
    mod_list, remainder_list = [p[0] for p in pairs], [p[1] for p in pairs]
    mod_product = reduce(lambda x, y: x * y, mod_list)
    mi_list = [mod_product//x for x in mod_list]
    mi_inverse = [egcd(mi_list[i], mod_list[i])[0] for i in range(len(mi_list))]
    x = 0
    for i in range(len(remainder_list)):
        x += mi_list[i] * mi_inverse[i] * remainder_list[i]
        x %= mod_product
    return x

print(chinese_remainder([(3,2),(5,3),(7,4),(11,5)]))
# 368
```

åœ¨Sagemathä¸­æœ‰å‡½æ•°`CRT`å’Œ`CRT_list`

## 7. å¹¿ä¹‰Fibonacciï¼ˆæ–æ³¢æ‹‰å¥‘ï¼‰æ•°åˆ—
* æ­£å¸¸çš„Fibonacciæ•°åˆ—ï¼š$F_n = F_{n-1} + F_{n-2} (n\geq 2)$
* å¹¿ä¹‰Fibonacciæ•°åˆ—ï¼š$F_n = pF_{n-1} + qF_{n-2} (n\geq 2)$
    * å¿«é€Ÿè®¡ç®—çš„è¡¨è¾¾å¼ä¸º $$ [f[n]\ f[n-1]] = [f[2]\ f[1]]
    \left[
    \begin{matrix}
    p & 1\\
    q & 0
    \end{matrix}
    \right]^{n-2}$$
    * å½“$p = 1, q = 1$æ—¶å˜ä¸ºæ­£å¸¸çš„Fibonacciæ•°åˆ—

* ä»ä¸å®šæ–¹ç¨‹å¯ä»¥è½¬æ¢æˆå¹¿ä¹‰Fibonaciiæ•°åˆ—çš„å½¢å¼
    * å‚è€ƒï¼šæ¨è‰¾æ¬£,æ²ˆæºé’¦.ä¸€ç±»ä¸å®šæ–¹ç¨‹çš„éè´Ÿæ•´æ•°è§£[J].éŸ©å±±å¸ˆèŒƒå­¦é™¢å­¦æŠ¥,2013,34(03):19-22.
    * $x^2+kxy-y^2+1 = 0$ æ„æˆçš„$k~1$å‹å¹¿ä¹‰Fibonaciiæ•°åˆ—ã€‚è§£ä¸º$p = k, q = 1$ã€‚
    * $x^2-kxy+y^2-1 = 0$ çš„è§£ä¸º$p = k, q = -1$ã€‚
    ä¸€èˆ¬é‡åˆ°è¿™ç§ä¸æ‡‚çš„é¢˜å¯ä»¥éå†ä¸€å¼€å§‹é‚£äº›æ¯”è¾ƒå°çš„æ•°ï¼Œè·å¾—å‰å‡ ä¸ªæ•°åˆ—çš„å€¼ï¼Œç„¶åç”¨æ±‚æ•°åˆ—é€šé¡¹å…¬å¼çš„ç½‘ç«™è·å¾—é€šé¡¹å…¬å¼ï¼Œä»è€Œæ±‚å‡ºè¦æ±‚çš„æ•°ã€‚

### 7.1 ä½©å°”æ–¹ç¨‹ Pell Equation
#### 7.1.1 ç¬¬ä¸€ç±»ä½©å°”æ–¹ç¨‹
$$x^2-dy^2=1$$ å…¶ä¸­$d>1$ä¸”$d$ä¸æ˜¯å®Œå…¨å¹³æ–¹æ•°ã€‚è€Œä¸”æ–¹ç¨‹çš„è§£æ»¡è¶³$x>0,y>0,x,y\in \mathbb{Z}$ã€‚

* å®šç†ï¼šç¬¬ä¸€ç±»ä½©å°”æ–¹ç¨‹æœ‰æ— æ•°ä¸ªè§£(è¿™é‡Œä¸ç»™å‡ºè¯æ˜)

å¦‚æœçŸ¥é“äº†å…¬å¼çš„ä¸€ä¸ªæœ€å°æ•´æ•°è§£$(x_1,y_1)$ï¼Œåˆ™ç»™å‡ºå…¶é€šè§£çš„è¿­ä»£å…¬å¼$$x_n=x_{n-1}x_1+dy_{n-1}y_1 \\ y_n = x_{n-1}y_1+y_{n-1}x_1$$ 

> è¯æ˜ï¼šè”ç«‹æ–¹ç¨‹$$ x_1^2-dy_1^2=1 \\ x_2^2-dy_2^2=1 $$ å¯ä»¥è”ç«‹å¾—åˆ° $$(x_1x_2-dy_1y_2)^2-d(x_1y_2+x_2y_1)^2=1$$ è¿™æ ·ä¸€æ¥æ›¿æ¢ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°é€šè§£äº†ã€‚

* æ±‚è§£ä½©å°”æ–¹ç¨‹
    * å¯¹äºç»™å®šçš„$d$ï¼Œå¯ä»¥é€šè¿‡æš´åŠ›æ±‚è§£**æœ€å°æ•´æ•°è§£$x_1,y_1$**ï¼Œç„¶åç”¨é€šé¡¹å…¬å¼æ±‚è§£ã€‚
    * ä½¿ç”¨**è¿åˆ†æ•°**è¿›è¡Œæ±‚è§£ã€‚
    * ä½¿ç”¨çŸ©é˜µå¿«é€Ÿå¹‚è¿›è¡Œæ±‚è§£ï¼š $$\left[ \begin{matrix}x_n \\ y_n \end{matrix}\right] = \left[ \begin{matrix}x_1 & dy_1\\ y_1 & x_1 \end{matrix}\right]^{n-1}  \left[ \begin{matrix}x_1 \\ y_1 \end{matrix}\right]$$

* è¿åˆ†æ•°æ±‚è§£åŸç†ï¼š
  é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹è¿åˆ†æ•°ï¼Œ$n$é˜¶ç®€å•è¿åˆ†æ•°è®°ä¸ºï¼š$$[x_0,x_1,...,x_n]$$ æ— é™ç®€å•è¿åˆ†æ•°è®°ä¸º:$$[x_0,x_1,x_2,...]$$ å¯ä»¥å°†æœ‰é™ç®€å•è¿åˆ†æ•°å«åšæ— é™è¿åˆ†æ•°å¼çš„ç¬¬$n$ä¸ª**æ¸è¿›åˆ†æ•°**ã€‚$x_n$å«åšç¬¬$n$ä¸ª**éƒ¨åˆ†å•†**ã€‚
  * å®šç†ï¼šæ— é™ç®€å•è¿åˆ†æ•°$[x_0,x_1,x_2,...]$æ˜¯æ”¶æ•›çš„ï¼Œå­˜åœ¨å®æ•°$\theta$ï¼Œä½¿å¾—$$\lim_{n\to +\infty}[x_0,x_1,x_2,...]=\theta$$
  * å®šç†ï¼šè®¾å®æ•°$\theta>1$çš„æ¸è¿‘åˆ†æ•°ä¸º$\frac{P_n}{Q_n}$ï¼Œåˆ™å¯¹ä»»æ„$n\geq 1$ï¼Œæœ‰$$|\theta^2Q_n^2 - P_n^2|<2\theta$$
* å®é™…ä¸Šå¯¹$d$è¿›è¡Œè¿åˆ†æ•°å±•å¼€å¯ä»¥æŠŠ$x^2-dy^2=1$çš„æ‰€æœ‰è§£å…¨éƒ¨æ±‚å‡ºã€‚åªè¦æœ‰$åŸå¼=1$ï¼Œåˆ™ä¸ºä½©å°”æ–¹ç¨‹çš„è§£ã€‚ç½‘ä¸Šè¯´ä½©å°”æ–¹ç¨‹çš„è§£åœ¨ä¸åŒçš„$d$ä¸­æœ‰ä¸åŒçš„å½¢å¼ï¼Œä½†å®è´¨ä¸Šç›´æ¥è¿åˆ†æ•°å±•å¼€æ‰¾åˆ°$åŸå¼=1$æ—¶çš„è§£å³å¯ã€‚(ç†è®ºä¸Šæ˜¯å¯ä»¥è¯æ˜çš„ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰å»è¯)



#### 7.1.2 ç¬¬äºŒç±»ä½©å°”æ–¹ç¨‹
$$x^2-ny^2=c$$

è§£ç¬¬äºŒç±»ä½©å°”æ–¹ç¨‹ï¼Œéœ€è¦ç”¨åˆ°ç¬¬ä¸€ç±»ä½©å°”æ–¹ç¨‹çš„è§£ã€‚

> è¯æ˜ï¼šè®¾ $ x^2-dy^2=1 $ çš„è§£ä¸º$x_1, y_1$ã€‚è®¾$x^2-dy^2=k$çš„è§£ä¸º$p,q$ã€‚
> è”ç«‹æ–¹ç¨‹$$ x_1^2-dy_1^2=1 \\ p^2-dq^2=k $$ å¯ä»¥è”ç«‹å¾—åˆ° $$(x_1p\pm dy_1q)^2-d(py_1\pm x_1q)^2=k$$ è¿™æ ·ä¸€æ¥æ›¿æ¢ä¸€ä¸‹å°±å¯ä»¥å¾—åˆ°é€šè§£ $$x = x_1p_i\pm dy_1q_i \\ y = p_iy_1\pm x_1q_i$$ åŒ–ä¸ºçŸ©é˜µä¹˜æ³•çš„å½¢å¼ä¸º $$ \left[ \begin{matrix}p_n \\ q_n \end{matrix}\right] = \left[ \begin{matrix}p & \pm dq\\ \pm q & p \end{matrix}\right]^{n-1}  \left[ \begin{matrix}x_1 \\ y_1 \end{matrix}\right] $$

* å‚è€ƒèµ„æ–™ï¼š
  * https://blog.csdn.net/TheWayForDream/article/details/113772229
  * https://www.cnblogs.com/lfri/p/11650132.html

## 8. ä¸€äº›å¯†ç å­¦åŸºæœ¬æ¦‚å¿µ
ç§°ä¸€ä¸ªæœºå™¨æ˜¯æ¦‚ç‡å¤šé¡¹å¼æ—¶é—´çš„ï¼Œå¦‚æœå®ƒçš„è¿è¡Œæ­¥æ•°æ˜¯å®‰å…¨å‚æ•°çš„å¤šé¡¹å¼å‡½æ•°ï¼Œç®€è®°ä¸ºPPTã€‚

### 8.1 é™·é—¨ç½®æ¢çš„å®šä¹‰
**å®šä¹‰ 8.1-1** ä¸€ä¸ªé™·é—¨ç½®æ¢æ—æ˜¯ä¸€ä¸ª PPT ç®—æ³•å…ƒç»„(Gen, Simple, Eval, Invert):
1. Gen($1^k$)æ˜¯ä¸€ä¸ªæ¦‚ç‡æ€§ç®—æ³•ï¼Œè¾“å…¥ä¸ºå®‰å…¨å‚æ•°$1^k$ï¼Œè¾“å‡ºä¸º($i$, td)ï¼Œå…¶ä¸­$i$æ—¶å®šä¹‰åŸŸ$D_i$ä¸Šçš„ä¸€ä¸ªç½®æ¢$f_i$çš„æ ‡å·ï¼Œtdæ—¶å…è®¸æ±‚$f_i$é€†çš„é™·é—¨ä¿¡æ¯ã€‚
2. Sample($1^k,i$)æ—¶ä¸€ä¸ªæ¦‚ç‡æ€§ç®—æ³•ï¼Œè¾“å…¥$i$ç”±Genäº§ç”Ÿï¼Œè¾“å‡ºä¸º$x\leftarrow_R D_i$ã€‚
3. Eval($1^k,i,x$)æ—¶ä¸€ä¸ªç¡®å®šæ€§ç®—æ³•ï¼Œè¾“å…¥$i$ç”±Genäº§ç”Ÿï¼Œ$x\leftarrow_R D_i$ç”±Sample($1^k,i$)äº§ç”Ÿï¼Œè¾“å‡ºä¸º$y\in D_i$ã€‚å³Eval($1^k,i,\cdot$):$D_i\rightarrow D_i$æ—¶$D_i$ä¸Šçš„ä¸€ä¸ªç½®æ¢ã€‚
4. Invert($1^k,(i, td),y$)æ—¶ä¸€ä¸ªç¡®å®šæ€§ç®—æ³•ï¼Œè¾“å…¥($i$,td)ç”±Genäº§ç”Ÿï¼Œ$y\in D_i$ã€‚è¾“å‡ºä¸º$x\in D_i$ã€‚
* é™·é—¨ç½®æ¢æ—çš„æ­£ç¡®æ€§è¦æ±‚ï¼šå¯¹æ‰€æœ‰çš„$k$ï¼Œ($i$,td)$\leftarrow$Gen($1^k$)ä»¥åŠ$x\leftarrow$Sample($i^k,i$)ï¼ŒInvert($1^k,(i,td),Eval(1^k,i,x$))= $x$ã€‚
* Invert($1^k,(i, td),\cdot$)å…¶å®å°±æ˜¯ç½®æ¢$f_i$çš„é€†ç½®æ¢$f_i^{-1}$ã€‚è™½ç„¶$f_i^{-1}$æ€»æ˜¯å­˜åœ¨çš„ï¼Œå•ä¸ä¸€å®šæ—¶å¯æœ‰æ•ˆè®¡ç®—çš„ã€‚ä¸Šé¢çš„å®šä¹‰è¯´ï¼Œå·²çŸ¥é™·é—¨ä¿¡æ¯tdï¼Œä½ ç½®æ¢$f_i^{-1}$æ˜¯å¯æœ‰æ•ˆè®¡ç®—çš„ã€‚
* **åœ¨ä»¥ä¸Šå®šä¹‰ä¸­ï¼Œæ²¡æœ‰è€ƒè™‘ä»»ä½•â€œå›°éš¾æ€§â€æˆ–â€œå®‰å…¨æ€§â€çš„æ¦‚å¿µã€‚ä½†å¯†ç å­¦ä¸­çš„é™·é—¨ç½®æ¢æ˜¯æŒ‡å•å‘é™·é—¨ç½®æ¢ï¼Œå³å½“é™·é—¨ä¿¡æ¯tdæœªçŸ¥æ—¶ï¼Œä¸€ä¸ªéšæœºé™·é—¨ç½®æ¢çš„æ±‚é€†æ˜¯å›°éš¾çš„ã€‚æ­£å¼å®šä¹‰å¦‚ä¸‹ã€‚**

**å®šä¹‰ 8.1-2: å•å‘é™·é—¨ç½®æ¢(TDP)** ä¸€ä¸ªé™·é—¨ç½®æ¢ç°‡(Gen,Sample, Eval, Invert)æ˜¯å•å‘çš„ï¼Œå¦‚æœå¯¹äºä»»æ„çš„ PPT æ•Œæ‰‹Aï¼Œå­˜åœ¨ä¸€ä¸ªå¯å¿½ç•¥çš„å‡½æ•°$\grave{o}(k)$ï¼Œä½¿å¾—Aåœ¨ä¸‹é¢çš„æ¸¸æˆä¸­ï¼Œå…¶ä¼˜åŠ¿${\rm Adv}_{\rm T-Perm,A}(k) \leq \grave{o}(k)$ï¼š
* ${\rm Exp_{T-Perm,A}}(k):$
    * ($i$,td)$\leftarrow$Gen($k$);
    * $y\leftarrow$ Sample($k,i$);
    * $x\leftarrow$ A($k,i,y$);
    * å¦‚æœEval($k,i,x$)=$y$ï¼Œè¿”å›1ï¼›å¦åˆ™è¿”å›0.

æ•Œæ‰‹çš„ä¼˜åŠ¿å®šä¹‰ä¸º${\rm Adv}_{\rm T-Perm,A}(k) = {\rm Pr[Exp_{T-Perm,A}}(k)=1]$ã€‚
* æ­¤å®šä¹‰ä¸»è¦ç”¨åœ¨å®‰å…¨æ€§è¯æ˜ä¸­ã€‚


## 9. æ¬§æ‹‰å‡½æ•° (Euler's totient function)
è®¡ç®—ä¸$n$äº’ç´ çš„æ‰€æœ‰å°äº$n$çš„æ•°çš„ä¸ªæ•°ã€‚å‡è®¾$p_1,\cdots,p_r$æ˜¯$n$çš„ç´ å› æ•°ï¼Œåˆ™ï¼š
$$\phi(n) = n(1-\frac{1}{p_1})\cdots(1-\frac{1}{p_r})$$


## 10. å¡è¿ˆå…‹å°”å‡½æ•° (Carmichael function)
ä½¿å¾—$$a^m\equiv 1\ mod\ n$$æˆç«‹çš„æœ€å°æ­£æ•´æ•°$m$ï¼Œå…¶ä¸­$(a,n)=1$ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬å°†$m$è®°ä¸º$\lambda(n)$ã€‚

## 11. åŸæ ¹
å®šä¹‰**é˜¶**ï¼šè®¾$n\geq 1, (a,n)=1$ï¼Œä½¿å¾—$a^d\equiv 1\ mod\ n$æˆç«‹çš„æœ€å°æ­£æ•´æ•°$d$ï¼Œç§°ä¸º$a$æ¨¡$n$çš„é˜¶ï¼Œè®°ä¸º$\delta_n(a)$æˆ–$ord_n(a)$ã€‚

å®šä¹‰**åŸæ ¹**ï¼šå½“$\delta_n(a)=\phi(n)$æ—¶ï¼Œ$a$ä¸ºæ¨¡$n$çš„åŸæ ¹ã€‚

* åŸæ ¹çš„å®šç†
    * æ¨¡$n$æœ‰åŸæ ¹$\Leftrightarrow n=1,2,4,p^l, 2p^l$

* æ¨è®º1ï¼šæ­£å¸¸çš„RSAæ–¹æ¡ˆçš„ä¸€ä¸ªå…¬é’¥æŒ‡æ•°è‡³å°‘å¯¹åº”ä¸¤ä¸ªç§é’¥ã€‚
  * $$a^{2k_1}\equiv 1\ mod\ n_1, \ \ a^{2k_2}\equiv 1\ mod\ n_2 \\ a^{2k_1k_2}\equiv 1\ mod\ n_1$$ è€Œ$\phi(n) = 4k_1k_2$ï¼Œå› æ­¤å®è´¨ä¸Šä¸€ä¸ªRSAæ–¹æ¡ˆä¸€ä¸ªå…¬é’¥æŒ‡æ•°å¯ä»¥å¯¹åº”$gcd(p-1,q-1)$ä¸ªç§é’¥æŒ‡æ•°ã€‚
* æ¨è®º2ï¼šèƒ½æ„æˆæ¨¡$n$çš„å¾ªç¯ç¾¤ä¸€å®šæ»¡è¶³$n=2,4,p^l, 2p^l$

## 12. Montgomery reduction 
ä¸€èˆ¬æ¥è¯´è¿™ä¸ªæ–¹æ³•ä¸»è¦åº”ç”¨äºå¿«é€Ÿè®¡ç®—ç´ æ•°é˜¶æœ‰é™åŸŸçš„ä¹˜æ³•è¿ç®—ã€‚åŸç†æ˜¯æŠŠéœ€è¦è®¡ç®—çš„æ•°æ˜ å°„åˆ°Montgomeryè¡¨ç¤ºå½¢å¼ä¸­ï¼Œç„¶ååœ¨è¿™ç§å½¢å¼ä¸­è¿›è¡Œä¹˜æ³•çš„è®¡ç®—ã€‚åœ¨Montgomeryè¡¨ç¤ºå½¢å¼ä¸­ï¼ŒåŒæ ·é€‚ç”¨äºåŠ æ³•å’Œä¹˜æ³•è¿ç®—ã€‚

> Montgomeryè§„çº¦é€‚ç”¨äºæ¨¡ä¸æ˜¯ç´ æ•°çš„æƒ…å†µï¼Œå¯è§å‚è€ƒæ–‡çŒ®2ä¸­çš„å†…å®¹ï¼Œè€Œä¸”æ˜¯åœ¨$GF(2^k)$ä¸Šçš„ã€‚è¿™é‡Œåªè¯´æ˜åœ¨ç´ æ•°åŸŸçš„æƒ…å†µä¸‹å¦‚ä½•å»è®¡ç®—ã€‚

å·²çŸ¥ï¼šæ¨¡æ•°$p$ï¼Œ$n=log_2(p)$ï¼Œä¹˜æ•°$a,b\ mod\ p$

é¢„è®¡ç®—ï¼š$r = 2^n$ï¼ŒæŠŠ$a,b$è½¬åŒ–æˆMontgomeryè¡¨ç¤ºå½¢å¼ï¼Œ$a' = ar\ (mod\ p)\ \ b' = br\ (mod\ p)$

æ ¹æ®Montgomery reductionå®šç†æœ‰ï¼š$$\forall t, 0\leq t\le nr, st. \frac{(t+tpp^{-1})}{r} \equiv tr^{-1}\ mod\ p$$ å…¶ä¸­çš„é™¤æ³•è¿ç®—å°±æ˜¯æ•´æ•°çš„é™¤æ³•ï¼Œä¸æ˜¯ä¹˜ä»¥$r$çš„é€†ã€‚

å› æ­¤ä½¿ç”¨Montgomery reductionå¯¹ç®—æ³•è¿›è¡ŒåŠ é€Ÿçš„æ—¶å€™æœ‰ä¸¤ä¸ªç®—æ³•éœ€è¦å®ç°ã€‚ç¬¬ä¸€ä¸ªæ˜¯å¦‚ä½•æŠŠä¹˜æ•°å˜æˆMontgomery reductionçš„å½¢å¼ï¼Œç„¶åç¬¬äºŒç‚¹å°±æ˜¯å¯¹ä¹˜æ³•è¿›è¡Œå®ç°ã€‚å¦‚æœç¡®å®šäº†è¦æŠŠä¹˜æ•°å˜æˆMontgomery reductionçš„å½¢å¼ï¼Œç„¶åä¸€ç›´éƒ½åœ¨è¿™ä¸ªå½¢å¼ä¸‹è¿›è¡Œè¿ç®—ã€‚å‡è®¾å½“å‰çš„æ•°ä¸º$t$ï¼Œé‚£ä¹ˆåªéœ€è¦æ‰§è¡Œ$tr^{-1}\ mod\ n$å°±å¯ä»¥æ¢å¤æˆæƒ³è¦çš„ç»“æœã€‚
- ç¬¬ä¸€æ­¥ä¸­çš„ä¹˜æ³•æ¨¡è¿ç®—å¯ä»¥ä½¿ç”¨æœ€ä¼ ç»Ÿçš„æ–¹å¼è¿›è¡Œé¢„å¤„ç†ã€‚ç„¶åä¹˜æ³•è¿ç®—å°±ç”¨Montgomeryä¹˜æ³•ã€‚
- Montgomery reductionä¹˜æ³•ï¼š
    1. $t = ab$
    2. $m = tn^{-1}\ mod\ r $ã€‚å…¶ä¸­æ±‚æ¨¡è¿ç®—åªéœ€è¦å–ä¹˜æ³•è¿ç®—çš„ä½$n$æ¯”ç‰¹å³å¯ã€‚
    3. $u=(t+mn)/r$
    4. if $u\geq n$, then $u = u-n$
    5. è¾“å‡º$u$


å‚è€ƒèµ„æ–™ï¼š
1. https://cryptography.fandom.com/wiki/Montgomery_reduction#The_Montgomery_step
2. https://www.researchgate.net/publication/225847328_Montgomery_Multiplication_in_GF2k   **Montgomery Multiplication in GF(2k)**



# å¸¸è§Cryptoæ”»å‡»æ€æƒ³

å¸¸è§æ”»å‡»æ–¹æ³•
æ ¹æ®ä¸åŒçš„æ”»å‡»æ¨¡å¼ï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„æ”»å‡»æ–¹æ³•ï¼Œç›®å‰å¸¸è§çš„æ”»å‡»æ–¹æ³•ä¸»è¦æœ‰

* æš´åŠ›æ”»å‡»ï¼ˆé€šç”¨ï¼‰
* ä¸­é—´ç›¸é‡æ”»å‡»ï¼ˆæ€æƒ³ï¼‰
* çº¿æ€§åˆ†æï¼ˆå¸¸ç”¨äºç¼ºé™·ç‰ˆAESï¼‰
* å·®åˆ†åˆ†æï¼ˆå¸¸ç”¨äºç¼ºé™·ç‰ˆAESï¼‰
* ä¸å¯èƒ½å·®åˆ†åˆ†æ
* ç§¯åˆ†åˆ†æ
* ä»£æ•°åˆ†æ
* ç›¸å…³å¯†é’¥æ”»å‡»
* ä¾§ä¿¡é“æ”»å‡»
* æ¯”ç‰¹æ”»å‡»

# è¯ä¹¦æ ¼å¼
æ•°å­—è¯ä¹¦æ˜¯æŒ‡åœ¨äº’è”ç½‘é€šè®¯ä¸­æ ‡å¿—é€šè®¯å„æ–¹èº«ä»½ä¿¡æ¯çš„ä¸€ä¸ªæ•°å­—è®¤è¯ï¼Œäººä»¬å¯ä»¥åœ¨ç½‘ä¸Šç”¨å®ƒæ¥è¯†åˆ«å¯¹æ–¹çš„èº«ä»½ã€‚

æ•°å­—è¯ä¹¦æœ‰ç€å…¶ç›¸åº”çš„å„å¼ï¼Œå¸¸è§çš„opensslè½¯ä»¶ä¼šä¸€èˆ¬éƒ½èƒ½å¤Ÿå¤„ç†è¯ä¹¦ã€‚**è¯¦ç»†è¿‡ç¨‹è§RSAç¬¬é›¶ç« **ã€‚

å¸¸è§çš„è¯ä¹¦å„å¼å¦‚ä¸‹ï¼š
* PEMï¼š PEM ä»¥ -----BEGIN å¼€å¤´ï¼Œä»¥ -----END ç»“å°¾ï¼Œä¸­é—´åŒ…å« ASN.1 æ ¼å¼çš„æ•°æ®ã€‚ç”¨ Python 3 å’Œ PyCryptodome åº“å¯ä»¥ä¸ PEM æ–‡ä»¶äº¤äº’å¹¶æå–ç›¸å…³æ•°æ®ã€‚ä¾‹å¦‚æˆ‘ä»¬æƒ³æå–å‡ºæ¨¡æ•° ``n``:
```python
# python3
from Crypto.PublicKey import RSA

with open("certificate.pem","r") as f:
    key = RSA.import_key(f.read())
    print(key.n)
```
ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼š
```python
from Crypto.PublicKey import RSA
x = RSA.generate(2048)              # é‡Œé¢æœ‰(n,e,d,p,q)
y = RSA.construct(x.n, x.e, x.d)    # å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥åˆ†è§£RSAå¾—åˆ°på’Œq

privatekey = x.exportKey("PEM")     # ç§é’¥
pubkey = x.publickey().exportKey()  # å…¬é’¥

with open('publicKey.pem', 'wb') as f:
    f.write(pubkey)
with open('privateKey.pem', 'wb') as f:
    f.write(privatekey)
```
PEMå¯†é’¥çš„ä¾‹å­ï¼š
```
-----BEGIN PUBLIC KEY-----
MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAIw/U51Fghh6WumZQjg9l3a6AjFZ+xm2
x2+9ja+8n8Yg95Hbxsp9vCpwlIol1A5wMo6p/hNlxzAE3/cY08eKzDMCAwEAAQ==
-----END PUBLIC KEY-----
```
```
-----BEGIN RSA PRIVATE KEY-----
MIIBOQIBAAJBAIw/U51Fghh6WumZQjg9l3a6AjFZ+xm2x2+9ja+8n8Yg95Hbxsp9
vCpwlIol1A5wMo6p/hNlxzAE3/cY08eKzDMCAwEAAQJAJearQxJYwSK31O9dDPPg
Le7AzvOBP4a8yP7R/o8cIp+3XdCXzuUreFzTWTXIg76tohg8cQb77HT/jVo2rLXa
AQIhAOrtFkJ0So2NZIp4xBPLqFozaSJNti8Yx8w1IOWoS2szAiEAmNQCPrBaB6p4
heIDYgaTYpJa4gbw3tLe82AAKzFLGwECIE/ZA37Uzd4s16ZlA6gCyZbW8H3zUd/S
GV6kFClauT+XAiBZuddbkNQ6vfYmvIw56Bxt+flLzMFsQSfOgaV3tmgfAQIgKW7C
LI1+rBn3TvmyLMZ7+3TEtVeTVRgabLWyOUjmv7w=
-----END RSA PRIVATE KEY-----
```

* DERï¼šDER æ˜¯ ASN.1 ç±»å‹çš„äºŒè¿›åˆ¶ç¼–ç ã€‚åç¼€ ``.cer`` æˆ– ``.crt`` çš„è¯ä¹¦é€šå¸¸åŒ…å« DER æ ¼å¼çš„æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ ``openssl`` å°† PEM(``.pem``) æ–‡ä»¶è½¬åŒ–ä¸º DER(``.der``) æ–‡ä»¶ï¼š
```
openssl x509 -inform DER -in certificate.der > certificate.pem
```
* å…¶ä»–æ ¼å¼è½¬æ¢ 
```
openssl x509 -outform der -in certificate.pem -out certificate.der
openssl x509 -inform der -in certificate.cer -out certificate.pem
```









# ç»ƒä¹ é¢˜

## Hashç›¸å…³
* 2017 34c3 Software_update
    * https://sectt.github.io/writeups/34C3CTF/crypto_182_software_update/Readme
    * https://github.com/OOTS/34c3ctf/blob/master/software_update/solution/exploit.py
* 2019 36c3 SaV-ls-l-aaS
    * https://ctftime.org/writeup/17966





# CTF cryptoä¸­pythonæŠ€å·§

## åˆ¤æ–­ç´ æ•°
* `pycryptodome` : `from Crypto.Util.number import isPrime `
* `gmpy2` : `gmpy2.is_prime()`
* `Sagemath` : `is_prime()`

## CTFå¸¸è§å­—ç¬¦é›†
```python
import string
print(string.printable.encode())	# å¯æ‰“å°å­—ç¬¦é›†  
TABLE1=ascii_letters+digits+"{}_@#\"| "  # æ•°å­—+å­—æ¯+å…¶å®ƒç¬¦å·
TABLE2=b'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,{} '
```

## æ¯”è¾ƒä¸¤ä¸ªlistä¸­æ˜¯å¦æœ‰ç›¸åŒçš„å…ƒç´ 
ä¸€èˆ¬æ¥è¯´å¸¸è§çš„æ€è·¯æ˜¯ä¸¤ä¸ªforå¾ªç¯ï¼ŒåµŒå¥—ä½†æ˜¯è¿™æ ·çš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(n^2)$ã€‚ä½¿ç”¨`set`æ•°æ®ç»“æ„èƒ½æŠŠå¤æ‚åº¦é™ä½åˆ°$O(nlog\ n)$ã€‚
```python
a, b = [1,2,3,4,5,6,7], [5,7,8,9,0,2332]
print(set(a)&set(b))
```

## å…¨æ’åˆ—   
```python
import itertools
a = [1,2,3,4]
for i in itertools.permutations(a):
    print(list(i))
```

# å…¶å®ƒè§£é¢˜æŠ€å·§

é‡åˆ°å¯†æ–‡æ˜¯ä¹±ä¸ƒå…«ç³Ÿçš„å­—ç¬¦ä¸²è€Œæ˜æ–‡æ˜¯æ­£å¸¸çš„è‹±æ–‡å­—ç¬¦+æ•°å­—+æ‹¬å·çš„æƒ…å†µçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§ç‰¹æ€§ç¼©å°æ˜æ–‡å’Œå¯†é’¥çš„å–å€¼ã€‚å‚è€ƒ`crypto/2021_Mtctf/RSA_2021_MTctf_easy_RSA`è¿™é“é¢˜ã€‚

## æ ¹æ®å‡ ä¸ªæ•°æ±‚æ•°åˆ—çš„é€šé¡¹å…¬å¼

http://oeis.org/search?q=1%2C4%2C15%2C56&sort=&language=english&go=Search




# è®¡ç®—å¤æ‚æ€§ç†è®º ï¼ˆå¿…è¦çŸ¥è¯†ï¼‰

å¤§å¤šæ•°æœç´¢å‹é—®é¢˜å¯ä»¥æ¨å¹¿åˆ°åˆ¤å®šå‹é—®é¢˜ä¸Šå»ã€‚

Pé—®é¢˜ï¼šæœ‰æ•ˆæ±‚è§£çš„é—®é¢˜

NPé—®é¢˜ï¼šæœ‰æ•ˆéªŒè¯è§£çš„é—®é¢˜ï¼ˆæ˜¯ä¸æ˜¯è¿˜è¦åŠ ä¸€ç‚¹ä¸œè¥¿ï¼‰

NPCé—®é¢˜(NPå®Œå¤‡é—®é¢˜)ï¼šéœ€è¦å¼•å…¥å¤šé¡¹å¼æ—¶é—´è§„çº¦çš„æ¦‚å¿µã€‚
    1. æ˜¯ä¸€ä¸ªNPé—®é¢˜
    2. æ‰€æœ‰çš„NPé—®é¢˜éƒ½å¯ä»¥(å¤šé¡¹å¼æ—¶é—´)çº¦åŒ–åˆ°å®ƒ

- Karpè§„çº¦â€”â€”åˆ¤å®šå‹é—®é¢˜ä¹‹é—´çš„è§„çº¦
- Levinè§„çº¦â€”â€”æœç´¢å‹é—®é¢˜åˆ°æœç´¢å‹é—®é¢˜ä¹‹é—´çš„è§„çº¦

NPéš¾é—®é¢˜ï¼šï¼ˆåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼‰
    1. æ˜¯ä¸€ä¸ªNPCé—®é¢˜
    2. ä¸æ˜¯ä¸€ä¸ªNPé—®é¢˜ï¼ˆæ²¡æœ‰æœ‰æ•ˆéªŒè¯è§£çš„é—®é¢˜ï¼‰


ä¼ ç»Ÿçš„NPé—®é¢˜çš„å®šä¹‰æ˜¯åˆ©ç”¨ç¡®å®šæ€§å›¾çµæœºå®ç°çš„ã€‚




# è¿‘å¹´æ¥æ¯”è¾ƒçƒ­çš„å¯†ç æŠ€æœ¯

> æ¨èçŸ¥ä¹ä¸Šä¸€ä¸ªäººï¼Œä»‹ç»äº†å¾ˆå¤šå¯†ç å­¦å­¦æœ¯ç•Œçš„çŸ¥è¯†ï¼Œå¦‚æœæœ‰å…´è¶£å»ç ”ç©¶å¯ä»¥å»çœ‹ä¸€ä¸‹taå†™çš„æ–‡ç« ï¼š https://www.zhihu.com/people/steven-yue-72/posts

## å·®åˆ†éšç§
> æœ€å¥½å¤šçœ‹å‡ ç¯‡æ–‡ç« ï¼Œè¿™é‡Œå°±åšç®€å•å™è¿°
* reference: 
    * https://blog.csdn.net/shangsongwww/article/details/105121386
    * https://zhuanlan.zhihu.com/p/48534275
    * https://www.zhihu.com/question/47492648/answer/194047182

å·®åˆ†éšç§ï¼ˆDifferential Privacyï¼‰æ˜¯å¯†ç å­¦ä¸­çš„ä¸€ç§æ‰‹æ®µï¼Œæ—¨åœ¨æä¾›ä¸€ç§å½“ä»ç»Ÿè®¡æ•°æ®åº“æŸ¥è¯¢æ—¶ï¼Œæœ€å¤§åŒ–æ•°æ®æŸ¥è¯¢çš„å‡†ç¡®æ€§ï¼ŒåŒæ—¶æœ€å¤§é™åº¦å‡å°‘è¯†åˆ«å…¶è®°å½•çš„æœºä¼šã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯åœ¨**ä¿ç•™ç»Ÿè®¡å­¦ç‰¹å¾çš„å‰æä¸‹å»é™¤ä¸ªä½“ç‰¹å¾ä»¥ä¿æŠ¤ç”¨æˆ·éšç§**ã€‚

è¿™é‡Œè¯´çš„æ•°æ®æŸ¥è¯¢ä¸èƒ½æ˜¯é’ˆå¯¹å•ä¸ªç”¨æˆ·çš„æ•°æ®æŸ¥è¯¢ï¼Œå› ä¸ºå¦‚æœè¦ç›´æ¥æŸ¥è¯¢å•ä¸ªç”¨æˆ·çš„ä¿¡æ¯çš„è¯å°±æ²¡æœ‰éšç§å¯è¨€ã€‚å› ä¸ºéšç§è¿™ç§ä¸œè¥¿æœ‰å¾ˆå¤šä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå› æ­¤åœ¨è®¨è®ºåˆ°å·®åˆ†éšç§çš„æ—¶å€™è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸€ç§**æ–°çš„éšç§å®šä¹‰**æš‚ä¸”ç§°ä½œ**å·®åˆ†éšç§**ã€‚

å·®åˆ†éšç§è¯´çš„æ˜¯ä¸€ç§é˜²æ­¢å·®åˆ†æ”»å‡»çš„æ–¹æ³•ã€‚æ”»å‡»è€…å¯¹æ•°æ®åº“çš„æŸ¥è¯¢æ“ä½œåªèƒ½æ˜¯æ‰¹é‡è¿›è¡ŒæŸ¥è¯¢ç„¶åè·å–æŸ¥è¯¢åçš„ç»Ÿè®¡æ•°æ®ï¼Œæ²¡æœ‰å•ä¸ªç”¨æˆ·çš„æŸ¥è¯¢åŠŸèƒ½ã€‚

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼šå®ƒæƒ³åšçš„äº‹æƒ…å°±æ˜¯å³ä½¿ä½ å°å­çŸ¥é“æˆ‘å‘å¸ƒçš„100ä¸ªäººçš„ä¿¡æ¯ï¼Œä»¥åŠå¦å¤–99ä¸ªäººçš„ä¿¡æ¯ï¼Œä½ ä¹Ÿç»å¯¹æ²¡åŠæ³•æŠŠè¿™ä¸¤ä¸ªä¿¡æ¯æ¯”å¯¹ä¹‹åè·å–ç¬¬100ä¸ªäººçš„ä¿¡æ¯ã€‚æ€ä¹ˆæ‰èƒ½åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿ**å·®åˆ†éšç§äºæ˜¯å®šä¹‰ï¼šå¦‚æœä½ èƒ½æ‰¾å‡ºä¸€ç§æ–¹æ³•è®©æ”»å‡»è€…ç”¨æŸç§æ–¹å¼æŸ¥è¯¢100ä¸ªä¿¡æ¯å’ŒæŸ¥è¯¢é‚£99ä¸ªä¿¡æ¯å¾—åˆ°çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œé‚£æ”»å‡»è€…å°±æ²¡åŠæ³•æ‰¾å‡ºé‚£ç¬¬100ä¸ªäººçš„ä¿¡æ¯äº†ã€‚** ä½†è¿™ä¸ªâ€œä¸€è‡´â€ æ€ä¹ˆåšåˆ°å‘¢ï¼Ÿé‚£å°±åŠ å…¥éšæœºæ€§å§ã€‚å¦‚æœæŸ¥è¯¢100ä¸ªè®°å½•å’ŒæŸ¥è¯¢99ä¸ªè®°å½•ï¼Œè¾“å‡ºåŒæ ·å€¼çš„æ¦‚ç‡æ˜¯ä¸€æ ·çš„ï¼Œæ”»å‡»è€…å°±æ— æ³•è¿›è¡Œå·®åˆ†æ”»å‡»ã€‚è¿™é‡Œæˆ‘ä»¬å°±å¾—åˆ°äº†**å·®åˆ†éšç§çš„æ ¸å¿ƒæ€æƒ³ï¼šå¯¹äºå·®åˆ«åªæœ‰ä¸€æ¡è®°å½•çš„ä¸¤ä¸ªæ•°æ®é›†ï¼ŒæŸ¥è¯¢å®ƒä»¬è·å¾—ç›¸åŒå€¼çš„æ¦‚ç‡éå¸¸éå¸¸çš„æ¥è¿‘ã€‚**

* å› æ­¤å·®åˆ†éšç§çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åœ¨æŸ¥è¯¢çš„ç»“æœä¸­åŠ å…¥éšæœºæ€§ã€‚å·®åˆ†éšç§ä¸»è¦æœ‰ä¸¤ç§æœºåˆ¶ï¼š **æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶ï¼ˆLaplace Machanismï¼‰å’ŒæŒ‡æ•°æœºåˆ¶ï¼ˆExponential Mechanismï¼‰** æ¥å®ç°å·®åˆ†éšç§ä¿æŠ¤ã€‚å…¶ä¸­ï¼Œæ‹‰æ™®æ‹‰æ–¯æœºåˆ¶ç”¨äºæ•°å€¼å‹ç»“æœçš„ä¿æŠ¤ï¼ŒæŒ‡æ•°æœºåˆ¶ç”¨äºç¦»æ•£å‹ç»“æœçš„ä¿æŠ¤ã€‚

### éå½¢å¼åŒ–å®šä¹‰

* **Laplaceæœºåˆ¶** ï¼šåœ¨æŸ¥è¯¢ç»“æœé‡ŒåŠ å…¥Laplaceåˆ†å¸ƒçš„å™ªéŸ³ï¼Œé€‚ç”¨äºæ•°å€¼å‹è¾“å‡ºã€‚ä¾‹å¦‚ï¼šzhihué‡Œæœ‰å¤šå°‘äººæ˜¯985å¤§å­¦æ¯•ä¸šçš„ï¼Ÿ å‡å¦‚ç»“æœæ˜¯2000äººï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡æŸ¥è¯¢å¾—åˆ°çš„ç»“æœéƒ½ä¼šç¨ç¨æœ‰äº›åŒºåˆ«ï¼Œæ¯”å¦‚æœ‰å¾ˆé«˜çš„æ¦‚ç‡è¾“å‡º2001ï¼Œä¹Ÿæœ‰è¾ƒé«˜æ¦‚ç‡è¾“å‡º2010ï¼Œ è¾ƒä½æ¦‚ç‡è¾“å‡º1990ï¼Œç­‰ç­‰ï¼Œç„¶åç»Ÿè®¡è¾“å‡ºçš„ç»“æœï¼Œä¼šå‘ç°ç»“æœæœä»æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒã€‚

* **æŒ‡æ•°æœºåˆ¶**ï¼š åœ¨æŸ¥è¯¢ç»“æœé‡Œç”¨æŒ‡æ•°åˆ†å¸ƒæ¥è°ƒæ•´æ¦‚ç‡ï¼Œé€‚ç”¨äºéæ•°å€¼å‹è¾“å‡ºã€‚ä¾‹å¦‚ï¼šä¸­å›½top 3å¤§å­¦æ˜¯å“ªä¸€æ‰€ã€‚å¾ˆé«˜æ¦‚ç‡è¾“å‡º æµ™æ±Ÿå¤§å­¦ï¼Œè¾ƒé«˜æ¦‚ç‡è¾“å‡ºä¸Šæµ·äº¤å¤§ï¼Œè¾ƒä½æ¦‚ç‡è¾“å‡ºæ­¦æ±‰å¤§å­¦ï¼Œå¾ˆä½æ¦‚ç‡è¾“å‡ºè“ç¿”æŠ€æ ¡ï¼Œç­‰ç­‰ã€‚

* **æ•æ„Ÿåº¦**ï¼š å·®åˆ†éšç§ä¿æŠ¤å¯ä»¥é€šè¿‡åœ¨æŸ¥è¯¢å‡½æ•°çš„è¿”å›å€¼ä¸­åŠ å…¥å™ªå£°æ¥å®ç°ï¼Œä½†æ˜¯å™ªå£°çš„å¤§å°åŒæ ·ä¼šå½±å“æ•°æ®çš„å®‰å…¨æ€§å’Œå¯ç”¨æ€§ã€‚é€šå¸¸ä½¿ç”¨æ•æ„Ÿæ€§ä½œä¸ºå™ªå£°é‡å¤§å°çš„å‚æ•°ï¼Œè¡¨ç¤ºåˆ é™¤æ•°æ®é›†ä¸­æŸä¸€è®°å½•å¯¹æŸ¥è¯¢ç»“æœé€ æˆçš„å½±å“ã€‚

### å½¢å¼åŒ–å®šä¹‰

* **$\epsilon$-å·®åˆ†éšç§**ï¼š ç»™å®šæ•°æ®é›†$D$,ç»™å®š$D$çš„é‚»è¿‘æ•°æ®é›†$D'$,å¯ä»¥ç†è§£ä¸º$||D|-|D'|| = 1$ã€‚ç»™å®šä¸€ä¸ªéšæœºå‡½æ•°$f:D\rightarrow S$ï¼Œ$S$è¡¨ç¤ºå‡½æ•°$f$è¾“å‡ºçš„å€¼åŸŸï¼Œå¯èƒ½æ˜¯$D$çš„ä¸€ä¸ªæŠ½æ ·ï¼Œä¹Ÿå¯èƒ½æ˜¯ç»Ÿè®¡ç‰¹æ€§ã€‚ç„¶åæˆ‘ä»¬æœ‰ $$
Pr[f(D)=s]\leq Pr[f(D')=s]\times e^{\epsilon} $$ å…¶ä¸­$e\approx 2.718281828459$æ˜¯è‡ªç„¶å¯¹æ•°ï¼Œä¸”$s\in S$ã€‚

æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶å’Œæ•æ„Ÿåº¦æœºåˆ¶æš‚æ—¶ä¸æåŠï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªå·±ç ”ç©¶æˆ–è¡¥å……ã€‚





## å®‰å…¨å¤šæ–¹è®¡ç®—

### Shamirç§˜å¯†åˆ†äº«
> æœ¬è´¨ä¸Šæ˜¯å¤šé¡¹å¼çš„æ±‚è§£ã€‚Shamirçš„$(k,n)$ç§˜å¯†å…±äº«ç®—æ³•å°†ç§˜å¯†$S$åˆ†ä¸º$n$ä¸ªå­ç§˜å¯†ï¼Œä»»æ„$k$ä¸ªå­ç§˜å¯†éƒ½å¯ä»¥æ¢å¤å‡º$S$ ï¼Œè€Œä»»æ„$k-1$ä¸ªå­ç§˜å¯†æ— æ³•æ¢å¤å‡º$S$ã€‚

ä¸‹é¢ä»‹ç»Shamirç§˜å¯†åˆ†ææ–¹æ¡ˆï¼Œ$(k,n)$ç§˜å¯†å…±äº«ç®—æ³•ï¼š
* KeyGenï¼š
    1. ç¡®å®š$(k,n)$ã€‚é€‰æ‹©ç´ æ•°$p$
    2. é€‰æ‹©ç§˜å¯†$S$ã€‚
    3. é€‰æ‹©$k-1$ä¸ªå°äº$p$çš„éšæœºæ•°$a_1,...,a_{k-1}$ï¼Œå¾—åˆ°å¤šé¡¹å¼$y = S + \sum_{i = 1}^{k-1}a_ix^i\ mod\ p$ã€‚
    4. é€‰æ‹©$n$ä¸ªéšæœºæ•°$x_1,...,x_n$ï¼Œè®¡ç®—$y_i = S + \sum_{j = 1}^{k-1}a_jx_i^j\ mod\ p$ï¼Œå¾—åˆ°$n$å¯¹äºŒå…ƒç»„$(x_i,y_i)$ã€‚å°†$(x_i,y_i)$ä½œä¸ºé’¥åŒ™åˆ†ç»™$n$ä¸ªäººã€‚
* Decryptionï¼š
    1. é›†é½ä»»æ„$k$ä¸ªäººçš„é’¥åŒ™ï¼Œåˆ—å‡º$k$ä¸ªæ–¹ç¨‹ç»„ $$ \begin{cases} S + a_1x_i + ... + a_{k-1}x_i^{k-1} = y_i \\ S + a_1x_{i+1} + ... + a_{k-1}x_{i+1}^{k-1} = y_{i+1} \\ \vdots \\ S + a_1x_{i+k} + ... + a_{k-1}x_{i+k}^{k-1} = y_{i+k}  \end{cases}.$$
    2. è§£æ–¹ç¨‹å¾—åˆ°$S,a_1,...,a_{k-1}$ï¼Œå…¶ä¸­$S$å°±æ˜¯åˆ†äº«çš„ç§˜å¯†ã€‚


* å‚è€ƒèµ„æ–™ï¼š
    * https://blog.csdn.net/z784561257/article/details/82942581
    * https://zhuanlan.zhihu.com/p/95362628

### é›¶çŸ¥è¯†è¯æ˜

é›¶çŸ¥è¯†è¯æ˜èµ·æºäºæœ€å°æ³„éœ²è¯æ˜ã€‚

#### äº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜
æœ¬è´¨ä¸Šæ˜¯åŸºäºä¸€ä¸ªäº¤äº’å¼è¯æ˜ç³»ç»Ÿï¼Œäº¤äº’è¯æ˜ç³»ç»Ÿç”±ä¸¤æ–¹å‚ä¸ï¼Œåˆ†åˆ«ç§°ä¸ºè¯æ˜è€…ï¼ˆProverï¼Œç®€è®°ä¸ºPï¼‰å’ŒéªŒè¯è€…ï¼ˆVerifierï¼Œç®€è®°ä¸º Vï¼‰ï¼Œå…¶ä¸­çŸ¥é“æŸä¸€ç§˜å¯†ï¼ˆå¦‚å…¬é’¥å¯†ç ä½“åˆ¶çš„ç§˜å¯†é’¥æˆ–ä¸€ä¸ªäºŒæ¬¡å‰©ä½™$x$çš„å¹³æ–¹æ ¹ï¼‰ï¼ŒPå¸Œæœ›ä½¿Vç›¸ä¿¡è‡ªå·±çš„ç¡®æŒæ¡è¿™ä¸€ç§˜å¯†ã€‚äº¤äº’è¯æ˜ç”±è‹¥å¹²è½®ç»„æˆã€‚

äº¤äº’è¯æ˜ç³»ç»Ÿéœ€è¦æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š
1. å®Œå¤‡æ€§ï¼šå¦‚æœPçŸ¥é“æŸä¸€ç§˜å¯†ï¼ŒVå°†æ¥å—Pçš„è¯æ˜ã€‚
2. å¯é æ€§ï¼šå¦‚æœPèƒ½ä»¥ä¸€å®šçš„æ¦‚ç‡ä½¿Vç›¸ä¿¡
çš„è¯æ˜ï¼Œåˆ™PçŸ¥é“ç›¸åº”çš„ç§˜å¯†ã€‚

**å®šä¹‰ï¼šäº¤äº’è¯æ˜ç³»ç»Ÿ**
* æˆ‘ä»¬ç§°(P,V)ï¼ˆæˆ–è®°ä¸ºS=(P,V)æ˜¯å…³äºè¯­è¨€ L ã€å®‰å…¨å‚æ•°Kçš„äº¤äº’å¼è¯æ˜ç³»ç»Ÿï¼Œå¦‚æœæ»¡è¶³ï¼š
    1. å®Œå¤‡æ€§ï¼š$\forall x\in L, {\rm Pr[(P,V)[}x]=1]\geq 1-\grave{o}(K)$ï¼›
    2. å¯é æ€§ï¼š$\forall x\notin L, {\rm \forall P^*, Pr[(P^*,V)[}x]=1]\leq 1-\grave{o}(K)$ï¼›
    å…¶ä¸­(P,V)[$x$]è¡¨ç¤ºå½“ç³»ç»Ÿçš„è¾“å…¥æ˜¯$x$æ—¶ç³»ç»Ÿçš„è¾“å‡ºã€‚è¾“å‡ºä¸º1è¡¨ç¤ºVæ¥æ”¶Pçš„è¯æ˜ã€‚$\grave{o}(K)$æ˜¯å¯å¿½ç•¥çš„ã€‚

å¦‚æœVé™¤äº†çŸ¥é“Pèƒ½è¯æ˜æŸä¸€äº‹å®å¤–ï¼Œä¸èƒ½å¾—åˆ°å…¶å®ƒä»»ä½•ä¿¡æ¯ï¼Œåˆ™ç§°På®ç°äº†é›¶çŸ¥è¯†è¯æ˜ï¼Œç›¸åº”çš„åè®®ç§°ä¸ºé›¶çŸ¥è¯†è¯æ˜åè®®ã€‚

* åˆ»ç”»äº¤äº’å¼è¯æ˜ç³»ç»Ÿçš„é›¶çŸ¥è¯†æ€§ã€‚

**å®šä¹‰ï¼šé›¶çŸ¥è¯†æ€§** è®¾S=(P,V)æ˜¯ä¸€äº¤äº’è¯æ˜ç³»ç»Ÿï¼Œè‹¥å¯¹ä»»ä¸€PPTçš„$V^*$ï¼Œå­˜åœ¨PPTçš„æœºå™¨$S$ï¼Œä½¿å¾—å¯¹$\forall x\in L$ï¼Œ$\{VIEW_{P,V^*}(x)\}_{x\in L}$å’Œ$\{S(x)\}_{x\in L}$æœä»ç›¸åŒçš„æ¦‚ç‡åˆ†å¸ƒï¼Œè®°ä¸º$\{VIEW_{P,V^*}(x)\}_{x\in L}\equiv \{S(x)\}_{x\in L}$ï¼Œç§°Sæ˜¯å®Œå¤‡é›¶çŸ¥è¯†çš„ï¼Œå¦‚æœ$\{VIEW_{P,V^*}(x)\}_{x\in L}\equiv^c\{S(x)\}_{x\in L}$ï¼Œåˆ™ç§°Sæ˜¯è®¡ç®—ä¸Šé›¶çŸ¥è¯†çš„ã€‚
* å…¶ä¸­Sä¸ºæ¨¡æ‹Ÿå™¨ï¼Œ$S(x)$è¡¨ç¤ºè¾“å…¥ä¸º$x$æ—¶ï¼ŒSçš„è¾“å‡º$\{S(x)\}_{x\in L}$è¡¨ç¤ºSè¾“å‡ºçš„æ¦‚ç‡ã€‚$\{VIEW_{P,V^*}(x)\}_{x\in L}$è¡¨ç¤º$x\in L$æ—¶ï¼Œ$$VIEW_{P,V^*}(x)$çš„æ¦‚ç‡åˆ†å¸ƒã€‚


##### åŸºäºäºŒæ¬¡å‰©ä½™çš„é›¶çŸ¥è¯†è¯æ˜

å·²çŸ¥y,N, å…¶ä¸­$N=p*q$ï¼Œå­˜åœ¨$x^2\equiv y\ mod\ N$ã€‚

* é›¶çŸ¥è¯†è¯æ˜åè®®
Proverï¼šé€‰æ‹©éšæœºæ•°$r\in Z_N^*$ï¼Œå‘é€$z\equiv r^2\ mod\ N$
Verifier: å‘é€$b\in\{0,1\}$
Prover: å‘é€$v\equiv x^br\ mod\ N$
Verifier: æ£€æŸ¥$v^2==y^bz\ mod\ N$

> è¿™ä¸ªåè®®råªèƒ½ç©ä¸€æ¬¡ï¼Œç›¸å½“äºä¸€æ¬¡ä¸€å¯†ã€‚

* Schnorrèº«ä»½è¯†åˆ«æ–¹æ¡ˆ

#### éäº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜
å¦‚æœPå’ŒVä¸è¿›è¡Œäº¤äº’ï¼Œè¯æ˜ç”±Päº§ç”Ÿåç›´æ¥ç»™Vï¼ŒVå¯¹è¯æ˜ç›´æ¥è¿›è¡ŒéªŒè¯ï¼Œè¿™ç§è¯æ˜ç³»ç»Ÿç§°ä¸ºéäº¤äº’å¼è¯æ˜ç³»ç»Ÿï¼ˆç®€ç§°ä¸ºNIZK: Non-Interactive Zero-Knowledgeï¼‰å®šä¹‰å¦‚ä¸‹ã€‚

> ä»¥ä¸‹å®šä¹‰éäººè¯ï¼Œå¯å¿½ç•¥

**å®šä¹‰ï¼šé€‚åº”æ€§éäº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿ**
å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œä¸€å¯¹å¤šé¡¹å¼æ—¶é—´ç®—æ³•$\sum_{ZK}=({\rm P,V,Sim_1,SIm_2})$å°±æ˜¯ä¸€ä¸ªè¯­è¨€$L\in NP$çš„é€‚åº”æ€§éäº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿ:
1. å®Œå¤‡æ€§ï¼šå¯¹ä»»æ„$x\in L(|x|=K)$æœºå™¨è¯æ®$w$ï¼Œæœ‰$$Pr[r\leftarrow_R\{0,1\}^{poly(k)};\pi\leftarrow P(r,x,w):V(r,x,w)=1]=1.$$
2. å¯é æ€§ï¼šå¯¹ä»»æ„$x\notin L$ï¼Œé‚£ä¹ˆå¯¹ä»»æ„çš„$P^*ï¼Œæœ‰$$Pr[r\leftarrow_R\{0,1\}^{poly(k)};\pi\leftarrow P(r,x,w):V(r,x,w)=1]=0.$$
3. é›¶çŸ¥è¯†æ€§ï¼šè®¾(${\rm Sim_1,Sim_2}$),(${\rm A_1,A_2}$)æ˜¯ä¸€å¯¹ä¸¤é˜¶æ®µç®—æ³•ï¼Œè€ƒè™‘å¦‚ä¸‹å®éªŒï¼š
    * ${\rm Exp_{ZK-real}(K)}:$
        1. $r\leftarrow_R \{0,1\}^{poly(K)}$ ;
        2. $(x,w)\leftarrow_R A_1(r)(x\in L\cap\{0,1\}^K$ ;
        3. $p \leftarrow_R P(r,x,w)$ ;
        4. $b \leftarrow_R A_2(r,x,p)$ ;
        5. è¿”å›$b$.
    * ${\rm Exp_{ZK-sim}(K)}:$
        1. $r\leftarrow_R Sim_1(K)$ ;
        2. $(x,w)\leftarrow_R A_1(r)(x\in L\cap\{0,1\}^K$ ;
        3. $\pi \leftarrow_R Sim_2(x)$ ;
        4. $b \leftarrow_R A_2(r,x,\pi)$ ;
        5. è¿”å›$b$.

    å¦‚æœ$|{\rm Pr[Exp_{ZK-real}(K)=1] - Pr[Exp_{ZK-sim}(K)=1]}|$æ˜¯å¯å¿½ç•¥çš„ï¼Œåˆ™ç§°$\sum_{ZK}$å…·æœ‰é›¶çŸ¥è¯†æ€§ã€‚

* ç›®å‰ä¸ºæ­¢æ¯”è¾ƒå‡ºåçš„æ˜¯ZCash(é›¶å¸)ä¸­æ‰€ä½¿ç”¨çš„zk-SNARKé›¶çŸ¥è¯†è¯æ˜ã€‚è¿™ä¸ªé›¶çŸ¥è¯†è¯æ˜åªéœ€è¦è¯æ˜è€…Proverç»™å‡ºå°‘é‡çš„ä¿¡æ¯ï¼ŒéªŒè¯è€…å°±èƒ½ç›¸ä¿¡è¯æ˜è€…çŸ¥é“ZCashä¸­çš„ç§é’¥å’Œç¡®å®šè¯æ˜è€…æ‹¥æœ‰çš„UTXOã€‚

* zk-SNARKæ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå°±ä¸ç»™å‡ºåŸç†äº†ï¼Œè§ä¸‹æ–¹é“¾æ¥ã€‚æœ€å¥½ä¸€èµ·çœ‹ï¼Œå› ä¸ºç¬”è€…ä¹Ÿä¸æ˜¯æ¯ä¸ªç»†èŠ‚éƒ½çœ‹æ‡‚å¾—æ‡‚emmmmmmã€‚ä½†æ˜¯è¿™ä¹ˆå¤æ‚çš„ç³»ç»Ÿèµ·ç éœ€è¦æ‡‚å¾—ä¸ºä»€ä¹ˆè¦å‡ºç°æŸäº›æ­¥éª¤ã€‚
    * https://www.jianshu.com/p/7b772e5cdaef 
    * https://www.jianshu.com/p/b6a14c472cc1
    * https://www.investopedia.com/terms/z/zksnark.asp
    * https://blog.csdn.net/luckydog612/article/details/80396343 éå½¢å¼åŒ–ä»‹ç»

* zk-SNARKä¸­çš„ä¸€äº›æ€»ç»“ï¼š
    * é¦–å…ˆæ˜¯å…ˆè®¾è®¡å‡ºä¸€å¥—ä¸å®‰å…¨çš„é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿï¼Œè¿™é‡Œä¸»è¦æ˜¯é¦–å…ˆProveréœ€è¦è®¡ç®—æŸä¸ªå¤šé¡¹å¼ï¼Œè€Œä¸”Proverä¸èƒ½è®©VerifierçŸ¥é“è¿™ä¸ªè§£ï¼Œä½†æ˜¯åˆè¦è®©Vç›¸ä¿¡PçŸ¥é“è¿™ä¸ªè§£ã€‚
    * Pæ ¹æ®å¤šé¡¹å¼æ„é€ å‡ºä¸€ç§QAP(Quadratic Arithmetic Programs)çš„å½¢å¼(åæ­£å°±æ˜¯è§£å¤šé¡¹å¼)ï¼Œç„¶åVé€šè¿‡Pæ„é€ å‡ºçš„å¤šé¡¹å¼éªŒè¯å‡ºPçŸ¥é“æŸä¸ªç§˜å¯†ã€‚
    * è¿™é‡Œä¼šå‡ºç°3ä¸ªé—®é¢˜ï¼š
        1. Véœ€è¦ç»™å‡ºå•ä¸ªç‚¹æ±‚å€¼åè¿›è¡Œæ¯”è¾ƒä»¥å‡å°‘Péœ€è¦ä¼ é€ç»™Vçš„æ•°æ®å¤§å°ã€‚
        2. På¯ä»¥æ ¹æ®Vç»™å‡ºçš„æŠ½æ ·ç‚¹æ„é€ å¤šé¡¹å¼ã€‚ï¼ˆå› æ­¤ç”¨åˆ°åŒæ€åŠ å¯†æ¥éšè—æŠ½æ ·ç‚¹ï¼‰
        3. På¯ä»¥æ„é€ é”™è¯¯çš„å¤šé¡¹å¼é€šè¿‡Vç»™å‡ºçš„æŠ½æ ·ç‚¹çš„æ£€æµ‹ã€‚ï¼ˆå› æ­¤ç”¨åˆ°äº†KCAæœºåˆ¶(Knowledge of Coefficient Test and Assumption)ï¼Œé€šè¿‡æ¤­åœ†æ›²çº¿ç¦»æ•£å¯¹æ•°é—®é¢˜ä¿è¯Pæ„é€ çš„å¤šé¡¹å¼æ»¡è¶³ç¦»æ•£å¯¹æ•°çš„çº¦æŸï¼Œä¿è¯Pä¸ä¼šæ„é€ é”™è¯¯çš„å¤šé¡¹å¼ï¼‰
        4. åœ¨éªŒè¯çš„æ—¶å€™ä¼šå‡ºç°ä¹˜æ³•åŒæ€éšè—çš„é—®é¢˜ï¼Œå› æ­¤ç”¨åˆ°æ¤­åœ†æ›²çº¿åŒçº¿æ€§çš„ç‰¹ç‚¹ã€‚
        5. åœ¨ZCashç§ï¼Œæ„é€ â€œå…±åŒå‚è€ƒæ•°æ®é›†â€ï¼ˆCRSï¼ŒCommon Reference Stringï¼‰ï¼Œé€šè¿‡æŸç§å¯ä¿¡çš„æ–¹å¼äº§ç”Ÿï¼Œä½œä¸ºä¸€ç§å…¨ä½“èŠ‚ç‚¹çš„å…±è¯†ï¼Œåœ¨æ‰€æœ‰äº¤æ˜“çš„éªŒè¯è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œå› è€Œâ€œè´¨è¯¢-å“åº”â€çš„äº¤äº’å¼éªŒè¯æ–¹å¼å˜æˆäº†åªéœ€è¦Pæäº¤è¯æ®å³å¯ã€‚


### åŒæ€åŠ å¯†è§ç°ä»£å¯†ç ä¸€ç« 

### ç¾¤ç­¾å

åœ¨ä¸€ä¸ªç¾¤ç­¾åæ–¹æ¡ˆä¸­ï¼Œä¸€ä¸ªç¾¤ä½“ä¸­çš„ä»»æ„ä¸€ä¸ªæˆå‘˜å¯ä»¥ä»¥åŒ¿åçš„æ–¹å¼ä»£è¡¨æ•´ä¸ªç¾¤ä½“å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åã€‚ä¸å…¶ä»–æ•°å­—ç­¾åä¸€æ ·ï¼Œç¾¤ç­¾åæ˜¯å¯ä»¥å…¬å¼€éªŒè¯çš„ï¼Œè€Œä¸”å¯ä»¥åªç”¨å•ä¸ªç¾¤å…¬é’¥æ¥éªŒè¯ã€‚

* ç¾¤ç­¾åçš„ä¸€èˆ¬æµç¨‹(å‚è€ƒç™¾åº¦ç™¾ç§‘)ï¼š
1. åˆ›å»ºï¼šä¸€ä¸ªç”¨ä»¥äº§ç”Ÿç¾¤å…¬é’¥å’Œç§é’¥çš„æ¦‚ç‡å¤šé¡¹å¼æ—¶é—´ç®—æ³•ã€‚
2. åŠ å…¥ï¼šä¸€ä¸ªç”¨æˆ·å’Œç¾¤ç®¡ç†å‘˜ä¹‹é—´çš„ä½¿ç”¨æˆ·æˆä¸ºç¾¤ç®¡ç†å‘˜çš„äº¤äº’å¼åè®®ã€‚æ‰§è¡Œè¯¥åè®®å¯ä»¥äº§ç”Ÿç¾¤å‘˜çš„ç§é’¥å’Œæˆå‘˜è¯ä¹¦ï¼Œå¹¶ä½¿ç¾¤ç®¡ç†å‘˜å¾—åˆ°ç¾¤æˆå‘˜çš„ç§æœ‰å¯†é’¥ã€‚
3. ç­¾åï¼šä¸€ä¸ªæ¦‚ç‡ç®—æ³•ï¼Œå½“è¾“å…¥ä¸€ä¸ªæ¶ˆæ¯å’Œä¸€ä¸ªç¾¤æˆå‘˜çš„ç§é’¥åï¼Œè¾“å‡ºå¯¹æ¶ˆæ¯çš„ç­¾åã€‚
4. éªŒè¯ï¼šä¸€ä¸ªæ¦‚ç‡ç®—æ³•ï¼Œå½“è¾“å…¥ä¸€ä¸ªåæ¶ˆæ¯å’Œä¸€ä¸ªç¾¤æˆå‘˜çš„ç§é’¥åï¼Œè¾“å‡ºå¯¹æ¶ˆæ¯çš„ç­¾åã€‚
5. æ‰“å¼€ï¼šä¸€ä¸ªåœ¨ç»™å®šä¸€ä¸ªç­¾ååŠç¾¤ç§é’¥çš„æ¡ä»¶ä¸‹ç¡®è®¤ç­¾åäººçš„åˆæ³•èº«ä»½çš„ç®—æ³•ã€‚

* ç¾¤ç­¾åçš„å®‰å…¨æ€§è¦æ±‚ï¼š 
    1. åŒ¿åæ€§(Anonymity)
        ç»™å®šä¸€ä¸ªç¾¤ç­¾ååï¼Œå¯¹é™¤äº†å”¯ä¸€çš„ç¾¤ç®¡ç†å‘˜ä»¥å¤–çš„ä»»ä½•äººæ¥è¯´ï¼Œç¡®å®šç­¾åè€…çš„èº«ä»½æ˜¯ä¸å¯è¡Œçš„ï¼Œè‡³å°‘åœ¨è®¡ç®—ä¸Šæ˜¯å›°éš¾çš„ã€‚
    2. ä¸å…³è”æ€§(Unlinkability)
        åœ¨ä¸æ‰“å¼€ç­¾åçš„æƒ…å†µä¸‹ï¼Œç¡®å®šä¸¤ä¸ªä¸åŒçš„ç­¾åæ˜¯å¦ä¸ºåŒä¸€ä¸ªç¾¤æˆå‘˜æ‰€ç­¾çš„æ˜¯ä¸å¯è¡Œçš„ï¼Œè‡³å°‘åœ¨è®¡ç®—ä¸Šæ˜¯å›°éš¾çš„ã€‚
    3. ä¸å¯ä¼ªé€ æ€§(Unforgeability)
        åªæœ‰ç¾¤æˆå‘˜æ‰èƒ½äº§ç”Ÿæœ‰æ•ˆçš„ç¾¤ç­¾åã€‚å…¶ä»–ä»»ä½•äººåŒ…æ‹¬ç¾¤ç®¡ç†å‘˜ä¹Ÿä¸èƒ½ä¼ªé€ ä¸€ä¸ªåˆæ³•çš„ç­¾åã€‚
    4. å¯è·Ÿè¸ªæ€§(Traceability)
        ç¾¤ç®¡ç†å‘˜åœ¨å‘ç”Ÿçº çº·çš„æƒ…å†µä¸‹å¯ä»¥æ‰“å¼€ä¸€ä¸ªç­¾åæ¥ç¡®å®šå‡ºç­¾åè€…çš„èº«ä»½ï¼Œè€Œä¸”ä»»ä½•äººéƒ½ä¸èƒ½é˜»æ­¢ä¸€ä¸ªåˆæ³•ç­¾åçš„æ‰“å¼€ã€‚
    5. æ­£ç¡®æ€§(Correctness)
        å½“éªŒè¯è€…æ£€éªŒä¸€ä¸ªç­¾åæ—¶ï¼Œä¸€ä¸ªåˆæ³•çš„ç¾¤æˆå‘˜æŒ‰ç…§ç­¾åç®—æ³•äº§ç”Ÿçš„ç¾¤ç­¾åä¸€å®šèƒ½å¤Ÿé€šè¿‡éªŒè¯ç®—æ³•ã€‚
    6. æŠµæŠ—è”åˆæ”»å‡»(Coalition-Resistance)
        å³ä½¿ä¸€äº›ç¾¤æˆå‘˜ä¸²é€šåœ¨ä¸€èµ·ä¹Ÿä¸èƒ½äº§ç”Ÿä¸€ä¸ªåˆæ³•çš„ä¸èƒ½è¢«è·Ÿè¸ªçš„ç¾¤ç­¾åã€‚

* å¸¸è§çš„ç¾¤ç­¾åæ–¹æ¡ˆï¼šCS97æ–¹æ¡ˆ


* å‚è€ƒèµ„æ–™ï¼š
    * https://blog.csdn.net/zhang_hui_cs/article/details/8965338
    * https://en.wikipedia.org/wiki/Group_signature


### ç¯ç­¾å

ç¯ç­¾åå…è®¸ç”¨æˆ·ä»¥ä¸€ä¸ªè‡ªç»„ç»‡çš„ç”¨æˆ·ç¾¤ä½“ (è¢«ç§°ä¸ºç¯) çš„åä¹‰ç­¾å, è€Œä¸æ³„éœ²ç­¾åè€…çš„ç¡®åˆ‡èº«ä»½ã€‚ç”¨åˆ°çš„æ€æƒ³æ˜¯åœ¨$n$ä¸ªå…¬é’¥ä¸­éšè—è‡ªå·±æ‹¥æœ‰ç§é’¥çš„é‚£ä¸ªå…¬é’¥ã€‚ä¸ç¾¤ç­¾åç›¸æ¯”ï¼Œæ²¡æœ‰äº†ç¾¤ç®¡ç†å‘˜è¿™ä¸ªé™åˆ¶ï¼Œå› æ­¤ä½¿å¾—ç­¾åä¸€å®šç¨‹åº¦ä¸Šæ— æ³•ç¡®å®šæ˜¯ç”±å“ªä¸ªæˆå‘˜ç­¾çš„ã€‚

> è¿™é‡Œçš„ç¯çš„æ„æ€æ˜¯ï¼šå…¬é’¥åºåˆ—æ„æˆä¸€ä¸ªç¯ï¼Œæœ¬æ¥åœ¨ç”Ÿæˆç­¾åçš„æ—¶å€™åªæ„æˆä¸€æ¡é“¾ï¼Œä½†æ˜¯å› ä¸ºè‡ªèº«çŸ¥é“ç§é’¥ï¼Œå¯ä»¥æ„é€ å‡ºç›¸åº”çš„ç­¾åï¼Œä½¿å¾—ç­¾åæ„æˆä¸€ä¸ªç¯ã€‚ï¼ˆè¿™é‡Œçš„ç¯ä¸æ˜¯æŠ½è±¡ä»£æ•°ä¸­çš„ç¯ï¼Œåªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„å®šä¹‰ï¼‰

![](crypto/images/ring_signature.png)

å› ä¸ºç¯ç­¾ååœ¨éšç§ä¿æŠ¤ä¸­ç”¨å¾—æ¯”è¾ƒå¤šï¼Œç½‘ä¸Šéƒ½æœ‰æ¯”è¾ƒè¯¦ç»†çš„æè¿°ï¼Œè¿™é‡Œå°±æè¿°ä¸€ä¸‹å…¶æŠ½è±¡çš„åŸç†ã€‚
* KeyGen($1^{\lambda}$)
  * å‡è®¾ç¯ç­¾åéœ€è¦$n$ä¸ªæˆå‘˜ï¼Œåˆ™æ”¶é›†$n-1$ä¸ªå…¬é’¥$P_1,...,P_{n-1}$å¹¶ç»“åˆè‡ªèº«çš„å…¬é’¥$P_n$æ„æˆç¯$R=\{P_1,...,P_n\}$ã€‚
* Sign(sk,s,M,R)
  * skä¸ºç§é’¥ï¼Œsä¸ºä½ç½®(ä¸é‡è¦,å› ä¸ºæ„æˆç¯ï¼Œè‡ªèº«ä¸€å®šæ˜¯æœ€åä¸€ä¸ª)ï¼ŒMä¸ºéœ€è¦ç­¾åçš„æ¶ˆæ¯ã€‚
  * ä»¤åŠ å¯†ç®—æ³•è®°ä¸º$E_{k'}$ï¼Œå…¶ä¸­$k'$å¯ä»¥ç”±æ¶ˆæ¯Mç”Ÿæˆï¼Œä¹Ÿå¯ä»¥åœ¨åŠ å¯†çš„æ—¶å€™é™„ä¸Šï¼Œåæ­£å¿…é¡»è¦å’Œæ¶ˆæ¯Mæœ‰å…³ã€‚è®°$f_i$ä¸ºä¸å…¬é’¥$P_i$æœ‰å…³çš„å‡½æ•°ã€‚
  * éšæœºé€‰å–ä¸€ä¸ªå€¼ä½œä¸ºåˆå§‹å€¼$v$ï¼Œè®¡ç®— $e_{s+1} = E_{k'}(f_{s}(v))$ã€‚
  * éšæœºé€‰å–éšæœºæ•°$k_{s+1}$ï¼Œè®¡ç®—$e_{s+2}=E_{k'}(f_{s+1}(k_{s+1} \oplus e_{s+1}))$ã€‚
  * ...
  * éšæœºé€‰å–éšæœºæ•°$k_{s-2}$ï¼Œè®¡ç®—$e_{s-1}=E_{k'}(f_{s-2}(k_{s-2} \oplus e_{s-2}))$ã€‚
  * éšæœºé€‰å–éšæœºæ•°$k_{s-1}$ï¼Œè®¡ç®—$e_{s}=E_{k'}(f_{s-1}(k_{s-1} \oplus e_{s-1}))$ã€‚
  * é€šè¿‡ç§é’¥skï¼Œè§£å¾—$k_{s}$æ˜¯æ–¹ç¨‹$E_{k'}(f_{s}(v)) = e_{s+1} = E_{k'}(f_{s}(k_{s} \oplus e_{s}))$çš„è§£ã€‚ï¼ˆ**å…³é”®æ­¥éª¤**ï¼‰
  * è¾“å‡ºç­¾å$S = \{k_1,k_2,...,k_n,e_1,e_2,...,e_n\}$ã€‚
* Verify(R,S,M)
  * å¯¹äº$1\leq i\leq n$ï¼Œåˆ¤æ–­$e_{i} == E_{k'}(f_{i-1}(k_{i-1} \oplus e_{i-1}))$ï¼Œè‹¥$i-1==0$ï¼Œåˆ™ä»¤$i-1=n$ã€‚
  * è‹¥éƒ½æ»¡è¶³ï¼Œåˆ™ç­¾ååˆæ³•ã€‚

* å¸¸è§çš„ç¯ç­¾å
  * AOS(Abe-Ohkubo-Suzuki) ï¼ˆåŒºå—é“¾éšç§é¢†åŸŸï¼‰
  * Borromean ï¼ˆé—¨ç½—å¸ï¼‰

* å‚è€ƒèµ„æ–™ï¼š
  * https://blog.csdn.net/qq_31739317/article/details/103706858
  * https://blog.csdn.net/jason_cuijiahui/article/details/84933744
  * å†¯ç¿°æ–‡, åˆ˜å»ºä¼Ÿ, ä¼å‰çº¢. åé‡å­å®‰å…¨çš„ç¾¤ç­¾åå’Œç¯ç­¾å[J]. å¯†ç å­¦æŠ¥, 2021, 8(2): 183â€“201. [DOI: 10.13868/j.cnki.jcr.000430]  **ä¸€ç¯‡ç»¼è¿°**

### OTï¼ˆOblivious Transferï¼Œä¸ç»æ„ä¼ è¾“ï¼‰

* å‚è€ƒèµ„æ–™ï¼š
    * https://en.wikipedia.org/wiki/Oblivious_transfer
      * https://www.zhihu.com/column/c_1409550861031251968 æ›´åå‘äºå­¦æœ¯çš„OT

**1-2 oblivious Transfer**: æ–¹æ¡ˆè§ç¬¬ä¸€ç¯‡å‚è€ƒèµ„æ–™ï¼Œå†™å¾—éå¸¸çš„æ¸…æ™°äº†ã€‚

å…¶ä¸­ä¸€ç§æ”»å‡»æ–¹å¼ï¼š
ç°åœ¨å·²çŸ¥$N,e,x_0,x_1,v$ï¼Œæˆ‘ä»¬å¯ä»¥ç²¾å¿ƒæ„é€ $v$ä½¿å¾—Aliceè®¡ç®—å‡ºçš„$k_0 = k'k_1$ï¼Œå…¶ä¸­$k'$æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å› æ­¤è”ç«‹æ–¹ç¨‹$$\begin{cases} k_0 = k'k_1\ mod\ N \\ k_0^e \equiv v - x_0\ mod\ N \\ k_1^e \equiv v - x_1\ mod\ N \end{cases}$$ è§£å¾—$v = (k'^ex_1 - x_0) / (k'^e - 1) \ mod\ N$ã€‚å› æ­¤å¯ä»¥è®¡ç®—å‡º$$m \equiv m'_0k' - m'_1 \equiv k'x - y\ (mod\ N)$$






## åŒºå—é“¾ä¸­çš„å¯†ç æŠ€æœ¯

### ç›²ç­¾å (Blind Signature)

* éå½¢å¼åŒ–å®šä¹‰ï¼šä¸€ç§æ•°å­—ç­¾åçš„æ–¹å¼,åœ¨æ¶ˆæ¯å†…å®¹è¢«ç­¾åä¹‹å‰,å¯¹äºç­¾åè€…æ¥è¯´æ¶ˆæ¯å†…å®¹æ˜¯ä¸å¯è§çš„ã€‚ **ç±»æ¯”ä¾‹å­**:å¯¹æ–‡ä»¶ç­¾åå°±æ˜¯é€šè¿‡åœ¨ä¿¡å°é‡Œæ”¾ä¸€å¼ å¤å†™çº¸ï¼Œç­¾åè€…åœ¨ä¿¡å°ä¸Šç­¾åæ—¶ï¼Œä»–çš„ç­¾åä¾¿é€è¿‡å¤å†™çº¸ç­¾åˆ°æ–‡ä»¶ä¸Šã€‚

* æ€§è´¨
  1. ç­¾åè€…å¯¹å…¶æ‰€ç­¾ç½²çš„æ¶ˆæ¯æ˜¯ä¸å¯è§çš„ï¼Œå³ç­¾åè€…ä¸çŸ¥é“ä»–æ‰€ç­¾ç½²æ¶ˆæ¯çš„å…·ä½“å†…å®¹ã€‚
  2. ç­¾åæ¶ˆæ¯ä¸å¯è¿½è¸ªï¼Œå³å½“ç­¾åæ¶ˆæ¯è¢«å…¬å¸ƒåï¼Œç­¾åè€…æ— æ³•çŸ¥é“è¿™æ˜¯ä»–å“ªæ¬¡çš„ç­¾ç½²çš„ã€‚

* ç›²ç­¾åæ¨¡å‹ï¼šæœ¬è´¨ä¸Šå°±æ˜¯éªŒè¯è€…å¯¹æ¶ˆæ¯è¿›è¡Œç›²åŒ–ï¼Œç„¶åæ”¶åˆ°ç­¾åè€…ç­¾ååå¯¹æ¶ˆæ¯è¿›è¡Œå»ç›²ã€‚

* RSAç›²ç­¾åï¼š
  1. ç›²åŒ–æ¶ˆæ¯ï¼š$m'\equiv mr^e\ mod\ N$
  2. ç­¾åæ¶ˆæ¯ï¼š$s'\equiv (m')^d\ mod\ N$
  3. å»ç›²æ¶ˆæ¯ï¼š$s\equiv s'\cdot r^{-1}\ mod\ N$
  4. æ­¤æ—¶$s$å°±æ˜¯ç­¾åè€…å¯¹æ¶ˆæ¯$m$çš„ç­¾åã€‚ 


* å‚è€ƒèµ„æ–™ï¼šhttps://blog.csdn.net/zhang_hui_cs/article/details/8728776


### keccak256 å“ˆå¸Œç®—æ³•

ç›®å‰ä¸ºæ­¢æ­¤å‡½æ•°çš„å®‰å…¨æ€§ã€çµæ´»æ€§ã€é«˜æ•ˆæ€§è¿˜æ˜¯å¯ä»¥çš„ã€‚

```python
from Crypto.Hash import keccak

keccak_hash = keccak.new(digest_bits=512)   # 224, 256, 384, 512
keccak_hash.update(b'Some data')
print keccak_hash.hexdigest()
```

## åŒºå—é“¾å‰æ²¿éšç§æŠ€æœ¯
|åç§°|	ç±»å‹|	æŠ€æœ¯å®ç°|
|:---:|:---:|:---:|
|Zcash|	UTXO|	é›¶çŸ¥è¯†è¯æ˜æŠ€æœ¯zk-SNARK|
|é—¨ç½—å¸|	UTXO|	ç¯ç­¾åæŠ€æœ¯Borromean|
|Beam|	UTXO|	Mimble-Wimble|
|EYBlockchain|	Account|	åŸºäºåˆçº¦çš„zk-SNARK|
|AZTEC|	Account|	åŒæ€è¯æ˜&&rangeproof|
|Zether|	Account|	Î£-Bullets ZK-proofé›¶çŸ¥è¯†è¯æ˜|
|PGC|	Account|	bulletproofé›¶çŸ¥è¯†è¯æ˜|

* å‚è€ƒèµ„æ–™
  * https://blog.csdn.net/qq_31739317/article/details/103706898