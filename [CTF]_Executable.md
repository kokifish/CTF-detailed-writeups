# Executable

> 记录：可执行文件相关的内容，未来可能包含编译链接的过程
>
> 通常CTF中不会直接考察可执行文件的知识，但在做reverse, pwn, misc, android可能会有题目涉及到可执行文件相关的知识

可执行文件在计算机科学中指一种内容可被电脑解释为程序的电脑文件。——zh.wiki



# Linux





## ELF

ELF (Executable and Linkable Format) 文件，即 Linux 中的目标文件，主要有以下三种类型

1. 可重定位文件 Relocatable File: 含编译器生成的代码及数据。链接器会将它与其它目标文件链接起来从而创建可执行文件或者共享目标文件。e.g. `x.o` 。
2. 可执行文件 Executable File: 即通常在 Linux 中执行的程序
3. 共享目标文件 Shared Object File: 含代码和数据的库文件，e.g. `x.so` 。一般有两种使用情景：
   - 链接器 (Link eDitor, ld ) 可能会处理它和其它可重定位文件以及共享目标文件，生成另外一个目标文件。
   - 动态链接器 (Dynamic Linker) 将它与可执行文件以及其它共享目标组合在一起生成进程镜像。

目标文件由汇编器和链接器创建，是文本程序的二进制形式，可以直接在处理器上运行。那些需要虚拟机才能够执行的程序 (Java) 不属于这一范围

### Format

- 目标文件既会参与程序链接又会参与程序执行。出于方便性和效率考虑，根据过程的不同，目标文件格式提供了其内容的两种并行视图: 链接视图与执行视图

![](https://raw.githubusercontent.com/hex-16/pictures/master/CTF_pic/object_file_format.png)

**链接视图**：文件开始处是 ELF 头部（ **ELF Header**），它给出了整个文件的组织情况。

如果程序头部表（Program Header Table）存在的话，它会告诉系统如何创建进程。用于生成进程的目标文件必须具有程序头部表，但是重定位文件不需要这个表。

节区部分包含在链接视图中要使用的大部分信息：指令、数据、符号表、重定位信息等等。

节区头部表（Section Header Table）包含了描述文件节区的信息，每个节区在表中都有一个表项，会给出节区名称、节区大小等信息。用于链接的目标文件必须有节区头部表，其它目标文件则无所谓，可以有，也可以没有。

对于**执行视图**来说，其主要的不同点在于没有了 section，而有了多个 segment。其实这里的 segment 大都是来源于链接视图中的 section。

>  尽管图中是按照 ELF 头，程序头部表，节区，节区头部表的顺序排列的。但实际上除了 ELF 头部表以外，其它部分都没有严格的的顺序。



![](https://raw.githubusercontent.com/hex-16/pictures/master/CTF_pic/ELF-Walkthrough.png)



### Loader

程序加载过程其实就是系统创建或者或者扩充进程镜的过程。它只是按照一定的规则把文件的段拷贝到虚拟内存段中。进程只有在执行的过程中使用了对应的逻辑页面时，才会申请相应的物理页面。通常来说，一个进程中有很多页是没有被引用的。因此，延迟物理读写可以提高系统的性能。为了达到这样的效率，可执行文件以及共享目标文件所拥有的段的文件偏移以及虚拟地址必须是合适的，也就是说他们必须是页大小的整数倍。



# Windows